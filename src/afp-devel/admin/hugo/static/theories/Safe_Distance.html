<div id="Safe_Distance">
<div class="head">
<h1>Theory Safe_Distance</h1>
</div>
<pre class="source"><span class="comment1">✐‹creator "Albert Rizaldi" "Fabian Immler›</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Safe Distance›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Safe_Distance
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
  <a href="../Sturm_Sequences/Sturm.html">Sturm_Sequences.Sturm</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory is about formalising the safe distance rule. The safe distance rule is obtained
from Vienna Convention which basically states the following thing.

  ``The car at all times must maintain a safe distance towards the vehicle in front of it,
    such that whenever the vehicle in front and the ego vehicle apply maximum deceleration,
    there will not be a collision.''

To formalise this safe distance rule we have to define first what is a safe distance.
To define this safe distance, we have to model the physics of the movement of the vehicle.
The following model is sufficient.

  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s = s<span class="hidden">⇩</span><sub>0</sub> + v<span class="hidden">⇩</span><sub>0</sub> * t + 1 / 2 * a<span class="hidden">⇩</span><sub>0</sub> * t<span class="hidden">⇧</span><sup>2</sup>›</span></span></span></span>

Assumptions in this model are :
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Both vehicles are assumed to be point mass. The exact location of the ego vehicle
    is the front-most occupancy of the ego vehicle. Similarly for the other vehicle,
    its exact location is the rearmost occupancy of the other vehicle.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> Both cars can never drive backward.
›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span><span class="main">]</span> <span class="main">=</span> div_mult_self1 div_mult_self2 div_mult_self3 div_mult_self4

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quadratic Equations›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> discriminant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (R&lt;1 * (R&lt;1 * [2*a*x + b]^2))))"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quadratic_eq_factoring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> D <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">=</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> sqrt <span class="free">D</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span> <span class="main">-</span> sqrt <span class="free">D</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nn
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D x1 x2<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms power2_eq_square power3_eq_cube <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quadratic_eq_zeroes_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> D <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">=</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> sqrt <span class="free">D</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span> <span class="main">-</span> sqrt <span class="free">D</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">D</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">⟷</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> quadratic_eq_factoring<span class="main">[</span><span class="operator">OF</span> D _ x1 x2 a<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> discriminant<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> a
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Convexity Condition›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_convex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> ge   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">p</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">p</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less ge <span class="keyword1"><span class="command">unfolding</span></span> p_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * (A&lt;1 * A&lt;2)) * R&lt;1) + (((A&lt;2 * R&lt;1) * (R&lt;1/4 * [y + ~1*z]^2)) +
    (((A&lt;=1 * R&lt;1) * (R&lt;1 * [x + ~1*y]^2)) + (((A&lt;=1 * (A&lt;0 * (A&lt;1 * R&lt;1))) * (R&lt;1/4 * [1]^2)) +
    (((A&lt;=0 * R&lt;1) * (R&lt;1/4 * [~1*y^2 + x*y + ~1*x*z + y*z]^2)) +
    ((A&lt;=0 * (A&lt;0 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [x + ~1/2*y + ~1/2*z]^2))))))))"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_in</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">..</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">}</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quadroot_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quadroot_in</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> root_in <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_iff_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">⟷</span> finite <span class="free">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> quadroot_in_sturm<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">M</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="free">m</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">∧</span> poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span>
    count_roots_between <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="free">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">M</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quadroot_in_def root_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">∧</span> poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quadroot_in_def root_in_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square count_roots_between_correct card_iff_exists<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">m</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">∧</span> poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">m</span> <span class="main">&gt;</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">&lt;</span> count_roots_between <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> pnz<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> count_roots_between_correct card_iff_exists
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> poly <span class="main"><span class="main">[:</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">b</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">a</span></span><span class="main"><span class="main">:]</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_finite<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nz<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> pnz
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_between_correct quadroot_in_def root_in_def card_iff_exists
          <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="free">m</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quadroot_in_def count_roots_between_correct root_in_def card_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">∨</span>
     <span class="free">m</span> <span class="main">≤</span> <span class="free">M</span> <span class="main">∧</span> poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span>
     <span class="main">0</span> <span class="main">&lt;</span> count_roots_between <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="free">m</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> check_quadroot_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">M</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="keyword1">in</span> <span class="free">m</span> <span class="main">&gt;</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quadroot_in_def Let_def root_in_def assms <span class="dynamic"><span class="dynamic">field_split_simps</span></span>
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">c</span> <span class="main">/</span> <span class="free">b</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="keyword1">in</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quadroot_in_def Let_def root_in_def assms <span class="dynamic"><span class="dynamic">field_split_simps</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">c</span> <span class="main">/</span> <span class="free">b</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult_le_cancel_left_neg add_eq_0_iff mult_le_cancel_iff2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def not_less not_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> check_quadroot_nonlinear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">D</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">in</span> <span class="bound">D</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> sqrt <span class="bound">D</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">)</span> <span class="keyword1">in</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">M</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span> <span class="main">-</span> sqrt <span class="bound">D</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">)</span> <span class="keyword1">in</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quadroot_in_def Let_def root_in_def quadratic_eq_zeroes_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl refl assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ncheck_quadroot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span><span class="main">¬</span>quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span>quadroot_in <span class="free">m</span> <span class="free">M</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Movement›</span></span>

<span class="keyword1"><span class="command">locale</span></span> movement <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">v</span> <span class="free">s0</span> <span class="main">::</span> <span class="quoted">real</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Function to compute the distance using the equation

    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s(t) = s<span class="hidden">⇩</span><sub>0</sub> + v<span class="hidden">⇩</span><sub>0</sub> * t + 1 / 2 * a<span class="hidden">⇩</span><sub>0</sub> * t<span class="hidden">⇧</span><sup>2</sup>›</span></span></span></span>
  
  Input parameters: 
   <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s<span class="hidden">⇩</span><sub>0</sub>›</span></span></span></span>: initial distance
   <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v<span class="hidden">⇩</span><sub>0</sub>›</span></span></span></span>: initial velocity (positive means forward direction and the converse is true)
   <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>: acceleration (positive for increasing and negative for decreasing)
   <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t›</span></span></span></span>: time 

  For the time <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t &lt; 0›</span></span></span></span>, we assume the output of the function is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s<span class="hidden">⇩</span><sub>0</sub>›</span></span></span></span>. Otherwise, the output
  is calculated according to the equation above.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Continuous Dynamics›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">s0</span> <span class="main">+</span> <span class="free">v</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_all_zeroes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">=</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">s0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"p <span class="free">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">D</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span> <span class="main">+</span> sqrt <span class="free">D</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span> <span class="main">-</span> sqrt <span class="free">D</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">s0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="free">s0</span> <span class="main">/</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quadratic_eq_zeroes_iff<span class="main">[</span><span class="operator">OF</span> refl refl refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">s0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.p_def D power2_eq_square <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p <span class="main">0</span> <span class="main">=</span> <span class="free">s0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_continuous<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> p"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_p<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont p <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_continuous<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">v</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p'_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"p' <span class="main">0</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_has_vector_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>p <span class="keyword1">has_vector_derivative</span> p' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> p'_def has_vector_derivative_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>p <span class="keyword1">has_real_derivative</span> p' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_has_vector_derivative
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p''</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">p''</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">a</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p'_has_vector_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>p' <span class="keyword1">has_vector_derivative</span> p'' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> p''_def has_vector_derivative_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p'_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>p' <span class="keyword1">has_real_derivative</span> p'' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p'_has_vector_derivative
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_stop</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">t_stop</span> <span class="main">=</span> <span class="main">-</span> <span class="free">v</span> <span class="main">/</span> <span class="free">a</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p'_stop_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"p' t_stop <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def t_stop_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p'_pos_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"p' <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">-</span><span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">v</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_t_stop_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> t_stop <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> p' <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">else</span> p' <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span> t_stop_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p'_continuous<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> p'"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_p'<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont p' <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p'_continuous<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_max</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">p_max</span> <span class="main">=</span> p t_stop"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> p_t_stop <span class="main">=</span> p_max_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> p_max_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"p_max <span class="main">=</span> <span class="free">s0</span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_max_def p_def t_stop_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Hybrid Dynamics›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>     <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> <span class="main">0</span>      <span class="keyword1">then</span> <span class="free">s0</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> t_stop <span class="keyword1">then</span> p <span class="free"><span class="bound"><span class="entity">t</span></span></span>
          <span class="keyword1">else</span>                p_max<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">s0</span> <span class="main">+</span> <span class="free">v</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">q'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">q'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">v</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> init_q<span class="main">:</span> <span class="quoted"><span class="quoted">"q <span class="main">0</span> <span class="main">=</span> <span class="free">s0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> q_continuous<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> q"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_q<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont q <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> q_continuous<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> q_has_vector_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>q <span class="keyword1">has_vector_derivative</span> q' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> q'_def has_vector_derivative_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> q_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>q <span class="keyword1">has_real_derivative</span> q' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> q_has_vector_derivative
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_cond_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> s <span class="free">t</span> <span class="main">=</span> <span class="free">s0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">≤</span> t_stop <span class="main">⟹</span> s <span class="free">t</span> <span class="main">=</span> p <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> braking_movement <span class="main">=</span> movement <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> decel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg_vel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> t_stop"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel nonneg_vel
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_stop_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> t_stop"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel nonneg_vel assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_stop_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms decel
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_stop_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_zero_not_moving<span class="main">:</span> <span class="quoted"><span class="quoted">"t_stop <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> q <span class="free">t</span> <span class="main">=</span> <span class="free">s0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> t_stop_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">s_stop</span> <span class="main">≡</span> s t_stop"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_t_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"s_stop <span class="main">=</span> p_max"</span></span>
  <span class="keyword1"><span class="command">using</span></span> t_stop_nonneg
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def t_stop_def p_max_def p_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s0_le_s_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≤</span> s_stop"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"s_stop"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"p_max"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_max <span class="main">=</span> s_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s_t_stop<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≤</span> p_max"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"p_max"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">s0</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">v</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span> <span class="main"><span class="main">/</span></span> <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">/</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">s0</span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> p_max"</span></span> <span class="keyword1"><span class="command">using</span></span> p_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decel zero_le_square<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> zero_le_divide_iff zero_le_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">≤</span> <span class="free">s0</span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> t_stop <span class="main">⟹</span> p <span class="free">x</span> <span class="main">≤</span> p <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> t_stop"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v</span> <span class="main">/</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs0</span> <span class="main">≤</span> <span class="var">?rhs0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs0</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">≥</span> <span class="var">?rhs0</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sos</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" p <span class="free">x</span> <span class="main">≤</span> p <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_max_def p_def t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> t_stop <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> p <span class="free">y</span> <span class="main">≤</span> p <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">≥</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sos</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"p <span class="free">y</span> <span class="main">≤</span> p <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_max_def p_def t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_strict_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> t_stop <span class="main">⟹</span> p <span class="free">x</span> <span class="main">&lt;</span> p <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> t_stop"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v</span> <span class="main">/</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs0</span> <span class="main">&lt;</span> <span class="var">?rhs0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs0</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="var">?rhs0</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sos</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" p <span class="free">x</span> <span class="main">&lt;</span> p <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_max_def p_def t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_strict_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> t_stop <span class="main">≤</span> <span class="free">x</span><span class="main">⟹</span> p <span class="free">y</span> <span class="main">&lt;</span> p <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sos</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"p <span class="free">y</span> <span class="main">&lt;</span> p <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_max_def p_def t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_max<span class="main">:</span> <span class="quoted"><span class="quoted">"p <span class="free">x</span> <span class="main">≤</span> p_max"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> p_max_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> t_stop"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> p_mono p_antimono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_s<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> s"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> s_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> t_stop_nonneg
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">T</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{..</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span><span class="main"><span class="main"><span class="main">∪</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">..</span></span></span> t_stop<span class="main"><span class="main"><span class="main">}</span></span></span> <span class="main"><span class="main"><span class="main">∪</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span>t_stop <span class="main"><span class="main"><span class="main">..}</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> continuous_on_If<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_continuous p_max_def antisym_conv<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_s<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont s <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_s<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> t_stop <span class="keyword1">then</span> p' <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_has_real_derivative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_real_derivative</span> s' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> t_stop <span class="main">⟷</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> t_stop<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_stop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> t_stop<span class="main">}</span> <span class="keyword1">then</span> p <span class="bound">t</span> <span class="keyword1">else</span> p_max<span class="main">)</span> <span class="keyword1">has_real_derivative</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>t_stop<span class="main">}</span> <span class="keyword1">then</span> p' <span class="free">t</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> s_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> s'_def 
      has_field_derivative_iff_has_vector_derivative
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_If_within_closures<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>t_stop <span class="main"><span class="main">..}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> t_stop›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms p'_stop_zero p_t_stop max_def insert_absorb
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> p_has_vector_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> _ _ this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_vector_derivative_def has_field_derivative_iff_has_vector_derivative
      s'_def s_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_derivative_transform<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms s_def p_max_def t_stop_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_has_vector_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_vector_derivative</span> s' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s_has_real_derivative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
   
<span class="keyword1"><span class="command">lemma</span></span> s_has_field_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">/</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_field_derivative</span> s' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s_has_vector_derivative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> s_has_real_derivative_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_real_derivative</span> s' <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_real_derivative</span> s' <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span> <span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> s_has_real_derivative<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> divide_nonneg_nonpos<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_real_derivative</span> s' <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s <span class="keyword1">has_real_derivative</span> s' <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> at_within_open<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
                   
<span class="keyword1"><span class="command">lemma</span></span> s_delayed_has_field_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> s <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> s <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DERIV_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"s"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">δ</span>"</span></span><span class="main">]</span> s_has_real_derivative_at 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> s <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_field_derivative_at_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> s_delayed_has_vector_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> s <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s_delayed_has_field_derivative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>  
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> s' <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s'_def p'_def t_stop_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> s'_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> t_stop <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> s' <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_neq_trans s'_nonneg<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s'_def p'_def t_stop_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Monotonicity of Movement›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"s <span class="free">t</span> <span class="main">≥</span> s <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> assms p_max<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_strict_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> t_stop"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"s <span class="free">u</span> <span class="main">&lt;</span> s <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> assms p_max<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_antimono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"s <span class="free">y</span> <span class="main">≤</span> s <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"s <span class="free">y</span> <span class="main">≤</span> p_max"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s_def p_max_eq
    <span class="keyword1"><span class="command">using</span></span> p_max_def p_max_eq s0_le_s_stop s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> s <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> s_mono s_t_stop t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"s <span class="free">y</span> <span class="main">≤</span> s <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> init_s <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> s <span class="free">t</span> <span class="main">=</span> <span class="free">s0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decel nonneg_vel <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> s_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> q_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">s0</span> <span class="main">≤</span> q <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> nonneg_vel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> q_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> q <span class="free">x</span> <span class="main">≤</span> q <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> nonneg_vel <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Maximum at Stopping Time›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_max<span class="main">:</span> <span class="quoted"><span class="quoted">"s <span class="free">x</span> <span class="main">≤</span> s_stop"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_max<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> p_max<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_eq_s_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"NO_MATCH t_stop <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> t_stop <span class="main">⟹</span> s <span class="free">x</span> <span class="main">=</span> s_stop"</span></span>
  <span class="keyword1"><span class="command">using</span></span> t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def p_max_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Safe Distance›</span></span>

<span class="keyword1"><span class="command">locale</span></span> safe_distance <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg_vel_ego   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg_vel_other <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> decelerate_ego   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> decelerate_other <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_front         <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> hyps <span class="main">=</span>
  nonneg_vel_ego   
  nonneg_vel_other 
  decelerate_ego   
  decelerate_other 
  in_front

<span class="keyword1"><span class="command">sublocale</span></span> ego<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> hyps<span class="main">)</span>
<span class="keyword1"><span class="command">sublocale</span></span> other<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> hyps<span class="main">)</span>
<span class="keyword1"><span class="command">sublocale</span></span> ego_other<span class="main">:</span> movement <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Collision›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">collision</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">collision</span> <span class="free"><span class="bound"><span class="entity">time_set</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">time_set</span></span></span><span class="main">.</span> ego.s <span class="bound">t</span> <span class="main">=</span> other.s <span class="bound">t</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_collision</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">no_collision</span> <span class="free"><span class="bound"><span class="entity">time_set</span></span></span> <span class="main">≡</span> <span class="main">¬</span> collision <span class="free"><span class="bound"><span class="entity">time_set</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_collision_initially <span class="main">:</span> <span class="quoted"><span class="quoted">"no_collision <span class="main">{..</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> decelerate_ego nonneg_vel_ego
  <span class="keyword1"><span class="command">using</span></span> decelerate_other nonneg_vel_other in_front
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> collision_def ego.s_def other.s_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> no_collisionI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> ego.s <span class="bound">t</span> <span class="main">≠</span> other.s <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> no_collision <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> collision_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> cond_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟹</span> no_collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> no_collisionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.s <span class="skolem">t</span> <span class="main">≤</span> ego.s_stop"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ego.s_max<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> other.s <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> other.init_s<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> other.s <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> hyps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> other.s_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ego.s <span class="skolem">t</span> <span class="main">≠</span> other.s <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ego_other_strict_ivt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ego.s <span class="free">t</span> <span class="main">&gt;</span> other.s <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟹</span> ego.s <span class="main">0</span> <span class="main">≤</span> other.s <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> movement.s_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms in_front
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">∧</span> other.s <span class="bound">x</span> <span class="main">-</span> ego.s <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IVT2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_diff other.isCont_s ego.isCont_s<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> collision_def Bex_def order.order_iff_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def ego.init_s other.init_s <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"collision <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">t</span> <span class="main">⟹</span> collision <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ego_other_ivt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ego.s <span class="free">t</span> <span class="main">≥</span> other.s <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ego.s <span class="free">t</span> <span class="main">&gt;</span> other.s <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ego_other_strict_ivt<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> collision_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> hyps assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def ego.init_s other.init_s<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> cond_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">≥</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> collision_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span> <span class="main"><span class="main">..}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span> <span class="main"><span class="main">..</span></span> max ego.t_stop other.t_stop<span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ego_other_ivt<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"max ego.t_stop other.t_stop"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_eq_s_stop other.s_eq_s_stop<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">D2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D2</span> <span class="main">≡</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">t<span class="hidden">⇩</span><sub>D</sub>'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t<span class="hidden">⇩</span><sub>D</sub>'</span> <span class="main">≡</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ego.s_stop <span class="main">-</span> other.s_stop<span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pos_via_half_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dist <span class="free">a</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_real_def abs_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_within_p<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">t</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> ego.p <span class="bound">t</span> <span class="main">=</span> other.p <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> ego.t_stop <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> other.t_stop<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_def other.s_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms hyps ego.t_stop_nonneg other.t_stop_nonneg
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_def other.s_def ego.s_t_stop other.s_t_stop ego.p_t_stop other.p_t_stop not_le
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"ego.t_stop <span class="main">≤</span> other.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.t_stop <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> other.s_strict_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 1
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s ego.t_stop <span class="main">&lt;</span> other.s <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ego.s ego.t_stop"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ego.s_t_stop ego.t_stop_nonneg 1 other.s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s ego.t_stop <span class="main">&lt;</span> ego.s ego.t_stop"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> ego_other_strict_ivt<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> le in_front
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> collision_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.s_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.p_max <span class="main">=</span> ego.p <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ego.p ego.t_stop"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ego.p_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ego.p_max"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego.p_t_stop<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">&lt;</span> other.p_max›</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">t</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> ego.p <span class="bound">t</span> <span class="main">=</span> other.p <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> ego.t_stop <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> other.t_stop"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> other.t_stop"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> other.p_t_stop <span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ego.p_max not_le<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> ego.t_stop"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego.p_t_stop<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> other.p' <span class="bound">t</span> <span class="main">-</span> ego.p' <span class="bound">t</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="var">?d</span> ego.t_stop <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> d_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="var">?d</span> ego.t_stop"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ego.t_stop_def other.p'_def ego.p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> ego.t_stop <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego.p'_stop_zero other.p'_pos_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego.t_stop_def other.t_stop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> d_cont<span class="main">[</span><span class="operator">unfolded</span> continuous_at_eps_delta<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> dist <span class="bound">x</span> ego.t_stop <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="var">?d</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d'_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> ego.t_stop <span class="main">&gt;</span> <span class="main">0</span>›</span></span> pos_via_half_dist
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> ego.t_stop <span class="main">-</span> min <span class="main">(</span>ego.t_stop <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ego.t_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.p <span class="skolem">t'</span> <span class="main">-</span> ego.p <span class="skolem">t'</span> <span class="main">&lt;</span> other.p ego.t_stop <span class="main">-</span> ego.p ego.t_stop"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_pos_imp_increasing<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t'_def e min_def <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> ego.t_stop›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> e<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t'_def dist_real_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego.p_t_stop<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"other.p <span class="skolem">t'</span> <span class="main">&lt;</span> ego.p <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t'_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> min_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">&lt;</span> ego.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t'_def <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹ego.t_stop <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> less_le_trans<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&lt;</span> ego.t_stop›</span></span> <span class="quoted"><span class="quoted">‹ego.t_stop <span class="main">≤</span> other.t_stop›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">&lt;</span> other.t_stop"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> ego_other_strict_ivt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> less
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">t'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&lt;</span> ego.t_stop›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&lt;</span> other.t_stop›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> other.s_def ego.s_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&lt;</span> ego.t_stop›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">&lt;</span> other.t_stop›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def ego.s_def other.s_def movement.p_def
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.p_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collision_within_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span> collision <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> collision_within_p<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> collision_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span>
    <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_def other.s_def movement.p_def ego.t_stop_def other.t_stop_def
    <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_excluded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> ego.s <span class="bound">t</span> <span class="main">≠</span> other.s <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> collision <span class="free">S</span> <span class="main">⟷</span> collision <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_within_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span> collision <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> collision_within_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span> <span class="main">⟷</span>
    collision <span class="main">(</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hyps assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> collision_excluded<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_def other.s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> collision_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">;</span></span>
      <span class="operator">force</span>
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_def other.s_def movement.p_def ego.t_stop_def other.t_stop_def
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> D2 <span class="main">∧</span> sqrt D2 <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> movement.s_def movement.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> hyps <span class="main">=</span> hyps this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bounded</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bounded</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> ego.t_stop <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> other.t_stop<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ego_other_conv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">bounded</span> <span class="bound">t</span> <span class="main">⟹</span> ego.p <span class="bound">t</span> <span class="main">=</span> other.p <span class="bound">t</span> <span class="main">⟷</span> ego_other.p <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.p_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> min ego.t_stop other.t_stop<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> D2<span class="main">:</span> <span class="quoted"><span class="quoted">"D2 <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> D2"</span></span>
  <span class="keyword1"><span class="command">note</span></span> D <span class="main">=</span> D_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≡</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≡</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x2_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x1_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> collision_within_less<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> coll_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">=</span> collision <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> D2 <span class="main">∧</span> sqrt D2 <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> D2"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt D2 <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> sol <span class="main">=</span> quadratic_eq_zeroes_iff<span class="main">[</span><span class="operator">OF</span> D2 x1_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> meta_eq_to_obj_eq<span class="main"><span class="main">]</span></span> x2_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> meta_eq_to_obj_eq<span class="main"><span class="main">]</span></span> nz<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> sol<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> D2›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.p <span class="skolem">x2</span> <span class="main">=</span> ego.p <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.p_def other.p_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego_other.p <span class="skolem">x2</span> <span class="main">≥</span> ego_other.p <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> H hyps
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_nonpos_imp_nonincreasing<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
          <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"ego_other.p' <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span>
            <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego_other.p'_def add_nonpos_nonpos mult_nonneg_nonpos<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego_other.p <span class="main">0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego_other.p_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>xtrans<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹other.p <span class="skolem">x2</span> <span class="main">=</span> ego.p <span class="skolem">x2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> movement.p_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">&lt;</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sqrt H hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x2 other.t_stop_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span> power2_eq_square<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>min ego.t_stop other.t_stop<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">&lt;</span> ego.t_stop"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s <span class="skolem">x2</span> <span class="main">=</span> other.p <span class="skolem">x2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> other.s_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ego.p ego.t_stop"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ego.p_antimono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ego.s <span class="skolem">x2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_def ego.p_t_stop<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s <span class="skolem">x2</span> <span class="main">≤</span> ego.s <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> ego_other_ivt<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coll_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> collision_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def ego.s_def other.s_def not_le <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?max</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max ego.t_stop other.t_stop"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?min</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min ego.t_stop other.t_stop"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"collision <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"ego.p <span class="skolem">t</span> <span class="main">=</span> other.p <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?min</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def ego.s_def other.s_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego.t_stop_def other.t_stop_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego_other.p <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.p_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?max</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> hyps assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ego_other.p <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ego_other.p_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">THEN</span> meta_eq_to_obj_eq<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> eop_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ego_other.p <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.p other.t_stop <span class="main">≤</span> ego.p_max"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ego.p_max<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> other.p other.t_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> hyps assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>other.s_def ego.s_def ego.p_t_stop <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> ego_other.p other.t_stop"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>movement.p_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> p_convex<span class="main">[</span><span class="operator">OF</span> eop_eq<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted">other.t_stop</span><span class="main">,</span> <span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹ego_other.p <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">,</span>
        <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">&lt;</span> other.t_stop›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> ego_other.p <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> ego_other.p other.t_stop›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> rewr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹ego_other.p <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span> ego_other.p_all_zeroes<span class="main">[</span><span class="operator">OF</span> D2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> D2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hyps assms
      <span class="keyword1"><span class="command">unfolding</span></span> rewr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> D2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> add_strict_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_split_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹movement.p <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span> in_front  t<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.p_def divide_less_0_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_less_0_iff mult_le_cancel_right mult_mono mult_nonneg_nonneg nonneg_vel_ego<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> disj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">&lt;</span> <span class="var">?min</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">rule</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?min</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> sqrt D2<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="skolem">x2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> x2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> divide_right_mono<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_conv_add_uminus<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹D2 <span class="main">≥</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="main">(</span>xtrans<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?min</span>›</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sqrt D2 <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hyps <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x2 <span class="dynamic"><span class="dynamic">field_split_simps</span></span> other.t_stop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Formalising Safe Distance›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First definition for Safe Distance based on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>cond_1›</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">absolute_safe_distance</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">absolute_safe_distance</span> <span class="main">=</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> absolute_safe_distance<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> absolute_safe_distance"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms hyps absolute_safe_distance_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ego.s_def ego.p_def ego.t_stop_def power_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cond_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First Fallback for Safe Distance.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fst_safe_distance</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fst_safe_distance</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">distance_leq_d2</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">distance_leq_d2</span> <span class="main">=</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> snd_leq_fst_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"distance_leq_d2 <span class="main">≤</span> fst_safe_distance"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span>other.t_stop <span class="main">-</span> ego.t_stop<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> ego.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> other.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> other.t_stop <span class="main">*</span> ego.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> ego.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span>other.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> other.t_stop <span class="main">*</span> ego.t_stop<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> half_gt_zero_iff mult_le_cancel_right<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ego.t_stop_def other.t_stop_def hyps 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">≥</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fst_safe_distance_def distance_leq_d2_def
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst_safe_distance <span class="main">≥</span>  <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">=</span> distance_leq_d2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?LHS</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?LHS</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> distance_leq_d2"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span> distance_leq_d2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> sqrt_D2_leq_stop_time_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> "</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≥</span> distance_leq_d2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sqrt D2 <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> distance_leq_d2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"D2 <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> distance_leq_d2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> distance_leq_d2_def
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> distance_leq_d2 <span class="main">=</span> 
             <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> hyps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> real_le_lsqrt real_sqrt_le_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cond2_imp_pos_vo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> other.s_def other.t_stop_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s_stop <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cond2_imp_gt_fst_sd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst_safe_distance <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> fst_safe_distance_def assms ego.s_def ego.t_stop_pos<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> ego.p_def ego.t_stop_def
       other.s_def other.t_stop_pos<span class="main">[</span><span class="operator">OF</span> cond2_imp_pos_vo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> other.p_def other.t_stop_def hyps
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> fst_safe_distance_def  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst_safe_distance <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_nonneg_neg hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Second Fallback for Safe Distance.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">snd_safe_distance</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">snd_safe_distance</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_leq_snd_safe_distance<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"fst_safe_distance <span class="main">≤</span> snd_safe_distance"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_nonpos_nonpos<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> mult_right_mono<span class="main">[</span><span class="operator">OF</span> 1 this<span class="main">]</span> hyps
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>  <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> hyps <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> divide_right_mono<span class="main">[</span><span class="operator">OF</span> 2 this<span class="main">]</span> assms fst_safe_distance_def snd_safe_distance_def
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> snd_safe_distance_iff_nonneg_D2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> snd_safe_distance <span class="main">⟷</span> <span class="main">0</span> <span class="main">≤</span> D2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> snd_safe_distance_def assms pos_le_divide_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> snd_safe_distance <span class="main">⟷</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">≤</span> D2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_diff_neg_means_leq_D2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> D2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> sqrt D2 <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> only_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> sqrt D2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> only_if <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> sqrt D2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> if_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> sqrt D2"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cond2_imp_gt_fst_sd<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> snd_leq_fst_exp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distance_leq_d2 <span class="main">≤</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> if_part <span class="keyword2"><span class="keyword">and</span></span> sqrt_D2_leq_stop_time_diff <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> _ <span class="quoted"><span class="quoted">‹distance_leq_d2 <span class="main">≤</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>›</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.s_stop"</span></span> <span class="quoted"><span class="quoted">"ego.s_stop <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> snd_safe_distance <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∨</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≥</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> cond_3<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∨</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∨</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> snd_safe_distance_iff_nonneg_D2 <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> snd_safe_distance <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> D2 <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> t_stop_diff_neg_means_leq_D2<span class="main">[</span><span class="operator">OF</span> assms <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> D2 <span class="main">∧</span> sqrt D2 <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">with</span></span> 1 cond_3<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> ego.t_stop <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> other.t_stop <span class="keyword1">then</span> ego_other.p <span class="free"><span class="bound"><span class="entity">t</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> ego.t_stop <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> other.t_stop <span class="keyword1">then</span> other.p <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> ego.s_stop
    <span class="keyword1">else</span> <span class="keyword1">if</span> other.t_stop <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> ego.t_stop <span class="keyword1">then</span> other.s_stop <span class="main">-</span> ego.p <span class="free"><span class="bound"><span class="entity">t</span></span></span>
    <span class="keyword1">else</span> other.s_stop <span class="main">-</span> ego.s_stop
  <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">t</span> <span class="main">=</span> other.s <span class="free">t</span> <span class="main">-</span> ego.s <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def ego.s_eq_s_stop other.s_eq_s_stop ego.s_cond_def other.s_cond_def
    movement.p_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_d<span class="main">:</span> <span class="quoted"><span class="quoted">"collision <span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> d <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_diff collision_def <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_restrict<span class="main">:</span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span> collision <span class="main">{</span><span class="main">0</span><span class="main">..</span>max ego.t_stop other.t_stop<span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max.coboundedI1 ego.t_stop_nonneg min_def
    ego.s_eq_s_stop other.s_eq_s_stop collision_def
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">t</span> <span class="main">(</span>max <span class="main">(</span>movement.t_stop <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">(</span>movement.t_stop <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">t</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_union<span class="main">:</span> <span class="quoted"><span class="quoted">"collision <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> collision <span class="free">A</span> <span class="main">∨</span> collision <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symbolic_checker<span class="main">:</span>
  <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⟷</span>
    <span class="main">(</span>quadroot_in <span class="main">0</span> <span class="main">(</span>min ego.t_stop other.t_stop<span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span>quadroot_in ego.t_stop other.t_stop <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> ego.s_stop<span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span>quadroot_in other.t_stop ego.t_stop <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> other.s_stop<span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="var">?q1</span> <span class="main">∨</span> <span class="var">?q2</span> <span class="main">∨</span> <span class="var">?q3</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span>max ego.t_stop other.t_stop<span class="main">}</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">0</span> <span class="main">..</span> min ego.t_stop other.t_stop<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>ego.t_stop <span class="main">..</span> other.t_stop<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>other.t_stop <span class="main">..</span> ego.t_stop<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ego.t_stop_nonneg other.t_stop_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..</span>min <span class="main">(</span>movement.t_stop <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">(</span>movement.t_stop <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="var">?q1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def quadroot_in_def root_in_def d_def
      power2_eq_square <span class="dynamic"><span class="dynamic">field_split_simps</span></span> movement.p_def movement.s_cond_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span>ego.t_stop <span class="main">..</span> other.t_stop<span class="main">}</span> <span class="main">=</span> <span class="var">?q2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ego.t_stop_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def quadroot_in_def root_in_def d_def
      ego.s_eq_s_stop movement.s_cond_def movement.p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span>other.t_stop <span class="main">..</span> ego.t_stop<span class="main">}</span> <span class="main">=</span> <span class="var">?q3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> other.t_stop_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_def quadroot_in_def root_in_def d_def
      other.s_eq_s_stop movement.s_cond_def movement.p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> collision_restrict * collision_union
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Checker Design›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_dist_to_stop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_dist_to_stop</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> floatarith_notation <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_dist_to_stop_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> floatarith"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_dist_to_stop_expr</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Num</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_dist_to_stop'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval option <span class="main">⇒</span> float interval option <span class="main">⇒</span> float interval option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_dist_to_stop'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> approx <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>rel_dist_to_stop_expr <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dist_to_stop'<span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>rel_dist_to_stop_expr <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">[</span><span class="free">v</span><span class="main">,</span> <span class="free">a</span><span class="main">]</span> <span class="main">=</span> rel_dist_to_stop <span class="free">v</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_dist_to_stop_def rel_dist_to_stop_expr_def inverse_eq_divide<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">first_safe_dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">first_safe_dist</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">≡</span> rel_dist_to_stop <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">second_safe_dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">second_safe_dist</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span> rel_dist_to_stop <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">-</span> rel_dist_to_stop <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">second_safe_dist_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> floatarith"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">second_safe_dist_expr</span> <span class="free"><span class="bound"><span class="entity">ve</span></span></span> <span class="free"><span class="bound"><span class="entity">ae</span></span></span> <span class="free"><span class="bound"><span class="entity">vo</span></span></span> <span class="free"><span class="bound"><span class="entity">ao</span></span></span> <span class="main">=</span> <span class="keyword1">Add</span> <span class="main">(</span>rel_dist_to_stop_expr <span class="free"><span class="bound"><span class="entity">ve</span></span></span> <span class="free"><span class="bound"><span class="entity">ae</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span>rel_dist_to_stop_expr <span class="free"><span class="bound"><span class="entity">vo</span></span></span> <span class="free"><span class="bound"><span class="entity">ao</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">second_safe_dist'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval option <span class="main">⇒</span> float interval option
    <span class="main">⇒</span> float interval option <span class="main">⇒</span> float interval option <span class="main">⇒</span> float interval option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">second_safe_dist'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">=</span> approx <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>second_safe_dist_expr <span class="main">0</span> <span class="main">1</span> <span class="numeral">2</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> second_safe_dist'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>second_safe_dist_expr <span class="main">0</span> <span class="main">1</span> <span class="numeral">2</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">[</span><span class="free">v</span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">v'</span><span class="main">,</span> <span class="free">a'</span><span class="main">]</span> <span class="main">=</span> second_safe_dist <span class="free">v</span> <span class="free">a</span> <span class="free">v'</span> <span class="free">a'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> second_safe_dist_def second_safe_dist_expr_def rel_dist_to_stop_def rel_dist_to_stop_expr_def inverse_eq_divide<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_stop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t_stop</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_stop_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> floatarith"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t_stop_expr</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s_stop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">s_stop</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> rel_dist_to_stop <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">discriminant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">discriminant</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">suff_cond_safe_dist2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">suff_cond_safe_dist2</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span> 
    <span class="keyword1">let</span> <span class="bound">D2</span> <span class="main">=</span> discriminant <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> 
    <span class="keyword1">in</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">D2</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> sqrt <span class="bound">D2</span>
  <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_sqrt_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> sqrt <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> real_le_lsqrt real_less_rsqrt real_sqrt_ge_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> suff_cond_safe_dist2_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"suff_cond_safe_dist2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">D2</span> <span class="main">=</span> discriminant <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="keyword1">in</span>
      <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟶</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">D2</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="bound">D2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_sqrt_ge_zero real_less_rsqrt less_sqrt_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suff_cond_safe_dist2_def Let_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  There are two expressions for safe distance. The first safe distance <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>first_safe_dist›</span></span></span></span> is always valid.
  Whenever the distance is bigger than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>first_safe_dist›</span></span></span></span>, it is guarantee to be collision free.
  The second one is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>second_safe_dist›</span></span></span></span>. If the sufficient condition <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>suff_cond_safe_dist2›</span></span></span></span> is satisfied and
  the distance is bigger than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>second_safe_dist›</span></span></span></span>, it is guaranteed to be collision free.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">check_precond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">check_precond</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> "</span></span>

<span class="keyword1"><span class="command">lemma</span></span> check_precond_safe_distance<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">=</span> safe_distance <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"safe_distance <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> safe_distance <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> check_precond_def in_front nonneg_vel_ego other.nonneg_vel ego.decel other.decel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> check_precond_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Prescriptive Checker›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span>
    <span class="keyword1">let</span> <span class="bound">distance</span>   <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">precond</span>    <span class="main">=</span> check_precond <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">safe_dist1</span> <span class="main">=</span> first_safe_dist <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span> 
        <span class="bound">safe_dist2</span> <span class="main">=</span> second_safe_dist <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">cond2</span>      <span class="main">=</span> suff_cond_safe_dist2 <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> 
    <span class="keyword1">in</span> <span class="bound">precond</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">safe_dist1</span> <span class="main">&lt;</span> <span class="bound">distance</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">safe_dist2</span> <span class="main">&lt;</span> <span class="bound">distance</span> <span class="main">∧</span> <span class="bound">distance</span> <span class="main">≤</span> <span class="bound">safe_dist1</span> <span class="main">∧</span> <span class="bound">cond2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux_logic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⟹</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">⟷</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> soundness_correctness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> safe_distance.no_collision <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> aux_logic<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> checker_def Let_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_front'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nonneg_vel_ego<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nonneg_vel_other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> decelerate_ego<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> decelerate_other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> check_precond_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> in_front' <span class="keyword1"><span class="command">have</span></span> in_front<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

  <span class="keyword1"><span class="command">interpret</span></span> safe_distance <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> ego<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> other<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.p_max <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∨</span> other.p_max <span class="main">≤</span> ego.p_max <span class="main">∨</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.p_max <span class="main">∧</span> ego.p_max <span class="main">&lt;</span> other.p_max"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">=</span> safe_distance.no_collision <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ego.p_max <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> cp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> checker_def Let_def first_safe_dist_def rel_dist_to_stop_def ego.p_max_def
        ego.p_def ego.t_stop_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ego.p_max <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cond_1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_t_stop<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"other.p_max <span class="main">≤</span> ego.p_max"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> other.nonneg_vel
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> checker_def Let_def first_safe_dist_def second_safe_dist_def
        rel_dist_to_stop_def movement.p_max_def
        movement.p_def movement.t_stop_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
         <span class="main">(</span><span class="operator">smt</span> divide_nonneg_neg mult_nonneg_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹other.p_max <span class="main">≤</span> ego.p_max›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cond_2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> other.s_t_stop ego.s_t_stop<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> ego.p_max <span class="main">∧</span> ego.p_max <span class="main">&lt;</span> other.p_max"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> D2 <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> sqrt D2<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> cp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> checker_def Let_def first_safe_dist_def rel_dist_to_stop_def ego.p_max_def
        ego.p_def ego.t_stop_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square second_safe_dist_def
        suff_cond_safe_dist2_def discriminant_def not_less other.p_max_def other.p_def other.t_stop_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> no_collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H
      <span class="keyword1"><span class="command">unfolding</span></span> Not_eq_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cond_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego.s_t_stop other.s_t_stop<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker2</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span> 
    <span class="keyword1">let</span> <span class="bound">distance</span>   <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">precond</span>    <span class="main">=</span> check_precond <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">safe_dist1</span> <span class="main">=</span> first_safe_dist <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span> 
        <span class="bound">safe_dist2</span> <span class="main">=</span> second_safe_dist <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">safe_dist3</span> <span class="main">=</span> <span class="main">-</span> rel_dist_to_stop <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> 
    <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="main">¬</span> <span class="bound">precond</span> <span class="keyword1">then</span> False 
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist1</span> <span class="keyword1">then</span> True 
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist3</span>
      <span class="keyword1">else</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist2</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker_eq_checker2<span class="main">:</span> <span class="quoted"><span class="quoted">"checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> checker2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> checker_def checker2_def
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> check_precond_def safe_distance_def 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"safe_distance <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_precond_safe_distance<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">interpret</span></span> safe_distance <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> ego<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> other<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span>  cond_3 cond_3'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> fst_leq_snd_safe_distance
  ego.s_t_stop ego.p_max_def ego.p_def ego.t_stop_def hyps other.s_t_stop other.p_max_def other.p_def 
  other.t_stop_def checker2_def checker_def suff_cond_safe_dist2_def fst_safe_distance_def 
  first_safe_dist_def snd_safe_distance_def second_safe_dist_def rel_dist_to_stop_def discriminant_def 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker3</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span> 
    <span class="keyword1">let</span> <span class="bound">distance</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">precond</span>  <span class="main">=</span> check_precond <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">s_stop_e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">+</span> rel_dist_to_stop <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">s_stop_o</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">+</span> rel_dist_to_stop <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> 
    <span class="keyword1">in</span> <span class="bound">precond</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s_stop_e</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> 
               <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≤</span> <span class="bound">s_stop_e</span> <span class="main">∧</span> <span class="bound">s_stop_e</span> <span class="main">&lt;</span> <span class="bound">s_stop_o</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">distance</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker2_eq_checker3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"checker2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> checker3 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> checker2_def checker3_def Let_def first_safe_dist_def not_less
    suff_cond_safe_dist2_def second_safe_dist_def rel_dist_to_stop_def check_precond_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> safe_distance
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fst_leq_snd_safe_distance 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fst_safe_distance_def snd_safe_distance_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> safe_distance
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fst_leq_snd_safe_distance 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fst_safe_distance_def snd_safe_distance_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> safe_distance
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fst_leq_snd_safe_distance 3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fst_safe_distance_def snd_safe_distance_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Approximate Checker›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> checker2_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"checker2 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">distance</span>   <span class="main">=</span> <span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">;</span>
      <span class="bound">precond</span>    <span class="main">=</span> check_precond <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span><span class="main">;</span>
      <span class="bound">safe_dist1</span> <span class="main">=</span> first_safe_dist <span class="free">b</span> <span class="free">c</span><span class="main">;</span>
      <span class="bound">safe_dist2</span> <span class="main">=</span> second_safe_dist <span class="free">b</span> <span class="free">c</span> <span class="free">e</span> <span class="free">f</span><span class="main">;</span>
      <span class="bound">C</span>          <span class="main">=</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">∧</span> <span class="free">e</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">*</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">*</span> <span class="free">e</span><span class="main">;</span>
      <span class="bound">P1</span>         <span class="main">=</span> <span class="main">(</span><span class="free">e</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">distance</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">P2</span>         <span class="main">=</span> <span class="main">-</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">c</span> <span class="main">+</span> <span class="free">e</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">f</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">distance</span>
  <span class="keyword1">in</span> <span class="bound">precond</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">safe_dist1</span> <span class="main">&lt;</span> <span class="bound">distance</span> <span class="main">∨</span>
                <span class="bound">safe_dist1</span> <span class="main">≥</span> <span class="bound">distance</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">C</span> <span class="main">∧</span> <span class="bound">P1</span> <span class="main">∨</span> <span class="main">¬</span><span class="bound">C</span> <span class="main">∧</span> <span class="bound">P2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> checker2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="dynamic"><span class="dynamic">field_split_simps</span></span> check_precond_def second_safe_dist_def
    rel_dist_to_stop_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> power2_less_sqrt_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> abs <span class="free">x</span> <span class="main">&lt;</span> sqrt <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_less_rsqrt abs_real_def less_sqrt_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> le_less le_less_trans not_less power2_less_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> checker_form<span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_form <span class="var">?x</span> <span class="var">?y</span> <span class="main">⟹</span> checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> checker_eq_checker2 checker2_eq_checker3 checker3_def check_precond_def first_safe_dist_def second_safe_dist_def
    suff_cond_safe_dist2_def Let_def t_stop_def s_stop_def
    rel_dist_to_stop_def
    discriminant_def
    not_le not_less
    de_Morgan_conj
    de_Morgan_disj
    power2_less_sqrt_iff
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="main">(</span><span class="entity">Reification.tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> interpret_form.simps interpret_floatarith.simps interpret_floatarith_divide interpret_floatarith_diff<span class="antiquote">}</span></span></span><span class="main">)</span> NONE <span class="inner_numeral">1</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> floatarith_notation <span class="keyword2"><span class="keyword">begin</span></span>                                            
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">checker'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">=</span> approx_form <span class="free"><span class="bound"><span class="entity">p</span></span></span>
           <span class="main">(</span>Conj <span class="main">(</span>Conj <span class="main">(</span>Less <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>Conj <span class="main">(</span>LessEqual <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span>Conj <span class="main">(</span>LessEqual <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">(</span>Conj <span class="main">(</span>Less <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span>Less <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>Disj <span class="main">(</span>Less <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>Conj <span class="main">(</span>LessEqual <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>Conj <span class="main">(</span>Less <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>Disj <span class="main">(</span>LessEqual <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span>Disj <span class="main">(</span>LessEqual <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">(</span>Disj <span class="main">(</span>LessEqual <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span>Less <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="numeral">2</span><span class="main">)</span>
                                 <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">,</span> Interval' <span class="main">(</span>Float <span class="numeral">2</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Float <span class="numeral">2</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">,</span> Interval' <span class="main">(</span>Float <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Float <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>replicate <span class="numeral">8</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_Suc_iff_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="free">x</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> checker'_soundness_correctness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">al</span> <span class="main">..</span> real_of_float <span class="free">au</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">bl</span> <span class="main">..</span> real_of_float <span class="free">bu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">cl</span> <span class="main">..</span> real_of_float <span class="free">cu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">dl</span> <span class="main">..</span> real_of_float <span class="free">du</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">el</span> <span class="main">..</span> real_of_float <span class="free">eu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">fl</span> <span class="main">..</span> real_of_float <span class="free">fu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chk<span class="main">:</span> <span class="quoted"><span class="quoted">"checker' <span class="free">p</span> <span class="main">(</span>Interval' <span class="free">al</span> <span class="free">au</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">bl</span> <span class="free">bu</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">cl</span> <span class="free">cu</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">dl</span> <span class="free">du</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">el</span> <span class="free">eu</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">fl</span> <span class="free">fu</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"checker <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> checker_form<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> approx_form_aux<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> chk<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> checker'_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-6<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> bounded_by_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x2</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Interval' <span class="free">cl</span> <span class="free">cu</span><span class="main">,</span> Interval' <span class="free">fl</span> <span class="free">fu</span><span class="main">,</span> Interval' <span class="free">al</span> <span class="free">au</span><span class="main">,</span> Interval' <span class="free">dl</span> <span class="free">du</span><span class="main">,</span> 
           Interval' <span class="main">(</span>Float <span class="numeral">2</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Float <span class="numeral">2</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> Interval' <span class="free">bl</span> <span class="free">bu</span><span class="main">,</span> Interval' <span class="free">el</span> <span class="free">eu</span><span class="main">,</span> Interval' <span class="main">0</span> <span class="main">0</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="skolem">x2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">5</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">6</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">7</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="free">c</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">d</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">e</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">x2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">cases</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-6<span class="main">)</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_real_intervalI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Interval'_eq_Some<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> approximate_soundness_correctness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">al</span> <span class="main">..</span> real_of_float <span class="free">au</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">bl</span> <span class="main">..</span> real_of_float <span class="free">bu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">cl</span> <span class="main">..</span> real_of_float <span class="free">cu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">dl</span> <span class="main">..</span> real_of_float <span class="free">du</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">el</span> <span class="main">..</span> real_of_float <span class="free">eu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">{</span>real_of_float <span class="free">fl</span> <span class="main">..</span> real_of_float <span class="free">fu</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chk<span class="main">:</span> <span class="quoted"><span class="quoted">"checker' <span class="free">p</span> <span class="main">(</span>Interval' <span class="free">al</span> <span class="free">au</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">bl</span> <span class="free">bu</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">cl</span> <span class="free">cu</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">dl</span> <span class="free">du</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">el</span> <span class="free">eu</span><span class="main">)</span> <span class="main">(</span>Interval' <span class="free">fl</span> <span class="free">fu</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> checker'_precond<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> checker'_no_collision<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance.no_collision <span class="free">c</span> <span class="free">b</span> <span class="free">a</span> <span class="free">f</span> <span class="free">e</span> <span class="free">d</span>  <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> atomize_conj
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> soundness_correctness<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> checker'_soundness_correctness<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> checker_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Symbolic Checker›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symbolic_checker</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">symbolic_checker</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">≡</span>
    <span class="keyword1">let</span> <span class="bound">e_stop</span> <span class="main">=</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">o_stop</span> <span class="main">=</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span>
    <span class="keyword1">in</span> check_precond <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">¬</span>quadroot_in <span class="main">0</span> <span class="main">(</span>min <span class="bound">e_stop</span> <span class="bound">o_stop</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">¬</span>quadroot_in <span class="bound">e_stop</span> <span class="bound">o_stop</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> movement.p <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="bound">e_stop</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">¬</span>quadroot_in <span class="bound">o_stop</span> <span class="bound">e_stop</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">-</span> movement.p <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="bound">o_stop</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> symbolic_soundness_correctness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symbolic_checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> safe_distance.no_collision <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> safe_distance <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_precond_safe_distance<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symbolic_checker <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">=</span> no_collision <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">unfolding</span></span> symbolic_checker symbolic_checker_def ego.s_t_stop other.s_t_stop ego.p_max_def other.p_max_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def movement.t_stop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> symbolic_checker_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Safe_Distance_Reaction">
<div class="head">
<h1>Theory Safe_Distance_Reaction</h1>
</div>
<pre class="source"><span class="comment1">✐‹creator "Albert Rizaldi" "Fabian Immler›</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Safe Distance with Reaction Time›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Safe_Distance_Reaction
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Safe_Distance.html">Safe_Distance</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Normal Safe Distance›</span></span>
                                    
<span class="keyword1"><span class="command">locale</span></span> safe_distance_normal <span class="main">=</span> safe_distance <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">δ</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_react<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">δ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ego2<span class="main">:</span> braking_movement <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ego.q <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ego2_s_init<span class="main">:</span> <span class="quoted"><span class="quoted">"ego2.s <span class="main">0</span> <span class="main">=</span> ego.q <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">τ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> <span class="free">δ</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">τ'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> τ_continuous<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> τ"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> τ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_τ<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont τ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> τ_continuous<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> del_has_vector_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>τ <span class="keyword1">has_vector_derivative</span> τ' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> τ_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> τ'_def has_vector_derivative_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
           <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
                                                             
<span class="keyword1"><span class="command">lemma</span></span> del_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>τ <span class="keyword1">has_real_derivative</span> τ' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> del_has_vector_derivative
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delay_image<span class="main">:</span> <span class="quoted"><span class="quoted">"τ <span class="main">`</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> τ_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bexI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="free">δ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_delayed_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="keyword1">has_field_derivative</span> ego2.s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> τ' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_image_chain<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">-</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ego2.decel <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ego2.s <span class="keyword1">has_real_derivative</span> ego2.s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span>τ <span class="free">t</span><span class="main">)</span> <span class="keyword1">within</span> τ <span class="main">`</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ego2.s_has_real_derivative<span class="main">[</span><span class="operator">OF</span> 0 1 2<span class="main">]</span> sym<span class="main">[</span><span class="operator">OF</span> delay_image<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> del_has_real_derivative <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>τ <span class="keyword1">has_real_derivative</span> τ' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_delayed_has_real_derivative' <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span>ego2.s' <span class="main">∘</span> τ<span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s_delayed_has_real_derivative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="keyword1">has_field_derivative</span> ego2.s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> τ' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="keyword1">has_field_derivative</span> ego2.s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> τ'_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="keyword1">has_field_derivative</span> ego2.s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_delayed_has_vector_derivative' <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span>ego2.s' <span class="main">∘</span> τ<span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">δ</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s_delayed_has_real_derivative'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>     <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego.q <span class="free"><span class="bound"><span class="entity">t</span></span></span> 
          <span class="keyword1">else</span>          <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> init_u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> u <span class="free">t</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> u_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">=</span> ego2.s <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">=</span> ego.q <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.s <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">=</span> ego2.s <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> q_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"ego.q <span class="free">δ</span> <span class="main">=</span> ego2.s <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u_delta pos_react <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">u'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego.q' <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">else</span> ego2.s' <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> u'_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"u' <span class="free">δ</span> <span class="main">=</span> ego2.s' <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u' <span class="free">δ</span> <span class="main">=</span> ego.q' <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.q'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.p' <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.s' <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">unfolding</span></span> ego2.s'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u' <span class="free">δ</span> <span class="main">=</span> ego.s' <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> q'_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"ego.q' <span class="free">δ</span> <span class="main">=</span> ego2.s' <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u'_delta <span class="keyword1"><span class="command">unfolding</span></span> u'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> u_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>u <span class="keyword1">has_real_derivative</span> u' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pos_react <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> temp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span> <span class="keyword1">then</span> ego.q <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span> <span class="keyword1">then</span> ego.q' <span class="free">t</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s' <span class="main">∘</span> τ<span class="main">)</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f1</span> <span class="keyword1">has_real_derivative</span> <span class="var">?f2</span><span class="main">)</span> <span class="main">(</span><span class="var">?net</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> u_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> u'_def 
      has_field_derivative_iff_has_vector_derivative
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_If_within_closures<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">δ</span></span><span class="main"><span class="main">..}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">δ</span>›</span></span> q_delta q'_delta ego.s_has_vector_derivative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> ego.decel ego.t_stop_nonneg 
    s_delayed_has_vector_derivative'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main">]</span> τ_def
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms  max_def insert_absorb   
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ego.q_has_vector_derivative<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_vector_derivative_def has_field_derivative_iff_has_vector_derivative
      u'_def u_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_derivative_transform<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">t</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">..</span></span><span class="free"><span class="free">δ</span></span><span class="main"><span class="main">}</span></span> <span class="keyword1"><span class="keyword1">then</span></span> ego.q <span class="bound"><span class="bound">t</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">(</span></span>ego2.s <span class="main"><span class="main">∘</span></span> τ<span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> nonneg_t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">δ</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego.q <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span> <span class="keyword1">then</span> ego.q <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">unfolding</span></span> ego.q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> temp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f1</span> <span class="keyword1">has_vector_derivative</span> <span class="var">?f2</span><span class="main">)</span> <span class="var">?net</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_field_derivative_iff_has_vector_derivative <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span> <span class="keyword1">then</span> ego.q <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_derivative</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego2.q' <span class="free">t</span> <span class="keyword1">else</span> ego2.s' <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def has_vector_derivative_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_stop</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">t_stop</span> <span class="main">=</span> ego2.t_stop <span class="main">+</span> <span class="free">δ</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> t_stop"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def
  <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg pos_react
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> t_stop"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def
  <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg pos_react
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> t_stop_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg pos_react ego2.t_stop_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> u'_stop_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"u' t_stop <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> u'_def t_stop_def ego2.q'_def ego2.s'_def
  <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg ego2.p'_stop_zero decelerate_ego ego2.t_stop_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">u_max</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">u_max</span> <span class="main">=</span> u <span class="main">(</span>ego2.t_stop <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> u_max_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"u_max <span class="main">=</span> ego.q <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ego2.t_stop <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ego2.t_stop <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ego2.t_stop <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">=</span> ego.q <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> u_max_def u_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ego2.t_stop <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="main">(</span>ego2.t_stop <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> u_max_def u_def  <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.s ego2.t_stop"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.p_max"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ego2.s_def ego2.p_max_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ego2.t_stop <span class="main">≠</span> <span class="main">0</span>›</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego.q <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ego2.p_max_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> u_mono<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> t_stop"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">δ</span><span class="main">)</span> <span class="main">∨</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">δ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> ego.q_min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">δ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> u_def  <span class="keyword1"><span class="command">using</span></span> ego.q_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> 
      <span class="keyword1"><span class="command">with</span></span> pos_react <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos_react <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> u_def comp_def 
        <span class="keyword1"><span class="command">using</span></span> assms ego2.s_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">δ</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>τ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> ego.q <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> pos_react nonneg_vel_ego
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ego.q_def mult_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.s <span class="main">(</span>τ <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.s_def <span class="keyword1"><span class="command">unfolding</span></span> τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ego2.s <span class="main">(</span>τ <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> τ_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ego2.s_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> u <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> u_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> t_stop <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> u <span class="free">y</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> τ_def t_stop_def <span class="keyword1"><span class="command">using</span></span> pos_react ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span>›</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ego2.s_antimono<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"τ <span class="free">x</span> <span class="main">≤</span> τ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> τ_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ego2.t_stop <span class="main">≤</span> τ <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> τ_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_stop_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">≤</span> <span class="free">x</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span>›</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> contrapos_pp<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">δ</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.t_stop <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def 
        <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">=</span> <span class="free">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">δ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">δ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> ego.q <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>›</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ego2.t_stop <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>t_stop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ego2.t_stop_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> ego.q <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pos_react <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> u_def comp_def τ_def ego2.s_def ego2.p_def ego2.p_max_def ego2.t_stop_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>›</span></span> pos_react <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>       
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">y</span> <span class="main">≤</span> u <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> u_max<span class="main">:</span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">≤</span> u_max"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> u_max_def <span class="keyword1"><span class="command">using</span></span> t_stop_def        
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> t_stop"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> u_mono u_antimono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> u_eq_u_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"NO_MATCH t_stop <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> t_stop <span class="main">⟹</span> u <span class="free">x</span> <span class="main">=</span> u_max"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> t_stop_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">=</span> u_max"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> t_stop_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">=</span> ego.q <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> u_max"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_max_eq <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">=</span> u_max"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.s ego2.t_stop"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> comp_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> τ_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> order.antisym<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">δ</span> <span class="main">≥</span> ego2.t_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ego2.s <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≤</span> ego2.s ego2.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ego2.s_antimono<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">δ</span> <span class="main">≥</span> ego2.t_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹t_stop <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ego2.s ego2.t_stop <span class="main">≤</span> ego2.s <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ego2.s_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> u_max"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_max_eq ego2.s_t_stop ego2.p_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="free">x</span> <span class="main">=</span> u_max"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> at_least_delta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"t_stop <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="free">x</span> <span class="main">=</span> ego2.s <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ego2.t_stop_nonneg 
  <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def ego2.s_def less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_u<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> u"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> u_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> t_stop_nonneg pos_react at_least_delta
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">T</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{..</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">..</span></span><span class="free"><span class="free">δ</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">δ</span></span> <span class="main"><span class="main">..</span></span> t_stop<span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="main"><span class="main">{</span></span>t_stop <span class="main"><span class="main">..}</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> continuous_on_If <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def ego2.s_def 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">δ</span><span class="main">..</span>t_stop<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>t_stop<span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_stop_def <span class="keyword1"><span class="command">using</span></span> pos_react ego.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def ego2.s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{..</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> ego.q <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego.q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> pos_react <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego.q <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">δ</span><span class="main">..</span>t_stop<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>t_stop<span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react ego2.t_stop_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_stop_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego.q <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react ego.init_q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="keyword1">then</span> ego.q <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="main">{..</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">δ</span><span class="main">..</span>t_stop<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>t_stop<span class="main">..}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_u<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont u <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_u<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">collision_react</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">collision_react</span> <span class="free"><span class="bound"><span class="entity">time_set</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">time_set</span></span></span><span class="main">.</span> u <span class="bound">t</span> <span class="main">=</span> other.s <span class="bound">t</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">no_collision_react</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">no_collision_react</span> <span class="free"><span class="bound"><span class="entity">time_set</span></span></span> <span class="main">≡</span> <span class="main">¬</span> collision_react <span class="free"><span class="bound"><span class="entity">time_set</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_collision_reactI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> u <span class="bound">t</span> <span class="main">≠</span> other.s <span class="bound">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> no_collision_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_trim_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> cond_1r <span class="main">:</span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟹</span> no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> no_collision_reactI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">≤</span> u_max"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> u_max<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.s <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> other.init_s<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> other.s <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> hyps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> other.s_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">≠</span> other.s <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_1r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_1r</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_1r_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>u_max <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_1r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> u_max_eq ego.q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_1r_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sd_1r_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cond_1r<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> u_other_strict_ivt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u <span class="free">t</span> <span class="main">&gt;</span> other.s <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms in_front
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">∧</span> other.s <span class="bound">x</span> <span class="main">-</span> u <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IVT2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_u other.init_s continuous_diff isCont_u other.isCont_s<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> collision_react_def Bex_def order.order_iff_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> assms hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_react_def init_u other.init_s<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collision_react_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"collision_react <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">t</span> <span class="main">⟹</span> collision_react <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>collision_react_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> u_other_ivt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u <span class="free">t</span> <span class="main">≥</span> other.s <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"u <span class="free">t</span> <span class="main">&gt;</span> other.s <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> u_other_strict_ivt<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> collision_react_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> hyps assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collision_react_def init_u other.init_s<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> cond_2r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">≥</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> collision_react_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">..}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s <span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span> <span class="main"><span class="main">..</span></span> max t_stop other.t_stop<span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> u_other_ivt<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t <span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"max t_stop other.t_stop"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_eq_u_stop other.s_eq_s_stop<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ego_other2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ego_other2</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> other.s <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> u <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> continuous_on_ego_other2<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">T</span> ego_other2"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isCont_ego_other2<span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isCont ego_other2 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_ego_other2<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ego_other2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ego_other2'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>  <span class="main">=</span> other.s' <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> u' <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ego_other2_has_real_derivative<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ego_other2 <span class="keyword1">has_real_derivative</span> ego_other2' <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms other.t_stop_nonneg decelerate_other
  <span class="keyword1"><span class="command">unfolding</span></span> other.t_stop_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ego_other2_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> ego_other2'_def  <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
           <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3r_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">≥</span> other.s <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> collision_react_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">t</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="main">∧</span> ego_other2 <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> IVT2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ego_other2 <span class="free">δ</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> ego_other2 <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def 
        <span class="keyword1"><span class="command">using</span></span> other.init_s<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> init_u<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> in_front <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="main">⟶</span> isCont ego_other2 <span class="bound">t</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> isCont_ego_other2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">δ</span> <span class="main">∧</span> ego_other2 <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">=</span> other.s <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span><span class="main">.</span> u <span class="bound">t</span> <span class="main">=</span> other.s <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main">)</span>    
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">distance0</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">distance0</span> <span class="main">=</span>  <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">distance0_2</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">distance0_2</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3r_1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> distance0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">≥</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distance0_def other.s_def
    other.p_def u_def ego.q_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cond_3r_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> distance0_2_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>u <span class="free">δ</span> <span class="main">&lt;</span> other.s <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> distance0_2<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>u <span class="free">δ</span> <span class="main">&lt;</span> other.s <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ego.q <span class="free">δ</span> <span class="main">&lt;</span> other.p_max<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u_def other.s_def pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ego.q_def other.p_max_def other.p_def other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> other.p_def other.p_max_def other.p_max_eq other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> distance0_2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3r_1'_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> distance0_2"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms distance0_2_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">≥</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distance0_def other.s_def
    other.p_def u_def ego.q_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cond_3r_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_3r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_3r</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distance0_at_most_sd3r<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distance0 <span class="main">≤</span> safe_distance_3r"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> distance0_def safe_distance_3r_def <span class="keyword1"><span class="command">using</span></span> nonneg_vel_ego decelerate_ego
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_4r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_4r</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distance0_at_most_sd4r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distance0 <span class="main">≤</span> safe_distance_4r"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≥</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> divide_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> distance0_def safe_distance_4r_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_2r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_2r</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vo_start_geq_ve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s' <span class="free">δ</span> <span class="main">≥</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">&lt;</span> other.s <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s'_def other.p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span>  mult_right_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l0</span> <span class="main">≤</span> <span class="var">?r0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> power_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="var">?l0</span> <span class="main">≤</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="var">?r0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="var">?r0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_front <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decelerate_other pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_react assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> u_def ego.q_def other.s_def other.t_stop_def other.p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> so_star_stop_leq_se_stop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s'_def other.p'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l0</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> decelerate_other
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l0</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> divide_right_mono_neg<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?l0</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span> decelerate_ego <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decelerate_ego <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≥</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decelerate_other <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s'_def other.p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> vo_star_nneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.t_stop_def <span class="keyword1"><span class="command">using</span></span> decelerate_other
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> * ** _ <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonneg_vel_ego decelerate_ego
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s'_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> other.p'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> vo_star_nneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.t_stop_def <span class="keyword1"><span class="command">using</span></span> decelerate_other
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nonneg_vel_ego <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">/</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decelerate_ego decelerate_other
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nonneg_vel_ego decelerate_other <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> distance0_at_most_distance2r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distance0 <span class="main">≤</span> safe_distance_2r"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> so_star_stop_leq_se_stop<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span> "</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?term</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"safe_distance_2r <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decelerate_other <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> power_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="var">?term</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?left</span> <span class="main">+</span> <span class="var">?term</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"safe_distance_2r <span class="main">=</span> distance0 <span class="main">+</span> <span class="var">?term</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distance0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="var">?term</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distance0 <span class="main">≤</span> safe_distance_2r"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> dist0_sd2r_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> distance0"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"other.s' <span class="free">δ</span> <span class="main">≥</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> other.s' <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> vo_start_geq_ve<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">&lt;</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> distance0_def u_def <span class="keyword1"><span class="command">using</span></span> pos_react assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ego.q_def
    other.s_def other.p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> other.s' <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> other.s' <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> distance0_at_most_distance2r<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distance0 <span class="main">≤</span> safe_distance_2r"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sd2r_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>u_max <span class="main">&lt;</span> other.s <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>u_max <span class="main">&lt;</span> other.s <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">&lt;</span> other.p_max<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u_max_def ego2.t_stop_def u_def other.s_def τ_def pos_react ego2.p_max_eq ego2.s_t_stop u_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ego2.s_def ego2.p_def ego.q_def other.p_max_def other.p_def other.t_stop_def ego2.p_max_def ego2.s_t_stop ego2.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>  <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span>  <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ego2.p_def ego2.p_max_def ego2.p_max_eq ego2.t_stop_def other.p_def other.p_max_def other.p_max_eq other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>  <span class="main">&lt;</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> distance0_2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation safe_distance_2r_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> dist0_sd2r_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> distance0_2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_le_power2 hyps<span class="main">(</span>3<span class="main">)</span> divide_nonneg_neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≥</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"safe_distance_2r <span class="main">≥</span> distance0_2"</span></span> <span class="keyword1"><span class="command">using</span></span> safe_distance_2r_def distance0_2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Safe Distance Delta›</span></span>

<span class="keyword1"><span class="command">locale</span></span> safe_distance_no_collsion_delta <span class="main">=</span> safe_distance_normal <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_collision_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">&lt;</span> other.s <span class="free">δ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> delayed_safe_distance<span class="main">:</span> safe_distance <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="quoted">"ego.q <span class="free">δ</span>"</span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="quoted">"other.s' <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> nonneg_vel_ego <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> nonneg_vel_other <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> other.s' <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s'_def other.p'_def other.t_stop_def
      <span class="keyword1"><span class="command">using</span></span> decelerate_other <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> decelerate_ego <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> decelerate_other <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> no_collision_delta <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="free">δ</span> <span class="main">&lt;</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_collision_react_initially_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> no_collision_reactI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">≠</span> other.s <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> u <span class="skolem">t</span> <span class="main">≠</span> other.s <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ego_other2 <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego_other2 <span class="skolem">t</span> <span class="main">=</span> other.s <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def u_def <span class="keyword1"><span class="command">using</span></span> ego.init_q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop <span class="main">∨</span> other.t_stop <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> le_t_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ego_other2 <span class="skolem">t</span> <span class="main">=</span> other.s <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego_other2 <span class="skolem">t</span> <span class="main">=</span> other.p <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> other.s_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ego_other2 <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.p <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span><span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> other.p_def ego.q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> p_convex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> eq in_front <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="free">δ</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> no_collision_delta pos_react le_t_stop             
            <span class="keyword1"><span class="command">unfolding</span></span> p_def u_def other.s_def ego.q_def other.p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> decelerate_other <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> gt_t_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">have</span></span> t_lt_t_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">t</span> <span class="main">&lt;</span> other.t_stop"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.t_stop <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ego_other2 <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="skolem">t</span> <span class="main">=</span> other.p_max"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def u_def other.s_def comp_def τ_def other.p_max_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹other.t_stop <span class="main">≤</span> <span class="skolem">t</span>›</span></span> gt_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="skolem">t</span> <span class="main">=</span> u <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> u_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> other.p_max"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> other.s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego.q <span class="skolem">t</span> <span class="main">&lt;</span> other.p_max"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ego.q <span class="skolem">t</span> <span class="main">=</span> other.p_max›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">qed</span></span>
      
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ego_other2 <span class="skolem">t</span> <span class="main">=</span> other.s <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego_other2 <span class="skolem">t</span> <span class="main">=</span> other.p <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> other.s_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ego_other2 <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.p <span class="skolem">t</span> <span class="main">-</span> ego.q <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span><span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> other.p_def ego.q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> p_convex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> other.t_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> t_lt_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> eq in_front <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> other.t_stop <span class="main">=</span> ego_other2 other.t_stop"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def other.s_t_stop u_def ego.q_def 
                      other.s_def other.p_def p_def
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span> other.t_stop›</span></span> other.t_stop_nonneg other.t_stop_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_divide_distrib left_diff_distrib'<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u other.t_stop <span class="main">≤</span> u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> u_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> other.s_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> other.s_stop <span class="main">-</span> u other.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> ego_other2 other.t_stop"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego_other2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">p</span> other.t_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> zero <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">p</span> other.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> decelerate_other <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_collision_react_initially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> no_collision_react_initially_strict<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="main">0</span> <span class="main">≠</span> other.s <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> init_u other.init_s in_front <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_collision_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..&lt;</span> <span class="free">δ</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="free">δ</span> <span class="main">≠</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_collision_delta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">δ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">(</span><span class="main">{</span><span class="free">δ</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_collision_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">δ</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">δ</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collision_after_delta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span> collision_react <span class="main">{</span><span class="free">δ</span><span class="main">..}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> no_collision_react_initially<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> collision_trim_subset<span class="main">)</span>
  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>collision_react_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span><span class="main">..}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> collision_react_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collision_react_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span> <span class="main">⟷</span> collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_collision_delta <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">(</span><span class="main">{</span><span class="free">δ</span> <span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="free">δ</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm collision_trim_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span> <span class="main">=</span> <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> collision_react_subset<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delayed_other_s_stop_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s_stop <span class="main">=</span> other.s_stop"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> other.s_t_stop<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> delayed_safe_distance.other.s_t_stop<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> movement.p_max_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop <span class="main">∨</span> other.t_stop <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span> <span class="main">(</span>other.s' <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> other.s_def other.s'_def
    <span class="keyword1"><span class="command">using</span></span>  pos_react decelerate_other
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> other.p_def other.p'_def power2_eq_square <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"other.t_stop <span class="main">&lt;</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span> <span class="main">(</span>other.s' <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> other.s_def other.s'_def other.p_max_eq
    <span class="keyword1"><span class="command">using</span></span> pos_react decelerate_other 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span> <span class="main">(</span>other.s' <span class="free">δ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delayed_cond3'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> u_max"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span>  
          <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s <span class="free">δ</span> <span class="main">-</span> ego.q <span class="free">δ</span> <span class="main">≤</span> delayed_safe_distance.snd_safe_distance <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> delayed_safe_distance.cond_3'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹other.s <span class="free">δ</span> <span class="main">≤</span> u_max›</span></span> <span class="keyword1"><span class="command">.</span></span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ego2.s_stop"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_max_eq ego2.s_t_stop ego2.p_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> ego2.s_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s_stop <span class="main">=</span> u_max"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ego2.s_t_stop ego2.p_max_eq u_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> other.s_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> delayed_safe_distance.other.s_stop"</span></span> <span class="keyword1"><span class="command">using</span></span> delayed_other_s_stop_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ego2.s_stop <span class="main">&lt;</span> delayed_safe_distance.other.s_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delayed_other_t_stop_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.t_stop <span class="main">+</span> <span class="free">δ</span> <span class="main">=</span> other.t_stop"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms decelerate_other
  <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.other.t_stop_def other.t_stop_def other.s'_def
            movement.t_stop_def other.p'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delayed_other_s_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">≤</span> other.t_stop <span class="main">∨</span> other.t_stop <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> delayed_safe_distance.other.p <span class="free">t</span>"</span></span>    
      <span class="keyword1"><span class="command">using</span></span> delayed_other_t_stop_eq <span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.other.s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.p <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> movement.p_def other.s_def other.s'_def other.p'_def
      <span class="keyword1"><span class="command">using</span></span> pos_react 1 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>
      
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> other.s_def 
      <span class="keyword1"><span class="command">using</span></span> assms pos_react <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">≤</span> other.t_stop›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"other.t_stop <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> delayed_safe_distance.other.p_max"</span></span>
      <span class="keyword1"><span class="command">using</span></span> delayed_other_t_stop_eq <span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> assms delayed_safe_distance.other.t_stop_nonneg
      <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.other.s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.p_max"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> movement.p_max_eq other.s_def other.s'_def other.p_def other.p'_def
      <span class="keyword1"><span class="command">using</span></span> pos_react 1 decelerate_other 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_split_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> other.s_def
      <span class="keyword1"><span class="command">using</span></span> assms pos_react <span class="quoted"><span class="quoted">‹other.t_stop <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="free">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.t_stop <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s' <span class="free">δ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">=</span> other.p_max"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> other.s'_def other.s_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> delayed_safe_distance.other.p_max"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.other.s_def <span class="keyword1"><span class="command">using</span></span> assms decelerate_other 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>movement.p_max_eq movement.p_def movement.t_stop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.p_max"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> movement.p_max_eq <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹other.s' <span class="free">δ</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹other.s <span class="free">δ</span> <span class="main">=</span> other.p_max›</span></span>
    <span class="keyword1"><span class="command">using</span></span> other.p_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> other.s_def <span class="keyword1"><span class="command">using</span></span> pos_react assms <span class="quoted"><span class="quoted">‹other.t_stop <span class="main">&lt;</span> <span class="free">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="free">t</span> <span class="main">=</span> other.s <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> translate_collision_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span> collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ego2.s <span class="skolem">t</span> <span class="main">=</span> delayed_safe_distance.other.s <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.collision_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> u <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> pos_react 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> τ_def ego2.init_s<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> left<span class="main">:</span><span class="quoted"><span class="quoted">"ego2.s <span class="skolem">t</span> <span class="main">=</span> u <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> right<span class="main">:</span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="skolem">t</span> <span class="main">=</span> other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> delayed_other_s_eq pos_react <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword2"><span class="keyword">and</span></span> left <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> collision_react_strict<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">=</span> other.s <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s <span class="skolem">t</span> <span class="main">=</span> delayed_safe_distance.other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> delayed_other_s_eq <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> delayed_safe_distance.other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.collision_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3r_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span> 
         <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">≤</span> delayed_safe_distance.snd_safe_distance <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span> collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> collision_after_delta<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> delayed_safe_distance.collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> translate_collision_range<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span>  <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">≤</span> delayed_safe_distance.snd_safe_distance <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> delayed_cond3'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span>  <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">≤</span> delayed_safe_distance.snd_safe_distance <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_2r_correct_for_3r_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> other.p_def other.p_max_def other.p_max_eq other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s_stop <span class="main">&gt;</span> u_max"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s_def <span class="keyword1"><span class="command">using</span></span> u_max_eq other.t_stop_def
    <span class="keyword1"><span class="command">using</span></span> ego.q_def other.p_def other.p_max_def other.s_def other.s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> collision_after_delta cond_1r delayed_cond3' translate_collision_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd2_at_most_sd4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"safe_distance_2r <span class="main">≤</span> safe_distance_4r"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyps assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?l1</span> <span class="main">+</span> <span class="var">?l2</span> <span class="main">+</span> <span class="var">?l3</span><span class="main">)</span> <span class="main">*</span> <span class="var">?r</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ego2.decel other.decel<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">-</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">-</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs1</span> <span class="main">≤</span> <span class="var">?rhs1</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs2</span> <span class="main">≤</span> <span class="var">?rhs2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs1</span> <span class="main">≤</span> <span class="var">?rhs1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs1</span> <span class="main">=</span> <span class="var">?lhs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs1</span> <span class="main">=</span> <span class="var">?rhs2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lhs1</span> <span class="main">≤</span> <span class="var">?rhs1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>›</span></span> mult_le_cancel_iff1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span><span class="main">]</span> semiring_normalization_rules<span class="main">(</span>18<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> safe_distance_2r_def safe_distance_4r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_4r_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_4r"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_4r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">(</span>other.s' <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> ego.q_def other.p_def other.s_def other.p'_def other.s'_def pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">&gt;</span> delayed_safe_distance.snd_safe_distance"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delayed_safe_distance.snd_safe_distance_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">≤</span> delayed_safe_distance.snd_safe_distance<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> u_max_eq other.s_t_stop other.p_max_eq ego.q_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> sd2_at_most_sd4<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_4r_def safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> u_max"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> cond_3r_2<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹u_max <span class="main">&lt;</span> other.s_stop›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cond_1r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Irrelevant, this Safe Distance is unreachable in the checker.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_5r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_5r</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_5r_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_5r"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_5r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> other.s_def other.s_t_stop
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> movement.p_t_stop <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> cond_1r cond_2r other.s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">(</span>other.s' <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> other.s_def other.s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">&gt;</span> delayed_safe_distance.snd_safe_distance"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delayed_safe_distance.snd_safe_distance_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>other.s <span class="free">δ</span> <span class="main">-</span>  ego.q <span class="free">δ</span> <span class="main">≤</span> delayed_safe_distance.snd_safe_distance<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> cond_1r cond_3r_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> translate_no_collision_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"delayed_safe_distance.no_collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">⟷</span> no_collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> left<span class="main">:</span> <span class="quoted"><span class="quoted">"delayed_safe_distance.no_collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> collision_react_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span>  
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> pos_react <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> left <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"ego2.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≠</span> delayed_safe_distance.other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> delayed_safe_distance.collision_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ego2.s <span class="main">∘</span> τ<span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def τ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> u <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> pos_react 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> τ_def ego2.init_s<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> u <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> other.s <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> delayed_other_s_eq pos_react <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"u <span class="skolem">t</span> <span class="main">≠</span> other.s <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ineq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> right<span class="main">:</span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.no_collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> delayed_safe_distance.collision_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> right <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"u <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≠</span> other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> collision_react_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"u <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> ego2.s <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def comp_def τ_def 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> pos_react <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">≤</span> <span class="skolem">t</span><span class="main">+</span> <span class="free">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ego2.init_s<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"other.s <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">=</span> delayed_safe_distance.other.s <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> delayed_other_s_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ego2.s <span class="skolem">t</span> <span class="main">≠</span> delayed_safe_distance.other.s <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ineq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delayed_cond1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">&gt;</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.no_collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s_stop <span class="main">=</span> u_max"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> ego2.s_t_stop ego2.p_max_eq u_max_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ego2.s_stop <span class="main">&lt;</span> other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.no_collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delayed_safe_distance.cond_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cond_3r_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"u_max <span class="main">&lt;</span> other.s_stop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">&gt;</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> no_collision_union<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> no_collision_react_initially<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delayed_safe_distance.no_collision <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> delayed_cond1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> translate_no_collision_range <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="free">δ</span> <span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_2r_correct_for_3r_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">&gt;</span> u_max"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> other.p_def other.p_max_def other.p_max_eq other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s_stop <span class="main">&gt;</span> u_max"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.s_def <span class="keyword1"><span class="command">using</span></span> u_max_eq other.t_stop_def
    <span class="keyword1"><span class="command">using</span></span> ego.q_def other.p_def other.p_max_def other.s_def other.s_t_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> cond_1r cond_3r_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_3r_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_3r"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_collision_react <span class="main">{</span><span class="main">0</span> <span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_3r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"other.s <span class="free">δ</span> <span class="main">&gt;</span> u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> other.s_def u_max_eq assms<span class="main">(</span>2<span class="main">)</span> ego.q_def other.p_def pos_react <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cond_1r cond_3r_3 delayed_other_s_stop_eq delayed_safe_distance.other.s0_le_s_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sd_2_at_least_sd_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> other.t_stop"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"safe_distance_3r <span class="main">≥</span> safe_distance_2r"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">=</span> other.t_stop <span class="main">∨</span> <span class="free">δ</span> <span class="main">&lt;</span> other.t_stop"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"safe_distance_3r <span class="main">=</span> safe_distance_2r <span class="main">∨</span> safe_distance_3r <span class="main">&gt;</span> safe_distance_2r"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Meson.disj_forward<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">=</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">=</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>  <span class="main">*</span> other.t_stop <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> movement.t_stop_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"safe_distance_3r <span class="main">=</span> safe_distance_2r"</span></span>
        <span class="keyword1"><span class="command">using</span></span> other.p_def other.p_max_def other.p_max_eq safe_distance_2r_def safe_distance_3r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> other.t_stop"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> other.decel other.p'_def other.p'_pos_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">+</span> other.t_stop<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> other.t_stop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">-</span> other.t_stop<span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">+</span> other.t_stop<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">-</span> other.t_stop<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&lt;</span> other.t_stop›</span></span>  mult_less_cancel_left_neg<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">-</span> other.t_stop"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">+</span> other.t_stop<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">δ</span> <span class="main">+</span> other.t_stop<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">-</span> other.t_stop<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> other.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square square_diff_square_factored<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">-</span> other.t_stop<span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> other.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">-</span> other.t_stop<span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">+</span> other.t_stop<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">δ</span> <span class="main">-</span> other.t_stop<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> divide_divide_eq_left divide_divide_eq_right times_divide_eq_left<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.t_stop  <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span>  <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> other.t_stop<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span>  <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> movement.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"safe_distance_3r <span class="main">&gt;</span> safe_distance_2r"</span></span>
        <span class="keyword1"><span class="command">using</span></span> other.p_def other.p_max_def other.p_max_eq other.t_stop_def safe_distance_2r_def safe_distance_3r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Checker Design›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define two checkers for different cases: 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> one checker for the case that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>δ ≤ other.t_stop (other.t_stop = - v<span class="hidden">⇩</span><sub>o</sub> / a<span class="hidden">⇩</span><sub>o</sub>)›</span></span></span></span>
  <span class="antiquoted"><span class="antiquoted">▪</span></span> a second checker for the case that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>δ &gt; other.t_stop›</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">check_precond_r1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">check_precond_r1</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">≤</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance0</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_1r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_1r</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_2r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_2r</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_4r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_4r</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance_3r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance_3r</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker_r1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker_r1</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">≡</span> 
    <span class="keyword1">let</span> <span class="bound">distance</span>      <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
				<span class="bound">precond</span>       <span class="main">=</span> check_precond_r1 <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">vo_star</span>       <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">t_stop_o_star</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">vo_star</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">t_stop_e</span>      <span class="main">=</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">safe_dist0</span>    <span class="main">=</span> safe_distance_1r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist1</span>    <span class="main">=</span> safe_distance_2r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist2</span>    <span class="main">=</span> safe_distance_4r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist3</span>    <span class="main">=</span> safe_distance_3r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span>
    <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="main">¬</span> <span class="bound">precond</span> <span class="keyword1">then</span> False
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist0</span> <span class="main">∨</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist3</span> <span class="keyword1">then</span> True
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="bound">vo_star</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="bound">t_stop_e</span> <span class="main">&lt;</span> <span class="bound">t_stop_o_star</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist2</span>
      <span class="keyword1">else</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist1</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker_r1_correctness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">⟷</span> check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> 
   safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> checker_r1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">have</span></span> sdn'<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_precond_r1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdn<span class="main">:</span> safe_distance_normal <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
    <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sdn.distance0 <span class="main">=</span> safe_distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_1r <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_2r <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_4r <span class="main">=</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_3r <span class="main">=</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> sdn' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> "</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.distance0_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_1r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_1r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_2r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> "</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_4r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_4r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_3r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_3r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">so_delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">so_delta</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q_e_delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q_e_delta</span> <span class="main">≡</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u_stop_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u_stop_e</span> <span class="main">≡</span> <span class="skolem">q_e_delta</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vo_star</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vo_star</span> <span class="main">=</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t_stop_o_star</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t_stop_o_star</span> <span class="main">≡</span> <span class="main">-</span> <span class="skolem">vo_star</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t_stop_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t_stop_e</span> <span class="main">=</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≡</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance0</span> <span class="main">=</span> safe_distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist0</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist2</span> <span class="main">≡</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist1</span> <span class="main">≡</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist3</span> <span class="main">=</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> abb <span class="main">=</span> so_delta_def q_e_delta_def u_stop_e_def vo_star_def t_stop_o_star_def t_stop_e_def
             distance_def safe_dist2_def safe_dist1_def safe_dist0_def safe_dist3_def distance0_def
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist3</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist0</span> <span class="main">∧</span> <span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sdn.sd_1r_correct <span class="keyword1"><span class="command">unfolding</span></span>  abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">hence</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sdn.distance0_at_most_sd3r <span class="keyword1"><span class="command">unfolding</span></span> abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_def sdn.ego.q_def
      sdn.other.s_def sdn.other.t_stop_def sdn.other.p_def abb check_precond_r1_def sdn.distance0_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">interpret</span></span> sdr<span class="main">:</span> safe_distance_no_collsion_delta <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r1_def <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sdr.sd_3r_correct 2 pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def abb sdn.other.t_stop_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.other.s <span class="free">δ</span> <span class="main">≤</span> sdn.u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def sdn.other.s_def sdn.other.t_stop_def
      sdn.other.p_def sdn.u_max_eq sdn.ego.q_def abb sdn.safe_distance_3r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">vo_star</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">t_stop_e</span> <span class="main">&lt;</span> <span class="skolem">t_stop_o_star</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span>  <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">vo_star</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">t_stop_e</span> <span class="main">&lt;</span> <span class="skolem">t_stop_o_star</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">vo_star</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">t_stop_e</span> <span class="main">&lt;</span> <span class="skolem">t_stop_o_star</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 3 pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> checker_r1_def
          Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sdn.distance0_at_most_sd4r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abb <span class="keyword1"><span class="command">using</span></span> cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_def sdn.ego.q_def
          sdn.other.s_def sdn.other.t_stop_def sdn.other.p_def abb check_precond_r1_def sdn.distance0_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">interpret</span></span> sdr<span class="main">:</span> safe_distance_no_collsion_delta <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r1_def <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sdr.sd_4r_correct<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹sdn.other.s <span class="free">δ</span> <span class="main">≤</span> sdn.u_max›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist2</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pre cond  <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def sdn.other.t_stop_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> not_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>  <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">vo_star</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">t_stop_e</span> <span class="main">&lt;</span> <span class="skolem">t_stop_o_star</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 3 pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> checker_r1_def
        Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sdn.dist0_sd2r_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre not_cond <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def
        sdn.other.t_stop_def sdn.other.s'_def sdn.other.p'_def abb <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_def sdn.ego.q_def
          sdn.other.s_def sdn.other.t_stop_def sdn.other.p_def abb check_precond_r1_def sdn.distance0_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">interpret</span></span> sdr<span class="main">:</span> safe_distance_no_collsion_delta <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r1_def <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sdr.sd_2r_correct_for_3r_2<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹sdn.other.s <span class="free">δ</span> <span class="main">≤</span> sdn.u_max›</span></span><span class="main">]</span> not_cond <span class="quoted"><span class="quoted">‹<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> abb sdn.other.s'_def check_precond_r1_def sdn.other.t_stop_def sdn.other.p'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> pre <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> sdn.no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> as2<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> as1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">so_delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">so_delta</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q_e_delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q_e_delta</span> <span class="main">≡</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">+</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u_stop_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u_stop_e</span> <span class="main">≡</span> <span class="skolem">q_e_delta</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vo_star</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vo_star</span> <span class="main">≡</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t_stop_o_star</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t_stop_o_star</span> <span class="main">≡</span> <span class="main">-</span> <span class="skolem">vo_star</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t_stop_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t_stop_e</span> <span class="main">≡</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≡</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance0</span> <span class="main">≡</span> safe_distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist0</span> <span class="main">≡</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist2</span> <span class="main">≡</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist1</span> <span class="main">≡</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist3</span> <span class="main">≡</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> abb <span class="main">=</span> so_delta_def q_e_delta_def u_stop_e_def vo_star_def t_stop_o_star_def t_stop_e_def
               distance_def safe_dist2_def safe_dist1_def safe_dist0_def safe_dist3_def distance0_def
    <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">have</span></span> sdn'<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_precond_r1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> sdn<span class="main">:</span> safe_distance_normal <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
      <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sdn.distance0 <span class="main">=</span> safe_distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
               <span class="quoted"><span class="quoted">"sdn.safe_distance_1r <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
               <span class="quoted"><span class="quoted">"sdn.safe_distance_2r <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
               <span class="quoted"><span class="quoted">"sdn.safe_distance_4r <span class="main">=</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
               <span class="quoted"><span class="quoted">"sdn.safe_distance_3r <span class="main">=</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> sdn' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance0 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> "</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.distance0_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_1r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_1r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_2r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> "</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_4r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_4r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_3r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_3r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span> <span class="main">∨</span>  <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">distance0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sdn.cond_3r_1' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def abb
        sdn.other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sdn.collision_react_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> if2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist0</span> <span class="main">∨</span> <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">safe_dist0</span> <span class="main">&lt;</span> <span class="skolem">distance</span> <span class="main">∨</span> <span class="skolem">safe_dist3</span> <span class="main">&lt;</span> <span class="skolem">distance</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">safe_dist0</span> <span class="main">&lt;</span> <span class="skolem">distance</span> <span class="main">∨</span> <span class="skolem">safe_dist3</span> <span class="main">&lt;</span> <span class="skolem">distance</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> as1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> pre if2 <span class="keyword1"><span class="command">unfolding</span></span> checker_r1_def Let_def abb
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> if31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> if32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> if2 pre <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_def sdn.ego.q_def
          sdn.other.s_def sdn.other.t_stop_def sdn.other.p_def abb check_precond_r1_def sdn.distance0_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">interpret</span></span> sdr<span class="main">:</span> safe_distance_no_collsion_delta <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r1_def <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> sdn.u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> if31 <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_max_eq sdn.ego.q_def abb
        sdn.safe_distance_1r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.other.s <span class="free">δ</span> <span class="main">≤</span> sdn.u_max"</span></span> <span class="keyword1"><span class="command">using</span></span> if32 pre <span class="keyword1"><span class="command">unfolding</span></span> sdn.other.s_def check_precond_r1_def
        sdn.other.t_stop_def sdn.other.p_def sdn.u_max_eq sdn.ego.q_def abb sdn.safe_distance_3r_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">vo_star</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">t_stop_e</span> <span class="main">&lt;</span> <span class="skolem">t_stop_o_star</span><span class="main">)</span>"</span></span> <span class="main">|</span>
               <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">vo_star</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="skolem">t_stop_e</span> <span class="main">&lt;</span> <span class="skolem">t_stop_o_star</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">hence</span></span> rest_conjunct<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> sdn.other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">-</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> sdn.other.s' <span class="free">δ</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def <span class="keyword1"><span class="command">unfolding</span></span> sdn.other.s'_def sdn.other.t_stop_def
          sdn.other.p'_def abb <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as1 pre if2 if31 if32 <span class="keyword1"><span class="command">unfolding</span></span> checker_r1_def
          Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> cond_f<span class="main">:</span> <span class="quoted"><span class="quoted">"sdn.other.s <span class="free">δ</span> <span class="main">-</span> sdn.ego.q <span class="free">δ</span> <span class="main">≤</span> sdr.delayed_safe_distance.snd_safe_distance"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r1_def sdn.other.s_def sdn.other.t_stop_def sdn.other.p_def
          sdn.ego.q_def sdr.delayed_safe_distance.snd_safe_distance_def <span class="keyword1"><span class="command">using</span></span> sdn.other.s'_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> sdn.other.t_stop_def sdn.other.p'_def abb sdn.safe_distance_4r_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span> <span class="main">∨</span> <span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u_max <span class="main">&lt;</span> sdn.other.s_stop"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_max_eq sdn.ego.q_def sdn.other.s_t_stop
              sdn.other.p_max_eq abb sdn.safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> sdr.cond_3r_2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> sdn.u_max›</span></span> this <span class="quoted"><span class="quoted">‹sdn.other.s <span class="free">δ</span> <span class="main">≤</span> sdn.u_max›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cond_f rest_conjunct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist1</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u_max <span class="main">≥</span> sdn.other.s_stop"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_max_eq sdn.ego.q_def sdn.other.s_t_stop
              sdn.other.p_max_eq abb sdn.safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> sdn.cond_2r<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as1 pre if2 if31 if32 <span class="keyword1"><span class="command">unfolding</span></span> checker_r1_def
          Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u_max <span class="main">≥</span> sdn.other.s_stop"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sdn.u_max_eq sdn.ego.q_def sdn.other.s_t_stop
          sdn.other.p_max_eq abb sdn.safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> sdn.cond_2r<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">check_precond_r2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">check_precond_r2</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safe_distance0_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">safe_distance0_2</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker_r2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker_r2</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">≡</span> 
    <span class="keyword1">let</span> <span class="bound">distance</span>   <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
				<span class="bound">precond</span>    <span class="main">=</span> check_precond_r2 <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist0</span> <span class="main">=</span> safe_distance_1r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist1</span> <span class="main">=</span> safe_distance_2r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> 
    <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="main">¬</span> <span class="bound">precond</span> <span class="keyword1">then</span> False
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist0</span> <span class="keyword1">then</span> True
      <span class="keyword1">else</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist1</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker_r2_correctness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">⟷</span> check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> 
    safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> checker_r2_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">have</span></span> sdn'<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_precond_r2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdn<span class="main">:</span> safe_distance_normal <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
    <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sdn.distance0_2 <span class="main">=</span> safe_distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_1r <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_2r <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> sdn' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.distance0_2_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance0_2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_1r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_1r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_2r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≡</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance0_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance0_2</span> <span class="main">=</span> safe_distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist0</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist1</span> <span class="main">≡</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> abb <span class="main">=</span> distance_def safe_dist1_def safe_dist0_def distance0_2_def
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sdn.sd_1r_correct <span class="keyword1"><span class="command">unfolding</span></span> abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">≤</span> sdn.u_max<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distance_def safe_dist0_def sdn.sd_1r_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">with</span></span> 2 pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> checker_r2_def Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sdn.dist0_sd2r_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0_2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abb <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&lt;</span> <span class="free">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abb sdn.distance0_2_eq <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> sdn.other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.u_max <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abb sdn.sd2r_eq  <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> sdn.other.t_stop_def <span class="quoted"><span class="quoted">‹<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">interpret</span></span> sdr<span class="main">:</span> safe_distance_no_collsion_delta <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r2_def <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sdr.sd_2r_correct_for_3r_3<span class="main">[</span><span class="operator">OF</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist1</span>›</span></span> <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span> <span class="quoted"><span class="quoted">‹sdn.u_max <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> abb sdn.other.s'_def check_precond_r2_def sdn.other.t_stop_def sdn.other.p'_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> pre <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> sdn.no_collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> as2<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> as1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≡</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">distance0_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance0_2</span> <span class="main">=</span> safe_distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist0</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">safe_dist1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">safe_dist1</span> <span class="main">≡</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> abb <span class="main">=</span> distance_def safe_dist1_def safe_dist0_def distance0_2_def
    <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">have</span></span> sdn'<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_precond_r2_def<span class="main">)</span>
   <span class="keyword1"><span class="command">interpret</span></span> sdn<span class="main">:</span> safe_distance_normal <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
    <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"sdn.distance0_2 <span class="main">=</span> safe_distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_1r <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"sdn.safe_distance_2r <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> sdn' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance0_2 <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.distance0_2_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance0_2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_1r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_1r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"safe_distance_normal.safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">=</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> safe_distance_normal.safe_distance_2r_def<span class="main">[</span><span class="operator">OF</span> sdn'<span class="main">]</span> safe_distance_2r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0_2</span> <span class="main">∨</span>  <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0_2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0_2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">distance0_2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sdn.cond_3r_1'_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">δ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> check_precond_r2_def abb sdn.other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sdn.collision_react_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> if2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">distance0_2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">distance</span> <span class="main">&gt;</span> <span class="skolem">safe_dist0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">safe_dist0</span> <span class="main">&lt;</span> <span class="skolem">distance</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">safe_dist0</span> <span class="main">&lt;</span> <span class="skolem">distance</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> as1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> pre if2 <span class="keyword1"><span class="command">unfolding</span></span> checker_r2_def Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> if3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as1 <span class="keyword1"><span class="command">unfolding</span></span> checker_r2_def Let_def abb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abb if2 sdn.distance0_2_eq <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> sdn.other.t_stop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pre <span class="keyword1"><span class="command">interpret</span></span> sdr<span class="main">:</span> safe_distance_no_collsion_delta <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="quoted"><span class="free">δ</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r2_def <span class="quoted"><span class="quoted">‹sdn.u <span class="free">δ</span> <span class="main">&lt;</span> sdn.other.s <span class="free">δ</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.u_max <span class="main">≥</span> sdn.other.s <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abb sdn.sd2r_eq  <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> sdn.other.t_stop_def <span class="quoted"><span class="quoted">‹<span class="skolem">distance</span> <span class="main">≤</span> <span class="skolem">safe_dist1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdn.u_max <span class="main">≥</span> sdn.other.s_stop"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sdn.other.s_mono sdn.other.t_stop_nonneg sdn.other.p_t_stop sdn.other.p_zero sdn.other.t_stop_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sdn.other.s_def movement.t_stop_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> sdn.other.p_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sdn.collision_react <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sdn.cond_2r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Combine the two checkers into one.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">check_precond_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">check_precond_r</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">checker_r</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">≡</span> 
    <span class="keyword1">let</span> <span class="bound">distance</span>      <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
				<span class="bound">precond</span>       <span class="main">=</span> check_precond_r <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">vo_star</span>       <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">t_stop_o_star</span> <span class="main">=</span> <span class="main">-</span><span class="bound">vo_star</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">t_stop_e</span>      <span class="main">=</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span><span class="main">;</span>
        <span class="bound">t_stop_o</span>      <span class="main">=</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span><span class="main">;</span>
        <span class="bound">safe_dist0</span>    <span class="main">=</span> safe_distance_1r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist1</span>    <span class="main">=</span> safe_distance_2r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist2</span>    <span class="main">=</span> safe_distance_4r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span><span class="main">;</span>
        <span class="bound">safe_dist3</span>    <span class="main">=</span> safe_distance_3r <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> 
    <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="main">¬</span> <span class="bound">precond</span> <span class="keyword1">then</span> False
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist0</span> <span class="keyword1">then</span> True
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">≤</span> <span class="bound">t_stop_o</span> <span class="main">∧</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist3</span> <span class="keyword1">then</span> True
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">≤</span> <span class="bound">t_stop_o</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>o</sub></span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="bound">vo_star</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>e</sub></span></span></span> <span class="main">∧</span> <span class="bound">t_stop_e</span> <span class="main">&lt;</span> <span class="bound">t_stop_o_star</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist2</span>
      <span class="keyword1">else</span> <span class="bound">distance</span> <span class="main">&gt;</span> <span class="bound">safe_dist1</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker_eq_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>  <span class="main">⟷</span> checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>
        <span class="main">∨</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>
        <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> checker_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span>
        <span class="main">∨</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>
        <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r_def check_precond_r1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> checker_r1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker_eq_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⟷</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∨</span>
   <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">∨</span>
   <span class="main">(</span><span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_3r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span> <span class="main">∨</span>
   <span class="main">(</span><span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">&gt;</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">∧</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">+</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_4r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span> <span class="main">∨</span>
   <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> checker_r_def Let_def if_splits <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>
   <span class="main">∧</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">∨</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span>
   <span class="main">∧</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>HOL.disjE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>
   <span class="main">∧</span> <span class="main">(</span><span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_1r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">δ</span> <span class="main">∨</span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">-</span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">&gt;</span> safe_distance_2r <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r_def check_precond_r2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>checker_r2_def Let_def if_splits<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> checker_r_correctness<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">⟷</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">⟷</span> <span class="main">(</span>checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>checker_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> <span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> checker_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∨</span> checker_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> checker_eq_1 checker_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span>check_precond_r1 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span>check_precond_r2 <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> checker_r1_correctness checker_r2_correctness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">δ</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span><span class="free">δ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">/</span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">∧</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>check_precond_r_def check_precond_r1_def check_precond_r2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> check_precond_r <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">∧</span> safe_distance_normal.no_collision_react <span class="free">a<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">s<span class="hidden">⇩</span><sub>o</sub></span> <span class="free">δ</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Evaluation">
<div class="head">
<h1>Theory Evaluation</h1>
</div>
<pre class="source"><span class="comment1">✐‹creator "Albert Rizaldi" "Fabian Immler›</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Evaluation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Evaluation
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Safe_Distance.html">Safe_Distance</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Float.html">HOL-Library.Float</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Generation Setup for Numeric Values›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_div_down</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">real_div_down</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> truncate_down <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_div_up</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">real_div_up</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> truncate_up <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> float.lifting <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> float_div_down <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> float"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real_div_down</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_div_down_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> float_div_up <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> float"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real_div_up</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_div_up_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compute_float_div_up<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"float_div_up <span class="free">p</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="main">-</span> float_div_down <span class="free">p</span> <span class="main">(</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">including</span></span> float.lifting
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_div_up_def real_div_down_def truncate_up_eq_truncate_down<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compute_float_div_down<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"float_div_down <span class="free">prec</span> <span class="free">m1</span> <span class="free">m2</span> <span class="main">=</span> lapprox_rat <span class="main">(</span>Suc <span class="free">prec</span><span class="main">)</span> <span class="free">m1</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">including</span></span> float.lifting <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_div_down_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real2_of_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real2_of_real</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>truncate_down <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> truncate_up <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> float.lifting <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> float2_of_real <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> float <span class="main">×</span> float"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real2_of_real</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real2_of_real_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">float2_opt_of_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> float interval option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">float2_opt_of_real</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Interval' <span class="main">(</span>fst <span class="main">(</span>float2_of_real <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>float2_of_real <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Fraction_Field.Fract
<span class="keyword1"><span class="command">lemma</span></span> real_of_rat_Fract<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fract_of_int_quotient of_rat_divide<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"float2_of_real <span class="free">p</span> <span class="main">(</span>Ratreal <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> quotient_of <span class="free">r</span> <span class="keyword1">in</span>
  <span class="main">(</span>float_div_down <span class="free">p</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">,</span> float_div_up <span class="free">p</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">including</span></span> float.lifting
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real2_of_real_def real_div_down_def real_div_up_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> of_rat_divide of_rat_of_int_eq quotient_of_div<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">real_of_dec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"integer <span class="main">×</span> integer <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_of_dec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
    real_of_int <span class="main">(</span>int_of_integer <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">10</span> <span class="main">^</span> <span class="main">(</span>nat_of_integer <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">else</span> inverse <span class="main">(</span><span class="numeral">10</span> <span class="main">^</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="main">(</span>int_of_integer <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"real_of_dec <span class="main">(</span><span class="free">m</span><span class="main">,</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> int_of_integer <span class="free">m</span> <span class="main">*</span> <span class="numeral">10</span> <span class="keyword1">powr</span> <span class="main">(</span>int_of_integer <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> real <span class="main">(</span>nat_of_integer <span class="free">e</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="main">(</span>int_of_integer <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_integer.rep_eq nat_of_integer.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> real_of_int <span class="main">(</span>int_of_integer <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> real <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> int_of_integer <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_integer.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Data Evaluation›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trans6</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">trans6</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">chk</span></span></span>    <span class="free"><span class="bound"><span class="entity">se</span></span></span>     <span class="free"><span class="bound"><span class="entity">ve</span></span></span>     <span class="free"><span class="bound"><span class="entity">ae</span></span></span>     <span class="free"><span class="bound"><span class="entity">so</span></span></span>     <span class="free"><span class="bound"><span class="entity">vo</span></span></span>     <span class="free"><span class="bound"><span class="entity">ao</span></span></span> <span class="main">=</span>
            <span class="free"><span class="bound"><span class="entity">chk</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">se</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">ve</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">ae</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">so</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">vo</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">ao</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">checker_dec</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">checker_dec</span> <span class="free"><span class="bound"><span class="entity">chk</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> 
    trans6 <span class="main">(</span>float2_opt_of_real <span class="main">(</span>nat_of_integer <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="keyword1">o</span> real_of_dec<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">chk</span></span></span> <span class="main">(</span>nat_of_integer <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">checker_interval</span> <span class="main">=</span> checker_dec checker'"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">checker_symbolic</span> <span class="main">=</span> trans6 real_of_dec symbolic_checker"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">checker_rational</span> <span class="main">=</span> trans6 real_of_dec checker"</span></span>
<span class="keyword1"><span class="command">lemmas</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> movement.p_def

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
  <span class="keyword1"><span class="keyword">exception</span></span> <span class="entity">InvalidArgument</span> <span class="keyword2"><span class="keyword">of</span></span> string<span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">split_string</span> <span class="entity">s</span> <span class="main">=</span> String.fields <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="entity">c</span> <span class="main">=</span> the <span class="main">(</span>Char.fromString <span class="entity">s</span><span class="main">)</span><span class="main">)</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dec_of_string</span> <span class="entity">s</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">split_string</span> <span class="inner_quoted">"."</span> <span class="entity">s</span>
    <span class="keyword2"><span class="keyword">of</span></span> <span class="main">[</span><span class="entity">r</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span>the <span class="main">(</span>IntInf.fromString <span class="entity">r</span><span class="main">)</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span><span class="entity">d1</span><span class="main">,</span> <span class="entity">d2</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span>the <span class="main">(</span>IntInf.fromString <span class="main">(</span><span class="entity">d1</span> ^ <span class="entity">d2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> ~ <span class="main">(</span>String.size <span class="entity">d2</span><span class="main">)</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> <span class="main">(</span><span class="entity">InvalidArgument</span> <span class="entity">s</span><span class="main">)</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check_string</span> <span class="entity">chk</span> <span class="entity">data</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">split_string</span> <span class="inner_quoted">","</span> <span class="entity">data</span> <span class="keyword2"><span class="keyword">of</span></span>
      <span class="main">[</span><span class="main">_</span><span class="main">,</span> <span class="entity">so</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="entity">ve</span><span class="main">,</span> <span class="entity">ae</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="entity">vo</span><span class="main">,</span> <span class="entity">ao</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="entity">chk</span> <span class="entity">data</span> <span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span>
        <span class="main">(</span><span class="entity">dec_of_string</span> <span class="entity">ve</span><span class="main">)</span> <span class="main">(</span><span class="entity">dec_of_string</span> <span class="entity">ae</span><span class="main">)</span> <span class="main">(</span><span class="entity">dec_of_string</span> <span class="entity">so</span><span class="main">)</span> <span class="main">(</span><span class="entity">dec_of_string</span> <span class="entity">vo</span><span class="main">)</span> <span class="main">(</span><span class="entity">dec_of_string</span> <span class="entity">ao</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> <span class="main">(</span><span class="entity">InvalidArgument</span> <span class="entity">data</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The precision of the input data is roughly 12 and yields similar performance as Sturm›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prec</span> <span class="main">=</span> <span class="inner_numeral">12</span>

<span class="keyword2"><span class="keyword">local</span></span>

<span class="keyword1"><span class="keyword">exception</span></span> <span class="entity">Result</span> <span class="keyword2"><span class="keyword">of</span></span> int * int<span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check_line</span> <span class="entity">chk</span> <span class="entity">n</span> <span class="entity">l</span> <span class="main">(</span><span class="entity">y</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">l</span> <span class="main">=</span> String.substring <span class="main">(</span><span class="entity">l</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> String.size <span class="entity">l</span> - <span class="inner_numeral">1</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="entity">check_string</span> <span class="entity">chk</span> <span class="entity">l</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">i</span> &lt; <span class="entity">n</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">c</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">y</span> + <span class="inner_numeral">1</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">y</span><span class="main">,</span> <span class="entity">i</span> + <span class="inner_numeral">1</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword3"><span class="keyword">raise</span></span> <span class="entity">Result</span> <span class="main">(</span><span class="entity">y</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">in</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check_file</span> <span class="entity">chk</span> <span class="entity">path</span> <span class="entity">n</span> <span class="main">=</span>
  File.fold_lines <span class="main">(</span><span class="entity">check_line</span> <span class="entity">chk</span> <span class="entity">n</span><span class="main">)</span> <span class="entity">path</span> <span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span>
    <span class="keyword3"><span class="keyword">handle</span></span> <span class="entity">Result</span> <span class="entity">res</span> <span class="main">=&gt;</span> <span class="entity">res</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">check_file_symbolic</span>            <span class="main">=</span> <span class="entity">check_file</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">code</span><span class="hidden">&gt;</span></span><span class="quoted">‹checker_symbolic›</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check_file_interval</span> <span class="entity">prec</span> <span class="entity">uncer</span> <span class="main">=</span> <span class="entity">check_file</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">code</span><span class="hidden">&gt;</span></span><span class="quoted">‹checker_interval›</span></span></span> <span class="entity">prec</span> <span class="entity">uncer</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">check_file_rational</span>            <span class="main">=</span> <span class="entity">check_file</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">code</span><span class="hidden">&gt;</span></span><span class="quoted">‹checker_rational›</span></span></span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Number of data points:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> data01: 1121215
  <span class="antiquoted"><span class="antiquoted">▪</span></span> data02: 1341135
  <span class="antiquoted"><span class="antiquoted">▪</span></span> data03: 1452656
›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">data01</span> <span class="main">=</span> <span class="antiquoted"><span class="operator"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">master_dir</span><span class="hidden">&gt;</span></span></span></span> + <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">path</span><span class="hidden">&gt;</span></span>‹data/data01.csv›</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">data02</span> <span class="main">=</span> <span class="antiquoted"><span class="operator"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">master_dir</span><span class="hidden">&gt;</span></span></span></span> + <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">path</span><span class="hidden">&gt;</span></span>‹data/data02.csv›</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">data03</span> <span class="main">=</span> <span class="antiquoted"><span class="operator"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">master_dir</span><span class="hidden">&gt;</span></span></span></span> + <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">path</span><span class="hidden">&gt;</span></span>‹data/data03.csv›</span></span>
›</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t_start1</span> <span class="main">=</span> Timing.start <span class="main">(</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result1</span> <span class="main">=</span> <span class="entity">check_file_rational</span> <span class="entity">data01</span> <span class="inner_numeral">100</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t_end1</span> <span class="main">=</span> Timing.result <span class="entity">t_start1</span><span class="main">;</span>
    <span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">assert</span><span class="hidden">&gt;</span></span></span></span></span> <span class="main">(</span><span class="entity">result1</span> <span class="main">=</span> <span class="main">(</span><span class="inner_numeral">96</span><span class="main">,</span> <span class="inner_numeral">100</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t_start2</span> <span class="main">=</span> Timing.start <span class="main">(</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result2</span> <span class="main">=</span> <span class="entity">check_file_rational</span> <span class="entity">data02</span> <span class="inner_numeral">100</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t_end2</span> <span class="main">=</span> Timing.result <span class="entity">t_start2</span><span class="main">;</span>
    <span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">assert</span><span class="hidden">&gt;</span></span></span></span></span> <span class="main">(</span><span class="entity">result2</span> <span class="main">=</span> <span class="main">(</span><span class="inner_numeral">100</span><span class="main">,</span> <span class="inner_numeral">100</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t_start3</span> <span class="main">=</span> Timing.start <span class="main">(</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result3</span> <span class="main">=</span> <span class="entity">check_file_rational</span> <span class="entity">data03</span> <span class="inner_numeral">100</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t_end3</span> <span class="main">=</span> Timing.result <span class="entity">t_start3</span><span class="main">;</span>
    <span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">assert</span><span class="hidden">&gt;</span></span></span></span></span> <span class="main">(</span><span class="entity">result3</span> <span class="main">=</span> <span class="main">(</span><span class="inner_numeral">76</span><span class="main">,</span> <span class="inner_numeral">100</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Precision: 12, Uncertainty: 7 digits›</span></span>
<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹<span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">assert</span><span class="hidden">&gt;</span></span></span></span></span> <span class="main">(</span><span class="entity">check_file_interval</span> <span class="inner_numeral">12</span> <span class="inner_numeral">7</span> <span class="entity">data01</span> <span class="inner_numeral">100</span> <span class="main">=</span> <span class="main">(</span><span class="inner_numeral">95</span><span class="main">,</span> <span class="inner_numeral">100</span><span class="main">)</span><span class="main">)</span>›</span>
<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹<span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">assert</span><span class="hidden">&gt;</span></span></span></span></span> <span class="main">(</span><span class="entity">check_file_rational</span> <span class="entity">data01</span> <span class="inner_numeral">100</span> <span class="main">=</span> <span class="main">(</span><span class="inner_numeral">96</span><span class="main">,</span> <span class="inner_numeral">100</span><span class="main">)</span><span class="main">)</span>›</span>
<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹<span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span class="hidden">\&lt;^</span><span class="control">assert</span><span class="hidden">&gt;</span></span></span></span></span> <span class="main">(</span><span class="entity">check_file_symbolic</span> <span class="entity">data01</span> <span class="inner_numeral">100</span> <span class="main">=</span> <span class="main">(</span><span class="inner_numeral">96</span><span class="main">,</span> <span class="inner_numeral">100</span><span class="main">)</span><span class="main">)</span>›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>