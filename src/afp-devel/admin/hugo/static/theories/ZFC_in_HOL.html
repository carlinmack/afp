<div id="ZFC_Library">
<div class="head">
<h1>Theory ZFC_Library</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ZFC_Library
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Countable_Set.html">HOL-Library.Countable_Set</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Library/Equipollence.html">HOL-Library.Equipollence</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Cardinals/Cardinals.html">HOL-Cardinals.Cardinals</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Equipollence and Lists.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> countable_iff_lepoll<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="free">A</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">≲</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> countable_def lepoll_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_times_eqpoll_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">×</span> <span class="free">A</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Times_same_infinite_bij_betw assms eqpoll_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_finite_times_lepoll_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">×</span> <span class="free">B</span> <span class="main">≲</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≲</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms finite_lepoll_infinite<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">×</span> <span class="free">B</span> <span class="main">≲</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_imp_lepoll times_lepoll_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">A</span>›</span></span> infinite_times_eqpoll_self<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lists_n_lepoll_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≲</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Set.set_insert assms ex_in_conv finite.emptyI singleton_lepoll<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> Suc <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">l</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">#</span><span class="bound">l</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_Suc_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≲</span> <span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lepoll_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">.</span> Cons <span class="bound">x</span> <span class="bound">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≲</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms infinite_finite_times_lepoll_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">≲</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.IH subset_imp_lepoll times_lepoll_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms infinite_times_eqpoll_self<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_eqpoll_lists<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lists <span class="free">A</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lists <span class="free">A</span> <span class="main">≲</span> Sigma UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> lists <span class="free">A</span><span class="main">.</span> length <span class="bound">l</span> <span class="main">=</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lepoll_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">snd</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_listsI snd_image_Sigma<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≲</span> <span class="main">(</span>UNIV<span class="main">::</span>nat set<span class="main">)</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sigma_lepoll_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lists_n_lepoll_self assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≲</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms infinite_le_lepoll order_refl subset_imp_lepoll times_lepoll_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms infinite_times_eqpoll_self<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lepoll_antisym lepoll_lists<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ZFC_in_HOL">
<div class="head">
<h1>Theory ZFC_in_HOL</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The ZF Axioms, Ordinals and Transfinite Recursion›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ZFC_in_HOL
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ZFC_Library.html">ZFC_Library</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Syntax and axioms›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> list.set Sum subset

<span class="keyword1"><span class="command">notation</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Inf <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Sup <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">typedecl</span></span> V

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Presentation refined by Dmitriy Traytel›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="free">elts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V set"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> ext <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">elts</span> <span class="free">x</span> <span class="main">=</span> <span class="free">elts</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> down_raw<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">elts</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">∈</span> range <span class="free">elts</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> Union_raw<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> range <span class="free">elts</span> <span class="main">⟹</span> Union <span class="main">(</span><span class="free">elts</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> range <span class="free">elts</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> Pow_raw<span class="main">:</span>         <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> range <span class="free">elts</span> <span class="main">⟹</span> inv <span class="free">elts</span> <span class="main">`</span> Pow <span class="free">X</span> <span class="main">∈</span> range <span class="free">elts</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> replacement_raw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> range <span class="free">elts</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">∈</span> range <span class="free">elts</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> inf_raw<span class="main">:</span>         <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="free">g</span> <span class="main">::</span> nat <span class="main">⇒</span> V<span class="main">)</span> <span class="main">∈</span> range <span class="free">elts</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> foundation<span class="main">:</span>      <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">elts</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_not_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> elts <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wf_not_refl <span class="main">[</span><span class="operator">OF</span> foundation<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_not_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> elts <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wf_not_sym <span class="main">[</span><span class="operator">OF</span> foundation<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A set is small if it can be injected into the extension of a V-set.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">small</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">small</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">V_of</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> V<span class="main">.</span> inj_on <span class="bound">V_of</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="bound">V_of</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> range elts"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_empty <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> small_def down_raw<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_iff_range<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">∈</span> range elts"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> small_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_on_id2 replacement_raw the_inv_into_onto<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Small classes can be mapped to sets.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>   <span class="quoted"><span class="quoted">"<span class="free">set</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> small <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1">then</span> inv elts <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1">else</span> inv elts <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_elts <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>elts <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext set_def f_inv_into_f small_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_of_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>set <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> small <span class="free">X</span> <span class="keyword1">then</span> <span class="free">X</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ZFC_in_HOL.set_def down_raw f_inv_into_f small_iff_range<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> down<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> elts <span class="free">x</span> <span class="main">⟹</span> small <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> down_raw small_iff_range<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Union <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span> <span class="main">⟹</span> small <span class="main">(</span>Union <span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_raw small_iff_range<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Pow<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span> <span class="main">⟹</span> small <span class="main">(</span>set <span class="main">`</span> Pow <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> small_iff_range <span class="keyword1"><span class="command">using</span></span> Pow_raw set_def down <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">declare</span></span> replacement_raw <span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> replacement <span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_into <span class="free">X</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> AX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subsetI inv_into_into<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> injo<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>inv_into <span class="free">X</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_on_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V_of</span><span class="main">.</span> inj_on <span class="bound">V_of</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">V_of</span> <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">∈</span> range elts"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">V_of</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V_of</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> elts <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">V_of</span> <span class="main">∘</span> inv_into <span class="free">X</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹inv_into <span class="free">X</span> <span class="free">f</span> <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> comp_inj_on inj_on_subset injo that<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">V_of</span> <span class="main">(</span>inv_into <span class="free">X</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> elts <span class="main">(</span>set <span class="main">(</span><span class="skolem">V_of</span> <span class="main">`</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX down elts_of_set image_image image_mono that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V_of</span> <span class="main">∘</span> inv_into <span class="free">X</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="free">X</span> <span class="main">∈</span> range elts"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_comp image_image rangeI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> small_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_image_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span> <span class="main">⟹</span> small <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> small <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> replacement the_inv_into_onto<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A little bootstrapping is needed to characterise <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">small</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for sets of arbitrary type.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>range <span class="main">(</span><span class="free">g</span> <span class="main">::</span> nat <span class="main">⇒</span> V<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_raw small_iff_range<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_image_nat_V <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> V"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> down elts_of_set image_iff inf rangeI subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Finite_V<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> small_image_nat_V<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_insert_V<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>insert <span class="free">a</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Finite_V<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_imp_bij_betw2 <span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> replacement Un_insert_right assms bij_betw_imp_surj_on sup_bot.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_UN_V <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> small <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ZFC_in_HOL.set <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Union <span class="main">[</span><span class="operator">OF</span> replacement <span class="main"><span class="main">[</span></span><span class="operator">OF</span> X<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ZFC_in_HOL.set <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vinsert</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vinsert</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> set <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>elts <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_vinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vinsert <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>elts <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> down small_insert_V vinsert_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">succ</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> vinsert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>elts <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_imp_small<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V_of</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">V_of</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V_of</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">=</span> elts <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> small_def image_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">V_of</span><span class="main">(</span><span class="skolem">a</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI mem_not_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V_of</span><span class="main">(</span><span class="skolem">a</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> insert <span class="skolem">a</span> <span class="skolem">X</span> <span class="main">=</span> elts <span class="main">(</span>vinsert <span class="skolem">u</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> u<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V_of</span><span class="main">(</span><span class="skolem">a</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> insert <span class="skolem">a</span> <span class="skolem">X</span> <span class="main">∈</span> range elts"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>insert <span class="free">a</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_imp_small<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_imp_bij_betw2 <span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> replacement Un_insert_right assms bij_betw_imp_surj_on sup_bot.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smaller_than_small<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down elts_of_set image_mono small_def small_iff_range subset_inj_on<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> small_insert_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>insert <span class="free">a</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟷</span> small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> small_insert smaller_than_small subset_insertI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> elts <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down elts_of_set subset_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_elts <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>elts <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> small_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_diff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>elts <span class="free">a</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset down<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>list.set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ZFC_in_HOL.finite_imp_small<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_upair<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> small_Un_elts<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>elts <span class="free">x</span> <span class="main">∪</span> elts <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Union <span class="main">[</span><span class="operator">OF</span> small_upair<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> small_eqcong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>small <span class="free">X</span><span class="main">;</span> <span class="free">X</span> <span class="main">≈</span> <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span> small <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on eqpoll_def replacement<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> big_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> small <span class="main">(</span>UNIV<span class="main">::</span>V set<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> small <span class="var">?U</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"small <span class="var">?U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> UNIV_I down small_iff subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range elts <span class="main">=</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> small_iff surj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantors_paradox Pow_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_set<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on set <span class="main">(</span>Collect small<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set inj_onI mem_Collect_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_injective <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>small <span class="free">X</span><span class="main">;</span> small <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span> set <span class="free">X</span> <span class="main">=</span> set <span class="free">Y</span> <span class="main">⟷</span> <span class="free">X</span><span class="main">=</span><span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Type classes and other basic setup›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">zero_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> set <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> succ <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> insert_neq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>insert <span class="free">a</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">¬</span> small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_V_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set empty_not_insert set_of_elts small_insert_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_eq_empty_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">x</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ZFC_in_HOL.ext<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">distrib_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inf_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inf_V</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> set <span class="main">(</span>elts <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∩</span> elts <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">sup_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_V</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> set <span class="main">(</span>elts <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> elts <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_V</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> elts <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊆</span> elts <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_V</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> less_eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>V<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> ext less_V_def less_eq_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext less_eq_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down elts_of_set inf_V_def inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_eq_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_lower2 down elts_of_set inf_V_def less_eq_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> inf <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>elts <span class="skolem">y</span> <span class="main">∩</span> elts <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> down inf.cobounded1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> elts_of_set inf_V_def less_eq_V_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_V_def small_Un_elts sup_V_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_V_def sup_V_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup <span class="skolem">x</span> <span class="main">(</span>inf <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> inf <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>sup <span class="skolem">x</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>elts <span class="skolem">y</span> <span class="main">∩</span> elts <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> down inf.cobounded2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_Int_distrib inf_V_def small_Un_elts sup_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> V_equalityI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">a</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.antisym less_eq_V_def subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vsubsetI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">a</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_V_def subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vsubsetD <span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">∈</span> elts <span class="free">a</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">∈</span> elts <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rev_vsubsetD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> elts <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">∈</span> elts <span class="free">b</span>"</span></span>
  <span class="comment1">― ‹The same, with reversed premises for use with <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> erule<span class="antiquote">}</span></span> -- cf. <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> rev_mp<span class="antiquote">}</span></span>.›</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vsubsetCE <span class="main">[</span><span class="operator">elim</span><span class="main">,</span><span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span> <span class="main">∉</span> elts <span class="free">a</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span> <span class="main">∈</span> elts <span class="free">b</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="comment1">― ‹Classical elimination rule.›</span>
  <span class="keyword1"><span class="command">using</span></span> vsubsetD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> set_image_le_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">A</span> <span class="main">⟹</span> set <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eq0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> elts <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> less_eq_V_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subset_iff_less_eq_V<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟷</span> set <span class="free">A</span> <span class="main">≤</span> set <span class="free">B</span> <span class="main">∧</span> small <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms down small_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> small_Collect <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">A</span> <span class="main">⟹</span> small <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smaller_than_small<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_Union_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> set <span class="main">`</span> Pow <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Pow subset_iff_less_eq_V that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> not_less_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_V_def less_le_not_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> min_0L <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="main">0</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_absorb1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_0R <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="free">n</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_absorb2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neq0_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>V<span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_V_def<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VPow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VPow</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> set <span class="main">(</span>set <span class="main">`</span> Pow <span class="main">(</span>elts <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VPow_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span>VPow <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> down Pow
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VPow_def less_eq_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_V_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> VPow_le_VPow_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"VPow <span class="free">a</span> <span class="main">≤</span> VPow <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_VPow<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>VPow <span class="free">x</span><span class="main">)</span> <span class="main">=</span> set <span class="main">`</span> Pow <span class="main">(</span>elts <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VPow_def Pow<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_sup_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⟷</span> small <span class="free">X</span> <span class="main">∧</span> small <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down elts_of_set small_Un_elts sup_ge1 sup_ge2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_sup_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> elts <span class="free">x</span> <span class="main">∪</span> elts <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trad_foundation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> elts <span class="free">z</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> foundation assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_eq_minimal<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Int_emptyI equals0I inf_V_def set_of_elts zero_V_def<span class="main">)</span>


<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"V"</span> <span class="main">::</span> <span class="quoted">Sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">Sup_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sup_V</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> small <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1">then</span> set <span class="main">(</span>Union <span class="main">(</span>elts <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"V"</span> <span class="main">::</span> <span class="quoted">Inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">Inf_V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_V</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> set <span class="main">(</span>Inter <span class="main">(</span>elts <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> V_disjoint_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> elts <span class="free">x</span> <span class="main">∩</span> elts <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down elts_of_set inf_V_def inf_le1 zero_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹I've no idea why <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bdd_above</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is treated differently from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bdd_below</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but anyway›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> bdd_above_iff_small <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bdd_above <span class="free">X</span> <span class="main">=</span> small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"V set"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"bdd_above <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹bdd_above <span class="free">X</span>›</span></span> bdd_above_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> VPow_iff <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a</span>›</span></span> down subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdd_above <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_upper Sup_V_def Union less_eq_V_def that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bdd_above_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"V"</span> <span class="main">::</span> <span class="quoted">conditionally_complete_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bdd_below_V</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bdd_below_V</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="skolem">X</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="skolem">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bdd_below_V_def Inf_V_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">⨅</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bdd_below_V_def Inf_V_def less_eq_V_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> INT_subset_iff down eq_refl equals0I<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bdd_above <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that Sup_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="skolem">X</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">z</span><span class="main">::</span>V<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> that  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_least Sup_V_def less_eq_V_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_upper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> small <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">⨆</span><span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_V_def SUP_upper Union less_eq_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="free">A</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_V_def SUP_least less_eq_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>V<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_Sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span> <span class="main">⟹</span> elts <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sup_V_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊔</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sup_V_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊔</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_V_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">⨆</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms cSup_insert_If<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_Un_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>small <span class="free">A</span><span class="main">;</span> small <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="free">A</span> <span class="main">⊔</span> <span class="main">⨆</span><span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> SUP_sup_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> SUP_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>V<span class="main">)</span> <span class="keyword1">else</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cSUP_subset_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⨆</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_subset_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_Sup_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">∧</span> small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cSUP_UNION<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bdd_UN<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> bdd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> small <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bdd_UN subset_iff_less_eq_V
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> SUP_upper smaller_than_small<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bdd2<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ne<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cSUP_least <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cSUP_upper2 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bdd2 bdd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cSUP_least <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cSUP_upper <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_UN bdd_UN<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_subset_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> Sup <span class="free">A</span> <span class="main">≤</span> Sup <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_le_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">A</span> <span class="main">⟹</span> Sup <span class="free">A</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> SUP_le_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∨</span> <span class="main">¬</span> small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_upper <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_Union_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> small <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">⨆</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff_less_eq_V <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_eq_Sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Sup <span class="free">A</span> <span class="main">=</span> Sup <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms subset_iff_less_eq_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">∈</span> elts <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> elts <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Successor function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vinsert_not_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vinsert <span class="free">a</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> empty_not_vinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> vinsert <span class="free">a</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vinsert_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_not_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zero_not_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> succ <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> succ_def<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">zero_neq_one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">metis</span> elts_0 elts_succ empty_iff insert_iff one_V_def set_of_elts<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">zero_less_one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_V_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> succ_ne_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> succ <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_succ insertI1 mem_not_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_notin_self<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">i</span> <span class="main">∉</span> elts <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> elts_succ mem_not_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> le_succE<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">i</span> <span class="main">≤</span> succ <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_V_def mem_not_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_inject_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">i</span> <span class="main">=</span> succ <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.antisym le_succE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"inj succ"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_neq_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_0 elts_succ insert_not_empty<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pred</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pred</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> succ <span class="bound">j</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pred_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pred <span class="main">(</span>succ <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pred_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ordinals›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Transset</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Transset</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ord</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ord</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> Transset <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> Transset <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ON</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ON</span> <span class="main">≡</span> Collect Ord"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Transitive sets›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_succ <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def succ_def less_eq_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_Sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> Transset <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> Sup_upper assms dual_order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Transset <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Transset_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Transset <span class="free">i</span><span class="main">;</span> Transset <span class="free">j</span><span class="main">⟧</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="free">i</span> <span class="main">⊓</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Transset_def rev_vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_VPow<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> Transset<span class="main">(</span>VPow<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Transset <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def Inf_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_SUP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_Sup imageE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_INT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_Inf imageE<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Zero, successor, sups›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_succ <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_Sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> Ord <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def Transset_Sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_Union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> Ord <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>set <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Sup Sup_V_def assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span> <span class="main">∪</span> elts <span class="free">y</span><span class="main">.</span> Transset <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Transset <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> Transset <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> Transset <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_def Transset_sup assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> big_ON <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> small ON"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"small ON"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set ON <span class="main">∈</span> ON"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Union Ord_succ Sup_upper elts_Sup elts_succ insertI1 mem_Collect_eq mem_not_refl set_of_elts vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹small ON›</span></span> elts_of_set mem_not_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_1 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_succ one_V_def succ_def vinsert_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> OrdmemD<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> elts <span class="free">k</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_def Transset_def less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">∈</span> elts <span class="free">j</span><span class="main">;</span>  <span class="free">j</span> <span class="main">∈</span> elts <span class="free">k</span><span class="main">;</span>  Ord <span class="free">k</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">i</span> <span class="main">∈</span> elts <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_def Transset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_0_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> knz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_def Transset_def inf.orderE k knz trad_foundation<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_in_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Ord <span class="free">k</span><span class="main">;</span>  <span class="free">m</span> <span class="main">∈</span> elts <span class="free">k</span> <span class="main">⟧</span>  <span class="main">⟹</span> Ord <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_def Ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> OrdI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Transset <span class="free">i</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">i</span> <span class="main">⟹</span> Transset <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> Ord <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_is_Transset<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> Transset <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_contains_Transset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">i</span><span class="main">;</span> <span class="free">j</span> <span class="main">∈</span> elts <span class="free">i</span><span class="main">⟧</span> <span class="main">⟹</span> Transset <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ON_imp_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_subset_ON<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> elts <span class="free">α</span> <span class="main">⊆</span> ON"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_pred <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="main">(</span>elts <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_pred <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span> <span class="main">⟹</span> <span class="main">⨆</span> <span class="main">(</span>insert <span class="free">β</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_def Transset_pred <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Induction, Linearity, etc.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span><span class="main">⟦</span> Ord <span class="bound">x</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> foundation k
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord local.step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Comparability of ordinals›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Ord_linear<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">l</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∈</span> elts <span class="free">l</span> <span class="main">∨</span> <span class="free">k</span><span class="main">=</span><span class="free">l</span> <span class="main">∨</span> <span class="free">l</span> <span class="main">∈</span> elts <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> step_k <span class="main">=</span> step
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">l</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">l</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step_k
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_trans V_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The trichotomy law for ordinals›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Ord_linear_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_linear OrdmemD assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_linear2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ge<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_lt eq_refl assms order.strict_implies_order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_linear_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>le<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ge<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear2 le_less assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> union_less_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">i</span><span class="main">;</span> Ord <span class="free">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟷</span> <span class="free">i</span><span class="main">&lt;</span><span class="free">k</span> <span class="main">∧</span> <span class="free">j</span><span class="main">&lt;</span><span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le le_iff_sup sup.order_iff sup.strict_boundedE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_mem_iff_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">l</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∈</span> elts <span class="free">l</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear OrdmemD less_le_not_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_Collect_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> Ord <span class="bound">ξ</span> <span class="main">∧</span> <span class="bound">ξ</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">}</span> <span class="main">=</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Ord_in_Ord OrdmemD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_not_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Ord_linear2 leD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_not_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Ord_linear2 leD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_succ_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> Ord <span class="free">j</span> <span class="main">⟹</span> succ <span class="free">i</span> <span class="main">≤</span> succ <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le Ord_succ le_succE order_antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_le_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> Ord <span class="free">j</span> <span class="main">⟹</span> succ <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt dual_order.strict_implies_order less_eq_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_in_Sup_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">β</span> <span class="main">=</span> <span class="main">⨆</span><span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">β</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⨆</span><span class="free">A</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> succ_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 Sup_least Sup_upper eq_iff mem_Collect_eq subsetD succ_le_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_succ <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> elts <span class="main">(</span>succ <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mem_0_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_finite_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> ON<span class="main">;</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="free">A</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ZFC_in_HOL.finite_imp_small insert.hyps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="main">⨆</span><span class="skolem">A</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ON_imp_Ord Ord_linear_le sup.absorb2 that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹small <span class="skolem">A</span>›</span></span> Sup_V_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The natural numbers›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">ord_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ord_of_nat</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ord_of_nat</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> succ <span class="main">(</span><span class="free">ord_of_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_eq_initial<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">=</span> set <span class="main">(</span>ord_of_nat <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lessThan_Suc succ_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_ord_of_nat_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span>ord_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> ord_of_nat <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ord_of_nat_eq_initial<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_ord_of_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ord_of_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> ord_of_nat <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_equality<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span>succ <span class="main">`</span> elts <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_ord_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ord_of_nat <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_equality<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(</span>succ <span class="main">∘</span> ord_of_nat<span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_equality Ord_ord_of_nat elts_of_set image_comp small_image_nat_V ord_of_nat_eq_initial<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ω</span> <span class="main">::</span> <span class="quoted">V</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ω</span> <span class="main">≡</span> set <span class="main">(</span>range ord_of_nat<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_ω<span class="main">:</span> <span class="quoted"><span class="quoted">"elts ω <span class="main">=</span> <span class="main">{</span><span class="bound">α</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">α</span> <span class="main">=</span> ord_of_nat <span class="bound">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_into_Ord <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> elts ω <span class="main">⟹</span> Ord <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ord_of_nat ω_def elts_of_set image_iff inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Sup_ω<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span>elts ω<span class="main">)</span> <span class="main">=</span> ω"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ω_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_ω <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Sup Sup_ω nat_into_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_omega <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_def elts_of_set inf ord_of_nat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_in_omega <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> elts ω <span class="main">⟹</span> succ <span class="free">n</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_def elts_of_set image_iff small_image_nat_V ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> succ_neq_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_le_omega<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">≤</span> ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_ω ZFC_in_HOL.Sup_upper ω_def elts_of_set inf rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_of_eq_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_inject <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">i</span> <span class="main">=</span> ord_of_nat <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span><span class="main">=</span><span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_of_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> elts_0 elts_succ insert_not_empty not0_implies_Suc ord_of_nat.simps succ_inject_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> inj_ord_of_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"inj ord_of_nat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_injI<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"countable <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> range <span class="main">(</span>from_nat_into <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms subset_range_from_nat_into<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_raw inj_ord_of_nat replacement small_def smaller_than_small<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> infinite_ω<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>elts ω<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> range_inj_infinite <span class="main">[</span><span class="operator">of</span> <span class="quoted">ord_of_nat</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def inj_ord_of_nat<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> ord_of_nat_mono_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">i</span> <span class="main">≤</span> ord_of_nat <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_def Ord_ord_of_nat Transset_def eq_iff mem_ord_of_nat_iff not_less ord_of_nat_inject<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> ord_of_nat_strict_mono_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">i</span> <span class="main">&lt;</span> ord_of_nat <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> small_image_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> countable<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_Ord_omega<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω <span class="main">⟹</span> finite <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>elts <span class="main">(</span>ord_of_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_of_nat_eq_initial <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_Ord_omega<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> infinite <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> ω <span class="main">≤</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_linear2 Ord_mem_iff_lt finite_Ord_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> ord_of_nat <span class="free">n</span> <span class="main">=</span> succ <span class="main">(</span>ord_of_nat <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> card_ord_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>elts <span class="main">(</span>ord_of_nat <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def finite_Ord_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_ω <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_ω_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">n</span> <span class="main">∈</span> elts ω <span class="main">⟷</span> <span class="free">n</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω OrdmemD elts_vinsert insert_iff less_V_def succ_def succ_in_omega vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_gt0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_gt1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD one_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Limit ordinals›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Limit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Limit</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> Ord <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟶</span> succ <span class="bound">y</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_not_Limit <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Limit <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_succ_Limit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Limit<span class="main">(</span>succ <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def Ord_mem_iff_lt elts_succ insertI1 less_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_is_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">ξ</span> <span class="main">⟹</span> Ord <span class="free">ξ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_in_Limit_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">ξ</span> <span class="main">⟹</span> succ <span class="free">α</span> <span class="main">∈</span> elts <span class="free">ξ</span> <span class="main">⟷</span> <span class="free">α</span> <span class="main">∈</span> elts <span class="free">ξ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def OrdmemD elts_succ insertI1 less_V_def vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_eq_Sup_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">i</span> <span class="main">⟹</span> Sup <span class="main">(</span>elts <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_def Ord_def Transset_def Sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def Ord_equality Sup_V_def SUP_le_iff Sup_upper small_elts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_less_Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">β</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_def OrdmemD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> non_Limit_ord_of_nat <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Limit <span class="main">(</span>ord_of_nat <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def mem_ord_of_nat_iff not_succ_Limit ord_of_eq_0_iff ord_of_minus_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_omega <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Limit ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> omega_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Limit_omega <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_cases_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="free">k</span> <span class="main">=</span> succ <span class="bound">j</span><span class="main">)</span> <span class="main">∨</span> Limit <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Limit <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">j</span> <span class="main">∈</span> elts <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="free">k</span> <span class="main">≠</span> succ <span class="bound">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> elts <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_linear Ord_succ assms elts_succ insertE mem_not_sym that<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_def mem_0_Ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_cases <span class="main">[</span><span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> V<span class="main">,</span> <span class="operator">case_names</span> 0 succ limit<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="free">l</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">l</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Limit <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Ord_cases_lemma Ord_in_Ord elts_succ insertI1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> non_succ_LimitI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> succ<span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_cases_lemma assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_induct3 <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> 0 succ Limit<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> V<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="main">⟦</span>Ord <span class="bound">α</span><span class="main">;</span> <span class="free">P</span> <span class="bound">α</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>succ <span class="bound">α</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="main">⟦</span>Limit <span class="bound">α</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">ξ</span><span class="main">.</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="bound">α</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ξ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="bound">α</span><span class="main">.</span> <span class="bound">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> α
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_eq_Sup_self Ord_cases P elts_succ image_ident insertI1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties of LEAST for ordinals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> Ord_LeastI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ord_Least_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> classical<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Ord <span class="bound">y</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> classical<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">y</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> step <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear2 Ord_mem_iff_lt<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear_le y order.trans <span class="quoted"><span class="quoted">‹Ord <span class="skolem">x</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_equality <span class="quoted"><span class="quoted">‹Ord <span class="skolem">x</span>›</span></span> step.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_Least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span>Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_LeastI <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">― ‹The following 3 lemmas are due to Brian Huffman›</span>
<span class="keyword1"><span class="command">lemma</span></span> Ord_LeastI_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_LeastI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_LeastI2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">a</span><span class="main">;</span> <span class="free">P</span> <span class="free">a</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span>Ord <span class="bound">x</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_LeastI Ord_Least<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_LeastI2_ex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> Ord <span class="bound">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span>Ord <span class="bound">x</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_LeastI_ex Ord_Least<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_LeastI2_wellorder<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">P</span> <span class="bound">a</span><span class="main">;</span> <span class="main">∀</span><span class="bound">b</span><span class="main">.</span> Ord <span class="bound">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI2_order<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_Least Ord_LeastI assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">y</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_Least_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> Ord <span class="bound">y</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_LeastI2_wellorder_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Ord <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">P</span> <span class="bound">a</span><span class="main">;</span> <span class="main">∀</span><span class="bound">b</span><span class="main">.</span> Ord <span class="bound">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ord_LeastI2_wellorder<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_less_Ord_Least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">k</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> Ord <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> Ord <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_Least_le less_le_not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> exists_Ord_Least_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">α</span><span class="main">.</span> Ord <span class="bound">α</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">α</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">α</span><span class="main">.</span> Ord <span class="bound">α</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">α</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">β</span></span> <span class="main">&lt;</span> <span class="bound">α</span><span class="main">.</span> Ord <span class="bound">β</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">β</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">α</span><span class="main">.</span> Ord <span class="bound">α</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">α</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="var">?x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Least α<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">β</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&lt;</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> not_less_Ord_Least<span class="main">[</span><span class="operator">OF</span> m<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_LeastI_ex<span class="main">[</span><span class="operator">OF</span> H<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_mono_imp_increasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fun_hD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">→</span> <span class="free">D</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono_h<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="free">h</span> <span class="free">D</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">≤</span> <span class="free">h</span> <span class="free">ν</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> non<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">ν</span> <span class="main">≤</span> <span class="free">h</span> <span class="free">ν</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">μ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">μ</span><span class="main">.</span> Ord <span class="bound">μ</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">μ</span> <span class="main">≤</span> <span class="free">h</span> <span class="bound">μ</span> <span class="main">∧</span> <span class="bound">μ</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ν <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">μ</span> <span class="main">≤</span> <span class="free">h</span> <span class="skolem">μ</span> <span class="main">∧</span> <span class="skolem">μ</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Ord_LeastI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ν non<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">h</span> <span class="free">ν</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">h</span> <span class="main">(</span><span class="free">h</span> <span class="free">ν</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ON_imp_Ord ν assms funcset_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> μ <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">μ</span> <span class="main">&lt;</span> <span class="skolem">μ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ON_imp_Ord Ord_linear2 PiE μ <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> fun_hD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">h</span> <span class="skolem">μ</span> <span class="main">≤</span> <span class="free">h</span> <span class="main">(</span><span class="free">h</span> <span class="skolem">μ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> μ fun_hD mono_h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">μ</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> μ fun_hD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">h</span> <span class="skolem">μ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">D</span> <span class="main">⊆</span> ON›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">≤</span> <span class="free">h</span> <span class="skolem">μ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> μ_def Ord_Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> μ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_Sup_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">⨆</span><span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> ON<span class="main">.</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI ballI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="bound">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ON"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⨆</span> <span class="free">A</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 Sup_least <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> ON›</span></span> mem_Collect_eq subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>ON<span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Sup Ord_linear_le Sup_upper less_le_not_le mem_Collect_eq subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_SUP_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> ON<span class="main">;</span> Ord <span class="free">x</span><span class="main">;</span> small <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> ON<span class="main">.</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_Sup_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Transfinite Recursion and the V-levels›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">transrec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>V<span class="main">⇒</span>V<span class="main">,</span>V<span class="main">]</span><span class="main">⇒</span>V<span class="main">,</span> V<span class="main">]</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">transrec</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> wfrec <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transrec<span class="main">:</span> <span class="quoted"><span class="quoted">"transrec <span class="free">H</span> <span class="free">a</span> <span class="main">=</span> <span class="free">H</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">∈</span> elts <span class="free">a</span><span class="main">.</span> transrec <span class="free">H</span> <span class="bound">x</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cut <span class="main">(</span>wfrec <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> <span class="free">H</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> <span class="free">a</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span>elts <span class="free">a</span><span class="main">.</span> wfrec <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> <span class="free">H</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> transrec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foundation wfrec<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Avoids explosions in proofs; resolve it with a meta-level definition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> def_transrec<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≡</span> transrec <span class="free">H</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">H</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">∈</span> elts <span class="free">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_ext transrec<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eps_induct <span class="main">[</span><span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wf_induct <span class="main">[</span><span class="operator">OF</span> foundation<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Vfrom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span>V<span class="main">]</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vfrom</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> transrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊔</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> VPow<span class="main">(</span><span class="bound">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Vset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vset</span> <span class="main">≡</span> Vfrom <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom<span class="main">:</span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊔</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> VPow<span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Vfrom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> transrec<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Vfrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Vfrom<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Vset<span class="main">:</span> <span class="quoted"><span class="quoted">"Vset <span class="free">i</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> VPow<span class="main">(</span>Vset <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Vfrom<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_mono1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">≤</span> Vfrom <span class="free">b</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="skolem">i</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="skolem">i</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">b</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sup_mono cSUP_subset_mono <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_mono2<span class="main">:</span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">≤</span> Vfrom <span class="free">a</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="skolem">i</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
           <span class="main">≤</span> <span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span><span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sup_mono cSUP_subset_mono order_refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">i</span><span class="main">;</span> <span class="free">a</span><span class="main">≤</span><span class="free">b</span><span class="main">;</span> <span class="free">i</span><span class="main">≤</span><span class="free">j</span><span class="main">⟧</span> <span class="main">⟹</span> Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">≤</span> Vfrom <span class="free">b</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Vfrom_mono1 Vfrom_mono2 dual_order.trans sup.absorb_iff2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_Vfrom<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Transset<span class="main">(</span>Vfrom <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_SUP Transset_VPow Transset_sup Vfrom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_Vset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Transset<span class="main">(</span>Vset <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Transset_Vfrom<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">⊔</span> Vfrom <span class="free">a</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">⊔</span> Vfrom <span class="free">a</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span><span class="main"><span class="main">]</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="main">]</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="main">]</span></span> Sup_Un_distrib image_Un sup.assoc sup.left_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">⊔</span> Vfrom <span class="free">a</span> <span class="free">j</span> <span class="main">≤</span> Vfrom <span class="free">a</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom_mono2 le_supI sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_succ_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">(</span>succ <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊔</span> VPow<span class="main">(</span>Vfrom <span class="free">a</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">x</span><span class="main">∈</span>elts <span class="free">i</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cSup_least<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">i</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_linear_le Vfrom_mono assms mem_not_refl order_refl vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span>succ <span class="free">i</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊔</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sup_mono order_antisym<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_V_insert *<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vset_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> Vset<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> VPow<span class="main">(</span>Vset<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vfrom_succ_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_Sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">(</span>Sup <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> Vfrom <span class="free">a</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom all_not_in_conv assms bdd_above_iff_small cSUP_upper2 replacement sup_ge1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> Vfrom <span class="free">a</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom bdd_above_iff_small cSUP_upper2 le_supI2 order_refl replacement small_elts that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cSUP_upper<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_le_iff <span class="quoted"><span class="quoted">‹small <span class="free">X</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">a</span> <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span>
         <span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="bound">x</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
         <span class="main">≤</span> <span class="free">a</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cSUP_subset_mono <span class="quoted"><span class="quoted">‹small <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span>Vfrom <span class="free">a</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> Vfrom <span class="free">a</span> <span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vfrom assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cSUP_least<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_Vfrom_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> Vfrom <span class="free">a</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="free">i</span><span class="main">.</span> Vfrom <span class="free">a</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def Limit_eq_Sup_self Vfrom_Sup ex_in_conv small_elts<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ZFC_Cardinals">
<div class="head">
<h1>Theory ZFC_Cardinals</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cartesian products, Disjoint Sums, Ranks, Cardinals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ZFC_Cardinals
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ZFC_in_HOL.html">ZFC_in_HOL</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion_enabled</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">::</span> nat <span class="main">⇒</span> V"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ordered Pairs›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> singleton_eq_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> set <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> doubleton_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> set <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">d</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.doubleton_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vpair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vpair</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> set <span class="main">{</span>set <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">,</span>set <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vfst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vfst</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> vpair <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vsnd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vsnd</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> vpair <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vsplit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>V<span class="main">,</span> V<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">,</span> V<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{}</span>"</span></span>  <span class="comment1">― ‹for pattern-matching›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vsplit</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>vfst <span class="bound">p</span><span class="main">)</span> <span class="main">(</span>vsnd <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">nonterminal</span></span> Vs
<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_Tuple"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span> Vs<span class="main">]</span> <span class="main">⇒</span> V"</span></span>              <span class="main">(</span><span class="quoted">"<span class="keyword1">&lt;</span><span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword1">&gt;</span>"</span><span class="main">)</span>
  <span class="quoted">"_hpattern"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> patterns<span class="main">]</span> <span class="main">⇒</span> pttrn"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">&lt;</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">&gt;</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">""</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> Vs"</span></span>                    <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_Enum"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span> Vs<span class="main">]</span> <span class="main">⇒</span> Vs"</span></span>             <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_Tuple"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span> Vs<span class="main">]</span> <span class="main">⇒</span> V"</span></span>              <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span><span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword1">⟩</span>"</span><span class="main">)</span>
  <span class="quoted">"_hpattern"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> patterns<span class="main">]</span> <span class="main">⇒</span> pttrn"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="main">&lt;</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span><span class="main">&gt;</span>"</span>
  <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">&gt;</span>"</span>       <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> vpair <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="main">&lt;</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span><span class="main">&gt;</span>"</span>
  <span class="quoted">"<span class="main">λ</span><span class="main">&lt;</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">zs</span><span class="main">&gt;</span><span class="main">.</span> <span class="free">b</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> vsplit<span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="main">&lt;</span><span class="free">y</span><span class="main">,</span><span class="free">zs</span><span class="main">&gt;</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">λ</span><span class="main">&lt;</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">&gt;</span><span class="main">.</span> <span class="free">b</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> vsplit<span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="free">y</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span>"</span>


<span class="keyword1"><span class="command">lemma</span></span> vpair_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"vpair <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> set <span class="main">{</span>set <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">a</span><span class="main">}</span><span class="main">,</span>set <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vpair_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vpair_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vpair <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> vpair <span class="free">a'</span> <span class="free">b'</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">a'</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">b'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vpair_def' doubleton_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> vpair_inject <span class="main">=</span> vpair_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjE<span class="main">,</span> <span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> vfst_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vfst <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vfst_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vsnd_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vsnd <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vsnd_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vsplit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vsplit <span class="free">c</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vsplit_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vpair_neq_fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set insertI1 mem_not_sym small_upair vpair_def'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vpair_neq_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set insertI1 mem_not_sym small_upair subsetD subset_insertI vpair_def'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vpair_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_0 elts_of_set empty_not_insert small_upair vpair_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_notin_vpair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> elts <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vpair_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_vpair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalized Cartesian product›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VSigma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> <span class="main">(</span>V <span class="main">⇒</span> V<span class="main">)</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VSigma</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> set<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">⋃</span><span class="bound">y</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vtimes</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vtimes</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> VSigma <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pairs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> <span class="main">(</span>V <span class="main">*</span> V<span class="main">)</span>set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span> "</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pairs_iff_elts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="free">z</span> <span class="main">⟷</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairs_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VSigma_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="main">(</span>VSigma <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> elts <span class="free">A</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">B</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VSigma_def UNION_singleton_eq_range<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VSigmaI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> elts <span class="free">A</span><span class="main">;</span>  <span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">B</span> <span class="free">a</span><span class="main">)</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="main">(</span>VSigma <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> VSigmaD1 <span class="main">=</span> VSigma_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> VSigmaD2 <span class="main">=</span> VSigma_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The general elimination rule›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> VSigmaE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> elts <span class="main">(</span>VSigma <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">B</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VSigma_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VSigmaE2 <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="main">(</span>VSigma <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">B</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> VSigma_empty1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"VSigma <span class="main">0</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> times_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="main">(</span>vtimes <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> elts <span class="free">A</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> elts <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> timesI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> elts <span class="free">A</span><span class="main">;</span>  <span class="free">b</span> <span class="main">∈</span> elts <span class="free">B</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="main">(</span>vtimes <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> times_empty2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vtimes <span class="free">A</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> elts_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> times_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"VSigma <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> elts <span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> VSigmaE VSigmaI elts_0 empty_iff trad_foundation<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_VSigma<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>VSigma <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> vpair <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> Sigma <span class="main">(</span>elts <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> elts <span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> small_Times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">g</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> elts <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> elts <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> small_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g</span> <span class="bound">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">h</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">g</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> elts <span class="main">(</span>vtimes <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def image_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> range elts"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Disjoint Sum›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vsum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> V"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⨄</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main"><span class="free">⨄</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span>VSigma <span class="main">(</span>set <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>VSigma <span class="main">(</span>set <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>V"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">Inl</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>V"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">Inr</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">⟨</span><span class="main">1</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> sum_defs <span class="main">=</span> vsum_def Inl_def Inr_def

<span class="keyword1"><span class="command">lemma</span></span> Inl_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Inl <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inl_def vpair_nonzero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Inr_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Inr <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inr_def vpair_nonzero<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Equivalences for the injections and an elimination rule›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Inl_in_sum_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="free">a</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">A</span> <span class="main">⨄</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Inr_in_sum_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inr <span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">A</span> <span class="main">⨄</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">∈</span> elts <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sumE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">A</span> <span class="main">⨄</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span>Inl <span class="free">x</span>"</span></span> <span class="main">|</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span>Inr <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Injection and freeness equivalences, for rewriting›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Inl_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="free">a</span><span class="main">=</span>Inl <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Inr_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inr <span class="free">a</span><span class="main">=</span>Inr <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_Inl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on Inl <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_Inr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on Inr <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Inl_Inr_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="free">a</span><span class="main">=</span>Inr <span class="free">b</span> <span class="main">⟷</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Inr_Inl_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inr <span class="free">b</span><span class="main">=</span>Inl <span class="free">a</span> <span class="main">⟷</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⨄</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_vsum<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">a</span> <span class="main">⨄</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Inl <span class="main">`</span> <span class="main">(</span>elts <span class="free">a</span><span class="main">)</span> <span class="main">∪</span> Inr <span class="main">`</span> <span class="main">(</span>elts <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">A</span> <span class="main">⨄</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">A</span> <span class="main">∧</span> <span class="free">u</span><span class="main">=</span>Inl <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="free">B</span> <span class="main">∧</span> <span class="free">u</span><span class="main">=</span>Inr <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_subset_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⨄</span><span class="free">B</span> <span class="main">≤</span> <span class="free">C</span><span class="main">⨄</span><span class="free">D</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">≤</span><span class="free">C</span> <span class="main">∧</span> <span class="free">B</span><span class="main">≤</span><span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_equal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⨄</span><span class="free">B</span> <span class="main">=</span> <span class="free">C</span><span class="main">⨄</span><span class="free">D</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">=</span><span class="free">C</span> <span class="main">∧</span> <span class="free">B</span><span class="main">=</span><span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff sum_subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_sum</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> Inr <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sum_case</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>V <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>V <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> V <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sum_case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span>
    <span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Inr <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> is_sum <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">=</span> undefined<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_case_Inl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_case <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Inl <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_def is_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_case_Inr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_case <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Inr <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_def is_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_case_non <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sum <span class="free">a</span> <span class="main">⟹</span> sum_case <span class="free">f</span> <span class="free">g</span> <span class="free">a</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_def is_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_sum_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">z</span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> Inr <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> is_sum <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_case_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>sum_case <span class="free">f</span> <span class="free">g</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inr <span class="bound">y</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> is_sum <span class="free">a</span> <span class="main">⟶</span> <span class="free">P</span> undefined<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_sum <span class="free">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sum_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_case_split_asm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>sum_case <span class="free">f</span> <span class="free">g</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inr <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> is_sum <span class="free">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_case_split<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Applications of disjoint sums and pairs: general union theorems for small sets›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>V"</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">g</span> <span class="free">Y</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms small_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">then</span> Inl <span class="main">(</span><span class="skolem">f</span> <span class="bound">z</span><span class="main">)</span> <span class="keyword1">else</span> Inr <span class="main">(</span><span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">h</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def h_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> range elts"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X Y image_Un replacement small_iff_range small_sup_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_UN <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> small <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>V"</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">X</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms small_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> inj_on <span class="bound">g</span> <span class="main">(</span><span class="free">B</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> range elts"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> B small_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> inj_on <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">@</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">unfolding</span></span> φ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UN_E someI that<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">h</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f g φ <span class="keyword1"><span class="command">unfolding</span></span> h_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vpair_inject<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">h</span> <span class="main">`</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B X image_UN<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> range elts"</span></span>
    <span class="keyword1"><span class="command">using</span></span> small_iff_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_Union <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊆</span> Collect small"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">𝒜</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span> <span class="free">𝒜</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> small_UN <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒜</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Generalised function space and lambda›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VLambda</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> <span class="main">(</span>V <span class="main">⇒</span> V<span class="main">)</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VLambda</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> elts <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span>V<span class="main">]</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">app</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> beta <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app <span class="main">(</span>VLambda <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VLambda_def app_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VPi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> <span class="main">(</span>V <span class="main">⇒</span> V<span class="main">)</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VPi</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> set <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> elts <span class="main">(</span>VPow<span class="main">(</span>VSigma <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span> elts <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≤</span> Domain <span class="main">(</span>pairs <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> single_valued <span class="main">(</span>pairs <span class="bound">f</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VPi_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">A</span> <span class="main">⟹</span> <span class="free">b</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"VLambda <span class="free">A</span> <span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VPi_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VLambda <span class="free">A</span> <span class="free">b</span> <span class="main">≤</span> VSigma <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms VLambda_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">A</span> <span class="main">⊆</span> Domain <span class="main">(</span>pairs <span class="main">(</span>VLambda <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VLambda_def pairs_iff_elts<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"single_valued <span class="main">(</span>pairs <span class="main">(</span>VLambda <span class="free">A</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VLambda_def single_valued_def pairs_iff_elts<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">≤</span> VSigma <span class="free">A</span> <span class="free">B</span> <span class="main">∧</span> elts <span class="free">A</span> <span class="main">⊆</span> Domain <span class="main">(</span>pairs <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> single_valued <span class="main">(</span>pairs <span class="bound">f</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> down VPow_iff mem_Collect_eq subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_pair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span> app <span class="free">f</span> <span class="free">x</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Domain <span class="main">(</span>pairs <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> VPi_def assms elts_of_set empty_iff mem_Collect_eq subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pairs_iff_elts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> app_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> theI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> y<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">⟩</span> <span class="main">∈</span> elts <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> VPi_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> that elts_of_set empty_iff mem_Collect_eq pairs_iff_elts single_valued_def y<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VPi_D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">B</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> VSigma <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> VPi_def elts_of_set empty_iff f VPow_iff mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_pair <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VPi_memberD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> elts <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> app <span class="free">f</span> <span class="free">x</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> VSigma <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> VPi_def elts_of_set empty_iff f VPow_iff mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> app <span class="free">f</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> VPi_def apply_pair elts_of_set equals0D f mem_Collect_eq p pairs_iff_elts single_valuedD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">A</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fun_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">A</span> <span class="main">⟹</span> app <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> app <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> VPi_memberD V_equalityI apply_pair assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eta<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"VLambda <span class="free">A</span> <span class="main">(</span><span class="main">(</span>app<span class="main">)</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fun_ext <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VLambda <span class="free">A</span> <span class="main">(</span>app <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> elts <span class="main">(</span>VPi <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VPi_D VPi_I assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> fst_pairs_VLambda<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> pairs <span class="main">(</span>VLambda <span class="free">A</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> elts <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VLambda_def pairs_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_pairs_VLambda<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> pairs <span class="main">(</span>VLambda <span class="free">A</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> elts <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> VLambda_def pairs_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VLambda_eq_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"VLambda <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> VLambda <span class="free">B</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZFC_in_HOL.ext fst_pairs_VLambda<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VLambda_eq_D2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>VLambda <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> VLambda <span class="free">A</span> <span class="free">g</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> beta<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Transitive closure of a set›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">TC</span> <span class="main">≡</span> transrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="bound">f</span> <span class="main">`</span> elts <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC<span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> elts <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_cong TC_def restrict_apply' transrec<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC ZFC_in_HOL.Sup_empty elts_0 image_is_empty sup_V_0_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arg_subset_TC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> TC <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> TC sup_ge1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_TC<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset<span class="main">(</span>TC <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> TC <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> arg_subset_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>elts <span class="skolem">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">using</span></span> that step <span class="keyword1"><span class="command">unfolding</span></span> TC <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Transset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Transset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> TC<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC_least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Transset <span class="free">x</span><span class="main">;</span>  <span class="free">a</span><span class="main">≤</span><span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> TC <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cSup_least<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"TC <span class="main">`</span> elts <span class="skolem">y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> TC <span class="main">`</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_def image_iff step.IH step.prems vsubsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_TC</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">le_TC</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_TC_imp_not_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> TC<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> less_TC_def
    <span class="keyword1"><span class="command">using</span></span> Transset_TC Transset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_TC_less_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊏</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_TC_imp_not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> less_TC_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> elts <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊑</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_TC_def le_TC_def TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonzero_less_TC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eps_induct le_TC_def less_TC_iff trad_foundation<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_irrefl_TC <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_TC_imp_not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> less_asym_TC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_least Transset_TC Transset_def antisym_conv less_TC_def less_TC_imp_not_le order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_antisym_TC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_asym_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> less_imp_le_TC <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_TC_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_TC_refl <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_TC_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_TC_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> TC_least Transset_TC Transset_def less_TC_def less_eq_V_def subsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_le_TC_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊑</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_TC_def less_TC_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> le_less_TC_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_TC_def less_TC_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> le_TC_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊑</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_TC_def le_less_TC_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_sup_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> TC <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_Un_distrib TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span><span class="main"><span class="main">]</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> image_Un sup.assoc sup_left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_Sup_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TC <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">(</span>TC <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="free">X</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> TC <span class="main">`</span> elts <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_le_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> arg_subset_TC <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_least Transset_TC Transset_def arg_subset_TC vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="free">X</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> TC <span class="main">`</span> elts <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_le_iff assms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">∈</span> elts <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span>elts <span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">∉</span> elts <span class="main">(</span>TC <span class="bound">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_Un_distrib TC <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">X</span>"</span></span><span class="main">]</span> image_Union assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Union inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> sup.absorb_iff2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC'<span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> TC <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span>elts <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> TC_Sup_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arg_subset_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A distinctive induction principle›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> TC_induct_down_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊏</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">y</span> <span class="main">⊏</span> <span class="free">b</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="free">d</span><span class="main">;</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> elts <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span>TC <span class="free">b</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Transset_TC
    <span class="keyword1"><span class="command">unfolding</span></span> Transset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.bounded_iff less_TC_def less_eq_V_def local.step subsetI vsubsetD<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> TC <span class="free">b</span> <span class="main">⊓</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arg_subset_TC base<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> TC_least <span class="main">[</span><span class="operator">THEN</span> vsubsetD<span class="main">]</span> ab <span class="keyword1"><span class="command">unfolding</span></span> less_TC_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> TC_least le_inf_iff vsubsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC_induct_down <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step small<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊏</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> elts <span class="free">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">y</span> <span class="main">⊏</span> <span class="free">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">y</span><span class="main">;</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>Collect <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TC_induct_down_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>Collect <span class="free">P</span><span class="main">)</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set mem_Collect_eq vsubsetI<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Rank of a set›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rank</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rank</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> transrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> set <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span>elts <span class="bound">x</span><span class="main">.</span> elts <span class="main">(</span>succ<span class="main">(</span><span class="bound">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">a</span> <span class="main">=</span> set<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span> <span class="main">∈</span> elts <span class="free">a</span><span class="main">.</span> elts <span class="main">(</span>succ<span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rank_def <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> def_transrec<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rank_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">a</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> succ<span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_Sup image_image rank replacement set_of_elts small_elts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_rank <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rank_Sup <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ord_Sup Ord_succ imageE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> rank <span class="free">i</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ord_equality SUP_cong rank_Sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_iff_rank<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟷</span> rank <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_rank <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> rank_of_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> rank_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> elts <span class="free">b</span> <span class="main">⟹</span> rank <span class="free">a</span> <span class="main">&lt;</span> rank <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rank <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ord_mem_iff_lt Ord_rank small_UN UN_iff elts_of_set elts_succ insert_iff rank small_elts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rank_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rank_def
  <span class="keyword1"><span class="command">using</span></span> transrec <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> rank_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank<span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> succ<span class="main">(</span>rank <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> succ <span class="main">(</span>rank <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rank <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"succ <span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sup_insert elts_of_set elts_succ equals0D image_insert rank small_sup_iff subset_insertI sup.orderE vsubsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span>rank <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> rank <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ZFC_in_HOL.Sup_upper elts_succ image_insert insertI1 rank_Sup replacement small_elts<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> rank <span class="free">a</span> <span class="main">≤</span> rank <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vsubsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> rank <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> rank <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> small_UN <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> VsetI<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">b</span> <span class="main">⊏</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"rank <span class="skolem">b</span> <span class="main">∈</span> elts <span class="skolem">x</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>elts <span class="skolem">x</span><span class="main">.</span> rank <span class="skolem">b</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_TC_def less_TC_def less_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>elts <span class="skolem">x</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">≤</span> Vset <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> Vset <span class="main">(</span>rank <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_V_def subset_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_mem_iff_lt Ord_rank le_TC_refl less_TC_iff rank_lt step.IH<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step.IH
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_V_def subset_iff less_TC_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_mem_iff_lt Ord_rank Transset_TC Transset_def rank_lt vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_VsetI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">i</span><span class="main">;</span> rank <span class="free">b</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_mem_iff_lt Ord_rank VsetI arg_subset_TC less_TC_def vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arg_le_Vset_rank<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> Vset<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_VsetI rank_lt vsubsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> two_in_Vset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">α</span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_rank Ord_VsetI elts_of_set insert_iff rank_lt small_elts small_insert_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rank_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arg_le_Vset_rank <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> small_ranks_imp_small<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≡</span> set <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>elts <span class="main">`</span> <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">using</span></span> Ord_Union Ord_rank assms imageE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Vset <span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>Vset <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_rank Sup_V_def ZFC_in_HOL.Sup_upper Vfrom_mono assms imageI le_less that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> elts <span class="main">(</span>VPow <span class="main">(</span>Vset <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"*"</span> VPow_iff arg_le_Vset_rank order.trans subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> down <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_Union<span class="main">:</span> <span class="quoted"><span class="quoted">"rank<span class="main">(</span><span class="main">⨆</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="main">(</span><span class="main">⨆</span> <span class="free">A</span><span class="main">)</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="comment1">(*SLOW*)</span>
    <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt Ord_rank rank_lt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_le_not_le rank_lt vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="main">⨆</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_V_def rank_Sup<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> rank <span class="main">(</span><span class="main">⨆</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ZFC_in_HOL.Sup_least ZFC_in_HOL.Sup_upper image_iff rank_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> small <span class="main">(</span>rank <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> small_ranks_imp_small <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_bounded_rank<span class="main">:</span>  <span class="quoted"><span class="quoted">"small <span class="main">{</span><span class="bound">x</span><span class="main">.</span> rank <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> rank <span class="bound">x</span> <span class="main">∈</span> elts <span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> rank <span class="bound">x</span> <span class="main">⊏</span> <span class="free">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> elts <span class="main">(</span>Vset <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VsetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> down <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_bounded_rank_le<span class="main">:</span>  <span class="quoted"><span class="quoted">"small <span class="main">{</span><span class="bound">x</span><span class="main">.</span> rank <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> small_bounded_rank <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"VPow <span class="free">a</span>"</span></span><span class="main">]</span> VPow_iff <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_rank_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊏</span> <span class="free">b</span> <span class="main">⟹</span> rank <span class="free">a</span> <span class="main">&lt;</span> rank <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> TC_induct_down<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_lt<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> less_trans rank_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> small
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> smaller_than_small <span class="main"><span class="main">[</span></span><span class="operator">OF</span> small_bounded_rank_le <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"rank <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_mono less_V_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC_rank_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟹</span> rank <span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span>rank <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt TC_rank_lt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_TC_less<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_inv_image <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> foundation<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">rank</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> inv_image <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> rank"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TC_rank_mem inv_image_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_TC_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊏</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wfE_min' <span class="main">[</span><span class="operator">OF</span> wf_TC_less<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="free">a</span><span class="main">}</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> le_TC_def less_le_TC_trans assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_rank_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">A</span> <span class="main">(</span>rank<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Vfrom <span class="free">A</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">A</span> <span class="main">(</span>rank <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> Vfrom <span class="free">A</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="skolem">x</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> step.IH
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_rank OrdmemD Vfrom_mono2 dual_order.trans inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> less_V_def sup.orderE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"rank<span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> sup.coboundedI2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">A</span> <span class="free">x</span> <span class="main">≤</span> Vfrom <span class="free">A</span> <span class="main">(</span>rank <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="skolem">x</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">j</span><span class="main">∈</span>elts <span class="main">(</span>rank <span class="skolem">x</span><span class="main">)</span><span class="main">.</span> VPow <span class="main">(</span>Vfrom <span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.IH TC_rank_mem less_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> Vfrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"rank<span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> sup.coboundedI2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Vfrom_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"Vfrom <span class="free">A</span> <span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⊔</span> VPow<span class="main">(</span>Vfrom <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_rank Vfrom_rank_eq Vfrom_succ_Ord rank_succ<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Vset_succ_TC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="main">(</span>ZFC_in_HOL.succ <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vfrom_succ<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> TC_least Transset_Vfrom less_TC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We extend the membership relation to a wellordering›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VWO</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>V <span class="main">×</span> V<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VWO</span> <span class="main">≡</span> <span class="main">@</span><span class="bound">r</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="bound">r</span> <span class="main">∧</span> Well_order <span class="bound">r</span> <span class="main">∧</span> Field <span class="bound">r</span> <span class="main">=</span> UNIV"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> elts <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> VWO <span class="main">∧</span> Well_order VWO <span class="main">∧</span> Field VWO <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> VWO_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> VWO_def foundation someI_ex total_well_order_extension<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"wf<span class="main">(</span>VWO <span class="main">-</span> Id<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO well_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_Ord_less<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> Ord <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ord_mem_iff_lt eps_induct wfPUNIVI wfP_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> refl_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"refl VWO"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO order_on_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> trans_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"trans VWO"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VWO wo_rel.TRANS wo_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> antisym_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"antisym VWO"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VWO wo_rel.ANTISYM wo_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> total_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"total VWO"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VWO <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wo_rel.TOTAL wo_rel.intro<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> total_VWOId<span class="main">:</span> <span class="quoted"><span class="quoted">"total <span class="main">(</span>VWO<span class="main">-</span>Id<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_VWO<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Linear_order_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"Linear_order VWO"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO well_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> wo_rel_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"wo_rel VWO"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO wo_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Transitive Closure and VWO›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_imp_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> VWO"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWO <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> less_TC_imp_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> VWO"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_TC_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y'</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y'</span>"</span></span> <span class="main">|</span> <span class="skolem">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mem_imp_VWO step.IH transD trans_VWO<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> mem_imp_VWO <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_TC_imp_VWO<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> VWO"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_TC_def less_TC_imp_VWO<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Linear_order_VWO Linear_order_in_diff_Id UNIV_I VWO<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_TC_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_TC_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_TC_succ<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">⊏</span> succ <span class="free">β</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊏</span> <span class="free">β</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_succ insert_iff le_TC_def less_TC_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_TC_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> succ <span class="free">β</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">β</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> succ <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_TC_def less_TC_succ<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Transset_TC_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span> <span class="main">⟹</span> TC <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC_least arg_subset_TC eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_TC_less_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">β</span> <span class="main">⊏</span> <span class="free">α</span> <span class="main">⟷</span> <span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_def Ord_mem_iff_lt Transset_TC_eq less_TC_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_mem_iff_less_TC<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">l</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∈</span> elts <span class="free">l</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">⊏</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_def less_TC_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_TC_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">β</span> <span class="main">⊑</span> <span class="free">α</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">⟧</span> <span class="main">⟹</span> Ord <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_def Ord_in_Ord Transset_TC_eq le_TC_def less_TC_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_less_TC_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">⊏</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_def assms less_TC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> VWO_TC_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> <span class="main">(</span><span class="free">β</span><span class="main">,</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> VWO<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">β</span> <span class="main">⊑</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Linear_order_VWO Linear_order_in_diff_Id Ord_TC_less_iff Ord_linear2 UNIV_I VWO le_TC_def le_less less_TC_imp_VWO pair_in_Id_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VWO_iff_Ord_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">β</span><span class="main">,</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> VWO <span class="main">⟷</span> <span class="free">β</span> <span class="main">≤</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> VWO_TC_le Ord_TC_less_iff le_TC_def le_TC_imp_VWO le_less<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_TC_le <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_TC_def nonzero_less_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_le_TC_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">j</span> <span class="main">⟹</span> succ <span class="free">i</span> <span class="main">⊑</span> <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">⊏</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_linear Ord_mem_iff_less_TC Ord_succ le_TC_def less_TC_succ less_asym_TC<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VWO_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> VWO <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> VWO"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_TC_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> le_TC_imp_VWO that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI Linear_order_VWO Linear_order_in_diff_Id UNIV_I VWO pair_in_Id_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> VWO_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> VWO"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> VWO"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff IdD Linear_order_VWO Linear_order_in_diff_Id UNIV_I VWO assms<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation VWF›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VWF</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VWF</span> <span class="main">≡</span> VWO <span class="main">-</span> Id"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_VWF <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf VWF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VWF_def wf_VWO<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trans_VWF <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trans VWF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VWF_def antisym_VWO trans_VWO trans_diff_Id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asym_VWF <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asym VWF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> VWF_def asym.intros irrefl_diff_Id wf_VWF wf_not_sym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> total_VWF <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"total VWF"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWF_def total_VWOId <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> total_on_VWF <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> VWF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I total_VWF total_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> VWF_asym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">using</span></span> VWF_def assms wf_VWO wf_not_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> VWF_non_refl <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∉</span> VWF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> VWF_iff_Ord_less <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">β</span><span class="main">)</span> <span class="main">∈</span> VWF <span class="main">⟷</span> <span class="free">α</span> <span class="main">&lt;</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VWF_def less_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_imp_VWF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VWF_def mem_imp_VWO <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Order types›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ordermap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ordermap</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> wfrec <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> set <span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ordertype</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ordertype</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> set <span class="main">(</span>ordermap <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_type<span class="main">:</span>
    <span class="quoted"><span class="quoted">"small <span class="free">A</span> <span class="main">⟹</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_in_ordertype <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> small <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">a</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span> <span class="main">⟹</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">a</span> <span class="main">=</span> set <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ordermap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wfrec_fixpoint adm_wf_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_ordermap <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span>set <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span> <span class="main">=</span> ZFC_in_HOL.set <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ordermap assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> elts_of_set empty_iff x<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="bound">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that transD <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>set <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Ord_def ordermap assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_Ord_ordertype<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> set <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_V_def ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ordermap OrdmemD assms imageE order.strict_implies_order that<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ordertype_def Ord_def Transset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_ordertype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span>ordertype <span class="free">A</span> VWF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wf_Ord_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def assms † ordermap <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ordermap</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves the orderings in both directions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">w</span> <span class="main">∈</span> elts <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordermap <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> elts_of_set image_eqI mem_Collect_eq replacement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> converse_ordermap_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mem_not_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹total_on <span class="free">A</span> <span class="free">r</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I total_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ordermap_mono assms mem_not_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_surj<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ordertype_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mem_not_refl ordermap_mono total_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordertype_def <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> elts_of_set replacement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> wf <span class="free">r</span><span class="main">;</span> total_on <span class="free">A</span> <span class="free">r</span><span class="main">;</span> small <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_iff_bijections ordermap_bij<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_into_ordermap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> inv_into <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">α</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_mono inv_into_into ordermap_surj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_nat_imp_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ord_of_nat <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≈</span> elts <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_def assms ordermap_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_finite_iff finite_Ord_omega <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_ordertype_eqpoll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eqpoll_def eqpoll_sym ordermap_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_eqpoll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ordertype <span class="free">A</span> VWF<span class="main">)</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms wf_ordertype_eqpoll total_VWF wf_VWF
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ordertype_eqpoll total_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More advanced <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ordertype</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ordermap</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> results›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_VWF_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> VWF <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordermap wf_VWO VWF_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">{}</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>small <span class="free">X</span><span class="main">;</span> wf <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> ordertype <span class="free">X</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordertype_def elts_of_set replacement image_is_empty zero_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_mono_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">w</span> <span class="main">&lt;</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD assms ordermap_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_mono_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">w</span><span class="main">=</span><span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">w</span> <span class="main">≤</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dual_order.strict_implies_order eq_refl ordermap_mono_less<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> converse_ordermap_le_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">y</span> <span class="main">≤</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total <span class="free">r</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">y</span><span class="main">=</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I assms mem_not_refl ordermap_mono total_on_def vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">X</span> <span class="free">r</span> <span class="main">≤</span> ordertype <span class="free">Y</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms smaller_than_small <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="free">X</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">≤</span> ordermap <span class="free">Y</span> <span class="free">r</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">X</span> <span class="free">r</span> <span class="skolem">z</span> <span class="main">&lt;</span> ordermap <span class="free">Y</span> <span class="free">r</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">using</span></span> less <span class="main">[</span><span class="operator">OF</span> zx<span class="main">]</span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear2 OrdmemD Ord_ordermap ordermap_mono in_mono leD that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vsubsetD zx<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordermap <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">X</span>›</span></span> Ord_mem_iff_lt set_image_le_iff less_eq_V_def r<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">Y</span> <span class="free">r</span> <span class="main">`</span> <span class="free">Y</span> <span class="main">=</span> elts <span class="main">(</span>ordertype <span class="free">Y</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordertype_def <span class="quoted"><span class="quoted">‹small <span class="free">Y</span>›</span></span> elts_of_set replacement<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">Y</span> <span class="free">r</span> <span class="main">∉</span> ordermap <span class="free">X</span> <span class="free">r</span> <span class="main">`</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 Ord_mem_iff_lt ordertype_def wf_Ord_ordertype <span class="quoted"><span class="quoted">‹small <span class="free">X</span>›</span></span> elts_of_set replacement r<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ordertype_VWF_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">X</span> VWF <span class="main">≤</span> ordertype <span class="free">Y</span> VWF"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_UNION_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊆</span> Collect small"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">𝒜</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">≤</span> ordertype <span class="main">(</span><span class="main">⋃</span><span class="free">𝒜</span><span class="main">)</span> <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_ordermap_mono_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> <span class="free">r</span><span class="main">)</span> <span class="free">α</span><span class="main">,</span> inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> <span class="free">r</span><span class="main">)</span> <span class="free">β</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&lt;</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ordermap <span class="free">M</span> <span class="free">r</span> <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> <span class="free">r</span><span class="main">)</span> <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> α f_inv_into_f ordermap_surj subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ordermap <span class="free">M</span> <span class="free">r</span> <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> <span class="free">r</span><span class="main">)</span> <span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> α β assms in_mono inv_into_into ordermap_mono_less ordermap_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> β f_inv_into_f in_mono ordermap_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_ordermap_mono_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> <span class="free">r</span><span class="main">)</span> <span class="free">α</span> <span class="main">=</span> inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> <span class="free">r</span><span class="main">)</span> <span class="free">β</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms f_inv_into_f ordermap_surj subsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_ordermap_VWF_mono_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="free">α</span> <span class="main">≤</span> inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="free">β</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ordermap <span class="free">M</span> VWF <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> α f_inv_into_f ordermap_surj subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ordermap <span class="free">M</span> VWF <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ON_imp_Ord VWF_iff_Ord_less assms dual_order.strict_implies_order elts_of_set eq_refl inv_into_into order.not_eq_order_implies_strict ordermap_mono_less ordertype_def replacement trans_VWF wf_VWF<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> β f_inv_into_f in_mono ordermap_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_mono_on_ordertype<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span> <span class="main">→</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="free">f</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span> <span class="main">→</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pi_I' in_mono inv_into_into ordermap_surj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_on_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="skolem">x</span> <span class="main">&lt;</span> inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ON_imp_Ord Ord_linear2 inv_into_into inv_ordermap_VWF_mono_le leD ordermap_surj subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_inc_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">,</span> <span class="free">π</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">π</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="free">s</span> <span class="main">(</span><span class="free">π</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">π</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">π</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span><span class="main">}</span> <span class="main">=</span> <span class="free">π</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">π</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> invπ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">,</span> <span class="free">π</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> π <span class="quoted"><span class="quoted">‹wf <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹total_on <span class="free">A</span> <span class="free">r</span>›</span></span> total_on_def wf_not_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">π</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">π</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="free">π</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_subset_iff invπ π<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> less
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹wf <span class="free">s</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span> 1 2 eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_inc_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">,</span> <span class="free">π</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="free">π</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> ordertype <span class="free">A</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span><span class="free">π</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="free">s</span> <span class="main">(</span><span class="free">π</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordermap_inc_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ordertype_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_cong image_image<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_inc_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">,</span> <span class="free">π</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">≤</span> ordertype <span class="free">B</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ordertype_inc_eq ordertype_mono<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> ordertype_VWF_inc_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">x</span><span class="main">&lt;</span><span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">π</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">π</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="free">π</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="free">A</span> VWF"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">π</span> <span class="skolem">x</span><span class="main">,</span> <span class="free">π</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that ON_imp_Ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I total_VWF total_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_image_ordermap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">X</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="free">X</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms smaller_than_small<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span><span class="main">,</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> that Ord_ordermap VWF_iff_Ord_less assms ordermap_mono_less subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> ordertype_map_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">A</span> <span class="main">-</span> ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> VWF"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">A</span> <span class="main">-</span> ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">A</span> <span class="main">-</span> ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="main">(</span>ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ordertype <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> VWF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> ordertype_image_ordermap <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> ordertype_le_ordertype<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">≤</span> ordertype <span class="free">B</span> <span class="free">s</span> <span class="main">⟷</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="main">∘</span> ordermap <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI ballI impI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> ordertype_def replacement set_of_elts small_elts subset_iff_less_eq_V<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> bijA<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> L <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> inv_into_into ordermap_in_ordertype ordermap_surj subsetD that vsubsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pi_iff f_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def inj_on_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AB <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> inv_into_injective ordermap_in_ordertype subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> bijA bij_betw_inv_into_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ‡<span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span> <span class="main">∈</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> L <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> in_mono ordermap_in_ordertype ordermap_surj vsubsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ordermap <span class="free">B</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ‡ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_inv_into_f<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">∈</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> L <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> in_mono ordermap_in_ordertype ordermap_surj vsubsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">&lt;</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * r s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Ord_ordermap OrdmemD <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> ordermap_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> † s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> f_inv_into_f inv_into_into less_asym ordermap_mono_less total_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> R<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_le <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> π<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> f assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iso_imp_ordertype_eq_ordertype<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> iso<span class="main">:</span> <span class="quoted"><span class="quoted">"iso <span class="free">r</span> <span class="free">r'</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Total <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sm<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>Field <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>Field <span class="free">r</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> ordertype <span class="main">(</span>Field <span class="free">r'</span><span class="main">)</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> iso_forward iso_wf assms iso_Field ordertype_inc_eq sm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_infinite_ge_ω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">≥</span> ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>ordermap <span class="free">A</span> VWF<span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ordermap_bij <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> bij_betw_def total_on_VWF wf_VWF<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">A</span>›</span></span> finite_image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ordertype <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> infinite_Ord_omega <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordertype_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> 
          <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bij_betw_imp_surj_on ordertype_inc_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_eq_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> VWF <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> x 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> elts <span class="free">α</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">}</span> <span class="main">=</span> elts <span class="skolem">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> elts <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_mem_iff_lt VWF_iff_Ord_less step.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">x</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_trans OrdmemD VWF_iff_Ord_less step.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> step
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_VWF<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> 1 Ord_trans <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">α</span></span><span class="main"><span class="main">]</span></span> step.prems <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_eq_Ord <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ordermap_eq_self <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def<span class="main">)</span>


<span class="keyword1"><span class="command">proposition</span></span> ordertype_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> <span class="free">α</span> <span class="main">⟷</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ordertype <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms ordermap_bij<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">&lt;</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.asym ordermap_mono_less total_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> 
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ordertype <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> VWF"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord VWF_iff_Ord_less α bij_betwE f<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms f <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ordertype_VWF_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">=</span> <span class="free">α</span> <span class="main">⟷</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I assms ordertype_eq_iff total_VWF total_on_def trans_VWF wf_VWF<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> ordertype_le_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">X</span> VWF <span class="main">≤</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ordertype_VWF_mono ordertype_eq_Ord small_elts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_inc_le_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">π</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">π</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">π</span> <span class="bound">x</span><span class="main">,</span> <span class="free">π</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord VWF_iff_Ord_less π <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> sub image_subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordertype_inc_eq ordertype_le_Ord wf_VWF<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_ordertype_obtains_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≤</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">H</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">G</span> VWF <span class="main">=</span> <span class="free">β</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI that<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ordermap <span class="free">H</span> VWF"</span></span>
  <span class="keyword3"><span class="command">show</span></span> ‡<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_subset_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> α inv_into_into ordermap_surj subsetD vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">(</span>inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">(</span>inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span> <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="main">[</span><span class="operator">OF</span> wf_VWF total_on_VWF <span class="quoted"><span class="quoted">‹small <span class="free">H</span>›</span></span><span class="main">]</span> α 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_RIGHT bij_betw_subset less_eq_V_def ‡<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that ‡ <span class="quoted"><span class="quoted">‹small <span class="free">H</span>›</span></span> in_mono ordermap_mono_less x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that ‡ <span class="quoted"><span class="quoted">‹small <span class="free">H</span>›</span></span> in_mono ordermap_mono_less <span class="main">[</span><span class="operator">OF</span> _ wf_VWF trans_VWF<span class="main">]</span> x y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I less_imp_not_less total_VWF total_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>inv_into <span class="free">H</span> <span class="var">?f</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_infinite_ω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">=</span> ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">≤</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms ordertype_le_Ord<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> ordertype <span class="free">A</span> VWF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms down ordertype_infinite_ge_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For infinite sets of natural numbers›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> ordertype_nat_ω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">N</span> less_than <span class="main">=</span> ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_on_def ord_of_nat_inject small_def small_iff_range small_image_nat_V<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>ord_of_nat <span class="main">`</span> <span class="free">N</span><span class="main">)</span> VWF <span class="main">=</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms finite_image_iff inj_on_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ordertype_infinite_ω<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>ord_of_nat <span class="main">`</span> <span class="free">N</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="free">N</span> less_than"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ordertype_inc_eq <span class="quoted"><span class="quoted">‹small <span class="free">N</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> ordertype_eq_ordertype<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="free">s</span> <span class="main">⟷</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> ordertype <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ordermap_bij assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> bij_betw_def r<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ordermap_bij assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> bij_betw_def s<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">o</span> ordermap <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> bijA<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> γ_def <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> bijB<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="free">B</span> <span class="main">(</span>elts <span class="skolem">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L γ_def ordermap_bij <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> s<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> bij_betw_comp_iff bij_betw_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> invB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="bound">α</span> <span class="main">∈</span> elts <span class="skolem">γ</span> <span class="main">⟹</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="main">(</span>inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="bound">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bijB bij_betw_inv_into_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ordermap_A_γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="bound">a</span> <span class="main">∈</span> elts <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bijA bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f_in_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">&lt;</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> o_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> f_def <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> comp_apply f_in_B invB ordermap_A_γ ordermap_mono_less s<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> s<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> order.asym ordermap_mono_less r total_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">&lt;</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> ordermap_mono_less r<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> comp_apply f_def f_in_B invB order.asym ordermap_A_γ ordermap_mono_less s<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> s<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> bij bij_betw_inv_into_left r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wf_not_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> f_in_B s<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> total_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordertype_eqI  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ordertype_eq_ordertype_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FA<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="free">r</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FB<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="free">s</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> iso <span class="free">r</span> <span class="free">s</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordertype_eq_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> FA FB iso_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> FA FB <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> iso_imp_ordertype_eq_ordertype r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_ordertype_imp_Field_Restr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Lim<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?oy</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> ordermap_in_ordertype succ_in_Limit_iff that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_into <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="var">?oy</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_into_ordermap<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> inv_into <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="var">?oy</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="var">?oy</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"§"</span> elts_succ f_inv_into_f insert_iff ordermap_surj subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> A converse_ordermap_mono r that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> Field <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Field_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Field_Restr_subset subset_antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_Field_Restr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>Field <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> ordertype <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ordertype_eq_ordertype wf_Restr total_on_def trans_Restr<span class="main">)</span>

<span class="keyword1"><span class="command">proposition</span></span> ordertype_eq_ordertype_iso_Restr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FA<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FB<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="main">(</span>Restr <span class="free">s</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> iso <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Restr <span class="free">s</span> <span class="free">B</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordertype_eq_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> FA FB bij_betwE <span class="keyword1"><span class="command">unfolding</span></span> iso_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>Field <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> ordertype <span class="free">A</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FA <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> ordertype_Field_Restr r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>Field <span class="main">(</span>Restr <span class="free">s</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Restr <span class="free">s</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FB <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> ordertype_Field_Restr s <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> iso_imp_ordertype_eq_ordertype FA FB <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> total_on_imp_Total_Restr trans_Restr wf_Int1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordermap_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="main">(</span>insert <span class="free">α</span> <span class="free">U</span><span class="main">)</span> VWF <span class="free">y</span> <span class="main">=</span> ordermap <span class="free">U</span> VWF <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> y
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">}</span> <span class="main">=</span> elts <span class="skolem">y</span> <span class="main">∩</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_mem_iff_lt VWF_iff_Ord_less assms subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> insert <span class="free">α</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">}</span> <span class="main">=</span> elts <span class="skolem">y</span> <span class="main">∩</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_mem_iff_lt VWF_iff_Ord_less assms leD step.hyps step.prems subsetD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> step
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_VWF<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> 1 2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_lower1 Ord_is_Transset Sup.SUP_cong Transset_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> in_mono vsubsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>insert <span class="free">α</span> <span class="free">U</span><span class="main">)</span> VWF <span class="main">=</span> succ <span class="main">(</span>ordertype <span class="free">U</span> VWF<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> insert <span class="free">α</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">}</span> <span class="main">=</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">}</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord OrdmemD assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟹</span> ordermap <span class="main">(</span>insert <span class="free">α</span> <span class="free">U</span><span class="main">)</span> VWF <span class="bound">x</span> <span class="main">=</span> ordermap <span class="free">U</span> VWF <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_is_Transset Transset_def U assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> in_mono ordermap_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>insert <span class="free">α</span> <span class="free">U</span><span class="main">)</span> VWF <span class="main">=</span>
        ZFC_in_HOL.set <span class="main">(</span>insert <span class="main">(</span>ordermap <span class="free">U</span> VWF <span class="free">α</span><span class="main">)</span> <span class="main">(</span>ordermap <span class="free">U</span> VWF <span class="main">`</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def ordermap_insert assms eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> succ <span class="main">(</span>ZFC_in_HOL.set <span class="main">(</span>ordermap <span class="free">U</span> VWF <span class="main">`</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"†"</span> U <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_VWF<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">α</span></span><span class="main"><span class="main">]</span></span> down succ_def vinsert_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> succ <span class="main">(</span>ordertype <span class="free">U</span> VWF<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_ordertype_le_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">≤</span> ord_of_nat <span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_Ord_ordertype assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordertype_def finite_imp_small <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> card_image_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le Ord_ord_of_nat <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> card_ord_of_nat card_seteq finite_imageI less_eq_V_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_VWF_ω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">∈</span> elts ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">&lt;</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω OrdmemD trans_VWF wf_VWF assms finite_ordertype_le_card le_less_trans ord_of_nat_ω<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_VWF_finite_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">=</span> ord_of_nat <span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imp_small ordermap_bij total_on_VWF wf_VWF ω_def assms bij_betw_same_card card_ord_of_nat elts_of_set f_inv_into_f inf ordertype_VWF_ω<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_ordertype_eq_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> <span class="free">r</span> <span class="main">=</span> ord_of_nat <span class="free">m</span> <span class="main">⟷</span> finite <span class="free">A</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ordermap_bij <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>elts <span class="main">(</span>ordertype <span class="free">A</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms ordermap_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_betw_def * card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms bij_betw_finite bij_betw_imp_surj_on finite_Ord_omega ordertype_VWF_finite_nat wf_Ord_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ex_bij_betw_strict_mono_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> ON"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">h</span> <span class="main">{..&lt;</span>card <span class="free">M</span><span class="main">}</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="free">h</span> <span class="main">{..&lt;</span>card <span class="free">M</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span> <span class="free">M</span> <span class="main">(</span>elts <span class="main">(</span>card <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Finite_V <span class="quoted"><span class="quoted">‹finite <span class="free">M</span>›</span></span> ordermap_bij ordertype_VWF_finite_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span><span class="main">)</span> <span class="main">∘</span> ord_of_nat"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> bijh<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?h</span> <span class="main">{..&lt;</span>card <span class="free">M</span><span class="main">}</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_trans<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw ord_of_nat <span class="main">{..&lt;</span>card <span class="free">M</span><span class="main">}</span> <span class="main">(</span>elts <span class="main">(</span>card <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def elts_ord_of_nat inj_on_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span>ordermap <span class="free">M</span> VWF<span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>card <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Finite_V assms bij_betw_inv_into ordermap_bij ordertype_VWF_finite_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="var">?h</span> <span class="main">{..&lt;</span>card <span class="free">M</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="var">?h</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> elts <span class="main">(</span>ordertype <span class="free">M</span> VWF<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">M</span>›</span></span> ordertype_VWF_finite_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="var">?h</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="var">?h</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bijh assms<span class="main">(</span>2<span class="main">)</span> bij_betwE that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?h</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="var">?h</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">m</span> <span class="main">=</span> <span class="var">?h</span> <span class="skolem">n</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">m</span> <span class="main">&gt;</span> <span class="var">?h</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Ord_linear_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_ordermap_mono_eq mn comp_apply ord_of_nat_inject<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="skolem">n</span> <span class="main">≤</span> ord_of_nat <span class="skolem">m</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Finite_V mn assms comp_def inv_ordermap_VWF_mono_le less_imp_le<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> leD <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_finite_less_than <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> less_than <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ord_of_nat assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> less_than <span class="main">=</span> ordertype <span class="var">?M</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_inc_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms finite_imp_small total_on_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">force</span><span class="keyword3">+</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijh<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">h</span> <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="var">?M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> smh<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="skolem">h</span> <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> M card_image ex_bij_betw_strict_mono_card inj_on_def ord_of_nat_inject<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> ord_of_nat <span class="main">∘</span> inv_into <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="var">?M</span> <span class="main">(</span>elts <span class="main">(</span>card <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>ord_of_nat <span class="main">∘</span> inv_into <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span>ord_of_nat <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ord_of_nat <span class="main">`</span> <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I bijh bij_betw_def bij_betw_inv_into bij_betw_subset bij_betw_trans inj_ord_of_nat subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="var">?M</span> <span class="main">(</span>elts <span class="main">(</span>card <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_ord_of_nat f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> ord_of_nat <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="skolem">h</span> <span class="main">∘</span> inv_into <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">∘</span> inv_into <span class="main">{..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> smh bij_betw_imp_surj_on <span class="main">[</span><span class="operator">OF</span> bijh<span class="main">]</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inv_into_into not_less_iff_gr_or_eq order.asym strict_mono_onD xy<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bijh
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into_right xy<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>2<span class="main">)</span> ON_imp_Ord xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Cardinality of a set›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">vcard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vcard</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> elts <span class="bound">i</span> <span class="main">≈</span> elts <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Card</span><span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Card</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vcard <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">CARD</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">CARD</span> <span class="main">≡</span> Collect Card"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cardinal_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">x</span> <span class="main">≈</span> elts <span class="free">y</span> <span class="main">⟹</span> vcard <span class="free">x</span> <span class="main">=</span> vcard <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vcard_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqpoll_sym eqpoll_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Card_cardinal_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span> <span class="main">⟹</span> vcard <span class="free">κ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Card_is_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">α</span> <span class="main">≈</span> elts <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ordertype ordertype_eqpoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> elts <span class="bound">i</span> <span class="main">≈</span> elts <span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Least<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_def vcard_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cardinal_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard <span class="free">a</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vcard_def
  <span class="keyword1"><span class="command">using</span></span> ordertype_eqpoll <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"elts <span class="free">a</span>"</span></span><span class="main">]</span> Ord_LeastI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ordertype small_elts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_into_vcard<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> elts <span class="free">A</span> <span class="main">→</span> elts <span class="main">(</span>vcard <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> inj_on_the_inv_into the_inv_into_onto
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pi_iff bij_betw_def eqpoll_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cardinal_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>vcard <span class="free">a</span><span class="main">)</span> <span class="main">=</span> vcard <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cardinal_cong cardinal_eqpoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹every natural number is a (finite) cardinal›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> nat_into_Card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Card_def vcard_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sym<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_def assms elts_of_set imageE inf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">β</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">β</span> <span class="main">≈</span> elts <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">β</span> <span class="main">≈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_of_nat_eq_initial <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span> eqpoll_trans inj_on_def inj_on_image_eqpoll_self<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms n  <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹elts <span class="skolem">β</span> <span class="main">≈</span> elts <span class="free">α</span>›</span></span> card_seteq eqpoll_finite_iff eqpoll_iff_card finite_lessThan less_eq_V_def less_le_not_le order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> elts <span class="bound">i</span> <span class="main">≈</span> elts <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Least_equality Ord_linear_le eqpoll_refl less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Card_ord_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="main">(</span>ord_of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def nat_into_Card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Card_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_into_Card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> CardI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">i</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">;</span> Ord <span class="bound">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> elts <span class="bound">j</span> <span class="main">≈</span> elts <span class="free">i</span><span class="main">⟧</span> <span class="main">⟹</span> Card <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Card_def vcard_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Least Ord_linear_lt cardinal_eqpoll eqpoll_refl not_less_Ord_Least vcard_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vcard_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Card_0 Card_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_cardinal <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span>vcard <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vcard_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_def Card_is_Ord cardinal_cong cardinal_eqpoll vcard_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The cardinals are the initial ordinals.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Card_iff_initial<span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span> <span class="main">⟷</span> Ord <span class="free">κ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">α</span><span class="main">.</span> Ord <span class="bound">α</span> <span class="main">∧</span> <span class="bound">α</span> <span class="main">&lt;</span> <span class="free">κ</span> <span class="main">⟶</span> <span class="main">~</span> elts <span class="bound">α</span> <span class="main">≈</span> elts <span class="free">κ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> κ<span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">j</span> <span class="main">≈</span> elts <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> elts <span class="bound">i</span> <span class="main">≈</span> elts <span class="free">κ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> κ
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_def vcard_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> Ord <span class="bound">i</span> <span class="main">∧</span> elts <span class="bound">i</span> <span class="main">≈</span> elts <span class="free">κ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> κ
      <span class="keyword1"><span class="command">using</span></span> not_less_Ord_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> CardI Card_is_Ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Card_ω <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Card ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span> <span class="bound">f</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">α</span> <span class="main">∈</span> elts ω<span class="main">;</span> bij_betw <span class="bound">f</span> <span class="main">(</span>elts <span class="bound">α</span><span class="main">)</span> <span class="main">(</span>elts ω<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_finite finite_Ord_omega infinite_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CardI Ord_ω Ord_mem_iff_lt eqpoll_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lt_Card_imp_lesspoll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">i</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">;</span> Card <span class="free">a</span><span class="main">;</span> Ord <span class="free">i</span><span class="main">⟧</span> <span class="main">⟹</span> elts <span class="free">i</span> <span class="main">≺</span> elts <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Card_iff_initial less_eq_V_def less_imp_le lesspoll_def subset_imp_lepoll<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lepoll_imp_Card_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">a</span> <span class="main">≲</span> elts <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">a</span> <span class="main">≤</span> vcard <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Ord_cardinal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> Ord_cardinal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_linear_le<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> le <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ge
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">b</span> <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardinal_eqpoll eqpoll_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≲</span> elts <span class="main">(</span>vcard <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ge less_eq_V_def subset_imp_lepoll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardinal_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">b</span> <span class="main">≲</span> elts <span class="free">a</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">a</span> <span class="main">≈</span> elts <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms lepoll_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">a</span> <span class="main">=</span> vcard <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cardinal_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lepoll_cardinal_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>elts <span class="free">A</span> <span class="main">≲</span> elts <span class="free">i</span><span class="main">;</span> Ord <span class="free">i</span><span class="main">⟧</span> <span class="main">⟹</span> vcard <span class="free">A</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Least Ord_linear2 dual_order.trans eqpoll_refl lepoll_imp_Card_le not_less_Ord_Least vcard_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cardinal_le_lepoll<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="free">A</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">⟹</span> elts <span class="free">A</span> <span class="main">≲</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cardinal_eqpoll eqpoll_sym lepoll_trans1 less_eq_V_def subset_imp_lepoll<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lesspoll_imp_Card_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">a</span> <span class="main">≺</span> elts <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">a</span> <span class="main">&lt;</span> vcard <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cardinal_eqpoll eqpoll_sym eqpoll_trans le_neq_trans lepoll_imp_Card_le lesspoll_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Card_Union <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Card<span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="main">⨆</span><span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> CardI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="main">⨆</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_is_Ord Ord_Sup<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">⨆</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="bound">c</span> <span class="main">∧</span> Card<span class="main">(</span><span class="bound">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Card_is_Ord Ord_linear2 ZFC_in_HOL.Sup_least leD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> jls<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="skolem">j</span> <span class="main">≺</span> elts <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j<span class="main">(</span>2<span class="main">)</span> lt_Card_imp_lesspoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> eqp<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="skolem">j</span> <span class="main">≈</span> elts <span class="main">(</span><span class="main">⨆</span><span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"elts <span class="skolem">c</span> <span class="main">≲</span> elts <span class="main">(</span><span class="main">⨆</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">using</span></span> Sup_V_def ZFC_in_HOL.Sup_upper j<span class="main">(</span>1<span class="main">)</span> less_eq_V_def subset_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≈</span> elts <span class="skolem">j</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eqpoll_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eqp<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≺</span> elts <span class="skolem">c</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> jls<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">c</span> <span class="main">≺</span> elts <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> elts <span class="skolem">j</span> <span class="main">≈</span> elts <span class="main">(</span><span class="main">⨆</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Card_UN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> Card<span class="main">(</span><span class="free">K</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> Card<span class="main">(</span>Sup <span class="main">(</span><span class="free">K</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Transfinite recursion for definitions based on the three cases of ordinals›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">transrec3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span> <span class="main">[</span>V<span class="main">,</span>V<span class="main">]</span><span class="main">⇒</span>V<span class="main">,</span> <span class="main">[</span>V<span class="main">,</span>V<span class="main">⇒</span>V<span class="main">]</span><span class="main">⇒</span>V<span class="main">,</span> V<span class="main">]</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">transrec3</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
       transrec <span class="main">(</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">x</span><span class="main">.</span>
         <span class="keyword1">if</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
         <span class="keyword1">else</span> <span class="keyword1">if</span> Limit <span class="bound">x</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">x</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">∈</span> elts <span class="bound">x</span><span class="main">.</span> <span class="bound">r</span> <span class="bound">y</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">(</span>pred <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">r</span> <span class="main">(</span>pred <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transrec3_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"transrec3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transrec transrec3_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transrec3_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"transrec3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">(</span>succ <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="free">i</span> <span class="main">(</span>transrec3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transrec transrec3_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transrec3_Limit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"Limit <span class="free">i</span> <span class="main">⟹</span>  transrec3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">i</span> <span class="main">=</span> <span class="free">c</span> <span class="free">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span> <span class="main">∈</span> elts <span class="free">i</span><span class="main">.</span> transrec3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transrec3_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> transrec<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinal Addition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cadd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span>V<span class="main">]</span><span class="main">⇒</span>V"</span></span>       <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">⊕</span>›</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">≡</span> vcard <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">⨄</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal addition is commutative›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vsum_commute_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span><span class="free">b</span><span class="main">⨄</span><span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span><span class="main">.</span> sum_case Inr Inl <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">b</span><span class="main">⨄</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI inj_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span>sum_case Inr Inl<span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">a</span> <span class="main">⨄</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">⨄</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> elts <span class="main">(</span><span class="free">b</span> <span class="main">⨄</span> <span class="free">a</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> imageI sum_case_Inr sum_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inl_in_sum_iff imageI sum_case_Inl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊕</span> <span class="free">j</span> <span class="main">=</span> <span class="free">j</span> <span class="main">⊕</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cadd_def cardinal_cong vsum_commute_eqpoll<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal addition is associative›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_assoc_bij<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span><span class="main">⨄</span><span class="free">c</span><span class="main">)</span><span class="main">.</span> sum_case<span class="main">(</span>sum_case Inl <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Inr<span class="main">(</span>Inl <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Inr<span class="main">(</span>Inr <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>
      <span class="main">(</span>elts <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span><span class="main">⨄</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="main">(</span><span class="free">b</span><span class="main">⨄</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> f' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sum_case <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Inl <span class="main">(</span>Inl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sum_case <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Inl <span class="main">(</span>Inr <span class="bound">x</span><span class="main">)</span><span class="main">)</span> Inr<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bij_betw_byWitness<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_assoc_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span><span class="main">⨄</span><span class="free">c</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="main">(</span><span class="free">b</span><span class="main">⨄</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sum_assoc_bij<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_vcard_vsum_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> Inl <span class="main">`</span> elts <span class="free">i</span> <span class="main">∪</span> Inr <span class="main">`</span> elts <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span> <span class="main">≈</span> Inl <span class="main">`</span> elts <span class="free">i</span> <span class="main">∪</span> Inr <span class="main">`</span> elts <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_vsum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll eqpoll_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">⊕</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> cadd_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> cardinal_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard<span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span> <span class="main">⨄</span> <span class="free">k</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span> <span class="main">⨄</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjnt_def elts_vsum elts_vcard_vsum_eqpoll <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Un_eqpoll_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="main">(</span><span class="free">j</span> <span class="main">⨄</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_assoc_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> vcard<span class="main">(</span><span class="free">j</span> <span class="main">⨄</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjnt_def elts_vsum elts_vcard_vsum_eqpoll <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> eqpoll_sym<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Un_eqpoll_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span> <span class="main">⨄</span> <span class="free">k</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> vcard <span class="main">(</span><span class="free">j</span> <span class="main">⨄</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹0 is the identity for addition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> vsum_0_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="main">0</span><span class="main">⨄</span><span class="free">a</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_vsum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">⊕</span> <span class="free">κ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_def cadd_def cardinal_cong vsum_0_eqpoll<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span> <span class="main">⟹</span> <span class="free">κ</span> <span class="main">⊕</span> <span class="main">0</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cadd_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vsum_lepoll_self<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">a</span> <span class="main">≲</span> elts <span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> elts_vsum  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Inl_iff Un_upper1 inj_onI lepoll_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_le_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> κ<span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊕</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> cadd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> vcard <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_def κ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> vcard <span class="main">(</span><span class="free">κ</span> <span class="main">⨄</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lepoll_imp_Card_le vsum_lepoll_self<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> vcard <span class="main">(</span><span class="free">κ</span> <span class="main">⨄</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Monotonicity of addition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cadd_le_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">κ'</span> <span class="main">≤</span> <span class="free">κ</span><span class="main">;</span> <span class="free">μ'</span> <span class="main">≤</span> <span class="free">μ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">κ'</span> <span class="main">⊕</span> <span class="free">μ'</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊕</span> <span class="free">μ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cadd_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> lepoll_imp_Card_le less_eq_V_def subset_imp_lepoll sum_subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal multiplication›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span>V<span class="main">]</span><span class="main">⇒</span>V"</span></span>       <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">⊗</span>›</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">≡</span> vcard <span class="main">(</span>VSigma <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal multiplication is commutative›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prod_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">C</span><span class="main">;</span> bij_betw <span class="free">g</span> <span class="free">B</span> <span class="free">D</span><span class="main">⟧</span>
             <span class="main">⟹</span> bij_betw <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span> <span class="main">×</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span>inv_into <span class="free"><span class="free">A</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> inv_into <span class="free"><span class="free">B</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into_left bij_betw_inv_into_right bij_betwE<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> bij_betwE bij_betw_inv_into <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> cmult_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊗</span> <span class="free">j</span> <span class="main">=</span> <span class="free">j</span> <span class="main">⊗</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>elts <span class="free">i</span> <span class="main">×</span> elts <span class="free">j</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>elts <span class="free">j</span> <span class="main">×</span> elts <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_vpair times_commute_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cmult_def
    <span class="keyword1"><span class="command">using</span></span> cardinal_cong elts_VSigma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal multiplication is associative›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_vcard_VSigma_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">i</span> <span class="main">×</span> elts <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">i</span> <span class="main">×</span> elts <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_VSigma<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll eqpoll_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cmult_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">⊗</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cmult_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cardinal_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> elts <span class="free">k</span> <span class="main">≈</span> <span class="main">(</span>elts <span class="free">i</span> <span class="main">×</span> elts <span class="free">j</span><span class="main">)</span> <span class="main">×</span> elts <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> times_eqpoll_cong elts_vcard_VSigma_eqpoll cardinal_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="free">i</span> <span class="main">×</span> <span class="main">(</span>elts <span class="free">j</span> <span class="main">×</span> elts <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_assoc_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="free">i</span> <span class="main">×</span> elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">j</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> times_eqpoll_cong elts_vcard_VSigma_eqpoll cardinal_eqpoll eqpoll_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>VSigma <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>VSigma <span class="free">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> vcard <span class="main">(</span>vtimes <span class="free">j</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_VSigma<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Cardinal multiplication distributes over addition›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_cmult_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">⊕</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cadd_def cmult_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cardinal_cong<span class="main">)</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vtimes <span class="main">(</span>vcard <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="main">(</span>vsum <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> elts <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll elts_vcard_VSigma_eqpoll eqpoll_sym eqpoll_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> <span class="main">(</span>Inl <span class="main">`</span> elts <span class="free">i</span> <span class="main">∪</span> Inr <span class="main">`</span> elts <span class="free">j</span><span class="main">)</span> <span class="main">×</span> elts <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elts_vcard_vsum_eqpoll times_eqpoll_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> <span class="main">(</span>Inl <span class="main">`</span> elts <span class="free">i</span><span class="main">)</span> <span class="main">×</span> elts <span class="free">k</span> <span class="main">∪</span> <span class="main">(</span>Inr <span class="main">`</span> elts <span class="free">j</span><span class="main">)</span> <span class="main">×</span> elts <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sigma_Un_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">k</span> <span class="main">⨄</span> vtimes <span class="free">j</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Plus_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> elts_vsum elts_VSigma disjnt_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Un_eqpoll_cong times_eqpoll_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">k</span> <span class="main">⨄</span> vtimes <span class="free">j</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardinal_eqpoll eqpoll_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">k</span><span class="main">)</span> <span class="main">⨄</span> vcard <span class="main">(</span>vtimes <span class="free">j</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cadd_assoc cadd_def cardinal_cong cardinal_eqpoll vsum_0_eqpoll vsum_commute_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>VSigma <span class="main">(</span>vcard <span class="main">(</span><span class="free">i</span> <span class="main">⨄</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>
             <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">i</span> <span class="free">k</span><span class="main">)</span> <span class="main">⨄</span> vcard <span class="main">(</span>vtimes <span class="free">j</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Multiplication by 0 yields 0›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cmult_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊗</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Card_0 Card_def cmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹1 is the identity for multiplication›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cmult_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊗</span> <span class="free">κ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vtimes <span class="main">(</span>set <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="free">κ</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> elts_VSigma <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> times_singleton_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_def assms cardinal_cong cmult_def elts_1 set_of_elts<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some inequalities for multiplication›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cmult_square_le<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">κ</span> <span class="main">≲</span> elts <span class="main">(</span><span class="free">κ</span> <span class="main">⊗</span> <span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> times_square_lepoll <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"elts <span class="free">κ</span>"</span></span><span class="main">]</span> cmult_def elts_vcard_VSigma_eqpoll eqpoll_sym lepoll_trans2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_def assms cmult_def lepoll_cardinal_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Multiplication by a non-empty set›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cmult_le_self<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">=</span> vcard <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_def <span class="quoted"><span class="quoted">‹Card <span class="free">κ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> vcard <span class="main">(</span>vtimes <span class="free">κ</span> <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lepoll_imp_Card_le<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_VSigma<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZFC_in_HOL.ext <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> elts_0 lepoll_times1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmult_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Monotonicity of multiplication›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cmult_le_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">κ'</span> <span class="main">≤</span> <span class="free">κ</span><span class="main">;</span> <span class="free">μ'</span> <span class="main">≤</span> <span class="free">μ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">κ'</span> <span class="main">⊗</span> <span class="free">μ'</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">μ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cmult_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> elts_VSigma <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lepoll_imp_Card_le times_lepoll_mono subset_imp_lepoll<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The finite cardinals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> succ_lepoll_succD<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>succ<span class="main">(</span><span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">≲</span> elts <span class="main">(</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> elts <span class="free">m</span> <span class="main">≲</span> elts <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_lepoll_insertD<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Congruence law for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">succ</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> under equipollence›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> succ_eqpoll_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">a</span> <span class="main">≈</span> elts <span class="free">b</span> <span class="main">⟹</span> elts <span class="main">(</span>succ<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>succ<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_def insert_eqpoll_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_succ_eqpoll<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>succ <span class="free">a</span> <span class="main">⨄</span> <span class="free">b</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>succ<span class="main">(</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">z</span><span class="main">=</span>Inl <span class="free">a</span> <span class="keyword1">then</span> <span class="free">a</span><span class="main">⨄</span><span class="free">b</span> <span class="keyword1">else</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">z</span><span class="main">=</span><span class="free">a</span><span class="main">⨄</span><span class="free">b</span> <span class="keyword1">then</span> Inl <span class="free">a</span> <span class="keyword1">else</span> <span class="bound">z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">(</span>elts <span class="main">(</span>succ <span class="free">a</span> <span class="main">⨄</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>succ <span class="main">(</span><span class="free">a</span> <span class="main">⨄</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?g</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Inl_in_sum_iff mem_not_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inr_in_sum_iff mem_not_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cadd_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">m</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">=</span> vcard <span class="main">(</span>succ<span class="main">(</span><span class="free">m</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> cadd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="main">(</span><span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll eqpoll_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>succ <span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> vcard <span class="main">(</span>succ<span class="main">(</span><span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_succ_eqpoll <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> cardinal_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vcard <span class="main">(</span>succ<span class="main">(</span>vcard <span class="main">(</span><span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> succ_eqpoll_cong cardinal_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>succ <span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> vcard <span class="main">(</span>succ<span class="main">(</span>vcard <span class="main">(</span><span class="free">m</span> <span class="main">⨄</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nat_cadd_eq_add<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">m</span> <span class="main">⊕</span> ord_of_nat <span class="free">n</span> <span class="main">=</span> ord_of_nat <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_def Card_ord_of_nat add_Suc cadd_succ ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vcard_disjoint_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> vcard <span class="free">x</span> <span class="main">⊕</span> vcard <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span><span class="free">x</span> <span class="main">⨄</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="free">x</span> <span class="keyword1">then</span> Inl <span class="bound">z</span> <span class="keyword1">else</span> Inr <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sum_case id id"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span><span class="free">x</span> <span class="main">⨄</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?g</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms V_disjoint_iff <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cadd_commute cadd_def cardinal_cong cardinal_idem vsum_0_eqpoll cadd_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Infinite cardinals›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">InfCard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">InfCard</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">≡</span> Card <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">∧</span> ω <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"InfCard <span class="free">κ</span> <span class="main">⟷</span> Card <span class="free">κ</span> <span class="main">∧</span> infinite <span class="main">(</span>elts <span class="free">κ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> <span class="free">κ</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_ord_of_nat lepoll_def less_eq_V_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> InfCard_def ω_def infinite_le_lepoll<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_iff_initial InfCard_def infinite_Ord_omega <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_ge_ord_of_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> InfCard_def assms ord_of_nat_le_omega <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_not_0<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> InfCard <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> InfCard_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">csucc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V<span class="main">⇒</span>V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">csucc</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">κ'</span><span class="main">.</span> Ord <span class="bound">κ'</span> <span class="main">∧</span> <span class="main">(</span>Card <span class="bound">κ'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">&lt;</span> <span class="bound">κ'</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> less_vcard_VPow<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="free">A</span> <span class="main">&lt;</span> vcard <span class="main">(</span>VPow <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lesspoll_imp_Card_less<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">A</span> <span class="main">≺</span> elts <span class="main">(</span>VPow <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_VPow down inj_on_def lesspoll_Pow_self<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greater_Card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> vcard <span class="main">(</span>VPow <span class="free">κ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">=</span> vcard <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> vcard <span class="main">(</span>VPow <span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lesspoll_imp_Card_less<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">κ</span> <span class="main">≺</span> elts <span class="main">(</span>VPow <span class="free">κ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_VPow down inj_on_def lesspoll_Pow_self<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> Card_csucc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Card <span class="main">(</span>csucc <span class="free">κ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less_csucc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> csucc <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Card <span class="main">(</span>csucc <span class="free">κ</span><span class="main">)</span> <span class="main">∧</span> <span class="free">κ</span> <span class="main">&lt;</span> csucc <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> csucc_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Ord_LeastI2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Card <span class="main">(</span>vcard <span class="main">(</span>VPow <span class="free">κ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">κ</span> <span class="main">&lt;</span> <span class="main">(</span>vcard <span class="main">(</span>VPow <span class="free">κ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Card_def assms greater_Card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Card <span class="main">(</span>csucc <span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> csucc <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_csucc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> csucc <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms less_csucc less_imp_le<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> csucc_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Card <span class="free">μ</span><span class="main">;</span> <span class="free">κ</span> <span class="main">∈</span> elts <span class="free">μ</span><span class="main">⟧</span> <span class="main">⟹</span> csucc <span class="free">κ</span> <span class="main">≤</span> <span class="free">μ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> csucc_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_is_Ord Ord_Least_le OrdmemD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_csucc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> elts ω <span class="main">⟹</span> csucc <span class="free">a</span> <span class="main">=</span> succ <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> csucc_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ZFC_in_HOL.succ <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> Card <span class="main">(</span>ZFC_in_HOL.succ <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> ZFC_in_HOL.succ <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> elts ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_V_def less_eq_V_def nat_into_Card<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ZFC_in_HOL.succ <span class="free">a</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> elts ω"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">y</span> <span class="main">∧</span> Card <span class="skolem">y</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt dual_order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Finite_imp_cardinal_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> FA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> csucc<span class="main">(</span>vcard <span class="main">(</span>set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> csucc_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FA Finite_V<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> elts <span class="main">(</span>set <span class="free">A</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FA a eqpoll_imp_lepoll eqpoll_sym finite_insert_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>vcard <span class="main">(</span>set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> Card <span class="main">(</span>vcard <span class="main">(</span>set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> vcard <span class="main">(</span>set <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> vcard <span class="main">(</span>set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_def lesspoll_imp_Card_less lesspoll_def subset_imp_lepoll subset_insertI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>set <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">i</span> <span class="main">∧</span> Card <span class="skolem">i</span> <span class="main">∧</span> vcard <span class="main">(</span>set <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vcard <span class="main">(</span>set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FA finite_imp_small cardinal_eqpoll elts_of_set<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≺</span> elts <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_lesspoll_trans eqpoll_sym lt_Card_imp_lesspoll that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_imp_insert_lepoll lepoll_cardinal_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vcard_finite_set<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> vcard <span class="main">(</span>set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> ord_of_nat <span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_empty ω_def finite_csucc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lt_csucc_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">κ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&lt;</span> csucc <span class="free">κ</span> <span class="main">⟷</span> vcard <span class="free">α</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">α</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&lt;</span> csucc <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">α</span> <span class="main">≤</span> csucc <span class="free">κ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> dual_order.trans lepoll_cardinal_le lepoll_refl less_le_not_le that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Card_def Card_iff_initial Ord_linear2 Ord_mem_iff_lt assms cardinal_eqpoll cardinal_idem csucc_le eq_iff eqpoll_sym that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&lt;</span> csucc <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">α</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> csucc <span class="free">κ</span> <span class="main">≤</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_csucc Card_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_less_trans lepoll_imp_Card_le less_csucc less_eq_V_def less_le_not_le subset_imp_lepoll<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Card_csucc Card_is_Ord Ord_linear2 assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Card_lt_csucc_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Card <span class="free">κ'</span><span class="main">;</span> Card <span class="free">κ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">κ'</span> <span class="main">&lt;</span> csucc <span class="free">κ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">κ'</span> <span class="main">≤</span> <span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_csucc_iff Card_cardinal_eq Card_is_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_csucc<span class="main">:</span> <span class="quoted"><span class="quoted">"InfCard <span class="free">κ</span> <span class="main">⟹</span> InfCard <span class="main">(</span>csucc <span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> InfCard_def le_csucc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Kunen's Lemma 10.11›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> InfCard_is_Limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> non_succ_LimitI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_def assms mem_not_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_is_Ord InfCard_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ZFC_in_HOL.succ <span class="skolem">y</span> <span class="main">≠</span> <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">y</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Card <span class="main">(</span>succ <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> InfCard_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> InfCard_iff Ord_in_Ord <span class="quoted"><span class="quoted">‹Ord <span class="free">κ</span>›</span></span> <span class="quoted"><span class="quoted">‹ZFC_in_HOL.succ <span class="skolem">y</span> <span class="main">=</span> <span class="free">κ</span>›</span></span> assms elts_succ finite_insert infinite_Ord_omega insertI1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">y</span> <span class="main">≈</span> elts <span class="main">(</span>succ <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> InfCard_iff <span class="quoted"><span class="quoted">‹ZFC_in_HOL.succ <span class="skolem">y</span> <span class="main">=</span> <span class="free">κ</span>›</span></span> assms eqpoll_sym infinite_insert_eqpoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_iff_initial Ord_in_Ord OrdmemD elts_succ insertI1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Toward's Kunen's Corollary 10.13 (1)›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Kunen's Theorem 10.12›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> InfCard_csquare_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">⊗</span> <span class="free">κ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> infinite_times_eqpoll_self <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"elts <span class="free">κ</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_iff Card_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cardinal_cong cardinal_eqpoll cmult_def elts_vcard_VSigma_eqpoll eqpoll_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_le_cmult_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">⊗</span> <span class="free">μ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">⊗</span> <span class="free">μ</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cmult_le_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> InfCard_csquare_eq assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">⊗</span> <span class="free">μ</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> cmult_le_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Kunen's Corollary 10.13 (1), for cardinal multiplication›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> InfCard_cmult_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>InfCard <span class="free">κ</span><span class="main">;</span> InfCard <span class="free">μ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">κ</span> <span class="main">⊗</span> <span class="free">μ</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">⊔</span> <span class="free">μ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_is_Ord InfCard_def InfCard_le_cmult_eq Ord_linear_le cmult_commute inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> mem_not_refl sup.orderE sup_V_0_right zero_in_omega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cmult_succ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">m</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">m</span> <span class="main">⊗</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cmult_def cadd_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cardinal_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vtimes <span class="main">(</span>ZFC_in_HOL.succ <span class="free">m</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">n</span> <span class="main">&lt;+&gt;</span> elts <span class="free">m</span> <span class="main">×</span> elts <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_VSigma prod_insert_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="main">(</span><span class="free">n</span> <span class="main">⨄</span> vcard <span class="main">(</span>vtimes <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> elts_VSigma elts_vsum Plus_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Un_eqpoll_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Sum_Type.Inr <span class="main">`</span> <span class="main">(</span>elts <span class="free">m</span> <span class="main">×</span> elts <span class="free">n</span><span class="main">)</span><span class="main">::</span><span class="main">(</span>V <span class="main">+</span> V <span class="main">×</span> V<span class="main">)</span> set<span class="main">)</span> <span class="main">≈</span> Inr <span class="main">`</span> elts <span class="main">(</span>vcard <span class="main">(</span>vtimes <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_vcard_VSigma_eqpoll eqpoll_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjnt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>vtimes <span class="main">(</span>ZFC_in_HOL.succ <span class="free">m</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span><span class="free">n</span> <span class="main">⨄</span> vcard <span class="main">(</span>vtimes <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cmult_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="numeral">2</span> <span class="main">⊗</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="numeral">2</span> <span class="main">=</span> succ <span class="main">(</span>succ <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmult_succ assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_cdouble_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">⊕</span> <span class="free">κ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">⊕</span> <span class="free">κ</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">⊗</span> ord_of_nat <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_def assms cmult_2 cmult_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> InfCard_le_cmult_eq InfCard_ge_ord_of_nat assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Corollary 10.13 (1), for cardinal addition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> InfCard_le_cadd_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>InfCard <span class="free">κ</span><span class="main">;</span> <span class="free">μ</span> <span class="main">≤</span> <span class="free">κ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">κ</span> <span class="main">⊕</span> <span class="free">μ</span> <span class="main">=</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> InfCard_cdouble_eq InfCard_def antisym cadd_le_mono cadd_le_self<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> InfCard_cadd_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>InfCard <span class="free">κ</span><span class="main">;</span> InfCard <span class="free">μ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">κ</span> <span class="main">⊕</span> <span class="free">μ</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">⊔</span> <span class="free">μ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Card_iff_initial InfCard_def InfCard_le_cadd_eq Ord_linear_le cadd_commute sup.absorb2 sup.orderE<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Aleph-seqence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the well-known transfinite enumeration of the cardinal numbers.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Aleph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V"</span></span>   <span class="main">(</span><span class="quoted">‹<span class="keyword1">ℵ</span>_›</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Aleph</span> <span class="main">≡</span> transrec3 ω <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">r</span><span class="main">.</span> csucc<span class="main">(</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">r</span> <span class="main">.</span> <span class="main">⨆</span> <span class="main">(</span><span class="bound">r</span> <span class="main">`</span> elts <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Card_Aleph <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> Card<span class="main">(</span>Aleph <span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Aleph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Aleph_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">ℵ</span><span class="main">0</span> <span class="main">=</span> ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aleph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Aleph_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">ℵ</span><span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> csucc <span class="main">(</span><span class="main">ℵ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aleph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Aleph_Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">γ</span> <span class="main">⟹</span> <span class="main">ℵ</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span>Aleph <span class="main">`</span> elts <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aleph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_Aleph_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> <span class="main">ℵ</span><span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">ℵ</span><span class="main">(</span>succ <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_is_Ord Ord_mem_iff_lt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Aleph_increasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&lt;</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Aleph<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">&lt;</span> Aleph<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="skolem">x</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">⟧</span> <span class="main">⟹</span> Aleph<span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> elts <span class="main">(</span>Aleph <span class="free">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">β</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">β</span>"</span></span> <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="skolem">β</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrdmemD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_is_Ord Ord_mem_iff_lt succ.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">with</span></span> succ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Aleph_succ Card_Aleph le_csucc vsubsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">γ</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="skolem">x</span> <span class="main">∈</span> elts <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_def Ord_mem_iff_lt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">ℵ</span> <span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span>Aleph <span class="main">`</span> elts <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Limit
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Limit
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aleph_Limit<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ab
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_is_Ord Ord_mem_iff_lt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> countable_iff_le_Aleph0<span class="main">:</span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> vcard <span class="free">A</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">A</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> vcard_finite_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts ω <span class="main">≈</span> elts <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> countableE_infinite <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span>     
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eqpoll_def ω_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> bij_betw_def bij_betw_inv bij_betw_trans inj_ord_of_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Card_ω Card_def cardinal_cong vcard_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">A</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">A</span> <span class="main">≲</span> elts ω"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cardinal_le_lepoll <span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> countable_iff_lepoll ω_def inj_ord_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The ordinal <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ω1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ω1</span> <span class="main">≡</span> Aleph <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_ω1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord ω1"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_is_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> omega_ω1 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω <span class="main">∈</span> elts ω1"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mem_Aleph_succ one_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_ω1 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">n</span> <span class="main">∈</span> elts ω1"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_ω1 Ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> countable_iff_less_ω1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">α</span> <span class="main">&lt;</span> ω1"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms countable_iff_le_Aleph0 lt_csucc_iff one_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_ω1_imp_countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_ω1 Ord_in_Ord OrdmemD assms countable_iff_less_ω1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ω1_gt0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω1 <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_ω1 Ord_trans OrdmemD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ω1_gt1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω1 <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_ω1 OrdmemD ω_gt1 less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_ω1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Limit ω1"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> InfCard_def InfCard_is_Limit le_csucc one_V_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Kirby">
<div class="head">
<h1>Theory Kirby</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Addition and Multiplication of Sets›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kirby
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ZFC_Cardinals.html">ZFC_Cardinals</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalised Addition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Source: Laurence Kirby, Addition and multiplication of sets
      Math. Log. Quart. 53, No. 1, 52-65 (2007) / DOI 10.1002/malq.200610026
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "http://faculty.baruch.cuny.edu/lkirby/mlqarticlejan2007.pdf"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Addition is a monoid›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This definition is credited to Tarski›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_V</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_V</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> transrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> set <span class="main">(</span><span class="bound">f</span> <span class="main">`</span> elts <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> set <span class="main">(</span>plus <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">`</span> elts <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> set <span class="main">(</span><span class="main">(+)</span><span class="free">x</span> <span class="main">`</span> elts <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_V_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> transrec<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_eq_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lift_def  <span class="keyword1"><span class="command">using</span></span> plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lemma 3.2›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> lift_sup_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">a</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un lift_def sup_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_Sup_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">Y</span> <span class="main">⟹</span> lift <span class="free">x</span> <span class="main">(</span><span class="main">⨆</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span>lift <span class="free">x</span> <span class="main">`</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_def Sup_V_def image_Union<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_Sup_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_eq_lift SUP_sup_distrib lift_Sup_distrib image_image<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_add_Sup_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">α</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="free">α</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="free">α</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_Sup_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proposition 3.3(ii)›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">monoid_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">⊔</span> set <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊔</span> lift <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊔</span> set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> plus_eq_lift step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊔</span> lift <span class="skolem">a</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊔</span> set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> lift <span class="skolem">a</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lift_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set image_image lift_def lift_sup_distrib plus_eq_lift replacement small_elts<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> plus<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> plus<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_by0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_by1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> set<span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that le_imp_less_or_eq not_less_0 plus sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_vinsert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> vinsert <span class="free">z</span> <span class="free">y</span> <span class="main">=</span> vinsert <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> elts <span class="free">x</span> <span class="main">∪</span> <span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_of_set lift_def plus_eq_lift replacement small_Un small_elts sup_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="main">(</span>vinsert <span class="free">z</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span><span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="main">(</span>set <span class="main">(</span>insert <span class="free">z</span> <span class="main">(</span>elts <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vinsert_def lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vinsert_def plus_eq_lift sup_V_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_V_succ_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> succ <span class="free">y</span> <span class="main">=</span> succ <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_vinsert succ_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_eq_add1<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_V_succ_right one_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_add<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> ord_of_nat <span class="free">m</span> <span class="main">+</span> ord_of_nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_V_succ_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_0_plus_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">0</span> <span class="main">+</span> <span class="free">α</span> <span class="main">=</span> succ <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def ord_of_nat.simps ord_of_nat_add plus_1_eq_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> omega_closed_add <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="free">β</span> <span class="main">∈</span> elts ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="free">β</span> <span class="main">=</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_of_nat_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_plus_V_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> elts <span class="free">x</span>"</span></span> <span class="main">|</span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_add_less_right<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_le_not_le plus sup_ge1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_add_mem_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> elts <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_ge1 mem_not_refl plus vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proposition 3.3(iii)›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> add_not_less_TC_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⊏</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> less_TC_imp_not_le plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC_sup_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="free">x</span> <span class="main">⊓</span> lift <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span> <span class="main">∩</span> elts <span class="main">(</span>set <span class="main">(</span><span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_not_less_TC_self <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_TC_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TC <span class="free">x</span> <span class="main">⊓</span> set <span class="main">(</span><span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="free">y</span><span class="main">)</span> <span class="main">=</span> set <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="main">(</span>lift <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add.assoc  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_self_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> lift <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_sup_lift arg_subset_TC inf.absorb_iff2 inf_assoc inf_sup_aci<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lift_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sup_lift_eq_lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms inf_sup_absorb inf_sup_distrib2 lift_self_disjoint sup_commute sup_inf_absorb<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Deeper properties of addition›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proposition 3.4(i)›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> lift_eq_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> vsubsetI order_antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="free">x</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lift_def step.prems that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="skolem">u</span> <span class="main">=</span> lift <span class="free">x</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sup_lift_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_eq_lift<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.IH that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="free">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lift_def step.prems that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="skolem">u</span> <span class="main">=</span> lift <span class="free">x</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sup_lift_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_eq_lift<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> inj_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>lift <span class="free">x</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lift_eq_lift<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> add_right_cancel <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">=</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lift_eq_lift plus_eq_lift sup_lift_eq_lift<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> add_mem_right_cancel <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">∈</span> elts <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mem_plus_V_E not_add_mem_right add_right_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZFC_in_HOL.ext dual_order.antisym elts_vinsert insert_subset order_refl plus_vinsert<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> add_le_cancel_left <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">+</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">≤</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> add_mem_right_cancel mem_plus_V_E plus sup_ge1 vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> add_less_cancel_left <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">+</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">&lt;</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> lift_le_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inf.absorb_iff2 lift_eq_lift lift_self_disjoint<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> succ_less_ω_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">x</span> <span class="main">&lt;</span> ω <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_le_cancel_left add.right_neutral le_0 le_less_trans succ_eq_add1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proposition 3.5›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> card_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>lift <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> vcard <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cardinal_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">(+)</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span>elts <span class="free">y</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>lift <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def lift_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>lift <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_def eqpoll_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eqpoll_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>lift <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_lift cardinal_eqpoll eqpoll_sym eqpoll_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vcard_add<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> vcard <span class="free">x</span> <span class="main">⊕</span> vcard <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_lift <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> lift_self_disjoint <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_eq_lift vcard_disjoint_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> countable_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="main">(</span><span class="free">A</span><span class="main">+</span><span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">A</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">B</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms countable_iff_le_Aleph0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span><span class="free">A</span><span class="main">+</span><span class="free">B</span><span class="main">)</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vcard_add
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Aleph_0 Card_ω InfCard_cdouble_eq InfCard_def cadd_le_mono order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> countable_iff_le_Aleph0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proposition 3.6›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> TC_add<span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> <span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> TC <span class="main">(</span>set <span class="main">(</span><span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹elts <span class="skolem">y</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TC <span class="free">x</span> <span class="main">≤</span> TC <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.IH<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"TC <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">w</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> TC <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> elts <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI impI order_antisym<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp †<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> TC_sup_distrib Un_iff elts_sup_iff plus<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_least Transset_TC arg_subset_TC le_sup_iff plus vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TC <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> elts <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> elts <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> TC <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_eq_lift image_Un Sup_Un_distrib sup.left_commute sup_assoc TC_sup_distrib SUP_sup_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def sup.commute sup_aci *<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> elts <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_aci step.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_aci SUP_sup_distrib <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span>TC <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> elts_of_set lift_Sup_distrib image_image lift_sup_distrib replacement small_elts sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> TC_add'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊏</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">⊏</span> <span class="free">x</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">⊏</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TC_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_TC_def lift_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Corollary 3.7›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> vcard_TC_add<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>TC <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vcard <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span> <span class="main">⊕</span> vcard <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC_add TC_sup_lift card_lift vcard_disjoint_sup<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Corollary 3.8›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> TC_lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TC <span class="main">(</span>lift <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TC <span class="main">(</span>lift <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> TC<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> TC <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lift <span class="free">x</span> <span class="free">y</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def image_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">y</span> <span class="main">⊔</span> TC <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SUP_sup_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> TC <span class="free">x</span> <span class="main">⊔</span> lift <span class="free">x</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> sup_aci image_image lift_sup_distrib lift_Sup_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> rank_add_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">+</span> rank <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> ZFC_in_HOL.set <span class="main">(</span><span class="main">(+)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus rank_Sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">x</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">+</span> rank <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_Un_distrib image_Un image_image<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> SUP_cong_simp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="skolem">y</span><span class="main">.</span> rank <span class="free">x</span> <span class="main">+</span> succ <span class="main">(</span>rank <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> ZFC_in_HOL.succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">+</span> rank <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_eq_lift <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cSUP_upper <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> e<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_V_succ_right <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> rank_Sup <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order_antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="skolem">y</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Sup_distrib False<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">+</span> rank <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_Sup <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> Ord <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_rank rank_add_distrib rank_of_Ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_Sup_distrib_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="main">⨆</span><span class="main">(</span>elts <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="free">A</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Sup_distrib image_ident image_image<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">α</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">α</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span><span class="main">∈</span>elts <span class="free">α</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_add_Sup_distrib Limit_eq_Sup_self image_ident image_image<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_le_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≤</span> <span class="free">α</span><span class="main">+</span><span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_V_succ_right Ord_mem_iff_lt assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit_eq_Sup_self<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">μ</span><span class="main">.</span> <span class="free">α</span> <span class="main">+</span> <span class="bound">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">α</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">β</span> <span class="main">∈</span> elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_add_Sup_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_ω_equals_ω<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">+</span> ω <span class="main">=</span> ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">+</span> ω <span class="main">≤</span> ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_trans assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mem_plus_V_E<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> <span class="free">α</span> <span class="main">+</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_le_left assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_plus_ω_equals_ω <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> ω <span class="main">=</span> ω"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_V_def plus_ω_equals_ω<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Cancellation / set subtraction›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊴</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊴</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">z</span><span class="main">::</span>V<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="bound">z</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vle_refl <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊴</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add.right_neutral vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vle_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊴</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V_equalityI plus_eq_lift sup_ge1 vle_def vsubsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vle_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊴</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊴</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vle_comparable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vle_comparable</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊴</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊴</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lemma 3.13›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> comparable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="free">b</span> <span class="main">=</span> <span class="free">c</span><span class="main">+</span><span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vle_comparable <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vle_comparable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> non<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊴</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">⊴</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span><span class="main">+</span><span class="bound">x</span> <span class="main">≠</span> <span class="free">c</span><span class="main">+</span><span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> non nonzero_less_TC <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> vle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trad_foundation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vle_def non <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> av<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">x</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⊔</span> lift <span class="free">c</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">c</span> <span class="main">⊔</span> lift <span class="free">c</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≡</span> set <span class="main">(</span>elts <span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> elts <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vinsert <span class="skolem">v</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_antisym<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="skolem">v</span> <span class="main">∉</span> elts <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> avc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">∈</span> elts <span class="free">c</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span> <span class="main">(</span><span class="operator">metis</span> Un_iff elts_sup_iff eq mem_not_sym mem_plus_V_E plus_eq_lift<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊔</span> lift <span class="free">a</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⊔</span> lift <span class="free">c</span> <span class="skolem">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_eq_lift<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="free">c</span> <span class="skolem">z</span> <span class="main">≤</span> lift <span class="free">a</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf_commute inf_sup_absorb inf_sup_distrib2 lift_self_disjoint sup.commute<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vinsert <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>lift <span class="free">a</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def vinsert_def xeq<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lift <span class="free">c</span> <span class="skolem">z</span> <span class="main">≤</span> vinsert <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>lift <span class="free">a</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="free">c</span> <span class="skolem">z</span> <span class="main">≤</span> lift <span class="free">a</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">∉</span> elts <span class="main">(</span>lift <span class="free">c</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> lift_self_disjoint <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> avc V_disjoint_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> * less_eq_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> elts <span class="skolem">z</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">+</span><span class="skolem">e</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="free">c</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">+</span><span class="skolem">e</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="free">a</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lift <span class="free">c</span> <span class="skolem">z</span> <span class="main">≤</span> lift <span class="free">a</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">+</span><span class="skolem">e</span> <span class="main">=</span> <span class="free">a</span><span class="main">+</span><span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_vinsert insert_iff step.IH xeq<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">x</span>›</span></span> av case1 eq mem_plus_V_E step.IH<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vle1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vle_def plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vle2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> TC_add' add.right_neutral le_TC_def vle_def nonzero_less_TC<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vle_iff_le_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">⊴</span> <span class="free">β</span> <span class="main">⟷</span> <span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">⊴</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vle1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">⊴</span> <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">γ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_add Ord_linear add_le_left mem_not_refl mem_plus_V_E vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_le_cancel_left0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">+</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vle1 vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_less_cancel_left0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">+</span><span class="free">z</span> <span class="main">⟷</span> <span class="main">0</span><span class="main">&lt;</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_cancel_left add.right_neutral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_Ord_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">γ</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="free">γ</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="skolem">γ</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_le_cancel_left add_le_left assms vle_def vle_iff_le_Ord<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_def Transset_def <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> γ that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_Ord_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="free">β</span> <span class="main">≤</span> <span class="free">β</span><span class="main">+</span><span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts ω"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="free">β</span> <span class="main">=</span> <span class="free">β</span><span class="main">+</span><span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> elts_ω add.commute ord_of_nat_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> <span class="free">β</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Ord_linear2 Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">+</span><span class="skolem">γ</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> le_Ord_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">+</span><span class="free">β</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_ω_equals_ω<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_right_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">α</span> <span class="main">≤</span> <span class="free">β</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">+</span><span class="free">γ</span> <span class="main">≤</span> <span class="free">β</span><span class="main">+</span><span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_le_cancel_left add.assoc add_le_left le_Ord_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_strict_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">α</span> <span class="main">&lt;</span> <span class="free">β</span><span class="main">;</span> <span class="free">γ</span> <span class="main">&lt;</span> <span class="free">δ</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">;</span> Ord <span class="free">δ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">+</span><span class="free">γ</span> <span class="main">&lt;</span> <span class="free">β</span><span class="main">+</span><span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.strict_implies_order add_less_cancel_left add_right_mono le_less_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_right_strict_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">α</span> <span class="main">≤</span> <span class="free">β</span><span class="main">;</span> <span class="free">γ</span> <span class="main">&lt;</span> <span class="free">δ</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">;</span> Ord <span class="free">δ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">+</span><span class="free">γ</span> <span class="main">&lt;</span> <span class="free">β</span><span class="main">+</span><span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_strict_mono le_imp_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_add_Limit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">μ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="free">μ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Limit_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="free">μ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="free">μ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def add_le_left assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="free">μ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="main">|</span> <span class="skolem">ξ</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> elts <span class="free">μ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="free">β</span> <span class="main">+</span> <span class="skolem">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mem_plus_V_E <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="free">μ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Kirby.add_strict_mono Limit_def Ord_add Ord_in_Ord Ord_mem_iff_lt assms one_V_def succ_eq_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def add_mem_right_cancel assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_V_succ_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalised Difference›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">odiff</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">odiff</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">z</span><span class="main">::</span>V<span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="bound">z</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊴</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vle_imp_odiff_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>odiff <span class="free">y</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vle_def odiff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_vle_imp_odiff_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>odiff <span class="free">y</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vle_def odiff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">+</span> odiff <span class="free">β</span> <span class="free">α</span> <span class="main">=</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms vle_iff_le_Ord vle_imp_odiff_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>odiff <span class="free">β</span> <span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">⊴</span> <span class="free">β</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel assms le_Ord_diff vle1 vle_imp_odiff_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odiff_def vle_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"odiff <span class="free">β</span> <span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">⊴</span> <span class="free">β</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel assms le_Ord_diff vle1 vle_imp_odiff_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odiff_def vle_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> odiff_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"odiff <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral vle_def vle_imp_odiff_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊴</span> <span class="free">x</span> <span class="main">⟹</span> odiff <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> succ <span class="main">(</span>odiff <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> odiff_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel odiff_def plus_V_succ_right vle_def vle_imp_odiff_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊴</span> <span class="free">x</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> odiff_def vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_le_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊴</span> <span class="free">x</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> odiff_def vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_less_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊴</span> <span class="free">x</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> odiff_def vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_ge_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊴</span> <span class="free">x</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> odiff_def vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff_le_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">α</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span> Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">⟧</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">α</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odiff_le_iff vle_iff_le_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_le_odiff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊴</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"odiff <span class="free">x</span> <span class="free">z</span> <span class="main">≤</span> odiff <span class="free">y</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊴</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms odiff_le_iff vle1 vle_imp_odiff_eq vle_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_vle_imp_odiff_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff_le_odiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span> Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">α</span> <span class="main">≤</span> odiff <span class="free">y</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odiff_le_odiff vle_iff_le_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff_less_odiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">α</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">;</span> Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">y</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">⟧</span> <span class="main">⟹</span> odiff <span class="free">x</span> <span class="free">α</span> <span class="main">&lt;</span> odiff <span class="free">y</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_odiff_eq Ord_odiff_le_odiff dual_order.strict_trans less_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_odiff_less_imp_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>odiff <span class="free">x</span> <span class="free">α</span> <span class="main">&lt;</span> odiff <span class="free">y</span> <span class="free">α</span><span class="main">;</span> Ord <span class="free">x</span><span class="main">;</span> Ord <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear2 leD odiff_le_odiff vle_iff_le_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_add_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"odiff <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odiff_eq_iff vle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_add_cancel_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"odiff <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odiff_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> odiff_add_cancel_both <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"odiff <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> odiff <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc odiff_def vle_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalised Multiplication›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Credited to Dana Scott›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This definition is credited to Tarski›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_V</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_V</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> transrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> lift <span class="main">(</span><span class="bound">f</span> <span class="bound">u</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">`</span> elts <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> times_V_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> transrec<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> elts_multE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="free">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> elts <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">v</span> <span class="main">+</span> <span class="free">u</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> lift_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 4.2›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_zero_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZFC_in_HOL.Sup_empty elts_0 image_empty mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span>vinsert <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">z</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> elts_vinsert image_insert replacement small_elts sup_commute mult Sup_V_insert<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> succ <span class="free">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_insert plus_eq_lift succ_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> ord_of_nat <span class="free">m</span> <span class="main">*</span> ord_of_nat <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_of_nat_add mult_succ<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> omega_closed_mult <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">*</span><span class="free">β</span> <span class="main">∈</span> elts ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">*</span><span class="free">β</span> <span class="main">=</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_of_nat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_imp_le_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proposition 4.3›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_zero_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_sup_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">*</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span><span class="main">]</span> mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_Un_distrib image_Un<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_Sup_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">Y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">⨆</span><span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span> <span class="main">`</span> <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Y</span><span class="main">::</span> <span class="quoted"><span class="quoted">"V set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">Y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cSUP_UNION<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_lift_imp_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span>lift <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main">+</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_sup_distrib plus_eq_lift<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span>lift <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> lift <span class="free">y</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="main">(</span>lift <span class="free">y</span> <span class="skolem">z</span><span class="main">)</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">v</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">v</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_lift_imp_distrib step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">v</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_lift<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">v</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image lift_Sup_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">γ</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span> <span class="main">`</span> elts <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_eq_Sup_self mult_Sup_distrib small_elts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_mult_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main">+</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_lift mult_lift_imp_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> V <span class="main">::</span> <span class="quoted">monoid_mult</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">V</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">*</span> lift <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">z</span><span class="main">.</span> lift <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image mult_Sup_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">*</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_insert succ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">(*)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="skolem">μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def one_V_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageI mult.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit.hyps mult_Limit<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_sing_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> set<span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> lift <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_2_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> set<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_V_insert plus_eq_lift<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">y</span><span class="main">;</span> Ord <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> Ord <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">⨆</span> <span class="main">(</span>elts <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Sup imageE mult_Sup_distrib small_elts<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_eq_Sup_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Proposition 4.4-5›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> rank_mult_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rank_Sup mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> <span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def image_image image_UN<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_V_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> <span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rank_add_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> <span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">*</span> rank <span class="bound">u</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step arg_cong <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted">Sup</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="skolem">y</span><span class="main">.</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="bound">u</span> <span class="main">+</span> rank <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SUP_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sup_le_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> plus_V_succ_right<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Sup_distrib False<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> plus_V_succ_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">y</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">r</span><span class="main">∈</span>elts <span class="free">x</span><span class="main">.</span> succ <span class="main">(</span>rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">u</span> <span class="main">+</span> rank <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rank_Sup<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank <span class="free">x</span> <span class="main">*</span> rank <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_Sup <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> mult_Sup_distrib mult_succ image_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_le1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> elts <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V_equalityI elts_1 insertI1 singletonD trad_foundation<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_def r<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">*</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bdd_above_iff_small cSUP_upper2 order_refl <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="skolem">y</span>›</span></span> replacement small_elts mult<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="skolem">p</span> <span class="main">⊑</span> <span class="free">x</span><span class="main">*</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC_add' V_equalityI add.right_neutral eps_induct le_TC_refl less_TC_iff less_imp_le_TC<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step.IH <span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> le_TC_trans less_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_0 le_TC_def less_TC_imp_not_le mult_le1 that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mult_le1 <span class="main">[</span><span class="operator">of</span> <span class="quasi_keyword">concl</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_TC_def TC_lift less_TC_def less_TC_imp_not_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_le2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span><span class="main">::</span><span class="quoted">V</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊏</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lift_lemma <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> bdd_above_iff_small cSUP_upper2 order_refl replacement small_elts mult v<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mult_le1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_TC_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elts_mult_ωE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ω<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ord_of_nat <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ord_of_nat <span class="bound">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ord_of_nat <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_Limit elts_ω<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_eq_0_iff elts_0 ex_in_conv ord_of_eq_0_iff that<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ord_of_nat <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI_ex k<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ord_of_nat <span class="bound">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mult_eq_0_iff elts_0 empty_iff n_def not_less_Least ord_of_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Theorem 4.6›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mult_eq_imp_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_le_cancel_left mult_eq_0_iff eq_iff le_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms less_asym_TC mult_le2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
      <span class="keyword1"><span class="command">using</span></span> that assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">0</span> <span class="main">⊏</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">⊏</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">r</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊏</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonzero_less_TC<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Φ_def <span class="keyword1"><span class="command">using</span></span> succ.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">x'</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">⊑</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x''</span><span class="main">.</span> <span class="bound">x''</span> <span class="main">⊏</span> <span class="skolem">x'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="skolem">Φ</span> <span class="bound">x''</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less_TC_minimal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">x</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊏</span> <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">x'</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">b'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">⊏</span> <span class="free">a</span><span class="main">*</span><span class="skolem">x'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TC_add' <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">⊏</span> <span class="skolem">b'</span>›</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">⊑</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less_TC_iff less_irrefl_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> lift <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">x'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x'</span><span class="main">)</span>›</span></span> elts_Sup replacement small_elts mult<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> eq plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> elts <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> eq mem_plus_V_E<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">≠</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="free">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">x'</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cSUP_upper<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq plus_eq_lift<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> add_le_cancel_left less_TC_imp_not_le plus_eq_lift <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup lift_eq_lift lift_sup_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> less_TC_imp_not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">⊴</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">⊴</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d comparable vle_comparable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral noteq vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e add_right_cancel <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">d</span>›</span></span> add.assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> elts <span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_TC_iff less_TC_trans vle2 vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="comment1">―‹contradicts minimality of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">x'</span></span><span class="antiquote">}</span></span>›</span>
            <span class="keyword1"><span class="command">using</span></span> min <span class="keyword1"><span class="command">unfolding</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x'</span>›</span></span> le_TC_def less_TC_iff nonzero_less_TC<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral noteq vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e add_right_cancel <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">d</span>›</span></span> add.assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> elts <span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> elts <span class="free">a</span>›</span></span> less_TC_iff vle2 vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">y</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> Φ_def <span class="keyword1"><span class="command">using</span></span> nonzero_less_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="skolem">y'</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x''</span><span class="main">.</span> <span class="bound">x''</span> <span class="main">⊏</span> <span class="skolem">y'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="skolem">Φ</span> <span class="bound">x''</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> less_TC_minimal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Φ</span> <span class="bound">x</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊏</span> <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y'</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> u_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">⊑</span> <span class="skolem">x</span>›</span></span> succ Vset_succ_TC less_TC_iff less_le_TC_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">⊏</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> TC_add' <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">⊏</span> <span class="skolem">b'</span>›</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">⊑</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> less_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> less_TC_iff less_irrefl_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>elts <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> lift <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">y'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y'</span><span class="main">)</span>›</span></span> elts_Sup replacement small_elts mult<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span>›</span></span> eq plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> elts <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span>›</span></span> eq mem_plus_V_E<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> v_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Vset_succ_TC <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">⊑</span> <span class="skolem">y</span>›</span></span> less_TC_iff less_le_TC_trans succ.hyps succ.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">≠</span> <span class="free">a</span><span class="main">*</span><span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">v</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y'</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">y'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cSUP_upper<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq plus_eq_lift<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">v</span>›</span></span> le_iff_sup lift_sup_distrib sup_left_commute sup_lift_eq_lift<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup lift_eq_lift lift_sup_distrib<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> less_TC_imp_not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">⊴</span> <span class="free">a</span><span class="main">*</span><span class="skolem">v</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">v</span> <span class="main">⊴</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d comparable vle_comparable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">v</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral noteq vle_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> add.assoc e<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> elts <span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_TC_iff less_TC_trans vle2 vle_def<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> succ.IH u_k v_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral noteq vle_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel add.assoc d e<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> elts <span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> elts <span class="free">a</span>›</span></span> less_TC_iff vle2 vle_def<span class="main">)</span>
           <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
             <span class="keyword1"><span class="command">using</span></span> succ.IH u_k v_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> elts <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> elts <span class="skolem">k</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that Limit <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_Vfrom_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Limit.IH <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">i</span></span> <span class="main"><span class="main">⊔</span></span> <span class="skolem"><span class="skolem">j</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span> <span class="main">∈</span> elts <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> k x y Limit.hyps Limit_def Ord_in_Ord Ord_mem_iff_lt Ord_sup union_less_iff<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="main">(</span><span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="main">(</span><span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Vfrom_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> Limit.prems <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> two_in_Vset Ord_rank Ord_VsetI rank_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Theorem 4.7›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_cancellation_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">using</span></span> that assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> u_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Vset_succ succ.hyps succ.prems<span class="main">(</span>1<span class="main">)</span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">⊑</span> <span class="skolem">r'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_TC_iff succ.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">r'</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'</span> <span class="main">∈</span> elts <span class="free">a</span>›</span></span> lift_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> elts <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> elts <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> plus_eq_lift succ.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> elts <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∪</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_eq_lift<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">r'</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∪</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">r'</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">r'</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> lift_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> v_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Vset_succ_TC less_TC_iff succ.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'</span> <span class="main">∈</span> elts <span class="free">a</span>›</span></span> antisym le_TC_refl less_TC_iff order_refl succ.IH u_k v<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">r'</span> <span class="main">∈</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> elts <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">r'</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">≠</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="free">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cSUP_upper<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span>›</span></span> plus_eq_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> add_le_cancel_left less_TC_imp_not_le plus_eq_lift <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup lift_eq_lift lift_sup_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> less_TC_imp_not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">⊴</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">⊴</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> t comparable vle_comparable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">+</span><span class="skolem">t</span> <span class="main">=</span> <span class="skolem">r'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel add.assoc t<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'</span> <span class="main">∈</span> elts <span class="free">a</span>›</span></span> less_TC_iff vle2 vle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> noteq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> mult_eq_imp_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">+</span><span class="skolem">r'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel add.assoc t<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> elts <span class="skolem">s</span>›</span></span> less_TC_iff less_TC_trans <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊏</span> <span class="free">a</span>›</span></span> vle2 vle_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> noteq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">c</span>›</span></span> mult_eq_imp_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> elts <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> elts <span class="skolem">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that Limit <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_Vfrom_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Limit.IH <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">i</span></span> <span class="main"><span class="main">⊔</span></span> <span class="skolem"><span class="skolem">j</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span> <span class="main">∈</span> elts <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> k x y Limit.hyps Limit_def Ord_in_Ord Ord_mem_iff_lt Ord_sup union_less_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="main">(</span><span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>Vset <span class="main">(</span><span class="skolem">i</span> <span class="main">⊔</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Vfrom_sup<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> two_in_Vset Ord_rank Ord_VsetI rank_lt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mult_cancellation_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span> <span class="main">∧</span> <span class="free">r</span><span class="main">=</span><span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms leD less_V_def mult_cancellation_half odiff_add_cancel order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mult_cancellation <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms nonzero_less_TC mult_cancellation_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mult_cancellation_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dual_order.strict_implies_order mult_cancellation_half<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> lt that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lift_mult_TC_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">a</span><span class="main">)</span> <span class="main">⊓</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> V_equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_TC_def inf_V_def lift_def image_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mult_cancellation_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> lift_mult_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">V</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">⊓</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">⊓</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">≤</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">a</span><span class="main">)</span> <span class="main">⊓</span> lift <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TC' inf_mono lift_sup_distrib sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms lift_mult_TC_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_add_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊏</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arg_subset_TC assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_TC_def mult_cancellation_lemma vsubsetD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arg_subset_TC assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_TC_def mult_cancellation_lemma v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> vsubsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_add_mem_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that   <span class="keyword1"><span class="command">using</span></span> mult_add_mem <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> nonzero_less_TC <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> lift_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_eq_0_iff add.right_neutral mult_add_mem<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nonzero_less_TC<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_mem_mult_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">∈</span> elts <span class="free">x</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Kirby.mult_zero_right mult_add_mem_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_less_mult_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Kirby.mult_eq_0_iff ZFC_in_HOL.neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_cancel_less_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">*</span><span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">*</span><span class="free">γ</span> <span class="main">⟷</span> <span class="free">β</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_add_mem_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_0 Ord_mem_iff_lt Ord_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_cancel_le_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">*</span><span class="free">β</span> <span class="main">≤</span> <span class="free">α</span><span class="main">*</span><span class="free">γ</span> <span class="main">⟷</span> <span class="free">β</span> <span class="main">≤</span> <span class="free">γ</span> <span class="main">∨</span> <span class="free">α</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 Ord_mult eq_iff leD mult_cancel_less_iff mult_cancellation<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_Suc_add_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">α</span> <span class="main">&lt;</span> <span class="free">γ</span><span class="main">;</span> <span class="free">β</span> <span class="main">&lt;</span> <span class="free">γ</span><span class="main">;</span> Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="free">m</span> <span class="main">+</span> <span class="free">α</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="main">+</span> <span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ add.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_add Ord_linear2 le_less_trans not_add_less_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_nat_less_add_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="free">m</span> <span class="main">+</span> <span class="free">α</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="free">n</span> <span class="main">+</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="free">m</span> <span class="main">+</span> <span class="free">α</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="main">+</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_Suc_add_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">γ</span> <span class="main">*</span> ord_of_nat <span class="free">n</span> <span class="main">+</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_mult Ord_ord_of_nat add_right_mono <span class="quoted"><span class="quoted">‹Suc <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> ord mult_cancel_le_iff ord_of_nat_mono_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_mult_less_add_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">ν</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="skolem">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> le_Ord_diff less_V_def mem_0_Ord<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib add.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> OrdmemD add_le_cancel_left0 <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="main">∈</span> elts <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> less_le_trans zero_imp_le_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_mult_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">*</span> <span class="free">ν</span> <span class="main">+</span> <span class="free">γ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span> <span class="main">*</span> <span class="free">β</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">ν</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_mem_iff_lt Ord_succ add_mem_right_cancel mult_cancel_le_iff mult_succ succ_le_iff vsubsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_add_mult_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β'</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α'</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">*</span> <span class="free">α</span> <span class="main">+</span> <span class="free">β</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">γ</span> <span class="main">*</span> <span class="free">α'</span> <span class="main">+</span> <span class="free">β'</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">α</span> <span class="main">∈</span> elts <span class="free">α'</span> <span class="main">∨</span> <span class="free">α</span> <span class="main">=</span> <span class="free">α'</span> <span class="main">∧</span> <span class="free">β</span> <span class="main">∈</span> elts <span class="free">β'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="free">α'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">α'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> L Ord_linear Ord_mult Ord_trans add_mult_less not_add_mem_right<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> L less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> R<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="free">α'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α'</span> <span class="main">=</span> <span class="free">α</span><span class="main">+</span><span class="skolem">δ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrdmemD assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> le_Ord_diff less_V_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">∈</span> elts <span class="free">α'</span>›</span></span> add_le_cancel_left0 add_mult_less vsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">α'</span> <span class="main">∧</span> <span class="free">β</span> <span class="main">∈</span> elts <span class="free">β'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vcard_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> vcard <span class="free">x</span> <span class="main">⊗</span> vcard <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">≈</span> elts <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cardinal_eqpoll eqpoll_sym eqpoll_trans card_lift<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">u</span> <span class="bound">u'</span><span class="main">.</span> disjnt <span class="main">(</span>elts <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u'</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>elts <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def disjnt_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> V_disjoint_iff lift_mult_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">u</span><span class="main">∈</span>elts <span class="free">y</span><span class="main">.</span> elts <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="free">y</span> <span class="main">×</span> elts <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Union_eqpoll_Times <span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="free">x</span> <span class="main">×</span> elts <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_commute_eqpoll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="free">x</span><span class="main">)</span> <span class="main">×</span> elts <span class="main">(</span>vcard <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll eqpoll_sym times_eqpoll_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="free">x</span> <span class="main">⊗</span> vcard <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmult_def elts_vcard_VSigma_eqpoll eqpoll_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>vcard <span class="free">x</span> <span class="main">⊗</span> vcard <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cadd_cmult_distrib cadd_def cardinal_cong cardinal_idem vsum_0_eqpoll<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> TC_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"TC<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">r</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">SUP</span> <span class="bound">u</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">.</span> set<span class="main">{</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">+</span> <span class="bound">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"TC<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="skolem">y</span><span class="main">)</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eps_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TC<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span> <span class="main">∈</span> elts <span class="skolem">y</span><span class="main">.</span> TC <span class="main">(</span>lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> TC_Sup_distrib image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span> <span class="main">∈</span> elts <span class="skolem">y</span><span class="main">.</span> TC<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC_lift False<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span> <span class="main">∈</span> elts <span class="skolem">y</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">z</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="bound">u</span><span class="main">)</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">u</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="skolem">y</span><span class="main">)</span><span class="main">.</span> lift <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TC' <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> image_Un Sup_Un_distrib TC_Sup_distrib cSUP_UNION SUP_sup_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * lift_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">corollary</span></span> vcard_TC_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span>TC<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> vcard <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span> <span class="main">⊗</span> vcard <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">u</span><span class="main">∈</span>elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">u</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">u</span><span class="main">∈</span>elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNION_singleton_eq_range<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">.</span> elts <span class="main">(</span>lift <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> UN_eqpoll_UN<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>lift <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onI less_TC_def mult_cancellation_lemma that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_image_eqpoll_self<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> elts <span class="main">(</span>lift <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eqpoll_lift eqpoll_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">u</span> <span class="bound">ya</span><span class="main">.</span> disjnt <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">ya</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_def disjnt_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> less_TC_def mult_cancellation_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">u</span> <span class="bound">ya</span><span class="main">.</span> disjnt <span class="main">(</span>elts <span class="main">(</span>lift <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>lift <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> <span class="bound">ya</span><span class="main">)</span> <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_def disjnt_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff V_disjoint_iff empty_iff lift_mult_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> elts <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> TC <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> elts_Sup image_image mult replacement small_elts<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">u</span><span class="main">∈</span>elts <span class="main">(</span>TC <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span>elts <span class="main">(</span>TC <span class="free">y</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">x</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">+</span> <span class="bound">u</span><span class="main">}</span><span class="main">)</span> <span class="main">≈</span> elts <span class="main">(</span>TC <span class="free">y</span> <span class="main">*</span> TC <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cmult_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TC_mult cardinal_cong <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> vcard_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> countable_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="main">(</span><span class="free">A</span><span class="main">*</span><span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">A</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"vcard <span class="free">B</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms countable_iff_le_Aleph0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vcard <span class="main">(</span><span class="free">A</span><span class="main">*</span><span class="free">B</span><span class="main">)</span> <span class="main">≤</span> <span class="main">ℵ</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vcard_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> InfCard_csquare_eq cmult_le_mono Aleph_0 Card_ω InfCard_def order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> countable_iff_le_Aleph0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ordertype properties›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_image_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">(+)</span> <span class="free">u</span> <span class="main">`</span> elts <span class="free">α</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_VWF_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">,</span> <span class="free">u</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_in_Ord Ord_mem_iff_lt add_mem_right_cancel assms mem_imp_VWF<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">,</span> <span class="free">u</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_linear_lt VWF_asym assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">(</span><span class="main">(+)</span> <span class="free">u</span> <span class="main">`</span> elts <span class="free">α</span><span class="main">)</span> <span class="main">(</span>elts <span class="free">α</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(+)</span> <span class="free">u</span> <span class="main">`</span> elts <span class="free">α</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(+)</span> <span class="free">u</span> <span class="main">`</span> elts <span class="free">α</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> odiff <span class="bound">x</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="free">α</span> <span class="main">-</span> elts <span class="free">β</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="free">α</span> <span class="main">-</span> elts <span class="free">β</span> <span class="main">=</span> <span class="main">(</span><span class="main">(+)</span><span class="free">β</span><span class="main">)</span> <span class="main">`</span> elts <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">α</span> <span class="main">-</span> elts <span class="free">β</span> <span class="main">⊆</span> <span class="main">(+)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_iff mem_plus_V_E<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="free">δ</span> <span class="main">⊆</span> elts <span class="free">α</span> <span class="main">-</span> elts <span class="free">β</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> not_add_mem_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">(+)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="free">δ</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_VWF_inc_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">δ</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="free">δ</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> α elts_subset_ON ordertype_eq_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted">"*"</span> assms elts_subset_ON <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_interval_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">{</span><span class="free">α</span> <span class="main">..&lt;</span> <span class="free">α</span><span class="main">+</span><span class="free">β</span><span class="main">}</span> <span class="main">∩</span> ON<span class="main">)</span> VWF <span class="main">=</span> <span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ON<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="free">β</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Ord_add Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="free">α</span> <span class="main">..&lt;</span> <span class="free">α</span><span class="main">+</span><span class="free">β</span><span class="main">}</span> <span class="main">∩</span> ON<span class="main">)</span> <span class="main">=</span> <span class="main">(+)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def set_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_cancel_left Ord_add Ord_in_Ord Ord_linear2 Ord_mem_iff_lt le_Ord_diff not_add_less_right<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="free">β</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="main">(</span><span class="main">(+)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="free">β</span><span class="main">)</span> VWF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ON β elts_subset_ON ordertype_VWF_inc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> β <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ordertype_Times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="free">A</span><span class="main">×</span><span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> ordertype <span class="free">B</span> <span class="free">s</span> <span class="main">*</span> ordertype <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?β</span> <span class="main">*</span> <span class="var">?α</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordertype_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="var">?β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> wf_Ord_ordertype Ord_mult r s<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span><span class="var">?β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI strip<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def inj_on_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">x'</span> <span class="skolem">y'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x'</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">y'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">=</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">x'</span> <span class="main">∧</span>
            ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">y</span> <span class="main">=</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">y'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_cancellation_lemma <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">y</span> <span class="main">⊏</span> <span class="var">?β</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ordermap_in_ordertype <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> less_TC_iff <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">y'</span> <span class="main">⊏</span> <span class="var">?β</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ordermap_in_ordertype <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> less_TC_iff <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> r s <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> elts <span class="main">(</span><span class="var">?β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span><span class="var">?β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def add_mult_less ordermap_in_ordertype wf_Ord_ordertype r s<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_less assms ordermap_in_ordertype wf_Ord_ordertype<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span><span class="var">?β</span> <span class="main">*</span> <span class="var">?α</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def image_iff <span class="quasi_keyword">elim</span> <span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> elts_multE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span><span class="var">?β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> elts <span class="var">?α</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">B</span> <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_into_ordermap u<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">A</span> <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_into_ordermap v<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="var">?β</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">=</span> <span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="bound">x</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="bound">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">B</span>›</span></span> bij_betw_inv_into_right ordermap_bij r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> s<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> s<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> u v<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">×</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">×</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> § assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">u</span><span class="main">=</span><span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_add Ord_add_mult_iff Ord_mem_iff_lt Ord_mult Ord_ordermap converse_ordermap_mono 
            ordermap_eq_iff ordermap_in_ordertype wf_Ord_ordertype<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> §<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> §<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> oo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Ord <span class="main">(</span>ordermap <span class="free">A</span> <span class="free">r</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> Ord <span class="main">(</span>ordermap <span class="free">B</span> <span class="free">s</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r s<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">a'</span> <span class="skolem">b'</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">a</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">b</span> <span class="main">&lt;</span> <span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">a'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ux assms §
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_mult Ord_ordermap OrdmemD Pair_inject add_mult_less ordermap_in_ordertype ordermap_mono wf_Ord_ordertype<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">a'</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">a</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">b</span> <span class="main">&lt;</span> <span class="var">?β</span> <span class="main">*</span> ordermap <span class="free">A</span> <span class="free">r</span> <span class="skolem">a'</span> <span class="main">+</span> ordermap <span class="free">B</span> <span class="free">s</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> § assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ordermap_mono_less<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms small_Times <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ordinal_Exp">
<div class="head">
<h1>Theory Ordinal_Exp</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Exponentiation of ordinals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Ordinal_Exp
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Kirby.html">Kirby</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Source: Schlöder, Julian.  Ordinal Arithmetic; available online at
    \url{http://www.math.uni-bonn.de/ag/logik/teaching/2012WS/Set%20theory/oa.pdf}›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">oexp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>V<span class="main">,</span>V<span class="main">]</span> <span class="main">⇒</span> V"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">↑</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">oexp</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> transrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span>
                                    <span class="keyword1">else</span> <span class="keyword1">if</span> Limit <span class="bound">x</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">ξ</span>
                                    <span class="keyword1">else</span> <span class="bound">f</span> <span class="main">(</span><span class="main">⨆</span><span class="main">(</span>elts <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">↑</span></span>ω <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if we don't make a special case for Limit ordinals and zero›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> oexp_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_transrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> oexp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span>succ <span class="free">β</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> def_transrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> oexp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">β</span> <span class="main">⟹</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">α</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="bound">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> def_transrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> oexp_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">β</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_1_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">1</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_V_def oexp_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> <span class="main">1</span><span class="main">↑</span><span class="free">α</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> Limit_def oexp_Limit <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> <span class="main">0</span><span class="main">↑</span><span class="free">α</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">α</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> Limit_def oexp_Limit <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">α</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">β</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def oexp_Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_gt_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">α</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="free">β</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms less_V_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ord_of_nat_oexp<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="main">(</span><span class="free">m</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> ord_of_nat <span class="free">m</span><span class="main">↑</span>ord_of_nat <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_of_nat_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> omega_closed_oexp <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">∈</span> elts ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ord_of_nat <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">=</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_of_nat_oexp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Ord_oexp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oexp_Limit image_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_Sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_mult assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 3.19›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> le_oexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">β</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> le_0 le_mult mult.left_neutral oexp_0_right order_refl order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def Limit_eq_Sup_self ZFC_in_HOL.Sup_upper eq_iff image_eqI image_ident oexp_1_right oexp_Limit replacement small_elts one_V_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 3.20›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> le_oexp'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">γ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="skolem">γ</span> <span class="main">*</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">γ</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_mult less_V_def mult.right_neutral mult_cancellation not_less_0 oexp_eq_0_iff succ.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">γ</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span>succ <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> succ.IH succ.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>›</span></span> succ
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_mem_iff_lt Ord_oexp Ord_succ elts_succ insert_subset less_eq_V_def less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_def oexp_Limit <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> elts_succ<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> oexp_Limit_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt ZFC_in_HOL.Sup_upper oexp_Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> oexp_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord OrdmemD assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> α dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> β
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">δ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="skolem">δ</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> <span class="skolem">δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrdmemD elts_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_1 Ord_oexp α gt0 mult_cancel_less_iff succ.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">δ</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_1 Ord_mem_iff_lt Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> α gt0 less_trans mult_cancel_less_iff succ<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">γ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">β</span> <span class="main">&lt;</span> <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit_def Ord_in_Ord OrdmemD assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> assms gt0 mult_cancel_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span>succ <span class="free">β</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="skolem">γ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="bound">ξ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">β</span> <span class="main">∈</span> elts <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit.prems Limit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ZFC_in_HOL.Sup_upper<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="skolem">γ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="bound">ξ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit.hyps oexp_Limit <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> oexp_less_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span> <span class="main">⟷</span> <span class="free">β</span> <span class="main">∈</span> elts <span class="free">γ</span> <span class="main">∧</span> <span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">=</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> less_V_def mem_0_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">use</span> that <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main">:</span> if_split_asm›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∉</span> elts <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_linear_le Ord_mem_iff_lt assms less_le_not_le<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">&lt;</span> <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">γ</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt assms oexp_less<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms oexp_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ω_oexp_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">⟧</span> <span class="main">⟹</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">β</span> <span class="main">⟷</span> <span class="free">α</span><span class="main">=</span><span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_linear ω_gt1 less_irrefl oexp_less<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_oexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Limit_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">show</span></span> Oαγ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def Ord_oexp <span class="quoted"><span class="quoted">‹Limit <span class="free">γ</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def oexp_Limit <span class="quoted"><span class="quoted">‹Limit <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def <span class="quoted"><span class="quoted">‹Limit <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Limit <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xβ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oexp_Limit <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord OrdmemD <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> Oαγ x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Oαβ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_oexp assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">γ</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> αβγ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="skolem">β</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper oexp_Limit <span class="quoted"><span class="quoted">‹Limit <span class="free">γ</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">x</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD Oαβ <span class="quoted"><span class="quoted">‹Ord <span class="skolem">x</span>›</span></span> succ_le_iff xβ<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">β</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"succ <span class="skolem">x</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_neq_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">with</span></span> αβγ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Oαβ Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit_def OrdmemD <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">∈</span> elts <span class="free">γ</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> Ord_0 <span class="quoted"><span class="quoted">‹Ord <span class="skolem">x</span>›</span></span> le_0 le_succ_iff one_V_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">x</span> <span class="main">&lt;</span> succ <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> Oαβ succ_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ge1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_eq_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span> <span class="main">*</span> succ <span class="main">(</span>succ <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="skolem">β</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Oαβ Ord_succ assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> one_V_def succ_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span>succ <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Limit_def <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">∈</span> elts <span class="free">γ</span>›</span></span> assms dual_order.order_iff_strict oexp_less<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"2"</span> Oαβ Oαγ Ord_mem_iff_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> oexp_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">⊑</span> <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">γ</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> β
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> α le_mult <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_TC_succ<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">γ</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit.hyps Ord_less_TC_mem <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> le_TC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oexp_Limit Limit_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oexp_Limit Limit.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_mono_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="free">γ</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms oexp_mono vle2 vle_iff_le_Ord<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">⊔</span> <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">⊔</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le assms oexp_mono_le sup.absorb2 sup.orderE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_Sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">⨆</span> <span class="free">X</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span><span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="main">⨆</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ON_imp_Ord Ord_Sup ZFC_in_HOL.Sup_upper assms cSUP_least oexp_mono_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>Sup <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_Sup X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">⨆</span> <span class="free">X</span> <span class="main">≤</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> X dual_order.antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ZFC_in_HOL.Sup_upper X succ_in_Sup_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> limit
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms oexp_Limit limit<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">↑</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">↑</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ON_imp_Ord Ord_in_Ord OrdmemD α <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> ON›</span></span> le_less oexp_mono_le<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> omega_le_Limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">μ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> <span class="free">μ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ρ</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ρ</span> <span class="main">∈</span> elts ω"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ρ</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elts_ω <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="skolem">n</span> <span class="main">∈</span> elts <span class="free">μ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> Limit_def assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ρ</span> <span class="main">∈</span> elts <span class="free">μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ρ</span> <span class="main">=</span> ord_of_nat <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_omega_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">↑</span>ω <span class="main">=</span> ω"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">(</span><span class="main">(↑)</span> <span class="main">(</span>ord_of_nat <span class="skolem">k</span><span class="main">)</span> <span class="main">`</span> elts ω<span class="main">)</span> <span class="main">≤</span> ω"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω OrdmemD Sup_eq_0_iff ZFC_in_HOL.SUP_le_iff le_0 le_less omega_closed_oexp ord_of_nat_ω<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">↑</span>ω <span class="main">≤</span> ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elts_ω oexp_Limit<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">≤</span> <span class="free">n</span><span class="main">↑</span>ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord assms le_oexp' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">proposition</span></span> oexp_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">*</span> <span class="free">α</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">ξ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_V_succ_right mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">)</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="bound">ξ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit.hyps oexp_Limit assms False<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> Ord <span class="bound">ξ</span> <span class="main">∧</span> <span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span> <span class="main">&lt;</span> <span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">}</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_eq_Sup<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">ξ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> Ord <span class="bound">ξ</span> <span class="main">∧</span> <span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span> <span class="main">&lt;</span> <span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def Ord_mem_iff_lt imageI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">ξ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">γ</span><span class="main">.</span> Ord <span class="bound">γ</span> <span class="main">∧</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="main">∧</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">ξ</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mem_plus_V_E <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ξ<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="skolem">ξ</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> arg_subset_TC assms False le_TC_def less_TC_def oexp_mono vsubsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> zero_less_Limit <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Limit <span class="skolem">μ</span>›</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">γ</span><span class="main">.</span> Ord <span class="bound">γ</span> <span class="main">∧</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="main">∧</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">ξ</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">δ</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="skolem">μ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="free">β</span> <span class="main">+</span> <span class="skolem">δ</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">δ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def Ord_in_Ord <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="skolem">μ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">&lt;</span> <span class="skolem">μ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def OrdmemD <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="skolem">μ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">γ</span><span class="main">.</span> Ord <span class="bound">γ</span> <span class="main">∧</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="skolem">μ</span> <span class="main">∧</span> <span class="free">α</span><span class="main">↑</span><span class="skolem">ξ</span> <span class="main">≤</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">=</span> <span class="free">β</span> <span class="main">+</span> <span class="skolem">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">ξ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> Ord <span class="bound">ξ</span> <span class="main">∧</span> <span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span> <span class="main">&lt;</span> <span class="free">β</span> <span class="main">+</span> <span class="skolem">μ</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">+</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Limit <span class="skolem">μ</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_Collect_lt Limit_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">*</span> <span class="free">α</span><span class="main">↑</span><span class="bound">ξ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="free">β</span> <span class="main">*</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">ξ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> Limit.hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image oexp_Limit mult_Sup_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> oexp_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span><span class="main">↑</span><span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> succ
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_succ oexp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">μ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Lim<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Limit_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def Ord_in_Ord <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_Sup<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">0</span> <span class="main">∈</span> elts <span class="skolem">μ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> mem_0_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span> that False Limit.hyps
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_linear Ord_mem_iff_lt Ord_mult Ord_succ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_V_def mult_cancellation mult_succ not_add_mem_right succ_le_iff succ_ne_self<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span><span class="main">↑</span><span class="main">⨆</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">β</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_Sup_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False Lim oexp_Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">x</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_eq_Sup<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">μ</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> False Limit
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def elts_succ imageI insertI1 mem_0_Ord mult_add_mem_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">α</span><span class="main">↑</span><span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> elts <span class="skolem">μ</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="main">(↑)</span> <span class="free">α</span> <span class="main">`</span> elts <span class="main">(</span><span class="free">β</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹Ord <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> False Limit
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> Limit_def Ord_in_Ord Ord_mult VWO_TC_le mem_imp_VWO oexp_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="main">(↑)</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span> <span class="main">`</span> elts <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">ξ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit.IH Limit.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">α</span><span class="main">↑</span><span class="free">β</span><span class="main">)</span><span class="main">↑</span><span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span><span class="main">∈</span>elts <span class="skolem">μ</span><span class="main">.</span> <span class="bound">ξ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False Limit.hyps oexp_Limit <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Limit_omega_oexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> elts ω"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">β</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_in_Ord Ord_mult Ord_oexp β n succ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> oo<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">n</span>›</span></span> succ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> oo Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> oexp_eq_0_iff omega_nonzero succ<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_cancel_left Ord_ω Ord_add Ord_mem_iff_lt OrdmemD <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span> add.right_neutral dual_order.strict_trans2 oexp_gt_0_iff succ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> succ_le_iff zero_in_omega<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> succ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_def mem_0_Ord<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_Limit<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * mult_succ succ_in_omega<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> limit
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_oexp Ord_ω OrdmemD one_V_def succ_in_omega zero_in_omega<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_mult_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span> <span class="main">=</span> <span class="free">α</span> <span class="main">*</span> <span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span> <span class="main">=</span> <span class="free">α</span> <span class="main">↑</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">α</span> <span class="main">*</span> <span class="main">(</span><span class="free">α</span> <span class="main">↑</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms oexp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> oexp_ω_Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit <span class="free">β</span> <span class="main">⟹</span> ω<span class="main">↑</span><span class="free">β</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">ξ</span> <span class="main">∈</span> elts <span class="free">β</span><span class="main">.</span> ω<span class="main">↑</span><span class="bound">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oexp_Limit<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_power_succ_gtr<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span> <span class="main">⟹</span> ω <span class="main">↑</span> <span class="free">α</span> <span class="main">*</span> ord_of_nat <span class="free">n</span> <span class="main">&lt;</span> ω <span class="main">↑</span> succ <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> countable_oexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ν<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts ω1"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="free">α</span> <span class="main">∈</span> elts ω1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_ω1 Ord_in_Ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">α</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">α</span> <span class="main">*</span> ω<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_in_Limit_iff countable_mult less_ω1_imp_countable<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt countable_iff_less_ω1 succ.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">α</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Ord_ω1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span><span class="main">⋃</span><span class="bound">β</span><span class="main">∈</span>elts <span class="skolem">α</span><span class="main">.</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="bound">β</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω <span class="main">↑</span> <span class="main">⨆</span> <span class="main">(</span>elts <span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Limit_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_trans less_ω1_imp_countable<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="main">⨆</span> <span class="main">(</span>elts <span class="skolem">α</span><span class="main">)</span> <span class="main">&lt;</span> ω1"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit.hyps countable_iff_less_ω1 oexp_Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit_def Ord_mem_iff_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Cantor_NF">
<div class="head">
<h1>Theory Cantor_NF</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cantor Normal Form›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cantor_NF
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Ordinal_Exp.html">Ordinal_Exp</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cantor normal form›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 5.1›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cnf_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> elts <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ord_of_nat <span class="free">n</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">β</span> <span class="main">*</span> ord_of_nat <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span>succ <span class="free">α</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_less_TC assms oexp_mono succ_le_TC_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ord_of_nat <span class="free">n</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord OrdmemD assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω<span class="main">↑</span>succ <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord α <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"†"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="free">β</span> <span class="main">*</span> ord_of_nat <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> le_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Cantor_sum</span>  <span class="keyword2"><span class="keyword">where</span></span>
  Cantor_sum_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Cantor_sum</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> Cantor_sum_Nil2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Cantor_sum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">αs</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> Cantor_sum_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Cantor_sum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">αs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ω<span class="main">↑</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="free">Cantor_sum</span> <span class="free"><span class="bound"><span class="entity">αs</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>"</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Cantor_dec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Cantor_dec</span> <span class="main">≡</span> sorted_wrt <span class="main">(&gt;)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_Cantor_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>Cantor_sum <span class="free">αs</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">αs</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Cantor_dec_Cons_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">β</span><span class="main">#</span><span class="free">βs</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span> <span class="main">∧</span> Cantor_dec <span class="main">(</span><span class="free">β</span><span class="main">#</span><span class="free">βs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 5.2. The second and third premises aren't really necessary, but their
      removal requires quite a lot of work.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cnf_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="free">α</span> <span class="main">&gt;</span> Cantor_sum <span class="free">αs</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α0</span></span> <span class="keyword2"><span class="keyword">where</span></span> α0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span><span class="main">#</span><span class="skolem">αs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">α0</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> α0 zero_less_Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m1</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α0</span></span> <span class="skolem"><span class="skolem">α1</span></span> <span class="skolem"><span class="skolem">αs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> α01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span><span class="main">#</span><span class="skolem">αs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">α0</span><span class="main">#</span><span class="skolem">α1</span><span class="main">#</span><span class="skolem">αs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc_length_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> α01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α0</span> <span class="main">*</span> ord_of_nat <span class="main">1</span> <span class="main">&gt;</span> ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cnf_1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α1</span> <span class="main">∈</span> elts <span class="skolem">α0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems α01 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> * one_V_def Cons.prems<span class="main">(</span>3<span class="main">)</span> α01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m2</span> <span class="skolem">ms'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α2</span></span> <span class="skolem"><span class="skolem">αs''</span></span> <span class="keyword2"><span class="keyword">where</span></span> α02<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span><span class="main">#</span><span class="skolem">αs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">α0</span><span class="main">#</span><span class="skolem">α1</span><span class="main">#</span><span class="skolem">α2</span><span class="main">#</span><span class="skolem">αs''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc_length_conv α01 length_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span> <span class="main">=</span> <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span><span class="main">)</span> <span class="main">*</span> ord_of_nat <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ eval_nat_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cnf_1 <span class="main">[</span><span class="operator">of</span> <span class="quasi_keyword">concl</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α0</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> Cons.prems α01 one_V_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc ord_of_nat_mult Ord_mem_iff_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="main">(</span>tl <span class="skolem">αs</span><span class="main">)</span> <span class="skolem">ms</span> <span class="main">&lt;</span> ω<span class="main">↑</span>hd <span class="skolem">αs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="main">(</span>hd <span class="skolem">αs</span> <span class="main">#</span> tl <span class="skolem">αs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Cantor_dec <span class="main">(</span><span class="skolem">α</span><span class="main">#</span><span class="skolem">αs</span><span class="main">)</span>›</span></span> α01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> Cons.prems α01 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="main">(</span><span class="skolem">α2</span> <span class="main">#</span> <span class="skolem">αs''</span><span class="main">)</span> <span class="skolem">ms</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> α02 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m1</span>›</span></span> le_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> II α02 dual_order.strict_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Cantor_nf_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">αs</span> <span class="free">ms</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="free">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> Cantor_sum <span class="free">αs</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> length_pos_if_in_set step.prems subset_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv not_gr_zero sorted_wrt.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">αhat</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">αhat</span> <span class="main">≡</span> Sup <span class="main">{</span><span class="bound"><span class="bound">γ</span></span> <span class="main">∈</span> ON<span class="main">.</span> ω<span class="main">↑</span><span class="bound">γ</span> <span class="main">≤</span> <span class="skolem">α</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">αhat</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_Sup assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ξ</span><span class="main">.</span> <span class="main">⟦</span>Ord <span class="bound">ξ</span><span class="main">;</span> ω<span class="main">↑</span><span class="bound">ξ</span> <span class="main">≤</span> <span class="skolem">α</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">ξ</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω OrdmemD le_oexp' order_trans step.hyps one_V_def succ_in_omega zero_in_omega<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">γ</span></span> <span class="main">∈</span> ON<span class="main">.</span> ω<span class="main">↑</span><span class="bound">γ</span> <span class="main">≤</span> <span class="skolem">α</span><span class="main">}</span> <span class="main">⊆</span> elts <span class="main">(</span>succ <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt step.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sma<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">{</span><span class="bound"><span class="bound">γ</span></span> <span class="main">∈</span> ON<span class="main">.</span> ω<span class="main">↑</span><span class="bound">γ</span> <span class="main">≤</span> <span class="skolem">α</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> down<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">αhat</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_linear2 Ord_mem_iff_lt Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> step.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">γ</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&lt;</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">αhat</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">with</span></span> † <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="skolem">β</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">γ</span></span> <span class="main">∈</span> ON<span class="main">.</span> ω<span class="main">↑</span><span class="bound">γ</span> <span class="main">≤</span> <span class="skolem">α</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> succ_in_Sup_Ord<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> succ αhat_def sma <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span>succ <span class="skolem">β</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> † <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">≤</span> <span class="skolem">α</span>›</span></span> succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> limit
        <span class="keyword1"><span class="command">with</span></span> † <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oexp_Limit αhat_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_in_Ord Ord_linear_le mem_not_refl oexp_mono_le omega_nonzero vsubsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω OrdmemD leD le_less_trans le_oexp' one_V_def succ_in_omega zero_in_omega<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">M</span><span class="main">.</span> <span class="skolem">α</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">M</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> that Ord_ω Ord_linear2 Ord_mult Ord_oexp Ord_ord_of_nat <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> step.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ω<span class="main">↑</span>succ <span class="skolem">αhat</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt αhat_def <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> sma elts_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&lt;</span> ω<span class="main">↑</span>succ <span class="skolem">αhat</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_linear2 Ord_oexp Ord_succ <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> step.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ω"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> oexp_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sup <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_Limit<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def image_image<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> † <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">M</span> <span class="main">&gt;</span> <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">i</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M dual_order.strict_trans2 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mhat</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mhat</span> <span class="main">≡</span> Greatest <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> mhat_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">mhat</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">unfolding</span></span> mhat_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Greatest_le_nat bound that<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mhat<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">mhat</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mhat_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GreatestI_nat <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">M</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> bound <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ξ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">mhat</span> <span class="main">+</span> <span class="skolem">ξ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_mult Ord_oexp Ord_ord_of_nat <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> step.hyps le_Ord_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">≥</span> ω<span class="main">↑</span><span class="skolem">αhat</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ζ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">ζ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ζ</span> <span class="main">≤</span> <span class="skolem">ξ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ζ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">+</span> <span class="skolem">ζ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">ξ</span>›</span></span> le_Ord_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="skolem">mhat</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">+</span> <span class="skolem">ζ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ξ add.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">αhat</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="skolem">mhat</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_le_cancel_left add.right_neutral le_0 mult_succ ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> Suc_n_not_le_n mhat_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ξinα<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> elts <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">ξ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">≤</span> <span class="skolem">α</span>›</span></span> less_V_def step.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> Cantor_sum <span class="main">[</span><span class="skolem">αhat</span><span class="main">]</span> <span class="main">[</span><span class="skolem">mhat</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True ξ<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> ξ True <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">βs</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="skolem">βs</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ns</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">βs</span> <span class="main">=</span> length <span class="skolem">ns</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> dec<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="skolem">βs</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ξeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> Cantor_sum <span class="skolem">βs</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.IH <span class="main">[</span><span class="operator">OF</span> ξinα<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">βs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False Cantor_sum.simps<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">=</span> Cantor_sum <span class="skolem">βs</span> <span class="skolem">ns</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β0</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="skolem"><span class="skolem">βs'</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> β0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">βs</span> <span class="main">=</span> <span class="skolem">β0</span> <span class="main">#</span> <span class="skolem">βs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> <span class="skolem">n0</span> <span class="main">#</span> <span class="skolem">ns'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β0</span> <span class="main">&gt;</span> <span class="skolem">αhat</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">*</span> ord_of_nat <span class="skolem">n0</span> <span class="main">+</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n0</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_le_cancel_left Ord_ord_of_nat add.right_neutral dual_order.trans gr_implies_not_zero le_0 le_mult ord_of_eq_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">&gt;</span> <span class="skolem">α</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ord_ω Ord_linear2 Ord_oexp Sup_upper αhat_def leD mem_Collect_eq sma step.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">≥</span> ω<span class="main">↑</span><span class="skolem">β0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ξeq β0 n0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">≤</span> <span class="skolem">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β0</span> <span class="main">≤</span> <span class="skolem">αhat</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_linear2 <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β0</span> <span class="main">&lt;</span> <span class="skolem">αhat</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">β0</span> <span class="main">=</span> <span class="skolem">αhat</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">αhat</span><span class="main">#</span><span class="skolem">βs</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="skolem">mhat</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">&lt;..}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">=</span> <span class="skolem">α</span> <span class="main">⟹</span> False›</span></span> ξ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="main">(</span><span class="skolem">αhat</span><span class="main">#</span><span class="skolem">βs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">β0</span> <span class="main">&lt;</span> <span class="skolem">αhat</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">αhat</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span> Ord_mem_iff_lt β0 dec less_Suc_eq_0_disj
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β0 n0<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">αhat</span><span class="main">#</span><span class="skolem">βs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">mhat</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len_eq<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> Cantor_sum <span class="main">(</span><span class="skolem">αhat</span><span class="main">#</span><span class="skolem">βs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mhat</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ξ ξeq β0 n0<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">βs</span> <span class="main">⊆</span> ON"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list.set <span class="main">(</span><span class="main">(</span><span class="skolem">n0</span><span class="main">+</span><span class="skolem">mhat</span><span class="main">)</span><span class="main">#</span><span class="skolem">ns'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">&lt;..}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> n0 sub<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">βs</span><span class="main">::</span>V list<span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="main">(</span><span class="skolem">n0</span><span class="main">+</span><span class="skolem">mhat</span><span class="main">)</span><span class="main">#</span><span class="skolem">ns'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_eq n0<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="skolem">βs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that β0 dec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> Cantor_sum <span class="skolem">βs</span> <span class="main">(</span><span class="main">(</span><span class="skolem">n0</span><span class="main">+</span><span class="skolem">mhat</span><span class="main">)</span><span class="main">#</span><span class="skolem">ns'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib β0 ξ ξeq add.assoc add.commute n0 ord_of_nat_add<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Cantor_sum_0E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="free">αs</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">αs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">#</span><span class="skolem">ms'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ms'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Suc_length_conv greaterThan_iff insert_subset list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Cantor_nf_unique_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αsON<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βsON<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">βs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="free">ns</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mseq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nseq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">βs</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αsdec<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="free">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βsdec<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="free">βs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> Cantor_sum <span class="free">αs</span> <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> Cantor_sum <span class="free">βs</span> <span class="free">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">αs</span> <span class="main">=</span> <span class="free">βs</span> <span class="main">∧</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">αs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quoted"><span class="free">βs</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum_0E length_0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α0</span></span> <span class="skolem"><span class="skolem">αs'</span></span> <span class="skolem"><span class="skolem">β0</span></span> <span class="skolem"><span class="skolem">βs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> αs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">αs</span> <span class="main">=</span> <span class="skolem">α0</span> <span class="main">#</span> <span class="skolem">αs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> βs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">βs</span> <span class="main">=</span> <span class="skolem">β0</span> <span class="main">#</span> <span class="skolem">βs'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> min_list.cases step.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ON<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">αs'</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">βs'</span> <span class="main">⊆</span> ON"</span></span>
      <span class="keyword1"><span class="command">using</span></span> αs βs step.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m0</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">m0</span> <span class="main">#</span> <span class="skolem">ms'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> <span class="skolem">n0</span> <span class="main">#</span> <span class="skolem">ns'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> αs βs length_0_conv list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust step.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ms'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ns'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ms ns step.prems<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β0</span> <span class="main">&lt;</span> <span class="skolem">α0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> Ordc<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>Cantor_sum <span class="skolem">βs</span> <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span>  step.hyps step.prems<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">βs</span> <span class="skolem">ns</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>2-6<span class="main">)</span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span> <span class="quoted"><span class="quoted">‹Cantor_dec <span class="skolem">βs</span>›</span></span> that βs cnf_2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_dec_Cons_iff insert_subset list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum_Cons Ord_mem_iff_lt Ord_ord_of_nat Ordc αs <span class="quoted"><span class="quoted">‹<span class="skolem">m0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * le_mult ms not_add_mem_right ord_of_eq_0 step.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">)</span></span> vsubsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α0</span> <span class="main">&lt;</span> <span class="skolem">β0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> Ordc<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>Cantor_sum <span class="skolem">αs</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span>  step.hyps step.prems<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">αs</span> <span class="skolem">ms</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>1-5<span class="main">)</span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span> <span class="quoted"><span class="quoted">‹Cantor_dec <span class="skolem">αs</span>›</span></span> that αs cnf_2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_dec_Cons_iff βs insert_subset list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum_Cons Ord_mem_iff_lt Ord_ord_of_nat Ordc βs <span class="quoted"><span class="quoted">‹<span class="skolem">n0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * le_mult not_add_mem_right ns ord_of_eq_0 step.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">)</span></span> vsubsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α0</span> <span class="main">=</span> <span class="skolem">β0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_linear_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="main">&lt;</span> <span class="skolem">n0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α0</span> <span class="main">&gt;</span> Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> αs <span class="quoted"><span class="quoted">‹list.set <span class="skolem">ms'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>›</span></span> cnf_2 ms step.prems<span class="main">(</span>1<span class="main">,</span>5<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α0</span> <span class="main">*</span> ord_of_nat <span class="skolem">m0</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> αs ms step.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">α0</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="skolem">m0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">α0</span> <span class="main">*</span> ord_of_nat <span class="skolem">n0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_oexp Ord_ord_of_nat Suc_leI <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span> mult_cancel_le_iff ord_of_nat_mono_iff that<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum_Cons add_le_cancel_left βs <span class="quoted"><span class="quoted">‹<span class="skolem">α0</span> <span class="main">=</span> <span class="skolem">β0</span>›</span></span> add.right_neutral le_0 ns step.prems<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> <span class="skolem">m0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">&gt;</span> Cantor_sum <span class="skolem">βs'</span> <span class="skolem">ns'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> βs <span class="quoted"><span class="quoted">‹list.set <span class="skolem">ns'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>›</span></span> cnf_2 ns step.prems<span class="main">(</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">*</span> ord_of_nat <span class="skolem">n0</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">β0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> βs ns step.prems<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="skolem">n0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_succ<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">*</span> ord_of_nat <span class="skolem">m0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_oexp Ord_ord_of_nat Suc_leI <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span> mult_cancel_le_iff ord_of_nat_mono_iff that<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum_Cons add_le_cancel_left αs <span class="quoted"><span class="quoted">‹<span class="skolem">α0</span> <span class="main">=</span> <span class="skolem">β0</span>›</span></span> add.right_neutral le_0 ms step.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="main">=</span> <span class="skolem">n0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_neq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">αs'</span> <span class="main">=</span> <span class="skolem">βs'</span> <span class="main">∧</span> <span class="skolem">ms'</span> <span class="main">=</span> <span class="skolem">ns'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.IH<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> αs cnf_2 ms nz<span class="main">(</span>2<span class="main">)</span> step.prems<span class="main">(</span>1<span class="main">)</span> step.prems<span class="main">(</span>5<span class="main">)</span> step.prems<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Cantor_sum <span class="skolem">αs</span> <span class="skolem">ms</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> αs βs ms ns<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor_sum_Cons add_less_cancel_left ON<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Ord_ω Ord_linear2 Ord_oexp Ord_ord_of_nat αs add.right_neutral dual_order.strict_trans1 le_mult ms not_less_0 nz<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ord_of_eq_0 step.hyps step.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span> <span class="main">∈</span> elts <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ON<span class="main">(</span>2<span class="main">)</span> Ord_Cantor_sum Ord_mem_iff_lt step.hyps step.prems<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">αs'</span> <span class="main">=</span> length <span class="skolem">ms'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">βs'</span> <span class="main">=</span> length <span class="skolem">ns'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> αs ms βs ns step.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="skolem">αs'</span>"</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="skolem">βs'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> αs βs step.prems<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">αs</span> <span class="skolem">ms</span> <span class="main">=</span> Cantor_sum <span class="skolem">βs</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>9<span class="main">,</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span> <span class="main">=</span> Cantor_sum <span class="skolem">βs'</span> <span class="skolem">ns'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> αs βs ms ns<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> ON nz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> αs βs ms ns<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">proposition</span></span> Cantor_nf_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="free">αs</span> <span class="free">ms</span> <span class="main">=</span> Cantor_sum <span class="free">βs</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αsON<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βsON<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">βs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"list.set <span class="free">ns</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mseq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nseq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">βs</span> <span class="main">=</span> length <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αsdec<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="free">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βsdec<span class="main">:</span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="free">βs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">αs</span> <span class="main">=</span> <span class="free">βs</span> <span class="main">∧</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cantor_nf_unique_aux Ord_Cantor_sum assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> less_ω_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α1</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> α2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α2</span> <span class="main">∈</span> elts <span class="free">α1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="free">α2</span> <span class="main">*</span> ord_of_nat <span class="free">m2</span> <span class="main">+</span> <span class="free">β</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α1</span> <span class="main">*</span> ord_of_nat <span class="free">m1</span> <span class="main">+</span> <span class="main">(</span>ω<span class="main">↑</span><span class="free">α2</span> <span class="main">*</span> ord_of_nat <span class="free">m2</span> <span class="main">+</span> <span class="free">β</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">&lt;</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> oo<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="free">α1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="free">α2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord Ord_oexp assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="free">m2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ord_of_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α2</span> <span class="main">*</span> ord_of_nat <span class="free">m2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ord_of_nat β dual_order.strict_trans1 le_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> oo assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">≠</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_mult Ord_ord_of_nat add_strict_mono add.assoc cnf_1 not_add_less_right oo<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_le_left <span class="quoted"><span class="quoted">‹Ord <span class="free">β</span>›</span></span> less_V_def oo<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Cantor_sum_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ms</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="free">α</span> <span class="main">≤</span> Cantor_sum <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ms</span> <span class="main">=</span> Cons <span class="skolem">m</span> <span class="skolem">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> strict_sorted.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω <span class="main">↑</span> <span class="free">α</span> <span class="main">≤</span> ω <span class="main">↑</span> <span class="free">α</span> <span class="main">*</span> ord_of_nat <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> le_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.trans ms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simplified Cantor normal form›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹No coefficients, and the exponents decreasing non-strictly›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ω_sum</span>  <span class="keyword2"><span class="keyword">where</span></span>
  ω_sum_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ω_sum</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> ω_sum_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ω_sum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">αs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ω<span class="main">↑</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="free">ω_sum</span> <span class="free"><span class="bound"><span class="entity">αs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ω_dec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ω_dec</span> <span class="main">≡</span> sorted_wrt <span class="main">(≥)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ord_ω_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON <span class="main">⟹</span> Ord <span class="main">(</span>ω_sum <span class="free">αs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_dec_Cons_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">β</span><span class="main">#</span><span class="free">βs</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">β</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">∧</span> ω_dec <span class="main">(</span><span class="free">β</span><span class="main">#</span><span class="free">βs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_sum_0E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="free">αs</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">αs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ω_of_Cantor</span> <span class="keyword2"><span class="keyword">where</span></span>
  ω_of_Cantor_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ω_of_Cantor</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> ω_of_Cantor_Nil2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ω_of_Cantor</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">αs</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> ω_of_Cantor_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ω_of_Cantor</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">αs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> replicate <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">@</span> <span class="free">ω_of_Cantor</span> <span class="free"><span class="bound"><span class="entity">αs</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ω_sum_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω_sum <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> ω_sum <span class="free">xs</span> <span class="main">+</span> ω_sum <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_sum_replicate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω_sum <span class="main">(</span>replicate <span class="free">m</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> ω <span class="main">↑</span> <span class="free">a</span> <span class="main">*</span> ord_of_nat <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_succ <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> replicate_append_same<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_sum_of_Cantor <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ω_sum <span class="main">(</span>ω_of_Cantor <span class="free">αs</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> Cantor_sum <span class="free">αs</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">αs</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_of_Cantor_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span>ω_of_Cantor <span class="free">αs</span> <span class="free">ms</span><span class="main">)</span> <span class="main">⊆</span> List.set <span class="free">αs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">αs</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> ω_dec_replicate<span class="main">:</span> <span class="quoted"><span class="quoted">"ω_dec <span class="main">(</span>replicate <span class="free">m</span> <span class="free">α</span> <span class="main">@</span> <span class="free">αs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> ω_dec <span class="free">αs</span> <span class="keyword1">else</span> ω_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> replicate_append_same<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> ω_dec_of_Cantor_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="main">(</span>ω_of_Cantor <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sorted_wrt_iff_nth_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">αs</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>list.set <span class="main">(</span>ω_of_Cantor <span class="skolem">αs</span> <span class="skolem">ns</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons ns <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="free">α</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_dec_replicate<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ω_of_Cantor_subset order.strict_implies_order subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons ns <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_dec_replicate<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ω_dec_of_Cantor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="free">αs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">αs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="main">(</span>ω_of_Cantor <span class="free">αs</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_dec_of_Cantor_aux assms length_Suc_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> ω_nf_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">αs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="free">αs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ω_sum <span class="free">αs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">αs</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"List.set <span class="skolem">αs</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">αs</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="skolem">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> Cantor_sum <span class="skolem">αs</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cantor_nf_exists assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_dec_of_Cantor ω_of_Cantor_subset ω_sum_of_Cantor order_trans that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ω_sum_take_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"ω_sum <span class="free">αs</span> <span class="main">=</span> ω_sum <span class="main">(</span>take <span class="free">k</span> <span class="free">αs</span><span class="main">)</span> <span class="main">+</span> ω_sum <span class="main">(</span>drop <span class="free">k</span> <span class="free">αs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">αs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_elts_ω_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">∈</span> elts <span class="main">(</span>ω_sum <span class="free">αs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span>length <span class="free">αs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">γ</span><span class="main">∈</span>elts <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="free">αs</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">δ</span> <span class="main">=</span> ω_sum <span class="main">(</span>take <span class="bound">k</span> <span class="free">αs</span><span class="main">)</span> <span class="main">+</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">δ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">α</span> <span class="skolem">αs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">α</span> <span class="main">+</span> ω_sum <span class="skolem">αs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mem_plus_V_E<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">η</span>
    <span class="keyword3"><span class="command">assume</span></span> η<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">η</span> <span class="main">∈</span> elts <span class="main">(</span>ω_sum <span class="skolem">αs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> ω <span class="main">↑</span> <span class="skolem">α</span> <span class="main">+</span> <span class="skolem">η</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span>length <span class="skolem">αs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="main">(</span><span class="skolem">αs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">η</span> <span class="main">=</span> ω_sum <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">αs</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ add.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_le_ω_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">k</span> <span class="main">&lt;</span> length <span class="free">αs</span><span class="main">;</span> List.set <span class="free">αs</span> <span class="main">⊆</span> ON<span class="main">⟧</span> <span class="main">⟹</span> ω <span class="main">↑</span> <span class="main">(</span><span class="free">αs</span><span class="main">!</span><span class="free">k</span><span class="main">)</span> <span class="main">≤</span> ω_sum <span class="free">αs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">αs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">αs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Cons.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="skolem">αs</span> <span class="main">⟹</span> ω <span class="main">↑</span> <span class="skolem">αs</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">≤</span> ω <span class="main">↑</span> <span class="skolem">a</span> <span class="main">+</span> ω_sum <span class="skolem">αs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_ω_sum Ord_oexp add_le_left order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ω_sum_less_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="free">αs</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">+</span> ω_sum <span class="free">αs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">α</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ZFC_in_HOL.neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">α1</span> <span class="skolem">αs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_right_strict_mono oexp_mono_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Something like Lemma 5.2 for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ω_sum</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> ω_sum_less_ω_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"List.set <span class="main">(</span><span class="free">α</span><span class="main">#</span><span class="free">αs</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="free">αs</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ω"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">αs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_gt0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">β</span> <span class="skolem">αs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="skolem">αs</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">+</span> ω_sum <span class="skolem">αs</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">+</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ω"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems add_right_strict_mono oexp_mono_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">α</span> <span class="main">*</span> ω"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Kirby.add_mult_distrib mult.right_neutral one_plus_ω_equals_ω<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ω_sum_nf_unique_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αsON<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">αs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βsON<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="free">βs</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αsdec<span class="main">:</span> <span class="quoted"><span class="quoted">"ω_dec <span class="free">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βsdec<span class="main">:</span> <span class="quoted"><span class="quoted">"ω_dec <span class="free">βs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> αseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ω_sum <span class="free">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> βseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ω_sum <span class="free">βs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">αs</span> <span class="main">=</span> <span class="free">βs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">α</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">αs</span></span> <span class="quoted"><span class="free">βs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_sum_0E<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α0</span></span> <span class="skolem"><span class="skolem">αs'</span></span> <span class="skolem"><span class="skolem">β0</span></span> <span class="skolem"><span class="skolem">βs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> αs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">αs</span> <span class="main">=</span> <span class="skolem">α0</span> <span class="main">#</span> <span class="skolem">αs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> βs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">βs</span> <span class="main">=</span> <span class="skolem">β0</span> <span class="main">#</span> <span class="skolem">βs'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ω_sum.elims step.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ON<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">αs'</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β0</span>"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">βs'</span> <span class="main">⊆</span> ON"</span></span>
      <span class="keyword1"><span class="command">using</span></span> αs βs step.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β0</span> <span class="main">&lt;</span> <span class="skolem">α0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> Ordc<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω_sum <span class="skolem">βs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span>  step.hyps step.prems<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="skolem">βs</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β0</span> <span class="main">*</span> ω"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ω_sum_less_ω_power<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> βs step.prems ON <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">α0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ON <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_succ oexp_mono_le oexp_succ omega_nonzero succ_le_iff that<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> αs leD step.prems<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α0</span> <span class="main">&lt;</span> <span class="skolem">β0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> Ordc<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω_sum <span class="skolem">αs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_oexp <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span>  step.hyps step.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="skolem">αs</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α0</span> <span class="main">*</span> ω"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ω_sum_less_ω_power<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> αs step.prems ON <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">β0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ON <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_succ oexp_mono_le oexp_succ omega_nonzero succ_le_iff that<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> βs leD step.prems<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">=</span> ω_sum <span class="skolem">αs</span>›</span></span> leD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> †<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α0</span> <span class="main">=</span> <span class="skolem">β0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_linear_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">αs'</span> <span class="main">=</span> <span class="skolem">βs'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.IH<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="skolem">αs'</span> <span class="main">∈</span> elts <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.prems αs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt ω_sum_less_self<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="skolem">αs'</span>"</span></span> <span class="quoted"><span class="quoted">"ω_dec <span class="skolem">βs'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> αs βs step.prems<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="skolem">αs</span> <span class="main">=</span> ω_sum <span class="skolem">βs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω_sum <span class="skolem">αs'</span> <span class="main">=</span> ω_sum <span class="skolem">βs'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> † αs βs<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> ON <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> αs βs<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Indecomposable ordinals›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cf exercise 5 on page 43 of Kunen›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indecomposable</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indecomposable</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">≡</span> Ord <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">β</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">γ</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">.</span> <span class="bound">β</span><span class="main">+</span><span class="bound">γ</span> <span class="main">∈</span> elts <span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposableD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>indecomposable <span class="free">α</span><span class="main">;</span> <span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">;</span> <span class="free">γ</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">;</span> Ord <span class="free">β</span><span class="main">;</span> Ord <span class="free">γ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">β</span><span class="main">+</span><span class="free">γ</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_mem_iff_lt OrdmemD indecomposable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_imp_Ord<span class="main">:</span>
  <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span> <span class="main">⟹</span> Ord <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indecomposable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_1<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indecomposable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_0<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indecomposable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>succ <span class="free">α</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> not_add_mem_right
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indecomposable_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel add.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> minor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">β</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">β</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">;</span> <span class="bound">γ</span> <span class="main">&lt;</span> <span class="free">α</span><span class="main">;</span> Ord <span class="bound">γ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">β</span><span class="main">+</span><span class="bound">γ</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">+</span><span class="free">α</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">β</span><span class="main">+</span><span class="free">α</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_le_left ord leD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">α</span> <span class="main">&lt;</span> <span class="free">β</span><span class="main">+</span><span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms le_Ord_diff less_V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_le_left less_V_def ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">+</span><span class="free">α</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms indecomposableD indecomposable_def le_Ord_diff less_V_def less_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> minor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">::</span>V<span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="bound">y</span><span class="main">+</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">+</span><span class="free">z</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_cancel_left y z minor<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_imp_Limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indec<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indecomposable_imp_Ord <span class="main">[</span><span class="operator">OF</span> indec<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms one_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_imp_indecomposable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">β</span><span class="main">::</span>V<span class="main">.</span> <span class="bound">β</span> <span class="main">∈</span> elts <span class="free">α</span> <span class="main">⟹</span> <span class="bound">β</span><span class="main">+</span><span class="free">α</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mem_right_cancel assms indecomposable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_ω_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indecomposable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">β</span> <span class="skolem">γ</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_ω Ord_in_Ord Ord_oexp OrdmemD <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>elts ω<span class="main">.</span> <span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts ω"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_ω Ord_mult Ord_oexp x y nat_into_Ord succ<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> add_mult_distrib Ord_add Ord_mem_iff_lt add_strict_mono ord x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span> succ ord β γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_Limit <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> limit
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">δ</span>›</span></span> limit ord β γ oexp_Limit
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_in_Ord<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> elts <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_def Ord_linear_le limit sup.absorb2 sup.orderE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span>succ <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> oxy<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_sup x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">x</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">y</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_linear_le Ord_mem_iff_less_TC Ord_mem_iff_lt le_TC_def less_le_not_le oexp_mono omega_nonzero sup.absorb2 sup.orderE x<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> y<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> succ <span class="main">(</span>succ <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_add Ord_mem_iff_lt Ord_oexp Ord_sup add_strict_mono mult.right_neutral mult_succ ord one_V_def x<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> y<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oxy<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Ord_ω Ord_mult Ord_oexp Ord_trans mem_0_Ord mult_add_mem_0 oexp_eq_0_iff omega_nonzero oxy succ_in_omega <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ord <span class="quoted"><span class="quoted">‹Ord <span class="main">(</span>ω<span class="main">↑</span><span class="free">δ</span><span class="main">)</span>›</span></span> limit oexp_Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ω_power_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">+</span> ω<span class="main">↑</span><span class="free">δ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms indecomposable_ω_power indecomposable_imp_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> type_imp_indecomposable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> minor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> elts <span class="free">α</span> <span class="main">⟹</span> ordertype <span class="bound">X</span> VWF <span class="main">=</span> <span class="free">α</span> <span class="main">∨</span> ordertype <span class="main">(</span>elts <span class="free">α</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indecomposable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">β</span> <span class="skolem">γ</span>
  <span class="keyword3"><span class="command">assume</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> βγ<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="skolem">β</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">γ</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> α Ord_in_Ord Ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> oeq<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="skolem">β</span><span class="main">)</span> VWF <span class="main">=</span> <span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∉</span> elts <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">δ</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ordertype βγ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_Ord_diff less_eq_V_def minor oeq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="free">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_linear βγ γ <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">∉</span> elts <span class="free">α</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="free">α</span> <span class="main">-</span> elts <span class="skolem">β</span><span class="main">)</span> VWF <span class="main">=</span> <span class="skolem">δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> δ ordertype_diff Limit_def α <span class="quoted"><span class="quoted">‹Ord <span class="skolem">β</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> β <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">∈</span> elts <span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹elts <span class="skolem">β</span> <span class="main">⊆</span> elts <span class="free">α</span>›</span></span> oeq mem_not_refl minor<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This proof uses Cantor normal form, yet still is rather long›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> indecomposable_is_ω_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">μ</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="free">δ</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_def assms indecomposable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">αs</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> Cantor<span class="main">:</span> <span class="quoted"><span class="quoted">"List.set <span class="skolem">αs</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
                                <span class="quoted"><span class="quoted">"length <span class="skolem">αs</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"Cantor_dec <span class="skolem">αs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> Cantor_sum <span class="skolem">αs</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cantor_nf_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">αs</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">αs</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">αs</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> μ assms False indecomposable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> αm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">αs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">α</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def <span class="quoted"><span class="quoted">‹length <span class="skolem">αs</span> <span class="main">=</span> length <span class="skolem">ms</span>›</span></span> length_0_conv length_Suc_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹list.set <span class="skolem">αs</span> <span class="main">⊆</span> ON›</span></span> <span class="quoted"><span class="quoted">‹list.set <span class="skolem">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">*</span> ord_of_nat <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> αm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> μ<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">+</span> Suc <span class="main">0</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral mult.left_neutral mult_succ ord_of_nat.simps ord_of_nat_add<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> μeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> μ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">&lt;</span> <span class="free">μ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω OrdmemD μeq <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α</span>›</span></span> add_le_cancel_left0 add_less_cancel_left0 le_less_trans less_V_def oexp_gt_0_iff zero_in_omega<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">μ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> <span class="quoted">"μ"</span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α</span>›</span></span> assms less indecomposableD less_V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> indecomposableD <span class="main">[</span><span class="operator">OF</span> inc<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">+</span> ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span>›</span></span> add.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹List.set <span class="skolem">αs</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">αs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">α</span><span class="main">]</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def mult.right_neutral ord_of_nat.simps one_V_def that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α1</span></span> <span class="skolem"><span class="skolem">α2</span></span> <span class="skolem"><span class="skolem">αs'</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="keyword2"><span class="keyword">where</span></span> αm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">αs</span> <span class="main">=</span> <span class="skolem">α1</span><span class="main">#</span><span class="skolem">α2</span><span class="main">#</span><span class="skolem">αs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">m1</span><span class="main">#</span><span class="skolem">m2</span><span class="main">#</span><span class="skolem">ms'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cantor<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> One_nat_def Suc_1 impossible_Cons length_Cons list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_numeral_le_zero remdups_adj.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α1</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α2</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"list.set <span class="skolem">αs'</span> <span class="main">⊆</span> ON"</span></span> <span class="quoted"><span class="quoted">"list.set <span class="skolem">ms'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹list.set <span class="skolem">αs</span> <span class="main">⊆</span> ON›</span></span> <span class="quoted"><span class="quoted">‹list.set <span class="skolem">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> oCs<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_Cantor_sum <span class="quoted"><span class="quoted">‹list.set <span class="skolem">αs'</span> <span class="main">⊆</span> ON›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> α21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α2</span> <span class="main">∈</span> elts <span class="skolem">α1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cantor_dec_Cons_iff αm<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Cantor_dec <span class="skolem">αs</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α1</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α2</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α2</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α2</span> <span class="main">*</span> ord_of_nat <span class="skolem">m2</span> <span class="main">+</span> Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD <span class="quoted"><span class="quoted">‹Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> mem_0_Ord oCs<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> μ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span> <span class="main">+</span> <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α2</span> <span class="main">*</span> ord_of_nat <span class="skolem">m2</span> <span class="main">+</span> Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">=</span> <span class="var">?α</span> <span class="main">+</span> <span class="var">?β</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> αm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> μ<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α2</span> <span class="main">*</span> ord_of_nat <span class="skolem">m2</span> <span class="main">+</span> Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α1</span> <span class="main">*</span> ord_of_nat <span class="skolem">m1</span> <span class="main">+</span> <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α2</span> <span class="main">*</span> ord_of_nat <span class="skolem">m2</span> <span class="main">+</span> Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α2</span> <span class="main">∈</span> elts <span class="skolem">α1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_ω_power<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Cantor_sum <span class="skolem">αs'</span> <span class="skolem">ms'</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">α2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> αm Cantor cnf_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> oCs <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?β</span> <span class="main">&lt;</span> <span class="free">μ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> α21 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> μ αm<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?α</span> <span class="main">&lt;</span> <span class="free">μ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> oCs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> μ <span class="quoted">"*"</span> add_less_cancel_left add.right_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> indecomposableD <span class="main">[</span><span class="operator">OF</span> inc<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?β</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α2</span><span class="main">)</span>›</span></span> oCs<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> indecomposable_iff_ω_power<span class="main">:</span>
   <span class="quoted"><span class="quoted">"indecomposable <span class="free">μ</span> <span class="main">⟷</span> <span class="free">μ</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">δ</span><span class="main">.</span> <span class="free">μ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="bound">δ</span> <span class="main">∧</span> Ord <span class="bound">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> indecomposable_0 indecomposable_ω_power indecomposable_is_ω_power<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> indecomposable_imp_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> V set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">γ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="free">X</span> <span class="bound">b</span><span class="main">)</span> VWF <span class="main">≤</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> small <span class="main">(</span><span class="free">X</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="free">X</span> <span class="bound">b</span> <span class="main">⊆</span> ON"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"elts <span class="free">γ</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">b</span><span class="main">.</span> <span class="free">X</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="free">X</span> <span class="bound">b</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> γ <span class="main">[</span><span class="operator">THEN</span> indecomposable_imp_Ord<span class="main">]</span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">β</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> succ.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span><span class="main">)</span> VWF <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> succ.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span><span class="main">)</span> VWF <span class="main">≥</span> succ <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ord_0 Ord_linear2 Ord_ordertype less_eq_V_0_iff succ_le_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> True succ.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> succ.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Limit <span class="skolem">γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit_eq_Sup_self image_ident indecomposable_is_ω_power not_succ_Limit oexp_0_right one_V_def zero_not_Limit<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Limit <span class="skolem">δ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> ot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">α</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> elts <span class="skolem">δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Limit.IH<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="quoted"><span class="quoted">‹Ord <span class="skolem">δ</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">∈</span> elts <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt δ ω_gt1 <span class="quoted"><span class="quoted">‹Ord <span class="skolem">δ</span>›</span></span> oexp_less that<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α</span>›</span></span> indecomposable_1 indecomposable_ω_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> down inf_le2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">≤</span> ω <span class="main">↑</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">α</span>›</span></span> ordertype_le_Ord<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit.prems inf.coboundedI1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> elts <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.prems Limit.hyps <span class="quoted"><span class="quoted">‹ω <span class="main">↑</span> <span class="skolem">α</span> <span class="main">∈</span> elts <span class="skolem">γ</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> Ord_trans UN_E indecomposable_imp_Ord subset_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">α</span></span> <span class="main">∈</span> elts <span class="skolem">δ</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="bound">α</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">≥</span> ω<span class="main">↑</span><span class="bound">α</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> Asmall<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">A</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> AON<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">b</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">using</span></span> A_def <span class="quoted"><span class="quoted">‹Ord <span class="skolem">δ</span>›</span></span> elts_subset_ON <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="skolem">δ</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> ot eq_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span><span class="skolem">A</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Limit <span class="skolem">δ</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> UN_bool_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AON ON_imp_Ord Ord_Sup Ord_linear_le Limit_eq_Sup_self Sup_Un_distrib Asmall sup.absorb2 sup.orderE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">α</span> <span class="main">≤</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span><span class="main">)</span> VWF"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span> <span class="main">=</span> ordertype <span class="main">(</span><span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∩</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">α</span><span class="main">)</span><span class="main">)</span> VWF"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">δ</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def Ord_in_Ord dual_order.antisym ordertype_le_Ord<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span><span class="main">)</span> VWF"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Limit.prems ordertype_VWF_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span><span class="main">)</span> VWF <span class="main">≥</span> Sup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> ω<span class="main">↑</span><span class="bound">α</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> ω<span class="main">↑</span><span class="bound">α</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> ω <span class="main">↑</span> Sup <span class="main">(</span><span class="skolem">A</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b Ord_ω ZFC_in_HOL.Sup_empty AON <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> Asmall oexp_Sup omega_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit.prems δ b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> succ <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_cases <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">δ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Ordωβ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_oexp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> subX12<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit β δ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="bound">n</span> <span class="main">..&lt;</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∩</span> ON"</span></span>
    <span class="keyword1"><span class="command">have</span></span> EON<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="skolem">n</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> E_imp_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> ord_of_nat <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ordωβ Ord_ord_of_nat leD mult_cancel_le_iff ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> EON ON_imp_Ord Ord_linear2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> djE<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">E</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">E</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> that nat_neq_iff <span class="keyword1"><span class="command">unfolding</span></span> disjnt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> less_imp_E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> that E_imp_less <span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">i</span>›</span></span><span class="main">]</span> leI less_asym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> β indecomposable_1 indecomposable_ω_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> in_En<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> that Ordωβ Ord_in_Ord <span class="main">[</span><span class="operator">OF</span> Ordωβ<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_def Ordωβ OrdmemD mult_succ<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"elts <span class="skolem">γ</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> succ <span class="main">(</span>ord_of_nat <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"ord_of_nat <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span> lift_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_cancel_left OrdmemD inc indecomposable_imp_Ord mult_succ plus sup_ge1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ordωβ Ord_in_Ord Ord_mult Ord_ord_of_nat that<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="skolem">γ</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> δ β E_def mult_Limit elts_ω<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> succ<span class="main">(</span>ord_of_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> succ <span class="main">(</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that Ord_mem_iff_lt Ord_mult Ord_ord_of_nat inc indecomposable_imp_Ord ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> δ β E_def Limit.prems mult_Limit<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> smE<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> complete_lattice_class.Sup_upper down rangeI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> otE<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span> VWF <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E_def inc indecomposable_imp_Ord mult_succ ordertype_interval_eq<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cut</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cut</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> odiff <span class="bound">x</span> <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> cutON<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subset_iff cut_def ON_imp_Ord Ordωβ Ord_odiff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cut <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">(</span>ω <span class="main">↑</span> <span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cuteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟷</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">X</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> E_def Ordωβ Ord_odiff_eq image_iff local.cut_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> IntI cut image_iff in_En that x<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> ot_cuteq<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span> VWF"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">X</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_VWF_inc_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span> <span class="main">⊆</span> ON"</span></span>
        <span class="keyword1"><span class="command">using</span></span> E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cutON<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_lower2 smE smaller_than_small<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cut</span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">cut</span> <span class="skolem">n</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E_def Ordωβ Ord_odiff_less_odiff local.cut_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="bound">n</span><span class="main">)</span> VWF <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> infinite <span class="main">(</span><span class="skolem">N</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">b</span><span class="main">.</span> infinite <span class="main">(</span><span class="skolem">N</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="skolem">N</span> <span class="bound">b</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_bool_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> finite_nat_set_iff_bounded not_less_iff_gr_or_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Limit.IH<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">∈</span> elts <span class="skolem">γ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Limit.hyps Limit_def Limit_omega Ord_mem_iff_less_TC β δ mult_le2 not_succ_Limit oexp_succ omega_nonzero one_V_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inc<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"otE"</span> inf_le2 ordertype_VWF_mono ot_cuteq smE<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
          <span class="keyword1"><span class="command">using</span></span> smE subset_iff_less_eq_V
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_le2 replacement<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
          <span class="keyword1"><span class="command">using</span></span> E_def cutON <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> succ <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>range <span class="skolem">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ordωβ Ord_ω Ord_ord_of_nat less_eq_V_def mult_cancel_le_iff ord_of_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ord_of_nat_le_omega order_trans subX12<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">cut</span> <span class="skolem">n</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_succ mult_Limit UN_subset_iff cuteq UN_bool_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="bound">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="skolem">n</span><span class="main">)</span> VWF <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ot_cuteq<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">N</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">φ</span> UNIV <span class="main">(</span><span class="skolem">N</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">φ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_enumerate enumerate_mono strict_mono_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> N_def bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_le2 smE subset_iff_less_eq_V<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ordertype ordertype_VWF_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> bij_betw <span class="main">(</span><span class="skolem">F</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">F</span> <span class="bound">n</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_ω Ord_oexp OrdmemD β<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bij_betw_imp_surj_on image_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> F_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> Ord <span class="main">(</span><span class="skolem">F</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> otE ON_imp_Ord Ord_ordertype bijF bij_betw_def elts_subset_ON imageI<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono strict_mono_imp_increasing<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> djφ<span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> djE<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> φ that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> bij_betw_def inj_def›</span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span> Y_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="keyword2"><span class="keyword">where</span></span> ι<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">(</span><span class="skolem">ι</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> ON"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def E_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ιle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">ι</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span> less_imp_E strict_mono_less_eq that ι <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span><span class="main">]</span> ι <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>›</span></span><span class="main">]</span> mono
        <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> eqι<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">ι</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> ι <span class="keyword1"><span class="command">unfolding</span></span> Y_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UN_I disjnt_iff djφ iso_tuple_UNIV_I<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span> <span class="quoted"><span class="quoted">"ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="skolem">ι</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def eqι<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">&lt;</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrdmemD β<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> β<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> elts <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> ON›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ON_imp_Ord Ord_ω Ord_in_Ord Ord_mem_iff_lt Ord_mult Ord_oexp Ord_ord_of_nat β<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that u<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="main">(</span><span class="skolem">ι</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">ι</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> G_strict_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">G</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ι</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> G_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F Int_iff add_less_cancel_left Limit.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ON_imp_Ord VWF_iff_Ord_less ι<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">ι</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> IntE ιle le_less that<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def F_Ord F_bound Ordωβ ι mult_nat_less_add_less<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> VWF <span class="main">=</span> <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span> <span class="main">*</span> ω"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordertype_VWF_eq_iff <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> β<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Limit.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf_le1 subset_iff_less_eq_V<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">G</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">G</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_inj_onI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">G</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> G_strict_mono xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="skolem">b</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> ON_imp_Ord Ord_linear Ord_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">⊆</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="skolem">b</span> <span class="main">⊆</span> ON›</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def mult_Limit Y_def eqι<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI add_mem_right_cancel bijF bij_betw_imp_surj_on image_eqI mult_succ ord_of_nat_ω succ_in_omega<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                          <span class="keyword2"><span class="keyword">and</span></span> minim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∉</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="bound">m</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> elts_mult_ωE
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> old.nat.exhaust<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ord_of_nat <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_succ <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> mem_plus_V_E<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_into <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bijF bij_betw_def inv_into_into<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_into <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">(</span>inv_into <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">F</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> G_def Int_iff bijF bij_betw_inv_into_right eqι xeq y<span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">G</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G_strict_mono Int_iff Limit.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ON_imp_Ord Ord_linear_lt less_asym<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> ON_imp_Ord <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> ON›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">G</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> VWF"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that ON_imp_Ord <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> ON›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_strict_mono that<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>elts <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span> <span class="main">*</span> ω<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> VWF<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="skolem">b</span> <span class="main">∩</span> <span class="skolem">E</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">≤</span> ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span><span class="main">)</span> VWF"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.prems<span class="main">(</span>3<span class="main">)</span> ordertype_VWF_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">X</span> <span class="skolem">b</span><span class="main">)</span> VWF <span class="main">=</span> <span class="main">(</span>ω<span class="main">↑</span><span class="skolem">β</span><span class="main">)</span> <span class="main">*</span> ω"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.hyps Limit.prems<span class="main">(</span>2<span class="main">)</span> β δ
        <span class="keyword1"><span class="command">using</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Limit.hyps β δ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> indecomposable_imp_type2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> elts <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">X</span> VWF <span class="main">=</span> <span class="free">γ</span> <span class="main">∨</span> ordertype <span class="main">(</span>elts <span class="free">γ</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indecomposable_imp_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> ordertype <span class="main">(</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free">X</span> <span class="keyword1">else</span> elts <span class="free">γ</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indecomposable_imp_type<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="free">X</span> <span class="keyword1">else</span> elts <span class="free">γ</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span> VWF <span class="main">≤</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> assms ordertype_le_Ord<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="free">X</span> <span class="keyword1">else</span> elts <span class="free">γ</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> ON"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="free">γ</span>›</span></span> assms elts_subset_ON <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms down <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹From ordinals to order types›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_ordertype_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indec<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">B</span> VWF <span class="main">=</span> <span class="free">α</span> <span class="main">∨</span> ordertype <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>ordertype <span class="free">B</span> VWF <span class="main">=</span> <span class="free">α</span> <span class="main">∨</span> ordertype <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="free">B</span> VWF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ordertype_image_ordermap <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span>elts <span class="free">α</span> <span class="main">-</span> ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> ordertype <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordertype_map_image α A elts_of_set ordertype_def replacement<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap <span class="free">A</span> VWF <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> elts <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> α A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> indecomposable_imp_type2 <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹indecomposable <span class="free">α</span>›</span></span><span class="main">]</span>  <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_ordertype_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indec<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> small<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">B</span> VWF <span class="main">≥</span> <span class="free">α</span> <span class="main">∨</span> ordertype <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">B</span><span class="main">)</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">A'</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> α <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> indec indecomposable_def le_ordertype_obtains_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="free">B</span> <span class="main">∩</span> <span class="skolem">A'</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span> <span class="main">∨</span> ordertype <span class="main">(</span><span class="skolem">A'</span><span class="main">-</span><span class="free">B</span><span class="main">)</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_Diff_Int Diff_subset Int_commute <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> indecomposable_ordertype_eq indec smaller_than_small<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="free">B</span> <span class="main">∩</span> <span class="skolem">A'</span><span class="main">)</span> VWF <span class="main">≤</span> ordertype <span class="free">B</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_lower1 small ordertype_VWF_mono smaller_than_small<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="skolem">A'</span><span class="main">-</span><span class="free">B</span><span class="main">)</span> VWF <span class="main">≤</span> ordertype <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">B</span><span class="main">)</span> VWF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_mono Diff_subset <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹small <span class="free">A</span>›</span></span> order_refl ordertype_VWF_mono smaller_than_small<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹now for finite partitions›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> indecomposable_ordertype_finite_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 𝒜<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"pairwise disjnt <span class="free">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="free">𝒜</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> ordertype <span class="bound">X</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 𝒜
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">X</span> <span class="skolem">𝒜</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> smA<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="skolem">𝒜</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">𝒜</span><span class="main">.</span> ordertype <span class="bound">X</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">⋃</span><span class="skolem">𝒜</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_insert disjnt_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> VWF <span class="main">=</span> <span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> indecomposable_ordertype_eq assms insert False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Union_mono cSup_singleton pairwise_insert smA subset_insertI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indecomposable_ordertype_finite_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indec<span class="main">:</span> <span class="quoted"><span class="quoted">"indecomposable <span class="free">α</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 𝒜<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="free">𝒜</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="free">A</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="main">⋃</span><span class="free">𝒜</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> ordertype <span class="bound">X</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 𝒜
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">X</span> <span class="skolem">𝒜</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> ordertype <span class="skolem">X</span> VWF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.trans ordertype_VWF_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">𝒜</span><span class="main">.</span> ordertype <span class="bound">X</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="main">⋃</span><span class="skolem">𝒜</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>insert <span class="skolem">X</span> <span class="skolem">𝒜</span><span class="main">)</span><span class="main">)</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems ordertype_VWF_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype <span class="skolem">X</span> VWF <span class="main">≥</span> <span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> indecomposable_ordertype_ge <span class="main">[</span><span class="operator">OF</span> indec<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset_conv Sup_insert cSup_singleton insert.IH small_sup_iff subset_refl<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ZFC_Typeclasses">
<div class="head">
<h1>Theory ZFC_Typeclasses</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Type Classes for ZFC›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ZFC_Typeclasses
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ZFC_Cardinals.html">ZFC_Cardinals</a> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>

<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The class of embeddable types›</span></span>

<span class="keyword1"><span class="command">class</span></span> embeddable <span class="main">=</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V_of</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> V<span class="main">.</span> inj <span class="bound">V_of</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> countable
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> embeddable
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>ord_of_nat <span class="main">∘</span> <span class="skolem">to_nat</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">to_nat</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">to_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_compose inj_ord_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.embeddable <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> local.ex_inj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> unit <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> bool <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> nat <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> int <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> rat <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> char <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> String.literal <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> typerep <span class="main">::</span> <span class="quoted">embeddable</span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">lemma</span></span> embeddable_classI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> embeddable_class<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> V <span class="main">::</span> <span class="quoted">embeddable</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> embeddable_classI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instance</span></span> prod <span class="main">::</span> <span class="main">(</span><span class="quoted">embeddable</span><span class="main">,</span><span class="quoted">embeddable</span><span class="main">)</span> <span class="quoted">embeddable</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">V_of2</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of1</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of2</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V_of2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">,</span> embeddable_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> embeddable_class.ex_inj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> sum <span class="main">::</span> <span class="main">(</span><span class="quoted">embeddable</span><span class="main">,</span><span class="quoted">embeddable</span><span class="main">)</span> <span class="quoted">embeddable</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>case_sum <span class="main">(</span>Inl <span class="main">∘</span> <span class="skolem">V_of1</span><span class="main">)</span> <span class="main">(</span>Inr <span class="main">∘</span> <span class="skolem">V_of2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of1</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of2</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V_of2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">+</span> <span class="tfree">'b</span><span class="main">,</span> embeddable_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> embeddable_class.ex_inj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> option <span class="main">::</span> <span class="main">(</span><span class="quoted">embeddable</span><span class="main">)</span> <span class="quoted">embeddable</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>case_option <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ZFC_in_HOL.set<span class="main">{</span><span class="skolem">V_of</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> embeddable_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> embeddable_class.ex_inj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">V_of_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">V_of_list</span> <span class="free"><span class="bound"><span class="entity">V_of</span></span></span> Nil <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">V_of_list</span> <span class="free"><span class="bound"><span class="entity">V_of</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">V_of</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free">V_of_list</span> <span class="free"><span class="bound"><span class="entity">V_of</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_V_of_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">V_of</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>V_of_list <span class="free">V_of</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> inj_eq <span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"V_of_list <span class="free">V_of</span> <span class="skolem">x</span> <span class="main">=</span> V_of_list <span class="free">V_of</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">embeddable</span><span class="main">)</span> <span class="quoted">embeddable</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>rec_list <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">xs</span> <span class="bound">r</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V_of</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">r</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"inj <span class="var">?f</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">if</span></span> V_of<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> inj_eq <span class="main">[</span><span class="operator">OF</span> V_of<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> embeddable_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> embeddable_class.ex_inj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The class of small types›</span></span>

<span class="keyword1"><span class="command">class</span></span> small <span class="main">=</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> small<span class="main">:</span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> embeddable
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> local.small small_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_small <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> small smaller_than_small <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> countable
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> small
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>ord_of_nat <span class="main">∘</span> <span class="skolem">to_nat</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">to_nat</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">to_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_compose inj_ord_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.small <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">metis</span> small_image_nat local.ex_inj the_inv_into_onto<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lepoll_UNIV_imp_small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>small set<span class="main">)</span> <span class="main">⟹</span> small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lepoll_iff replacement small smaller_than_small<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lepoll_imp_small<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>small set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"small <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lepoll_UNIV_imp_small UNIV_I assms lepoll_def subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> unit <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> bool <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> nat <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> int <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> rat <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> char <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> String.literal <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> typerep <span class="main">::</span> <span class="quoted">small</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> prod <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">,</span><span class="quoted">small</span><span class="main">)</span> <span class="quoted">small</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">V_of2</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">V_of2</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span> <span class="main">≤</span> elts <span class="main">(</span>VSigma <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of1</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of2</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of1</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of2</span> <span class="main">≤</span> elts <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V_of2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down_raw dual_order.refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> sum <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">,</span><span class="quoted">small</span><span class="main">)</span> <span class="quoted">small</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>case_sum <span class="main">(</span>Inl <span class="main">∘</span> <span class="skolem">V_of1</span><span class="main">)</span> <span class="main">(</span>Inr <span class="main">∘</span> <span class="skolem">V_of2</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"range <span class="main">(</span>case_sum <span class="main">(</span>Inl <span class="main">∘</span> <span class="skolem">V_of1</span><span class="main">)</span> <span class="main">(</span>Inr <span class="main">∘</span> <span class="skolem">V_of2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> elts <span class="main">(</span><span class="skolem">A</span> <span class="main">⨄</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of1</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of2</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of1</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of2</span> <span class="main">≤</span> elts <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V_of2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">+</span> <span class="tfree">'b</span><span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down_raw dual_order.refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> option <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">)</span> <span class="quoted">small</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> ZFC_in_HOL.set <span class="main">{</span><span class="skolem">V_of</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> ZFC_in_HOL.set <span class="main">{</span><span class="skolem">V_of</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> insert <span class="main">0</span> <span class="main">(</span>elts <span class="main">(</span>VPow <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">using</span></span> that  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down_raw elts_vinsert subset_insertI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">)</span> <span class="quoted">small</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>range <span class="main">(</span>V_of_list <span class="skolem">V_of</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>V_of_list <span class="skolem">V_of</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> list set<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_V_of_list<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≈</span> lists <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≲</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>range <span class="main">(</span><span class="skolem">V_of</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> V<span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lists <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">≲</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> countable_iff_lepoll countable_image_inj_on that<span class="main">(</span>1<span class="main">)</span> uncountable_infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lepoll_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ lepoll_times2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lists <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">≲</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>range <span class="skolem">V_of</span><span class="main">)</span>›</span></span> eqpoll_imp_lepoll infinite_eqpoll_lists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> lepoll_times1 lepoll_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lepoll_imp_small<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_V_of_list order_refl small_def small_iff_range<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">,</span><span class="quoted">embeddable</span><span class="main">)</span> <span class="quoted">embeddable</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of1</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of2</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of1</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V_of2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">u</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_f_f rangeI subsetD VLambda_eq_D2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">V_of1</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">u</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span> embeddable_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">metis</span> embeddable_class.ex_inj small order_refl replacement small_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">,</span><span class="quoted">small</span><span class="main">)</span> <span class="quoted">small</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"inj <span class="var">?φ</span>"</span></span><span class="main">)</span>
       <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> elts <span class="main">(</span>VPi <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of1</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of2</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of1</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of2</span> <span class="main">≤</span> elts <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V_of2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> VLambda <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">V_of2</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span>inv <span class="skolem">V_of1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">u</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_f_f rangeI subsetD VLambda_eq_D2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">V_of1</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">u</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="var">?φ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="var">?φ</span> <span class="main">≤</span> elts <span class="main">(</span>VPi <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VPi_I subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> down_raw dual_order.refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">small</span><span class="main">)</span> <span class="quoted">small</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ZFC_in_HOL.set <span class="main">(</span><span class="skolem">V_of</span> <span class="main">`</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">V_of</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def inj_image_eq_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ZFC_in_HOL.set <span class="main">(</span><span class="skolem">V_of</span> <span class="main">`</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> elts <span class="main">(</span>VPow <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">V_of</span> <span class="main">≤</span> elts <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def image_subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> small <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
    <span class="keyword1"><span class="command">unfolding</span></span> small_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 2 down_raw subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> real <span class="main">::</span> <span class="quoted">small</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"small <span class="main">(</span>range <span class="main">(</span>Rep_real<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span>real<span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">metis</span> Rep_real_inverse image_inv_f_f inj_on_def replacement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> complex <span class="main">::</span> <span class="quoted">small</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> Complex <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case_prod_conv complex.exhaust_sel rangeI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span>complex<span class="main">,</span> small_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">meson</span> TC_small replacement smaller_than_small subset_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>