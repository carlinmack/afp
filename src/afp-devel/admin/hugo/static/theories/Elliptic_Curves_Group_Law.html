<div id="Elliptic_Axclass">
<div class="head">
<h1>Theory Elliptic_Axclass</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formalization using Axiomatic Type Classes›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Elliptic_Axclass
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Reflective_Field.html">HOL-Decision_Procs.Reflective_Field</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Affine Coordinates›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> point <span class="main">=</span> Infinity <span class="main">|</span> Point <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword1"><span class="command">class</span></span> ell_field <span class="main">=</span> field <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> two_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nonsingular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonsingular</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">27</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">on_curve</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">on_curve</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> True
     <span class="main">|</span> Point <span class="bound">x</span> <span class="bound">y</span> <span class="main">⇒</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
     <span class="main">|</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">of</span>
         Infinity <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
       <span class="main">|</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇒</span>
           <span class="keyword1">if</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span>
             <span class="keyword1">if</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span> Infinity
             <span class="keyword1">else</span>
               <span class="keyword1">let</span>
                 <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">;</span>
                 <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span>
               <span class="keyword1">in</span>
                 Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>
           <span class="keyword1">else</span>
             <span class="keyword1">let</span>
               <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">;</span>
               <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span>
             <span class="keyword1">in</span>
               Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">opp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">opp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> Infinity
     <span class="main">|</span> Point <span class="bound">x</span> <span class="bound">y</span> <span class="main">⇒</span> Point <span class="bound">x</span> <span class="main">(</span><span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Elliptic_Axclass-on_curve_infinity"><span class="command">lemma</span></span> on_curve_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-opp_Infinity"><span class="command">lemma</span></span> opp_Infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"opp Infinity <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-opp_Point"><span class="command">lemma</span></span> opp_Point<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>Point <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Point <span class="free">x</span> <span class="main">(</span><span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-opp_opp"><span class="command">lemma</span></span> opp_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-opp_closed"><span class="command">lemma</span></span> opp_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def opp_def power2_eq_square
    <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-curve_elt_opp"><span class="command">lemma</span></span> curve_elt_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_eq_iff power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_closed"><span class="command">lemma</span></span> add_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Point' <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> True' <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> True' Point Point'
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> on_curve1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> Point' on_curve_def True'<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> False True' Point Point' assms
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False True' Point Point' assms
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def Let_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> on_curve1<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_not_zero<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">note</span></span> on_curve1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> Point' on_curve_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> on_curve2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> Point on_curve_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def Let_def False Point Point'<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> on_curve1 on_curve2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">with</span></span> Point <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_case"><span class="command">lemma</span></span> add_case <span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> InfL InfR Opp Tan Gen<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> Infinity <span class="bound">p</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> <span class="bound">p</span> Infinity <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> <span class="main">(</span>opp <span class="bound">p</span><span class="main">)</span> Infinity"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">l</span><span class="main">.</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
    <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
    <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">l</span><span class="main">.</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⟹</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span> <span class="free">q</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Point' <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">with</span></span> Point <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def R2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> True' <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> p Point Point' True' R3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> True' Point Point' p q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def ring_distribs power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False True' Point Point' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R4<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Point Point' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R5<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-eq_opp_is_zero"><span class="command">lemma</span></span> eq_opp_is_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ell_field<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> two_not_zero <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Elliptic_Axclass-add_casew"><span class="command">lemma</span></span> add_casew <span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> InfL InfR Opp Gen<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> Infinity <span class="bound">p</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> <span class="bound">p</span> Infinity <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> <span class="main">(</span>opp <span class="bound">p</span><span class="main">)</span> Infinity"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">l</span><span class="main">.</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⟹</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span> <span class="free">q</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p q
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_case<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R4<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def eq_opp_is_zero<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R4<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_tangent</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> Infinity <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> opp <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_generic</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> Infinity <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≠</span> Infinity <span class="main">∧</span>
      <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> opp <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Axclass-diff_neq0"><span class="command">lemma</span></span> diff_neq0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ring<span class="main">)</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Elliptic_Axclass-minus2_not0"><span class="command">lemma</span></span> minus2_not0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ell_field<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> two_not_zero <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> minus2_not0 <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> two_not_zero <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">]</span>

<span class="keyword1" id="Elliptic_Axclass-spec1_assoc"><span class="command">lemma</span></span> spec1_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Tan
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Gen <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Point <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tan
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> Gen
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> InfL
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> InfR
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Tan
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>5</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">note</span></span> ps <span class="main">=</span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub> p<span class="hidden">⇩</span><sub>4</sub> p<span class="hidden">⇩</span><sub>5</sub>
        <span class="keyword1"><span class="command">note</span></span> ps' <span class="main">=</span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> on_curve_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> on_curve_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> on_curve_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> ps'<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> ps'<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> ps'<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-spec2_assoc"><span class="command">lemma</span></span> spec2_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangent <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tan
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tan
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Gen
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> InfL
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> InfR
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Tan
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-spec3_assoc"><span class="command">lemma</span></span> spec3_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangent <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangent <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tan
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Opp
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Tan
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> InfL
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> InfR
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Tan
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">note</span></span> qs <span class="main">=</span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Gen
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Gen
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_0_l"><span class="command">lemma</span></span> add_0_l<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> Infinity <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-add_0_r"><span class="command">lemma</span></span> add_0_r<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> Infinity <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-add_opp"><span class="command">lemma</span></span> add_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> add <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def on_curve_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-add_comm"><span class="command">lemma</span></span> add_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Point' <span class="main">=</span> this
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l add_0_r<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> Point Point' <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> y1 y2 <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Point Point'
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square square_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Point Point' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-uniq_opp"><span class="command">lemma</span></span> uniq_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def
    <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm if_split_asm<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-uniq_zero"><span class="command">lemma</span></span> uniq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def eq_neg_iff_add_eq_0 add.assoc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> minus_add_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 x2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> y1 x2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y2 <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">a</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">27</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonsingular_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>›</span></span> ab
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonsingular_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ab <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonsingular_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-opp_add"><span class="command">lemma</span></span> opp_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Point <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> minus_equation_iff eq_commute<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-compat_add_opp"><span class="command">lemma</span></span> compat_add_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p</span> <span class="skolem">p</span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> opp <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> opp <span class="skolem">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_eq_0_iff<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Gen <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def eq_neg_iff_add_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-compat_add_triple"><span class="command">lemma</span></span> compat_add_triple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed <span class="main">[</span><span class="operator">OF</span> p p<span class="main">]</span> opp_closed <span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"opp <span class="free">p</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>›</span></span> uniq_opp <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Infinity <span class="main">=</span> add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>opp <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> opp <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> uniq_zero <span class="main">[</span><span class="operator">OF</span> ab p p<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹opp <span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">l'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xy
      <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xy<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
      add_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> add_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> p p<span class="main"><span class="main"><span class="main">]</span></span></span> opp_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> p<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span>
        <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>›</span></span><span class="main"><span class="main"><span class="main">]</span></span></span>
     <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> opp <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ab add_closed <span class="main">[</span><span class="operator">OF</span> p p<span class="main">]</span> opp_closed <span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_opp_double_opp"><span class="command">lemma</span></span> add_opp_double_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> False assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Gen <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span>
      <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span>
      <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> _ <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      add_closed <span class="main">[</span><span class="operator">OF</span>
        opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main"><span class="main">]</span></span> opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_Point Let_def <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_opp opp_closed<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> True<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> True add_opp<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> opp <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
            opp_add <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed opp_closed opp_opp add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compat_add_triple<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compat_add_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-cancel"><span class="command">lemma</span></span> cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> eq
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_casew<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InfR <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Infinity <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_casew<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InfR <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">∨</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∨</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">_</span><span class="main">∨</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∧</span> <span class="main">_</span> <span class="main">∨</span> <span class="main">_</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compat_add_opp<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        add_closed <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_opp_double_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_opp_double_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_minus_id"><span class="command">lemma</span></span> add_minus_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_opp_double_opp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_r<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compat_add_triple<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span>
      add_closed <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">,</span>
        <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      opp_closed <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      opp_closed <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      opp_opp <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span>
      Gen
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_r<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tan
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹opp <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point on_curve_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_shift_minus"><span class="command">lemma</span></span> add_shift_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> eq
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> add_minus_id <span class="main">[</span><span class="operator">OF</span> ab p<span class="hidden">⇩</span><sub>3</sub> opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">]</span> p<span class="hidden">⇩</span><sub>2</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> add_closed <span class="main">[</span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>3</sub> opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cancel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-degen_assoc"><span class="command">lemma</span></span> degen_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity<span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∨</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>3</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_minus_id<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> Infinity <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp add_minus_id add_0_r opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p<span class="hidden">⇩</span><sub>1</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_minus_id opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_opp opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> opp_add <span class="main">[</span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub><span class="main">]</span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p<span class="hidden">⇩</span><sub>1</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> opp_add <span class="main">[</span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main">]</span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_opp add_closed opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Infinity"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_minus_id add_opp opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-spec4_assoc"><span class="command">lemma</span></span> spec4_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> Infinity›</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> spec3_assoc<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def is_tangent_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ab add_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> True <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">with</span></span> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">with</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> Infinity›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> spec2_assoc<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def is_tangent_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-add_assoc"><span class="command">lemma</span></span> add_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>3</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">from</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cancel <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ab opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>3</sub><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc add_closed opp_closed<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main"><span class="main">]</span></span>
                        add_closed opp_closed add_minus_id<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> add_closed<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">case</span></span> False
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">with</span></span> ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cancel <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ab opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc add_closed opp_closed<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main"><span class="main">]</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">]</span></span>
                          add_closed opp_closed add_minus_id<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">case</span></span> False
                      <span class="keyword1"><span class="command">with</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
                        <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">≠</span> Infinity›</span></span>
                        <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
                        <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> spec1_assoc <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>3</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Elliptic_Axclass-add_comm'"><span class="command">lemma</span></span> add_comm'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⟹</span>
   add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_assoc add_comm<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> <span class="entity">point_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">point_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Infinity"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">point_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">point_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Axclass-point_mult_closed"><span class="command">lemma</span></span> point_mult_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-point_mult_add"><span class="command">lemma</span></span> point_mult_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> nonsingular <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   point_mult <span class="free">a</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_assoc point_mult_closed add_0_l<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-point_mult_mult"><span class="command">lemma</span></span> point_mult_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> nonsingular <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   point_mult <span class="free">a</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> point_mult <span class="free">a</span> <span class="free">n</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_mult_add<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-point_mult2_eq_double"><span class="command">lemma</span></span> point_mult2_eq_double<span class="main">:</span>
  <span class="quoted"><span class="quoted">"point_mult <span class="free">a</span> <span class="numeral">2</span> <span class="free">p</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 add_0_r<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Projective Coordinates›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> ppoint <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> ell_field <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pdouble</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pdouble</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span>
            <span class="bound">l</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">z</span><span class="main">;</span>
            <span class="bound">m</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> <span class="numeral">2</span>
          <span class="keyword1">in</span>
            <span class="main">(</span><span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">l</span><span class="main">)</span><span class="main">,</span>
             <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">-</span> <span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span>
             <span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">,</span>
             <span class="bound">l</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">padd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">padd</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span>
        <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span>
        <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span>
            <span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span>
            <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span>
            <span class="bound">l</span> <span class="main">=</span> <span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span>
            <span class="bound">m</span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span>
          <span class="keyword1">in</span>
            <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
              <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> pdouble <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>
            <span class="keyword1">else</span>
              <span class="keyword1">let</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">(</span><span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span>
              <span class="keyword1">in</span>
                <span class="main">(</span><span class="bound">l</span> <span class="main">*</span> <span class="bound">h</span><span class="main">,</span>
                 <span class="main">(</span><span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> <span class="bound">m</span> <span class="main">-</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span>
                 <span class="bound">l</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_affine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_affine</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Infinity <span class="keyword1">else</span> Point <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">/</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">on_curvep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">on_curvep</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span>
     <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Elliptic_Axclass-on_curvep_infinity"><span class="command">lemma</span></span> on_curvep_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-make_affine_infinity"><span class="command">lemma</span></span> make_affine_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-on_curvep_iff_on_curve"><span class="command">lemma</span></span> on_curvep_iff_on_curve<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">=</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def make_affine_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def make_affine_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> yz <span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def on_curvep_def make_affine_def False<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-pdouble_infinity"><span class="command">lemma</span></span> pdouble_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pdouble <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pdouble_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-padd_infinity_l"><span class="command">lemma</span></span> padd_infinity_l <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"padd <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-pdouble_correct"><span class="command">lemma</span></span> pdouble_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def pdouble_def make_affine_def eq_opp_is_zero Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-padd_correct"><span class="command">lemma</span></span> padd_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>make_affine <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>make_affine <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> p<span class="hidden">⇩</span><sub>1</sub>' <span class="main">=</span> fields
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
      yz<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">=</span>
        <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub>' <span class="keyword1"><span class="command">have</span></span>
      yz<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">=</span>
        <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def padd_def make_affine_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def padd_def make_affine_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> x
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> x'<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> True x <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> p<span class="hidden">⇩</span><sub>1</sub>' fields <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def pdouble_correct<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> yz<span class="hidden">⇩</span><sub>1</sub> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> yz<span class="hidden">⇩</span><sub>2</sub> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> x'<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">/</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">/</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>
              <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">/</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> TrueI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> False
            <span class="keyword1"><span class="command">have</span></span> y<span class="hidden">⇩</span><sub>2</sub>z<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_eq_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> x False <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def add_def make_affine_def Let_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> x'<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="hidden">⇩</span><sub>2</sub>z<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">/</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">/</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> notI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">ring</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def add_def make_affine_def Let_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-pdouble_closed"><span class="command">lemma</span></span> pdouble_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_iff_on_curve pdouble_correct add_closed<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-padd_closed"><span class="command">lemma</span></span> padd_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_iff_on_curve padd_correct add_closed<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> <span class="entity">ppoint_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> padd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Axclass-ppoint_mult_closed"><span class="command">lemma</span></span> ppoint_mult_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>ppoint_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_closed<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-ppoint_mult_correct"><span class="command">lemma</span></span> ppoint_mult_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span>
  make_affine <span class="main">(</span>ppoint_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> point_mult <span class="free">a</span> <span class="free">n</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_correct<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> ell_field <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj_eq</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Elliptic_Axclass-proj_eq_refl"><span class="command">lemma</span></span> proj_eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"proj_eq <span class="free">p</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-proj_eq_sym"><span class="command">lemma</span></span> proj_eq_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="free">p'</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-proj_eq_trans"><span class="command">lemma</span></span> proj_eq_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">in_carrierp</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">in_carrierp</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="free">in_carrierp</span> <span class="free">p''</span> <span class="main">⟹</span>
   proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="free">p'</span> <span class="free">p''</span> <span class="main">⟹</span> proj_eq <span class="free">p</span> <span class="free">p''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="skolem">z'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x''</span> <span class="skolem">y''</span> <span class="skolem">z''</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
        z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z''</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">*</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z''</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">*</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z''</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">*</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">x''</span> <span class="main">*</span> <span class="skolem">z'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">*</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">y''</span> <span class="main">*</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">*</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z''</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z''</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x''</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> xy<span class="main">)</span> <span class="main">(</span><span class="operator">ring</span> xy<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">*</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z''</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z''</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y''</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> xy<span class="main">)</span> <span class="main">(</span><span class="operator">ring</span> xy<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> z
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-make_affine_proj_eq_iff"><span class="command">lemma</span></span> make_affine_proj_eq_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">=</span> <span class="main">(</span>make_affine <span class="free">p</span> <span class="main">=</span> make_affine <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="skolem">z'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> xy<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> xy<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">/</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">/</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">/</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">/</span> <span class="skolem">z'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">/</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">/</span> <span class="skolem">z'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">/</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">/</span> <span class="skolem">z'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Axclass-pdouble_proj_eq_cong"><span class="command">lemma</span></span> pdouble_proj_eq_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_proj_eq_iff pdouble_correct<span class="main">)</span>

<span class="keyword1" id="Elliptic_Axclass-padd_proj_eq_cong"><span class="command">lemma</span></span> padd_proj_eq_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⟹</span>
   proj_eq <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⟹</span> proj_eq <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⟹</span> proj_eq <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_proj_eq_iff padd_correct<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Elliptic_Locale">
<div class="head">
<h1>Theory Elliptic_Locale</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formalization using Locales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Elliptic_Locale
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Reflective_Field.html">HOL-Decision_Procs.Reflective_Field</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Affine Coordinates›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> point <span class="main">=</span> Infinity <span class="main">|</span> Point <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword1"><span class="command">locale</span></span> ell_field <span class="main">=</span> field <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> two_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> two_not_zero <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">]</span>

<span class="keyword1" id="Elliptic_Locale-neg_equal_zero"><span class="command">lemma</span></span> neg_equal_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊕</span> <span class="main">⊖</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_2 l_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_neg integral_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> equal_neg_zero <span class="main">=</span> trans <span class="main">[</span><span class="operator">OF</span> eq_commute neg_equal_zero<span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nonsingular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonsingular</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">4</span><span class="main">»</span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">27</span><span class="main">»</span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">on_curve</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">on_curve</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> True
     <span class="main">|</span> Point <span class="bound">x</span> <span class="bound">y</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span>
         <span class="bound">y</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊗</span> <span class="bound">x</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
     <span class="main">|</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">of</span>
         Infinity <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
       <span class="main">|</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇒</span>
           <span class="keyword1">if</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span>
             <span class="keyword1">if</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span> Infinity
             <span class="keyword1">else</span>
               <span class="keyword1">let</span>
                 <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">;</span>
                 <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span>
               <span class="keyword1">in</span>
                 Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>
           <span class="keyword1">else</span>
             <span class="keyword1">let</span>
               <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">;</span>
               <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span>
             <span class="keyword1">in</span>
               Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">opp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">opp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> Infinity
     <span class="main">|</span> Point <span class="bound">x</span> <span class="bound">y</span> <span class="main">⇒</span> Point <span class="bound">x</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Locale-on_curve_infinity"><span class="command">lemma</span></span> on_curve_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-opp_Infinity"><span class="command">lemma</span></span> opp_Infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"opp Infinity <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-opp_Point"><span class="command">lemma</span></span> opp_Point<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>Point <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Point <span class="free">x</span> <span class="main">(</span><span class="main">⊖</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-opp_opp"><span class="command">lemma</span></span> opp_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> opp <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def on_curve_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-opp_closed"><span class="command">lemma</span></span> opp_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def opp_def power2_eq_square
    l_minus r_minus <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-curve_elt_opp"><span class="command">lemma</span></span> curve_elt_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_eq_iff power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_closed"><span class="command">lemma</span></span> add_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Point' <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> True' <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> True' Point Point'
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> Point' True'
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          on_curve1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> False True' Point Point' assms
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def nat_pow_zero<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">𝟬</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">with</span></span> False True' Point Point' assms
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def Let_def integral_iff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> on_curve1<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> Point'
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> on_curve1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Point
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> on_curve2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms not_sym <span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def Let_def False Point Point' eq_diff0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> on_curve1 on_curve2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">with</span></span> Point <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_case"><span class="command">lemma</span></span> add_case <span class="main">[</span><span class="operator">consumes</span> 4<span class="main">,</span> <span class="operator">case_names</span> InfL InfR Opp Tan Gen<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> Infinity <span class="bound">p</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> <span class="bound">p</span> Infinity <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> <span class="main">(</span>opp <span class="bound">p</span><span class="main">)</span> Infinity"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">l</span><span class="main">.</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span> <span class="main">⟹</span>
    <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
    <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">l</span><span class="main">.</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⟹</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span> <span class="free">q</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Point' <span class="main">=</span> this
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">with</span></span> Point <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def R2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> True' <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> p Point Point' True' R3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> True' p' q'<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0 integral_iff eq_diff0<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False True' Point Point' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R4<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Point Point' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R5<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_casew"><span class="command">lemma</span></span> add_casew <span class="main">[</span><span class="operator">consumes</span> 4<span class="main">,</span> <span class="operator">case_names</span> InfL InfR Opp Gen<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> Infinity <span class="bound">p</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">P</span> <span class="bound">p</span> Infinity <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> <span class="main">(</span>opp <span class="bound">p</span><span class="main">)</span> Infinity"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">l</span><span class="main">.</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⟹</span>
    <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
    <span class="bound">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span> <span class="free">q</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p q p q
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> R4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point equal_neg_zero on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_eq mult2 integral_iff a_assoc r_minus on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> R4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_tangent</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> Infinity <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> opp <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_generic</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> Infinity <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≠</span> Infinity <span class="main">∧</span>
      <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> opp <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Locale-spec1_assoc"><span class="command">lemma</span></span> spec1_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Tan
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Gen <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Point <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tan
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> Gen
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> InfL
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> InfR
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Tan
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>5</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">note</span></span> ps <span class="main">=</span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub> p<span class="hidden">⇩</span><sub>4</sub> p<span class="hidden">⇩</span><sub>5</sub>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2 y3<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
            not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
            not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2 y3<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
            not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
            not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-spec2_assoc"><span class="command">lemma</span></span> spec2_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangent <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tan
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tan
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Gen
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> InfL
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> InfR
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Tan
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y1 y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-spec3_assoc"><span class="command">lemma</span></span> spec3_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangent <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_generic <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_tangent <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tan
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Opp
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Tan
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> InfL
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> InfR
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_generic <span class="skolem">p</span> <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Tan
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">note</span></span> qs <span class="main">=</span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊖</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>7</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>7</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>7</sub></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub>'</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub>''</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ps qs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Gen
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Gen
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_tangent_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_0_l"><span class="command">lemma</span></span> add_0_l<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> Infinity <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-add_0_r"><span class="command">lemma</span></span> add_0_r<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> Infinity <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-add_opp"><span class="command">lemma</span></span> add_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> add <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def on_curve_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-add_comm"><span class="command">lemma</span></span> add_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Point' <span class="main">=</span> this
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l add_0_r<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> Point Point' <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> y1 y2 <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> Point Point'
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square square_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Point Point' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-uniq_opp"><span class="command">lemma</span></span> uniq_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def add_def opp_def Let_def
    <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm if_split_asm<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-uniq_zero"><span class="command">lemma</span></span> uniq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_neg minus_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neg_equal_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_div_def m_assoc eq_diff0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊕</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_eq minus_add a_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_neg equal_neg_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def nat_pow_zero eq_neg_iff_add_eq_0 a_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_2 l_distr minus_eq a_ac minus_add r_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 x2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> y1 x2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> not_sym <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> not_sym <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff eq_diff0<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y2 <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">«</span><span class="numeral">4</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">27</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> ab a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonsingular_def integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span> ab a b <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonsingular_def nat_pow_zero integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y1 <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> a b ab <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonsingular_def nat_pow_zero integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq_commute eq_neg_iff_add_eq_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-opp_add"><span class="command">lemma</span></span> opp_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Infinity
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Infinity
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Point <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def neg_equal_swap<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff nat_pow_zero
        trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq_commute eq_neg_iff_add_eq_0<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff nat_pow_zero
        trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq_commute eq_neg_iff_add_eq_0<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-compat_add_opp"><span class="command">lemma</span></span> compat_add_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p</span> <span class="skolem">p</span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> opp <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> opp <span class="skolem">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">4</span><span class="main">»</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Gen <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">«</span><span class="numeral">4</span><span class="main">»</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff opp_def eq_neg_iff_add_eq_0 mult2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-compat_add_triple"><span class="command">lemma</span></span> compat_add_triple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b add_closed <span class="main">[</span><span class="operator">OF</span> a b p p<span class="main">]</span> opp_closed <span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"opp <span class="free">p</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>›</span></span> uniq_opp <span class="main">[</span><span class="operator">OF</span> p <span class="quoted"><span class="quoted">‹Infinity <span class="main">=</span> add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> InfR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Opp
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"opp <span class="main">(</span>opp <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> opp <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> uniq_zero <span class="main">[</span><span class="operator">OF</span> a b ab p p<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> opp <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Tan
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> opp_closed <span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹opp <span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> p
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_def on_curve_def neg_equal_swap <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">l'</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊖</span> <span class="skolem">l'</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">⊖</span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> l' <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> a y2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neg_equal_zero neg_equal_swap integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xy
      <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xy eq_diff0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
      add_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a b add_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a b p p<span class="main"><span class="main"><span class="main">]</span></span></span> opp_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> p<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span>
        <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>›</span></span><span class="main"><span class="main"><span class="main">]</span></span></span>
     <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> opp <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> a b ab add_closed <span class="main">[</span><span class="operator">OF</span> a b p p<span class="main">]</span> opp_closed <span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_opp_double_opp"><span class="command">lemma</span></span> add_opp_double_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> False assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point integral_iff equal_neg_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Gen <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span>
      <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span>
      <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="hidden">⇩</span><sub>1</sub> y<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff neg_equal_swap<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span>
      <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff eq_diff0 neg_equal_swap<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> _ <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      add_closed <span class="main">[</span><span class="operator">OF</span> a b
        opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main"><span class="main">]</span></span> opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def opp_Point neg_equal_zero Let_def <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add opp_opp opp_closed<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> True<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> True add_opp<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> opp <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
            opp_add add_closed opp_closed opp_opp add_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compat_add_triple<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compat_add_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_add<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-cancel"><span class="command">lemma</span></span> cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> eq
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_casew<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InfL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InfR <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹Infinity <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> add_closed <span class="main">[</span><span class="operator">OF</span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">∨</span> <span class="main">_</span>›</span></span> a <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point equal_neg_zero integral_iff eq_diff0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_casew<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InfR <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">l'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∧</span> <span class="main">_</span> <span class="main">∨</span> <span class="main">_</span>›</span></span> a <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point equal_neg_zero integral_iff eq_diff0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">l'</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊖</span> <span class="main">(</span><span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l'</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq_commute eq_diff0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span> <span class="main">⊖</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">ring</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">∨</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff eq_diff0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">l'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq_commute eq_diff0<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">ring</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∨</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">_</span><span class="main">∨</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∧</span> <span class="main">_</span> <span class="main">∨</span> <span class="main">_</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subst<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">ring</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
            <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compat_add_opp<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span> <span class="main">[</span><span class="operator">simplified</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        add_closed <span class="main">[</span><span class="operator">OF</span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> curve_elt_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_opp_double_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_opp_double_opp<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_minus_id"><span class="command">lemma</span></span> add_minus_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_opp_double_opp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> InfL
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> InfR
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_r<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Opp
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tan <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point equal_neg_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compat_add_triple<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a b
      add_closed <span class="main">[</span><span class="operator">OF</span> a b <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">,</span>
        <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      opp_closed <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      opp_closed <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      opp_opp <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span>
      Gen
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> add_case<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> InfL
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> InfR
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_r<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Opp <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a b ab <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tan
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Gen <span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">l'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curve <span class="free">a</span> <span class="free">b</span> <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹opp <span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_Point on_curve_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Point <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="skolem">l'</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span> <span class="main">⊖</span> <span class="skolem">l'</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>6</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>4</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>5</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>4</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">[^]</span> <span class="numeral">2</span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊘</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> not_sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> not_sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> not_sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_shift_minus"><span class="command">lemma</span></span> add_shift_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> eq
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> add_minus_id <span class="main">[</span><span class="operator">OF</span> a b ab p<span class="hidden">⇩</span><sub>3</sub> opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">]</span> p<span class="hidden">⇩</span><sub>2</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>1</sub> add_closed <span class="main">[</span><span class="operator">OF</span> a b p<span class="hidden">⇩</span><sub>3</sub> opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cancel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-degen_assoc"><span class="command">lemma</span></span> degen_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity<span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">∨</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>3</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_minus_id<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> Infinity <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp add_minus_id add_0_r opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p<span class="hidden">⇩</span><sub>1</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_minus_id opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm opp_opp opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> opp_add <span class="main">[</span><span class="operator">OF</span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub><span class="main">]</span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p<span class="hidden">⇩</span><sub>1</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> opp_add <span class="main">[</span><span class="operator">OF</span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main">]</span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>opp <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm opp_opp add_closed opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Infinity"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_minus_id add_opp opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm opp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-spec4_assoc"><span class="command">lemma</span></span> spec4_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> Infinity›</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> spec3_assoc <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b<span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def is_tangent_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> uniq_zero <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b ab add_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> True <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniq_zero<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_0_l<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">with</span></span> a b p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">with</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> Infinity›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> spec2_assoc <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b<span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def is_tangent_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp <span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Elliptic_Locale-add_assoc"><span class="command">lemma</span></span> add_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> Infinity"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>3</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">from</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degen_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cancel <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b ab opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>3</sub><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc add_closed opp_closed<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>"</span></span><span class="main"><span class="main">]</span></span>
                        add_closed opp_closed add_minus_id<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm add_closed<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">case</span></span> False
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">with</span></span> a b ab p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cancel <span class="main"><span class="main">[</span></span><span class="operator">OF</span> a b ab opp_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec4_assoc add_closed opp_closed<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main"><span class="main">]</span></span> add_comm <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">]</span></span>
                          add_closed opp_closed add_minus_id<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">case</span></span> False
                      <span class="keyword1"><span class="command">with</span></span> a b p<span class="hidden">⇩</span><sub>1</sub> p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub>
                        <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> Infinity›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">≠</span> Infinity›</span></span>
                        <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
                        <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> spec1_assoc <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_generic_def<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">=</span></span> opp <span class="free"><span class="free">p<span class="hidden">⇩</span><sub>3</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uniq_opp<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹opp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_opp <span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_closed <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a b p<span class="hidden">⇩</span><sub>2</sub> p<span class="hidden">⇩</span><sub>3</sub><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Elliptic_Locale-add_comm'"><span class="command">lemma</span></span> add_comm'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> nonsingular <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⟹</span>
   add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>add <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_assoc add_comm<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">point_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> point <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">point_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Infinity"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">point_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">point_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Locale-point_mult_closed"><span class="command">lemma</span></span> point_mult_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span>
  on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-point_mult_add"><span class="command">lemma</span></span> point_mult_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> nonsingular <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   point_mult <span class="free">a</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_assoc point_mult_closed add_0_l<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-point_mult_mult"><span class="command">lemma</span></span> point_mult_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> nonsingular <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   point_mult <span class="free">a</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> point_mult <span class="free">a</span> <span class="free">n</span> <span class="main">(</span>point_mult <span class="free">a</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_mult_add<span class="main">)</span>

<span class="keyword1" id="Elliptic_Locale-point_mult2_eq_double"><span class="command">lemma</span></span> point_mult2_eq_double<span class="main">:</span>
  <span class="quoted"><span class="quoted">"point_mult <span class="free">a</span> <span class="numeral">2</span> <span class="free">p</span> <span class="main">=</span> add <span class="free">a</span> <span class="free">p</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 add_0_r<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Projective Coordinates›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> ppoint <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> <span class="entity">pdouble</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pdouble</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span>
            <span class="bound">l</span> <span class="main">=</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">y</span> <span class="main">⊗</span> <span class="bound">z</span><span class="main">;</span>
            <span class="bound">m</span> <span class="main">=</span> <span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊗</span> <span class="bound">z</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>
          <span class="keyword1">in</span>
            <span class="main">(</span><span class="bound">l</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">m</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="main">«</span><span class="numeral">4</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x</span> <span class="main">⊗</span> <span class="bound">y</span> <span class="main">⊗</span> <span class="bound">l</span><span class="main">)</span><span class="main">,</span>
             <span class="bound">m</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">«</span><span class="numeral">6</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">x</span> <span class="main">⊗</span> <span class="bound">y</span> <span class="main">⊗</span> <span class="bound">l</span> <span class="main">⊖</span> <span class="bound">m</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">⊖</span>
             <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">⊗</span> <span class="bound">y</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">,</span>
             <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> <span class="entity">padd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">padd</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span>
        <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span>
        <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">𝟬</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span>
            <span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span>
            <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span>
            <span class="bound">l</span> <span class="main">=</span> <span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span>
            <span class="bound">m</span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span>
          <span class="keyword1">in</span>
            <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="keyword1">then</span>
              <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="keyword1">then</span> pdouble <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span>
            <span class="keyword1">else</span>
              <span class="keyword1">let</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊖</span> <span class="main">(</span><span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊕</span> <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊗</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>
              <span class="keyword1">in</span>
                <span class="main">(</span><span class="bound">l</span> <span class="main">⊗</span> <span class="bound">h</span><span class="main">,</span>
                 <span class="main">(</span><span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊖</span> <span class="bound">h</span><span class="main">)</span> <span class="main">⊗</span> <span class="bound">m</span> <span class="main">⊖</span> <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span>
                 <span class="bound">l</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> field<span class="main">)</span> <span class="entity">make_affine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_affine</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="keyword1">then</span> Infinity <span class="keyword1">else</span> Point <span class="main">(</span><span class="bound">x</span> <span class="main">⊘</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊘</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> <span class="entity">in_carrierp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppoint <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">in_carrierp</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> <span class="entity">on_curvep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">on_curvep</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span>
     <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span>
     <span class="main">(</span><span class="bound">z</span> <span class="main">≠</span> <span class="main">𝟬</span> <span class="main">⟶</span>
      <span class="bound">y</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊗</span> <span class="bound">x</span> <span class="main">⊗</span> <span class="bound">z</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊗</span> <span class="bound">z</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> on_curvep_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> field<span class="main">)</span> make_affine_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> on_curvep_imp_in_carrierp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> in_carrierp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def in_carrierp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> on_curvep_iff_on_curve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"in_carrierp <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">=</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">𝟬</span> <span class="main">⟹</span>
        <span class="skolem">y</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def make_affine_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def make_affine_def carrier<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> yz <span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹in_carrierp <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def in_carrierp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹in_carrierp <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def on_curvep_def make_affine_def carrier False<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> pdouble_in_carrierp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> in_carrierp <span class="free">p</span> <span class="main">⟹</span> in_carrierp <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def pdouble_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> padd_in_carrierp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> in_carrierp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> in_carrierp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> in_carrierp <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def Let_def pdouble_in_carrierp <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> pdouble_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pdouble <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pdouble_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> padd_infinity_l <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"padd <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> pdouble_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> in_carrierp <span class="free">p</span> <span class="main">⟹</span>
   make_affine <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def pdouble_def make_affine_def equal_neg_zero divide_eq_0_iff
      integral_iff Let_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> minus_divide_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> padd_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> add <span class="free">a</span> <span class="main">(</span>make_affine <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span>make_affine <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p<span class="hidden">⇩</span><sub>1</sub>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> p<span class="hidden">⇩</span><sub>1</sub>' <span class="main">=</span> fields
  <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      yz<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span> <span class="main">⟹</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p<span class="hidden">⇩</span><sub>1</sub>' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      yz<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span> <span class="main">⟹</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊗</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def padd_def make_affine_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def padd_def make_affine_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊖</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_diff0<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> x
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> x'<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> True x <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> p<span class="hidden">⇩</span><sub>1</sub>' fields a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def pdouble_correct<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>
              <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> yz<span class="hidden">⇩</span><sub>1</sub> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main"><span class="main">]</span></span> yz<span class="hidden">⇩</span><sub>2</sub> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main"><span class="main">]</span></span> x'<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊘</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊘</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>
              <span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[^]</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⊘</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊘</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> TrueI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> False
            <span class="keyword1"><span class="command">have</span></span> y<span class="hidden">⇩</span><sub>2</sub>z<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊖</span> <span class="main">(</span><span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_eq_iff eq_diff0
                <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> x False <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def add_def make_affine_def Let_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> x'<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> y<span class="hidden">⇩</span><sub>2</sub>z<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊘</span> <span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊘</span> <span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> notI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">ring</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier <span class="free">R</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_def add_def make_affine_def Let_def integral_iff<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_iff<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> pdouble_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_carrierp <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_iff_on_curve pdouble_in_carrierp pdouble_correct
      add_closed <span class="quoted"><span class="quoted">‹in_carrierp <span class="free">p</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> padd_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_carrierp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_carrierp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_iff_on_curve padd_in_carrierp padd_correct
      add_closed <span class="quoted"><span class="quoted">‹in_carrierp <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹in_carrierp <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> <span class="entity">ppoint_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> padd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> ppoint_mult_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>ppoint_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> ppoint_mult_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">⟹</span>
  make_affine <span class="main">(</span>ppoint_mult <span class="free">a</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> point_mult <span class="free">a</span> <span class="free">n</span> <span class="main">(</span>make_affine <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_correct<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> <span class="entity">proj_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppoint <span class="main">⇒</span> <span class="tfree">'a</span> ppoint <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj_eq</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊗</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> proj_eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"proj_eq <span class="free">p</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> proj_eq_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="free">p'</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> domain<span class="main">)</span> proj_eq_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_carrierp <span class="free">p</span> <span class="main">⟹</span> in_carrierp <span class="free">p'</span> <span class="main">⟹</span> in_carrierp <span class="free">p''</span> <span class="main">⟹</span>
   proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="free">p'</span> <span class="free">p''</span> <span class="main">⟹</span> proj_eq <span class="free">p</span> <span class="free">p''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="skolem">z'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x''</span> <span class="skolem">y''</span> <span class="skolem">z''</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> carrier<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y''</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z''</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z''</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">⊗</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">z''</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">⊗</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">z''</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">⊗</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">x''</span> <span class="main">⊗</span> <span class="skolem">z'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">⊗</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">y''</span> <span class="main">⊗</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def proj_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">⊗</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">z''</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z''</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x''</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> xy<span class="main">)</span> <span class="main">(</span><span class="operator">ring</span> xy<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">⊗</span> <span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">⊗</span> <span class="skolem">z''</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z''</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y''</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">ring</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span> xy<span class="main">)</span> <span class="main">(</span><span class="operator">ring</span> xy<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> z
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def carrier conc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> field<span class="main">)</span> make_affine_proj_eq_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_carrierp <span class="free">p</span> <span class="main">⟹</span> in_carrierp <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">=</span> <span class="main">(</span>make_affine <span class="free">p</span> <span class="main">=</span> make_affine <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="skolem">z'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> carrier<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">⊗</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">⊗</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> xy<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> xy<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"make_affine <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span> <span class="skolem">y'</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> True carrier <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊘</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">⊘</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊘</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">⊘</span> <span class="skolem">z'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⊘</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">⊘</span> <span class="skolem">z'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">x'</span> <span class="main">⊗</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">⊘</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">⊘</span> <span class="skolem">z'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">⊗</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">field</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">prems</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">field</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_eq_def <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">𝟬</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> pdouble_proj_eq_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> in_carrierp <span class="free">p</span> <span class="main">⟹</span> in_carrierp <span class="free">p'</span> <span class="main">⟹</span> proj_eq <span class="free">p</span> <span class="free">p'</span> <span class="main">⟹</span>
   proj_eq <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>pdouble <span class="free">a</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_proj_eq_iff pdouble_in_carrierp pdouble_correct<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ell_field<span class="main">)</span> padd_proj_eq_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⟹</span>
   on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⟹</span> proj_eq <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⟹</span> proj_eq <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⟹</span>
   proj_eq <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_proj_eq_iff padd_in_carrierp padd_correct<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Elliptic_Test">
<div class="head">
<h1>Theory Elliptic_Test</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Validating the Specification›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Elliptic_Test
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Elliptic_Locale.html">Elliptic_Locale</a>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Residues.html">HOL-Number_Theory.Residues</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Specialized Definitions for Prime Fields›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> int"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">**</span>ı"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">**</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">madd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> int"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">++</span>ı"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">++</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">msub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> int"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">--</span>ı"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">--</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mpow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> nat <span class="main">⇒</span> int"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">^^^</span>ı"</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">^^^</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues<span class="main">)</span> res_of_natural_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">n</span><span class="main">»<span class="hidden">⇩</span><sub>ℕ</sub></span> <span class="main">=</span> int <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_natural_def res_zero_eq res_one_eq res_add_eq mod_add_right_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues<span class="main">)</span> res_of_integer_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">i</span><span class="main">»</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_integer_def res_of_natural_eq res_neg_eq mod_minus_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues<span class="main">)</span> res_pow_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> m_gt_one
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> res_one_eq res_mult_eq mult_ac mod_mult_right_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues<span class="main">)</span> res_sub_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_eq res_neg_eq res_add_eq mod_minus_eq mod_add_eq mod_diff_eq<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mpdouble</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int ppoint <span class="main">⇒</span> int ppoint"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mpdouble</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span>
            <span class="bound">l</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z</span><span class="main">;</span>
            <span class="bound">n</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span> <span class="main">++</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span>
          <span class="keyword1">in</span>
            <span class="main">(</span><span class="bound">l</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">n</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">4</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">l</span><span class="main">)</span><span class="main">,</span>
             <span class="bound">n</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="numeral">6</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">l</span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">n</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span>
             <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">l</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span><span class="main">,</span>
             <span class="bound">l</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mpadd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int ppoint <span class="main">⇒</span> int ppoint <span class="main">⇒</span> int ppoint"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mpadd</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span>
        <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span>
        <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>2</sub></span></span></span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span>
            <span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span>
            <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span>
            <span class="bound">l</span> <span class="main">=</span> <span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span>
            <span class="bound">n</span> <span class="main">=</span> <span class="bound">y<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span>
          <span class="keyword1">in</span>
            <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
              <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> mpdouble <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p<span class="hidden">⇩</span><sub>1</sub></span></span></span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>
            <span class="keyword1">else</span>
              <span class="keyword1">let</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">++</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">l</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span>
              <span class="keyword1">in</span>
                <span class="main">(</span><span class="bound">l</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">h</span><span class="main">,</span>
                 <span class="main">(</span><span class="bound">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">l</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">h</span><span class="main">)</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">n</span> <span class="main">--</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">l</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">3</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span>
                 <span class="bound">l</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">3</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">z<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues<span class="main">)</span> pdouble_residue_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"pdouble <span class="free">a</span> <span class="free">p</span> <span class="main">=</span> mpdouble <span class="free">m</span> <span class="free">a</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pdouble_def mpdouble_def
    madd_def mmult_def msub_def mpow_def res_zero_eq res_add_eq res_mult_eq res_of_integer_eq
    res_pow_eq res_sub_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues<span class="main">)</span> padd_residue_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"padd <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> mpadd <span class="free">m</span> <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> padd_def mpadd_def pdouble_residue_eq
    madd_def mmult_def msub_def mpow_def res_zero_eq res_add_eq res_mult_eq res_of_integer_eq
    res_pow_eq res_sub_eq Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fast_ppoint_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> nat <span class="main">⇒</span> int ppoint <span class="main">⇒</span> int ppoint"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fast_ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> mpdouble <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">fast_ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> mpadd <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>mpdouble <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">fast_ppoint_mult</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Elliptic_Test-fast_ppoint_mult_0"><span class="command">lemma</span></span> fast_ppoint_mult_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fast_ppoint_mult <span class="free">m</span> <span class="free">a</span> <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Elliptic_Test-fast_ppoint_mult_even"><span class="command">lemma</span></span> fast_ppoint_mult_even <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
   fast_ppoint_mult <span class="free">m</span> <span class="free">a</span> <span class="free">n</span> <span class="free">p</span> <span class="main">=</span> mpdouble <span class="free">m</span> <span class="free">a</span> <span class="main">(</span>fast_ppoint_mult <span class="free">m</span> <span class="free">a</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Elliptic_Test-fast_ppoint_mult_odd"><span class="command">lemma</span></span> fast_ppoint_mult_odd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
   fast_ppoint_mult <span class="free">m</span> <span class="free">a</span> <span class="free">n</span> <span class="free">p</span> <span class="main">=</span> mpadd <span class="free">m</span> <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>mpdouble <span class="free">m</span> <span class="free">a</span> <span class="main">(</span>fast_ppoint_mult <span class="free">m</span> <span class="free">a</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">declare</span></span> fast_ppoint_mult.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> residues_prime_gt2 <span class="main">=</span> residues_prime <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> residues_prime_gt2 <span class="main">&lt;</span> ell_field
  <span class="keyword1"><span class="command">using</span></span> gt2
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> res_of_integer_eq res_zero_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues_prime_gt2<span class="main">)</span> fast_ppoint_mult_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>fast_ppoint_mult <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="free">n</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"int <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fast_ppoint_mult.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">n</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m_gt_one
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curvep_infinity <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> res_zero_eq<span class="main"><span class="main">]</span></span> res_carrier_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_residue_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> pdouble_residue_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
          padd_closed pdouble_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues_prime_gt2<span class="main">)</span> point_mult_residue_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"on_curvep <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"nonsingular <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proj_eq <span class="main">(</span>ppoint_mult <span class="free">a</span> <span class="free">n</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>fast_ppoint_mult <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="free">n</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"point_mult <span class="free">a</span> <span class="free">n</span> <span class="main">(</span>make_affine <span class="free">q</span><span class="main">)</span> <span class="main">=</span> make_affine <span class="main">(</span>fast_ppoint_mult <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="free">n</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"int <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fast_ppoint_mult.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">n</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_infinity <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> res_zero_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"point_mult <span class="skolem">a</span> <span class="skolem">n</span> <span class="main">(</span>make_affine <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span>
        point_mult <span class="skolem">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>make_affine <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> add <span class="skolem">a</span> <span class="main">(</span>point_mult <span class="skolem">a</span> <span class="numeral">2</span> <span class="main">(</span>point_mult <span class="skolem">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>make_affine <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>point_mult <span class="skolem">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>make_affine <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> point_mult_mult point_mult_add
          on_curvep_iff_on_curve <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> on_curvep_imp_in_carrierp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> make_affine <span class="main">(</span>fast_ppoint_mult <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">n</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> padd_residue_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> pdouble_residue_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add_0_r
             padd_correct pdouble_correct
             fast_ppoint_mult_closed on_curvep_imp_in_carrierp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span>
             point_mult2_eq_double pdouble_closed
             add_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add_comm add_comm' on_curvep_iff_on_curve <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_proj_eq_iff fast_ppoint_mult_closed
      ppoint_mult_correct on_curvep_imp_in_carrierp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mmake_affine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int ppoint <span class="main">⇒</span> int point"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mmake_affine</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Infinity <span class="keyword1">else</span>
        <span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> bezout_coefficients <span class="bound">z</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>
        <span class="keyword1">in</span> Point <span class="main">(</span><span class="bound">a</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">q</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">q</span></span></span></sub><span class="hidden">⇙</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues_prime<span class="main">)</span> make_affine_residue_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"in_carrierp <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"make_affine <span class="free">q</span> <span class="main">=</span> mmake_affine <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> fields <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def mmake_affine_def res_zero_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bezout_coefficients <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> fields False assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> int <span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_carrierp_def res_carrier_eq prime_imp_coprime zdvd_not_zless<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> p_prime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_imp_coprime<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>bezout_coefficients <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">+</span>
        snd <span class="main">(</span>bezout_coefficients <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> int <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bezout_coefficients_fst_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> m_gt_one <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>bezout_coefficients <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="keyword1">mod</span> int <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arg_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> int <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊗</span> <span class="main">(</span>fst <span class="main">(</span>bezout_coefficients <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> res_mult_eq res_one_eq mult.commute mod_mult_right_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> fields assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">z</span> <span class="main">=</span> fst <span class="main">(</span>bezout_coefficients <span class="skolem">z</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_unique in_carrierp_def res_carrier_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> fields Pair False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_affine_def mmake_affine_def res_zero_eq m_div_def
          res_mult_eq mmult_def mod_mult_right_eq mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mon_curve</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> int point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mon_curve</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
       Infinity <span class="main">⇒</span> True
     <span class="main">|</span> Point <span class="bound">x</span> <span class="bound">y</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span>
         <span class="bound">y</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">2</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">^^^</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="numeral">3</span> <span class="main">++</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">**</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="main">++</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">m</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residues_prime_gt2<span class="main">)</span> on_curve_residues_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"on_curve <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">=</span> mon_curve <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> on_curve_def mon_curve_def res_carrier_eq res_add_eq res_mult_eq res_pow_eq
    madd_def mmult_def mpow_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> point.split<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The NIST Curve P-521›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following test data is taken from RFC 5903 \cite{RFC5903}, \S 3.3 and \S 8.3.
The curve parameters can also be found in \S D.1.2.5 of FIPS PUB 186-4 \cite{FIPS186-4}.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">m</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="numeral">0x01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> m <span class="main">-</span> <span class="numeral">3</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">b</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">0x0051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gx</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gx</span> <span class="main">=</span> <span class="numeral">0x00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gy</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gy</span> <span class="main">=</span> <span class="numeral">0x011839296A789A3BC0045C8A5FB42C7D1BD998F54449579B446817AFBD17273E662C97EE72995EF42640C550B9013FAD0761353C7086A272C24088BE94769FD16650</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">priv</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">priv</span> <span class="main">=</span> <span class="numeral">0x0037ADE9319A89F4DABDB3EF411AACCCA5123C61ACAB57B5393DCE47608172A095AA85A30FE1C2952C6771D937BA9777F5957B2639BAB072462F68C27A57382D4A52</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pubx</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pubx</span> <span class="main">=</span> <span class="numeral">0x0015417E84DBF28C0AD3C278713349DC7DF153C897A1891BD98BAB4357C9ECBEE1E3BF42E00B8E380AEAE57C2D107564941885942AF5A7F4601723C4195D176CED3E</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">puby</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">puby</span> <span class="main">=</span> <span class="numeral">0x017CAE20B6641D2EEB695786D8C946146239D099E18E1D5A514C739D7CB4A10AD8A788015AC405D7799DC75E7B7D5B6CF2261A6A7F1507438BF01BEB6CA3926F9582</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">order</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">order</span> <span class="main">=</span> <span class="numeral">0x01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"mon_curve m a b <span class="main">(</span>Point gx gy<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"mmake_affine m <span class="main">(</span>fast_ppoint_mult m a priv <span class="main">(</span>gx<span class="main">,</span> gy<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Point pubx puby"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"mmake_affine m <span class="main">(</span>fast_ppoint_mult m a order <span class="main">(</span>gx<span class="main">,</span> gy<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>