<div id="Social_Choice_Functions">
<div class="head"><h1>Theory Social_Choice_Functions</h1>
<span class="command">theory</span> <span class="name">Social_Choice_Functions</span><br/>
<span class="keyword">imports</span> <a href="Preference_Profile_Cmd.html"><span class="name">Preference_Profile_Cmd</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*  
  Title:    Social_Choice_Functions.thy
  Author:   Manuel Eberl, TU München

  Definitions of Social Choice Functions, their properties, and related concepts
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Social Choice Functions›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Social_Choice_Functions</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"Randomised_Social_Choice.Preference_Profile_Cmd"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Weighted majority graphs›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>supporters</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('agent, 'alt) pref_profile ⇒ 'alt ⇒ 'alt ⇒ 'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>supporters_auxdef</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"supporters R x y = {i. x ≽[R i] y}"</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>weighted_majority</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('agent, 'alt) pref_profile ⇒ 'alt ⇒ 'alt ⇒ int"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R x y = int (card (supporters R x y)) - int (card (supporters R y x))"</span></span></span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>weighted_majority_refl</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R x x = 0"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>weighted_majority_def</span><span class="delimiter">)</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>weighted_majority_swap</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R x y = -weighted_majority R y x"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>weighted_majority_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eval_set_filter</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"Set.filter P {} = {}"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"P x ⟹ Set.filter P (insert x A) = insert x (Set.filter P A)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"¬P x ⟹ Set.filter P (insert x A) = Set.filter P A"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Set.filter_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">context</span></span><span> </span><span>election</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supporters_def</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"supporters R x y = {i∈agents. x ≽[R i] y}"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_outside</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>supporters_auxdef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supporters_nonagent1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∉ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"supporters R x y = {}"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>supporters_def</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>not_outside</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>supporters_nonagent2</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∉ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"supporters R x y = {}"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>supporters_def</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>not_outside</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>weighted_majority_nonagent1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∉ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R x y = 0"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>weighted_majority_def</span><span> </span><span>supporters_nonagent1</span><span> </span><span>supporters_nonagent2</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>weighted_majority_nonagent2</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∉ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R x y = 0"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>weighted_majority_def</span><span> </span><span>supporters_nonagent1</span><span> </span><span>supporters_nonagent2</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>weighted_majority_eq_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R2"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R1 = weighted_majority R2 ⟷
             (∀x∈alts. ∀y∈alts. weighted_majority R1 x y = weighted_majority R2 x y)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>iffI</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">'alt</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∀x∈alts. ∀y∈alts. weighted_majority R1 x y = weighted_majority R2 x y"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"weighted_majority R1 x y = weighted_majority R2 x y"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts"</span></span></span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∈ alts"</span></span></span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>fun_eq_iff</span><span> </span><span>weighted_majority_nonagent1</span><span> </span><span>weighted_majority_nonagent2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Definition of Social Choice Functions›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>social_choice_function</span><span> </span><span class="delimiter">=</span><span> </span><span>election</span><span> </span><span>agents</span><span> </span><span>alts</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('agent, 'alt) pref_profile ⇒ 'alt set"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>scf_nonempty</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R ⟹ scf R ≠ {}"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>scf_alts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R ⟹ scf R ⊆ alts"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Anonymity›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  An SCF is anonymous if permuting the agents in the input does not change the result.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>anonymous_scf</span><span> </span><span class="delimiter">=</span><span> </span><span>social_choice_function</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>anonymous</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"π permutes agents ⟹ is_pref_profile R ⟹ scf (R ∘ π) = scf R"</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anonymous'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"anonymous_profile R1 = anonymous_profile R2"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R2"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"scf R1 = scf R2"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>anonymous_profile_agent_permutation</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span> </span><span>finite_agents</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>π</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"π permutes agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R1 = R2 ∘ π"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>anonymous</span><span class="delimiter">[</span><span>of</span><span> </span><span>π</span><span> </span><span>R2</span><span class="delimiter">]</span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anonymity_prefs_from_table</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"prefs_from_table_wf agents alts xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"prefs_from_table_wf agents alts ys"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"mset (map snd xs) = mset (map snd ys)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"scf (prefs_from_table xs) = scf (prefs_from_table ys)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>prefs_from_table_agent_permutation</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span><span> </span><span>π</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>anonymous</span><span class="delimiter">[</span><span>of</span><span> </span><span>π</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"prefs_from_table xs"</span></span></span><span class="delimiter">]</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>pref_profile_from_tableI</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword2"><span class="keyword">qualified</span></span><span> </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anonymity_prefs_from_table_aux</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R1 = prefs_from_table xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"prefs_from_table_wf agents alts xs"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R2 = prefs_from_table ys"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"prefs_from_table_wf agents alts ys"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"mset (map snd xs) = mset (map snd ys)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"scf R1 = scf R2"</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>anonymity_prefs_from_table</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>mset_map</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Neutrality›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  An SCF is neutral if permuting the alternatives in the input does not change the
  result, modulo the equivalent permutation in the output lottery.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>neutral_scf</span><span> </span><span class="delimiter">=</span><span> </span><span>social_choice_function</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>neutral</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts ⟹ is_pref_profile R ⟹ 
                        scf (permute_profile σ R) = σ ` scf R"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  Alternative formulation of neutrality that shows that our definition is 
  equivalent to that in the paper.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>neutral'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∈ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"σ a ∈ scf (permute_profile σ R) ⟷ a ∈ scf R"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>*</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x = y"</span></span></span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ x = σ y"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>permutes_inj</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>injD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>neutral</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>*</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>an_scf</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>anonymous_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span> </span><span>neutral_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>scf_anonymous_neutral</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>perm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R2"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"anonymous_profile R1 = 
                 image_mset (map (λA. σ ` A)) (anonymous_profile R2)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"scf R1 = σ ` scf R2"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R1</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R2</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>perm</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>wf'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile (permute_profile σ R2)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>R2.wf_permute_alts</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>eq</span><span> </span><span>perm</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"anonymous_profile R1 = anonymous_profile (permute_profile σ R2)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R2.anonymous_profile_permute</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>anonymous_profile_agent_permutation</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span> </span><span>wf</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>wf'</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>π</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"π permutes agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"permute_profile σ R2 ∘ π = R1"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"scf (permute_profile σ R2 ∘ π) = scf (permute_profile σ R2)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>anonymous</span><span class="delimiter">)</span><span> </span><span>fact</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"… = σ ` scf R2"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>neutral</span><span class="delimiter">)</span><span> </span><span>fact</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"permute_profile σ R2 ∘ π = R1"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>scf_anonymous_neutral'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>perm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R2"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"anonymous_profile R1 = 
                 image_mset (map (λA. σ ` A)) (anonymous_profile R2)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"σ x ∈ scf R1 ⟷ x ∈ scf R2"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"scf R1 = σ ` scf R2"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>scf_anonymous_neutral</span><span class="delimiter">)</span><span> </span><span>fact</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ x ∈ … ⟷ x ∈ scf R2"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>blast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>injD</span><span class="delimiter">[</span><span>OF</span><span> </span><span>permutes_inj</span><span class="delimiter">[</span><span>OF</span><span> </span><span>perm</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>scf_automorphism</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>perm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"image_mset (map (λA. σ ` A)) (anonymous_profile R) = anonymous_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"σ ` scf R = scf R"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>scf_anonymous_neutral</span><span class="delimiter">[</span><span>OF</span><span> </span><span>perm</span><span> </span><span>wf</span><span> </span><span>wf</span><span> </span><span>eq</span><span> </span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>an_scf_automorphism_aux</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"prefs_from_table_wf agents alts yss"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R ≡ prefs_from_table yss"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>an</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"an_scf agents alts scf"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"mset (map ((map (λA. permutation_of_list xs ` A)) ∘ snd) yss) = mset (map snd yss)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>perm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"set (map fst xs) ⊆ alts"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"set (map snd xs) = set (map fst xs)"</span></span></span><span> 
</span><span>                </span><span class="string"><span class="delete"><span class="delete">"distinct (map fst xs)"</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y = permutation_of_list xs x"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"x ∈ scf R ⟷ y ∈ scf R"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>perm</span><span> </span><span class="delimiter">=</span><span> </span><span>list_permutesI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>perm</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?σ</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"permutation_of_list xs"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>perm'</span><span> </span><span class="delimiter">=</span><span> </span><span>permutation_of_list_permutes</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>perm</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>wf</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>wf'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents alts R"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>pref_profile_from_tableI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>perm'</span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R'</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span class="string"><span class="delete"><span class="delete">"permute_profile ?σ R"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R.wf_permute_alts</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>an</span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>an_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>eq</span><span> </span><span>wf</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"image_mset (map (λA. ?σ ` A)) (anonymous_profile R) = anonymous_profile R"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>anonymise_prefs_from_table</span><span> </span><span>mset_map</span><span> </span><span>multiset.map_comp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ scf R ⟷ ?σ x ∈ ?σ ` scf R"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>blast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>injD</span><span class="delimiter">[</span><span>OF</span><span> </span><span>permutes_inj</span><span class="delimiter">[</span><span>OF</span><span> </span><span>perm'</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>eq'</span><span> </span><span>x</span><span> </span><span>wf'</span><span> </span><span>perm'</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?σ ` scf R = scf R"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>scf_automorphism</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R.anonymous_profile_permute</span><span> </span><span>pref_profile_from_tableI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>x</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Weighted-majoritarian SCFs›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>pairwise_scf</span><span> </span><span class="delimiter">=</span><span> </span><span>social_choice_function</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>pairwise</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1 ⟹ is_pref_profile R2 ⟹ weighted_majority R1 = weighted_majority R2 ⟹
       scf R1 = scf R2"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Pareto efficiency›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>pareto_efficient_scf</span><span> </span><span class="delimiter">=</span><span> </span><span>social_choice_function</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>pareto_efficient</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R ⟹ scf R ∩ pareto_losers R = {}"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pareto_efficient'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ≻[Pareto(R)] x"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"x ∉ scf R"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pareto_efficient</span><span class="delimiter">[</span><span>of</span><span> </span><span>R</span><span class="delimiter">]</span><span> </span><span>assms</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pareto_losers_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pareto_efficient''</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span>  </span><span class="string"><span class="delete"><span class="delete">"∀i∈agents. y ≽[R i] x"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬y ≼[R i] x"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"x ∉ scf R"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>2</span><span>-</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>pareto_efficient'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>_</span><span> </span><span>y</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Pareto_iff</span><span> </span><span>strongly_preferred_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Set extensions›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="tfree">'alt</span><span> </span><span>set_extension</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt relation ⇒ 'alt set relation"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Kelly</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set_extension"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"A ≽[Kelly(R)] B ⟷ (∀a∈A. ∀b∈B. a ≽[R] b)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Kelly_strict_iff</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"A ≻[Kelly(R)] B ⟷ ((∀a∈A. ∀b∈B. R b a) ∧ ¬ (∀a∈B. ∀b∈A. R b a))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>strongly_preferred_def</span><span> </span><span>Kelly_def</span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>Kelly_eval</span><span> </span><span class="delimiter">=</span><span> </span><span>Kelly_def</span><span> </span><span>Kelly_strict_iff</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Fishb</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set_extension"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"A ≽[Fishb(R)] B ⟷ (∀a∈A. ∀b∈B-A. a ≽[R] b) ∧ (∀a∈A-B. ∀b∈B. a ≽[R] b)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Fishb_strict_iff</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"A ≻[Fishb(R)] B ⟷ 
     ((∀a∈A. ∀b∈B - A. R b a) ∧ (∀a∈A - B. ∀b∈B. R b a)) ∧
     ¬ ((∀a∈B. ∀b∈A - B. R b a) ∧ (∀a∈B - A. ∀b∈A. R b a))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>strongly_preferred_def</span><span> </span><span>Fishb_def</span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>Fishb_eval</span><span> </span><span class="delimiter">=</span><span> </span><span>Fishb_def</span><span> </span><span>Fishb_strict_iff</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Strategyproofness›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>strategyproof_scf</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>social_choice_function</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>set_ext</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set_extension"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>strategyproof</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R ⟹ total_preorder_on alts Ri' ⟹ i ∈ agents ⟹
       ¬ scf (R(i := Ri')) ≻[set_ext(R i)] scf R"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>strategyproof_anonymous_scf</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>anonymous_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span> </span><span>strategyproof_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>set_ext</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set_ext</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>strategyproof'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R2"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"j ∈ agents"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"anonymous_profile R2 = anonymous_profile R1 - 
             {#weak_ranking (R1 i)#} + {#weak_ranking (R2 j)#}"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"¬scf R2 ≻[set_ext (R1 i)] scf R1"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?R3</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"R1(i := R2 j)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R1</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R2</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹j ∈ agents›</span></span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"total_preorder_on alts (R2 j)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>strategyproof</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>this</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹i ∈ agents›</span></span></span><span class="delimiter">]</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬scf ?R3 ≻[set_ext (R1 i)] scf R1"</span></span></span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"scf ?R3 = scf R2"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>anonymous'</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R1.anonymous_profile_update</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span> </span><span>preorder_on</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>strict_not_outside</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ≺[le] y"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"x ∈ carrier"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∈ carrier"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>not_outside</span><span class="delimiter">[</span><span>of</span><span> </span><span>x</span><span> </span><span>y</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>strongly_preferred_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Lifting preferences›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  Preference profiles can be lifted to a setting with more agents and alternatives by padding
  them with dummy agents and alternatives in such a way that every original agent prefers and
  original alternative over any dummy alternative and is indifferent between the dummy alternatives.
  Moreover, every dummy agent is completely indifferent.
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lift_prefs</span><span> </span><span class="delimiter">::</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"'alt set ⇒ 'alt set ⇒ 'alt relation ⇒ 'alt relation"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"lift_prefs alts alts' R = (λx y. 
     x ∈ alts' ∧ y ∈ alts' ∧ (x = y ∨ x ∉ alts ∨ (y ∈ alts ∧ R x y)))"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_prefs_wf</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"total_preorder_on alts R"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts ⊆ alts'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"total_preorder_on alts' (lift_prefs alts alts' R)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>total_preorder_on</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span> </span><span class="delimiter">(</span><span>insert</span><span> </span><span>R.total</span><span class="delimiter">,</span><span> </span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>R.trans</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lift_prefs_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lift_pref_profile</span><span> </span><span class="delimiter">::</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"'agent set ⇒ 'alt set ⇒ 'agent set ⇒ 'alt set ⇒
       ('agent, 'alt) pref_profile ⇒ ('agent, 'alt) pref_profile"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"lift_pref_profile agents alts agents' alts' R = (λi x y. 
     x ∈ alts' ∧ y ∈ alts' ∧ i ∈ agents' ∧
     (x = y ∨ x ∉ alts ∨ i ∉ agents ∨ (y ∈ alts ∧ R i x y)))"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_conv_vector</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"lift_pref_profile agents alts agents' alts' R i = lift_prefs alts alts' (R i)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>lift_prefs_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_wf</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents alts R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"agents ⊆ agents'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts ⊆ alts'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite alts'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">defines</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R' ≡ lift_pref_profile agents alts agents' alts' R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents' alts' R'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite_total_preorder_on alts' (R' i)"</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span>i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>i</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>finite_total_preorder_on</span><span> </span><span>alts</span><span> </span><span class="string"><span class="delete"><span class="delete">"R i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>True</span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>unfold_locales</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>total</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>trans</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>assms</span><span> </span><span>i</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>unfold_locales</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R' i = (λ_ _. False)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∉ agents'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_pref_profile_def</span><span> </span><span>R'_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>pref_profile_wf_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_permute_agents</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"π permutes agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"agents ⊆ agents'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"lift_pref_profile agents alts agents' alts' (R ∘ π) = 
             lift_pref_profile agents alts agents' alts' R ∘ π"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>permutes_subset</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>o_def</span><span> </span><span>permutes_in_image</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_permute_alts</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts ⊆ alts'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"lift_pref_profile agents alts agents' alts' (permute_profile σ R) = 
             permute_profile σ (lift_pref_profile agents alts agents' alts' R)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"inv σ permutes alts"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>permutes_inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>assms</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"inv σ permutes alts'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>permutes_subset</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>inv</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>permutes_inj</span><span class="delimiter">[</span><span>OF</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹inv σ permutes alts›</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>permutes_in_image</span><span>
</span><span>          </span><span>permute_profile_def</span><span> </span><span>fun_eq_iff</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>injD</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>R'</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>R_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents alts R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>election</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"agents ⊆ agents'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts ⊆ alts'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts ≠ {}"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"agents ≠ {}"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite alts'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">defines</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"R' ≡ lift_pref_profile agents alts agents' alts' R"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">interpretation</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span class="keyword1"><span class="command">interpretation</span></span><span> </span><span>R'</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>R'</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>election</span><span> </span><span>R_wf</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R'_def</span><span> </span><span>lift_pref_profile_wf</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_strict_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"x ≺[lift_pref_profile agents alts agents' alts' R i] y ⟷
     i ∈ agents ∧ ((y ∈ alts ∧ x ∈ alts' - alts) ∨ x ≺[R i] y)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>total_preorder_on</span><span> </span><span>alts</span><span> </span><span class="string"><span class="delete"><span class="delete">"R i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_outside</span><span> </span><span>election</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>strongly_preferred_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>strongly_preferred_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>preferred_alts_lift_pref_profile</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"preferred_alts (R' i) x = 
             (if i ∈ agents ∧ x ∈ alts then preferred_alts (R i) x else alts')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>Ri</span><span class="delimiter">:</span><span> </span><span>total_preorder_on</span><span> </span><span>alts</span><span> </span><span class="string"><span class="delete"><span class="delete">"R i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span>x</span><span> </span><span>election</span><span> </span><span>Ri.not_outside</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>preferred_alts_def</span><span> </span><span>R'_def</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>Ri.refl</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>preferred_alts_def</span><span> </span><span>R'_def</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>i</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_Pareto_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"x ≼[Pareto(R')] y ⟷ x ∈ alts' ∧ y ∈ alts' ∧ (x ∉ alts ∨ x ≼[Pareto(R)] y)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>R.nonempty_agents</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>Ri</span><span class="delimiter">:</span><span> </span><span>finite_total_preorder_on</span><span> </span><span>alts</span><span> </span><span class="string"><span class="delete"><span class="delete">"R i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>R'.Pareto_iff</span><span> </span><span>R.Pareto_iff</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>R'_def</span><span> </span><span>lift_pref_profile_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>election</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>preorder_on.refl</span><span class="delimiter">[</span><span>OF</span><span> </span><span>R.in_dom</span><span class="delimiter">]</span><span> 
</span><span>      </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>R.nonempty_alts</span><span> </span><span>R.nonempty_agents</span><span>  </span><span>intro</span><span class="delimiter">:</span><span> </span><span>Ri.not_outside</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_pref_profile_Pareto_strict_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"x ≺[Pareto(R')] y ⟷ x ∈ alts' ∧ y ∈ alts' ∧ (x ∉ alts ∧ y ∈ alts ∨ x ≺[Pareto(R)] y)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>strongly_preferred_def</span><span> </span><span>lift_pref_profile_Pareto_iff</span><span> </span><span>R.Pareto.not_outside</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pareto_losers_lift_pref_profile</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"pareto_losers R' = pareto_losers R ∪ (alts' - alts)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∈ alts"</span></span></span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ≺[Pareto(R)] y"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>that</span><span> </span><span>R.Pareto.not_outside</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>strongly_preferred_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>B</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>election</span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>R.nonempty_alts</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>pareto_losers_def</span><span> </span><span>lift_pref_profile_Pareto_strict_iff</span><span> </span><span class="delimiter">[</span><span>abs_def</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>A</span><span> </span><span>B</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Lowering SCFs›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  Using the preference lifting, we can now \emph{lower} an SCF to a setting with fewer agents
  and alternatives under mild conditions to the original SCF. This preserves many nice properties, 
  such as anonymity, neutrality, and strategyproofness.
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>scf_lowering</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>pareto_efficient_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>agents'_subset</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"agents' ⊆ agents"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts'_subset</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"alts' ⊆ alts"</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>agents'_nonempty</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"agents' ≠ {}"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts'_nonempty</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"alts' ≠ {}"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_agents'</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite agents'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>agents'_subset</span><span> </span><span>finite_agents</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>finite_subset</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_alts'</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite alts'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>alts'_subset</span><span> </span><span>finite_alts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>finite_subset</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>lift</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('agent, 'alt) pref_profile ⇒ ('agent, 'alt) pref_profile"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"lift ≡ lift_pref_profile agents' alts' agents alts"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lowered</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('agent, 'alt) pref_profile ⇒ 'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"lowered = scf ∘ lift"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_wf</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents' alts' R ⟹ is_pref_profile (lift R)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>alts'_subset</span><span> </span><span>agents'_subset</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>lift_pref_profile_wf</span><span class="delimiter">)</span><span> </span><span>simp_all</span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>lowered</span><span class="delimiter">:</span><span> </span><span>election</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>unfold_locales</span><span> </span><span>simp_all</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>preferred_alts_lift</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"lowered.is_pref_profile R ⟹ i ∈ agents ⟹ x ∈ alts ⟹
     preferred_alts (lift R i) x = 
       (if i ∈ agents' ∧ x ∈ alts' then preferred_alts (R i) x else alts)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>alts'_subset</span><span> </span><span>agents'_subset</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>preferred_alts_lift_pref_profile</span><span class="delimiter">)</span><span> </span><span>simp_all</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pareto_losers_lift</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"lowered.is_pref_profile R ⟹ pareto_losers (lift R) = pareto_losers R ∪ (alts - alts')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>agents'_subset</span><span> </span><span>alts'_subset</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>pareto_losers_lift_pref_profile</span><span class="delimiter">)</span><span> </span><span>simp_all</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>lowered</span><span class="delimiter">:</span><span> </span><span>social_choice_function</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>lowered</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>R</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>R_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents' alts' R"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>R_wf</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>R'_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents alts (lift R)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>lift_wf</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered R ⊆ alts'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>safe</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ lowered R"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ scf (lift R)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>o_def</span><span> </span><span>lowered_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"scf (lift R) ∩ pareto_losers (lift R) = {}"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>pareto_efficient</span><span> </span><span>R'_wf</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ∈ alts'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>scf_alts</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"lift R"</span></span></span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pareto_losers_lift</span><span> </span><span>R_wf</span><span> </span><span>R'_wf</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered R ≠ {}"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>R'_wf</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lowered_def</span><span> </span><span>scf_nonempty</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>lowered</span><span class="delimiter">:</span><span> </span><span>pareto_efficient_scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>lowered</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>R</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>R_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents' alts' R"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>R_wf</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>R'_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"pref_profile_wf agents alts (lift R)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>lift_wf</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered R ∩ pareto_losers (lift R) = {}"</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lowered_def</span><span> </span><span>o_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>pareto_efficient</span><span> </span><span>R'_wf</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>R_wf</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered R ∩ pareto_losers R = {}"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pareto_losers_lift</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>scf_lowering_anonymous</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>anonymous_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>scf_lowering</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>lowered</span><span class="delimiter">:</span><span> </span><span>anonymous_scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>lowered</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>π</span><span> </span><span>R</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"π permutes agents'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered.is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered (R ∘ π) = lowered R"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>agents'_subset</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lowered_def</span><span> </span><span>lift_pref_profile_permute_agents</span><span> </span><span>anonymous</span><span> </span><span>permutes_subset</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>scf_lowering_neutral</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>neutral_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>scf_lowering</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>lowered</span><span class="delimiter">:</span><span> </span><span>neutral_scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>lowered</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>σ</span><span> </span><span>R</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ permutes alts'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered.is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered (permute_profile σ R) = σ ` lowered R"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>alts'_subset</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lowered_def</span><span> </span><span>lift_pref_profile_permute_alts</span><span> </span><span>neutral</span><span> </span><span>permutes_subset</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  The following is a technical condition that we need from a set extensions in order for
  strategyproofness to survive the lowering. The condition could probably be weakened a bit,
  but it is good enough for our purposes the way it is.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>liftable_set_extension</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>alts'</span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>set_ext</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt relation ⇒ 'alt set relation"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>set_ext_strong_lift</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"total_preorder_on alts' R ⟹ A ≠ {} ⟹ B ≠ {} ⟹ A ⊆ alts' ⟹ B ⊆ alts' ⟹
       A ≺[set_ext R] B ⟹ A ≺[set_ext (lift_prefs alts' alts R)] B"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>liftable_set_extensionI_weak</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀R A B. total_preorder_on alts' R ⟹ A ≠ {} ⟹ B ≠ {} ⟹ 
                      A ⊆ alts' ⟹ B ⊆ alts' ⟹
              A ≼[set_ext R] B ⟷ A ≼[set_ext (lift_prefs alts' alts R)] B"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"liftable_set_extension alts' alts set_ext"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>standard</span><span class="delimiter">,</span><span> </span><span>goal_cases</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>1</span><span> </span><span>R</span><span> </span><span>A</span><span> </span><span>B</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span class="delimiter">[</span><span>of</span><span> </span><span>R</span><span> </span><span>A</span><span> </span><span>B</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>assms</span><span class="delimiter">[</span><span>of</span><span> </span><span>R</span><span> </span><span>B</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>strongly_preferred_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Kelly_liftable</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts' ⊆ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"liftable_set_extension alts' alts Kelly"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>liftable_set_extensionI_weak</span><span class="delimiter">,</span><span> </span><span>goal_cases</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>1</span><span> </span><span>R</span><span> </span><span>A</span><span> </span><span>B</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>total_preorder_on</span><span> </span><span>alts'</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>1</span><span class="delimiter">(</span><span>2</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>  </span><span>R.refl</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Kelly_def</span><span> </span><span>lift_prefs_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Fishburn_liftable</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"alts' ⊆ alts"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"liftable_set_extension alts' alts Fishb"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>liftable_set_extensionI_weak</span><span class="delimiter">,</span><span> </span><span>goal_cases</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>1</span><span> </span><span>R</span><span> </span><span>A</span><span> </span><span>B</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>total_preorder_on</span><span> </span><span>alts'</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conj_cong</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"P1 ∧ Q1 ⟷ P2 ∧ Q2"</span></span></span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"P1 ⟷ P2"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"Q1 ⟷ Q2"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>P1</span><span> </span><span>P2</span><span> </span><span>Q1</span><span> </span><span>Q2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>1</span><span class="delimiter">(</span><span>2</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Fishb_def</span><span> </span><span>lift_prefs_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>conj_cong</span><span> </span><span>ball_cong</span><span> </span><span>refl</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>scf_lowering_strategyproof</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>strategyproof_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>set_ext</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>liftable_set_extension</span><span> </span><span>alts'</span><span> </span><span>alts</span><span> </span><span>set_ext</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>scf_lowering</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>set_ext</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>lowered</span><span class="delimiter">:</span><span> </span><span>strategyproof_scf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>lowered</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>R</span><span> </span><span>Ri'</span><span> </span><span>i</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>R_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered.is_pref_profile R"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>Ri'_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"total_preorder_on alts' Ri'"</span></span></span><span> 
</span><span>     </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"i ∈ agents'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents'</span><span> </span><span>alts'</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>Ri'</span><span class="delimiter">:</span><span> </span><span>total_preorder_on</span><span> </span><span>alts'</span><span> </span><span>Ri'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>R_wf</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>R'_wf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile (lift R)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>lift_wf</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="comment">― ‹We lift the alternative preference for the agent @{term i} in @{term R} to 
      preferences in the lifted profile. ›</span><span>
</span><span>  </span><span class="keyword3"><span class="command">define</span></span><span> </span><span>Ri''</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"Ri'' = lift_prefs alts' alts Ri'"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬scf (lift R) ≺[set_ext (lift R i)] scf ((lift R)(i := Ri''))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span>agents'_subset</span><span> </span><span>alts'_subset</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Ri''_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof</span><span> </span><span>R'_wf</span><span> </span><span>Ri'_wf</span><span> </span><span>lift_prefs_wf</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(lift R)(i := Ri'') = lift (R(i := Ri'))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span>agents'_subset</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>fun_eq_iff</span><span> </span><span>Ri''_def</span><span> </span><span>lift_pref_profile_def</span><span> </span><span>lift_prefs_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>not_less</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬scf (lift R) ≺[set_ext (lift R i)] scf (lift (R(i := Ri')))"</span></span></span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬lowered R ≺[set_ext (R i)] lowered (R(i := Ri'))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered R ≺[set_ext (R i)] lowered (R(i := Ri'))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lowered R ≺[set_ext (lift_prefs alts' alts (R i))] lowered (R(i := Ri'))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>set_ext_strong_lift</span><span> </span><span>R.prefs_wf'</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>i</span><span> </span><span>lowered.scf_nonempty</span><span> </span><span>lowered.scf_alts</span><span>
</span><span>                </span><span>R.wf_update</span><span> </span><span>R_wf</span><span> </span><span>Ri'_wf</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"lift_prefs alts' alts (R i) = lift R i"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>agents'_subset</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>lift_pref_profile_conv_vector</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_less</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lowered_def</span><span> </span><span>o_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>contradiction</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span></pre>
</div>
</div><div id="Fishburn_Impossibility">
<div class="head"><h1>Theory Fishburn_Impossibility</h1>
<span class="command">theory</span> <span class="name">Fishburn_Impossibility</span><br/>
<span class="keyword">imports</span> <a href="Social_Choice_Functions.html"><span class="name">Social_Choice_Functions</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
  File:     Fishburn_Impossibility.thy
  Author:   Manuel Eberl, TU München
  Author:   Christian Saile, TU München

  Incompatibility of Pareto Optimality and Fishburn-Strategy-Proofness
*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Main impossibility result›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Fishburn_Impossibility</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span>
</span><span>  </span><span>Social_Choice_Functions</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Setting of the base case›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  Suppose we have an anonymous, Fishburn-strategyproof, and Pareto-efficient SCF
  for three agents $A1$ to $A3$ and three alternatives $a$, $b$, and $c$. We will derive
  a contradiction from this.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>fb_impossibility_3_3</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>strategyproof_anonymous_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>Fishb</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>pareto_efficient_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span>A1</span><span> </span><span>A2</span><span> </span><span>A3</span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>agents_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"agents = {A1, A2, A3}"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>alts_eq</span><span class="delimiter">:</span><span>    </span><span class="string"><span class="delete"><span class="delete">"alts = {a, b, c}"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>distinct_agents</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"distinct [A1, A2, A3]"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>distinct_alts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"distinct [a, b, c]"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We first give some simple rules that will allow us to break down the strategyproofness
  and support conditions more easily later.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>agents_neq</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"A1 ≠ A2"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A2 ≠ A1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A1 ≠ A3"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A3 ≠ A1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A2 ≠ A3"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A3 ≠ A2"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinct_agents</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>alts_neq</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ≠ b"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"a ≠ c"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ≠ c"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ≠ a"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"c ≠ a"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"c ≠ b"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinct_alts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>agent_in_agents</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"A1 ∈ agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A2 ∈ agents"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A3 ∈ agents"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>agents_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>alt_in_alts</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∈ alts"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ∈ alts"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∈ alts"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>alts_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Bex_alts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(∃x∈alts. P x) ⟷ P a ∨ P b ∨ P c"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>alts_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eval_pareto_loser_aux</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"x ∈ pareto_losers R ⟷ (∃y∈{a,b,c}. x ≺[Pareto(R)] y)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>*</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∈ {a,b,c}"</span></span></span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"x ≺[Pareto(R)] y"</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Pareto.strict_not_outside</span><span class="delimiter">[</span><span>of</span><span> </span><span>x</span><span> </span><span>y</span><span class="delimiter">]</span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>alts_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pareto_losers_def</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>*</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eval_Pareto</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"x ≺[Pareto(R)] y ⟷ (∀i∈{A1,A2,A3}. x ≼[R i] y) ∧ (∃i∈{A1,A2,A3}. ¬x ≽[R i] y)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>R</span><span class="delimiter">:</span><span> </span><span>pref_profile_wf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>R.Pareto_strict_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>strongly_preferred_def</span><span> </span><span>agents_eq</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>eval_pareto</span><span> </span><span class="delimiter">=</span><span> </span><span>eval_pareto_loser_aux</span><span> </span><span>eval_Pareto</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pareto_efficiency</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R ⟹ x ∈ pareto_losers R ⟹ x ∉ scf R"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pareto_efficient</span><span class="delimiter">[</span><span>of</span><span> </span><span>R</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Ball_scf</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"(∀x∈scf R. P x) ⟷ (a ∉ scf R ∨ P a) ∧ (b ∉ scf R ∨ P b) ∧ (c ∉ scf R ∨ P c)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>scf_alts</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>alts_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Ball_scf_diff</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R1"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R2"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"(∀x∈scf R1 - scf R2. P x) ⟷ 
             (a ∈ scf R2 ∨ a ∉ scf R1 ∨ P a) ∧ (b ∈ scf R2 ∨ b ∉ scf R1 ∨ P b) ∧ 
             (c ∈ scf R2 ∨ c ∉ scf R1 ∨ P c)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>scf_alts</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>alts_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>scf_nonempty'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"is_pref_profile R"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>   </span><span class="string"><span class="delete"><span class="delete">"∃x∈alts. x ∈ scf R"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>scf_nonempty</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>scf_alts</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Definition of Preference Profiles and Fact Gathering›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We now define the 21 preference profile that will lead to the impossibility result.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">preference_profile</span></span><span> 
</span><span>  </span><span>agents</span><span class="delimiter">:</span><span> </span><span>agents</span><span>
</span><span>  </span><span>alts</span><span class="delimiter">:</span><span>   </span><span>alts</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>R1</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R2</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R3</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span>   
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R4</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span>  </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>      </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R5</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span>  </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>      </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R6</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span>  </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R7</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R8</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>a</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R9</span><span>   </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>a</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R10</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span>   
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R11</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R12</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span>   
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R13</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R14</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>b</span><span>   
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R15</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>a</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R16</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>c</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R17</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R18</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>b</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R19</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">]</span><span>     </span><span>A3</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R20</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span class="delimiter">[</span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>c</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R21</span><span>  </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">:</span><span> </span><span class="delimiter">[</span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>a</span><span>    </span><span>A2</span><span class="delimiter">:</span><span> </span><span>a</span><span class="delimiter">,</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span>       </span><span>A3</span><span class="delimiter">:</span><span> </span><span>b</span><span class="delimiter">,</span><span> </span><span>c</span><span class="delimiter">,</span><span> </span><span>a</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>agents_eq</span><span> </span><span>alts_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>R_wfs</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>R1.wf</span><span> </span><span>R2.wf</span><span> </span><span>R3.wf</span><span> </span><span>R4.wf</span><span> </span><span>R5.wf</span><span> </span><span>R6.wf</span><span> </span><span>R7.wf</span><span> </span><span>R8.wf</span><span> </span><span>R9.wf</span><span> </span><span>R10.wf</span><span> </span><span>R11.wf</span><span> </span><span>R12.wf</span><span> </span><span>R13.wf</span><span> </span><span>R14.wf</span><span> </span><span>R15.wf</span><span> 
</span><span>  </span><span>R16.wf</span><span> </span><span>R17.wf</span><span> </span><span>R18.wf</span><span> </span><span>R19.wf</span><span> </span><span>R20.wf</span><span> </span><span>R21.wf</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>R_evals</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>R1.eval</span><span> </span><span>R2.eval</span><span> </span><span>R3.eval</span><span> </span><span>R4.eval</span><span> </span><span>R5.eval</span><span> </span><span>R6.eval</span><span> </span><span>R7.eval</span><span> </span><span>R8.eval</span><span> </span><span>R9.eval</span><span> </span><span>R10.eval</span><span> </span><span>R11.eval</span><span> </span><span>R12.eval</span><span>  </span><span>R13.eval</span><span> 
</span><span>  </span><span>R14.eval</span><span> </span><span>R15.eval</span><span> </span><span>R16.eval</span><span> </span><span>R17.eval</span><span> </span><span>R18.eval</span><span> </span><span>R19.eval</span><span> </span><span>R20.eval</span><span> </span><span>R21.eval</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>nonemptiness</span><span> </span><span class="delimiter">=</span><span> </span><span>R_wfs</span><span> </span><span class="delimiter">[</span><span>THEN</span><span> </span><span>scf_nonempty'</span><span class="delimiter">,</span><span> </span><span>unfolded</span><span> </span><span>Bex_alts</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We show the support conditions from Pareto efficiency
›</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∉ scf R1"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R1.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∉ scf R2"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R2.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∉ scf R3"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R3.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∉ scf R6"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R6.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∉ scf R7"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R7.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"b ∉ scf R8"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R8.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∉ scf R9"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R9.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ∉ scf R12"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R12.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"b ∉ scf R14"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R14.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∉ scf R15"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R15.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"b ∉ scf R16"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R16.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∉ scf R17"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R17.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∉ scf R18"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R18.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"b ∉ scf R19"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R19.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∉ scf R20"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R20.eval</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"c ∉ scf R21"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>pareto_efficiency</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eval_pareto</span><span> </span><span>R21.eval</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We derive the strategyproofness conditions:
›</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R4 ≻[Fishb(R1 A2)] scf R1"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R4.eval</span><span> </span><span>R1.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s32</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R3 ≻[Fishb(R2 A1)] scf R2"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R3.eval</span><span> </span><span>R2.eval</span><span class="delimiter">)</span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s122</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R12 ≻[Fishb(R2 A2)] scf R2"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R12.eval</span><span> </span><span>R2.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s133</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R13 ≻[Fishb(R3 A2)] scf R3"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R13.eval</span><span> </span><span>R3.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s102</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R10 ≻[Fishb(R2 A2)] scf R2"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R10.eval</span><span> </span><span>R2.eval</span><span class="delimiter">)</span><span>
</span><span>         
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R1 ≻[Fishb(R3 A3)] scf R3"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R1.eval</span><span> </span><span>R3.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s54</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R5 ≻[Fishb(R4 A1)] scf R4"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R5.eval</span><span> </span><span>R4.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s174</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R17 ≻[Fishb(R4 A1)] scf R4"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R17.eval</span><span> </span><span>R4.eval</span><span class="delimiter">)</span><span>
</span><span>      
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s74</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R7 ≻[Fishb(R4 A2)] scf R4"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R7.eval</span><span> </span><span>R4.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s114</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R11 ≻[Fishb(R4 A3)] scf R4"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R11.eval</span><span> </span><span>R4.eval</span><span class="delimiter">)</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s45</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R4 ≻[Fishb(R5 A1)] scf R5"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>R4.eval</span><span> </span><span>R5.eval</span><span class="delimiter">)</span><span>
</span><span>     
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s65</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R6 ≻[Fishb(R5 A2)] scf R5"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R5.eval</span><span> </span><span>R6.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s105</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R10 ≻[Fishb(R5 A3)] scf R5"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span>  </span><span>R10.eval</span><span> </span><span>R5.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s67</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R6 ≻[Fishb(R7 A1)] scf R7"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span>  </span><span>R6.eval</span><span> </span><span>R7.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s187</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R18 ≻[Fishb(R7 A3)] scf R7"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R7.eval</span><span> </span><span>R18.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s219</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R21 ≻[Fishb(R9 A2)] scf R9"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R9.eval</span><span> </span><span>R21.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1011</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R10 ≻[Fishb(R11 A1)] scf R11"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R10.eval</span><span> </span><span>R11.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1012</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R10 ≻[Fishb(R12 A2)] scf R12"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R10.eval</span><span> </span><span>R12.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1213</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R12 ≻[Fishb(R13 A1)] scf R13"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R12.eval</span><span> </span><span>R13.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1113</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R11 ≻[Fishb(R13 A2)] scf R13"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R11.eval</span><span> </span><span>R13.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1813</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R18 ≻[Fishb(R13 A3)] scf R13"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A2</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R18.eval</span><span> </span><span>R13.eval</span><span class="delimiter">)</span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s814</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R8 ≻[Fishb(R14 A2)] scf R14"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R8.eval</span><span> </span><span>R14.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1914</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R19 ≻[Fishb(R14 A3)] scf R14"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R19.eval</span><span> </span><span>R14.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1715</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R17 ≻[Fishb(R15 A1)] scf R15"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R17.eval</span><span> </span><span>R15.eval</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s815</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R8 ≻[Fishb(R15 A3)] scf R15"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R8.eval</span><span> </span><span>R15.eval</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s516</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R5 ≻[Fishb(R16 A1)] scf R16"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A3</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R5.eval</span><span> </span><span>R16.eval</span><span class="delimiter">)</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s517</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R5 ≻[Fishb(R17 A1)] scf R17"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span> </span><span>R5.eval</span><span> </span><span>R17.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1619</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R16 ≻[Fishb(R19 A1)] scf R19"</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span>  </span><span>R16.eval</span><span> </span><span>R19.eval</span><span class="delimiter">)</span><span> 
</span><span>     
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s1820</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R18 ≻[Fishb(R20 A2)] scf R20"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span>  </span><span>R18.eval</span><span> </span><span>R20.eval</span><span class="delimiter">)</span><span>
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s920</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R9 ≻[Fishb(R20 A3)] scf R20"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span>  </span><span>R20.eval</span><span> </span><span>R9.eval</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s521</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R5 ≻[Fishb(R21 A1)] scf R21"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span>  </span><span>R21.eval</span><span> </span><span>R5.eval</span><span class="delimiter">)</span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s421</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ scf R4 ≻[Fishb(R21 A1)] scf R21"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>strategyproof'</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span> </span><span class="delimiter">=</span><span> </span><span>A1</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insert_commute</span><span>  </span><span>R21.eval</span><span> </span><span>R4.eval</span><span class="delimiter">)</span><span>
</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>sp</span><span> </span><span class="delimiter">=</span><span> </span><span>s41</span><span> </span><span>s32</span><span> </span><span>s122</span><span> </span><span>s102</span><span> </span><span>s133</span><span> </span><span>s13</span><span> </span><span>s54</span><span> </span><span>s174</span><span> </span><span>s54</span><span> </span><span>s74</span><span> </span><span>s114</span><span> </span><span>s45</span><span> </span><span>s65</span><span> </span><span>s105</span><span> </span><span>s67</span><span>
</span><span>            </span><span>s187</span><span> </span><span>s219</span><span> </span><span>s1011</span><span> </span><span>s1012</span><span> </span><span>s1213</span><span> </span><span>s1113</span><span> </span><span>s1813</span><span> </span><span>s814</span><span> </span><span>s1914</span><span> </span><span>s1715</span><span> </span><span>s815</span><span> </span><span>s516</span><span>
</span><span>            </span><span>s517</span><span> </span><span>s1619</span><span> </span><span>s1820</span><span> </span><span>s920</span><span> </span><span>s521</span><span> </span><span>s421</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We now use the simplifier to break down the strategyproofness conditions into SAT formulae.
  This takes a few seconds, so we use some low-level ML code to at least do the simplification
  in parallel.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">local_setup</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹fn lthy =&gt;
  let
    val lthy' = lthy addsimps @{thms Fishb_strict_iff Ball_scf Ball_scf_diff R_evals}
    val thms = Par_List.map (Simplifier.asm_full_simplify lthy') @{thms sp}
  in
    Local_Theory.notes [((@{binding sp'}, []), [(thms, [])])] lthy |&gt; snd
  end
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We show that the strategyproofness conditions, the non-emptiness conditions (i.\,e.\ every SCF
  must return at least one winner), and the efficiency conditions are not satisfiable together,
  which means that the SCF whose existence we assumed simply cannot exist.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>absurd</span><span class="delimiter">:</span><span> </span><span>False</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sp'</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>nonemptiness</span><span> </span><span class="delimiter">[</span><span>simplified</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>satx</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Lifting to more than 3 agents and alternatives›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  We now employ the standard lifting argument outlined before to lift this impossibility
  from 3 agents and alternatives to any setting with at least 3 agents and alternatives.
›</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>fb_impossibility</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>strategyproof_anonymous_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span>Fishb</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>pareto_efficient_scf</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'agent set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'alt set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>scf</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>card_agents_ge</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"card agents ≥ 3"</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>card_alts_ge</span><span class="delimiter">:</span><span>   </span><span class="string"><span class="delete"><span class="delete">"card alts ≥ 3"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* TODO: Move? *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_list'</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite A"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">obtains</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A = set xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"distinct xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"length xs = card A"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"set xs = A"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite_list</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinct_card</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"remdups xs"</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>that</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"remdups xs"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span>simp_all</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_list_subset</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite A"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"card A ≥ n"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">obtains</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"set xs ⊆ A"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"distinct xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"length xs = n"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"A = set xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"distinct xs"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"length xs = card A"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite_list'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>assms</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>that</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"take n xs"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>set_take_subset</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>card_ge_3E</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite A"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"card A ≥ 3"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">obtains</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"distinct [a,b,c]"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"{a,b,c} ⊆ A"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>finite_list_subset</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span><span> </span><span>xs</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"xs = [a, b, c]"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>eval_nat_numeral</span><span> </span><span>length_Suc_conv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>that</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span>simp_all</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>absurd</span><span class="delimiter">:</span><span> </span><span>False</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>card_ge_3E</span><span class="delimiter">[</span><span>OF</span><span> </span><span>finite_agents</span><span> </span><span>card_agents_ge</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span><span> </span><span>A1</span><span> </span><span>A2</span><span> </span><span>A3</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>agents</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?agents'</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"{A1, A2, A3}"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>card_ge_3E</span><span class="delimiter">[</span><span>OF</span><span> </span><span>finite_alts</span><span> </span><span>card_alts_ge</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>alts</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?alts'</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"{a, b, c}"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>scf_lowering_anonymous</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="var">?agents'</span><span> </span><span class="var">?alts'</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>liftable_set_extension</span><span> </span><span class="var">?alts'</span><span> </span><span>alts</span><span> </span><span>Fishb</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>Fishburn_liftable</span><span> </span><span>alts</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>scf_lowering_strategyproof</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span>scf</span><span> </span><span class="var">?agents'</span><span> </span><span class="var">?alts'</span><span> </span><span>Fishb</span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>fb_impossibility_3_3</span><span> </span><span class="var">?agents'</span><span> </span><span class="var">?alts'</span><span> </span><span>lowered</span><span> </span><span>A1</span><span> </span><span>A2</span><span> </span><span>A3</span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>c</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>agents</span><span> </span><span>alts</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>simp_all</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>absurd</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span></pre>
</div>
</div>