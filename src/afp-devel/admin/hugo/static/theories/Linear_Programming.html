<div id="More_Jordan_Normal_Forms">
<div class="head">
<h1>Theory More_Jordan_Normal_Forms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> More_Jordan_Normal_Forms
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Jordan_Normal_Form/Matrix_Impl.html">Jordan_Normal_Form.Matrix_Impl</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-set_comprehension_list_comprehension"><span class="command">lemma</span></span> set_comprehension_list_comprehension<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="free">f</span> <span class="bound">i</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="free">x</span><span class="main">..&lt;</span><span class="free">a</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..&lt;</span><span class="free">a</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-in_second_append_list"><span class="command">lemma</span></span> in_second_append_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span> length <span class="free">a</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">∈</span> set <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_add_inverse diff_less_mono in_set_conv_nth leD length_append nth_append<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ General Theorems used later, that could be moved ›</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-split_four_block_dual_fst_lst"><span class="command">lemma</span></span> split_four_block_dual_fst_lst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_block <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="keyword2"><span class="keyword">where</span></span> nr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nr</span> <span class="main">=</span> dim_row <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nc</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc</span> <span class="main">=</span> dim_col <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> nr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nr2</span> <span class="main">=</span> <span class="skolem">nr</span> <span class="main">-</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nc2</span></span> <span class="keyword2"><span class="keyword">where</span></span> nc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nc2</span> <span class="main">=</span> <span class="skolem">nc</span> <span class="main">-</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">=</span> mat <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">($$)</span> <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">=</span> mat <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="skolem">nc2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span> <span class="main">+</span> dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A3</span></span> <span class="keyword2"><span class="keyword">where</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A3</span> <span class="main">=</span> mat <span class="skolem">nr2</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> dim_row <span class="free">A</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A4</span></span> <span class="keyword2"><span class="keyword">where</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A4</span> <span class="main">=</span> mat <span class="skolem">nr2</span> <span class="skolem">nc2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> dim_row <span class="free">A</span><span class="main">,</span> <span class="bound">j</span> <span class="main">+</span> dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"split_block <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">A2</span><span class="main">,</span> <span class="skolem">A3</span><span class="main">,</span> <span class="skolem">A4</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> split_block_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A1 A2 A3 A4 nc nc2 nr nr2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">=</span> <span class="skolem">A4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  nr nr2 nc nc2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">A1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"split_block <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="skolem">A2</span><span class="main">,</span> <span class="skolem">A3</span><span class="main">,</span> <span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-append_split_vec_distrib_scalar_prod"><span class="command">lemma</span></span> append_split_vec_distrib_scalar_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∙</span> <span class="main">(</span>vec_first <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span> <span class="main">∙</span> <span class="main">(</span>vec_last <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>vec_first <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
              <span class="free">u</span> <span class="main">∙</span> vec_first <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span> <span class="main">∙</span> vec_last <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> carrier_vec_dim_vec scalar_prod_append vec_first_carrier vec_last_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms carrier_vec_dim_vec index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_first_last_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-append_dot_product_split"><span class="command">lemma</span></span> append_dot_product_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_vec <span class="free">w</span><span class="main">}</span><span class="main">.</span> <span class="free">w</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="main">(</span><span class="bound">i</span> <span class="main">+</span> dim_vec <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ix</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ix</span> <span class="main">=</span> vec_first <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lx</span></span> <span class="keyword2"><span class="keyword">where</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lx</span> <span class="main">=</span> vec_last <span class="free">x</span> <span class="main">(</span>dim_vec <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∙</span> <span class="skolem">ix</span> <span class="main">+</span> <span class="free">w</span> <span class="main">∙</span> <span class="skolem">lx</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_split_vec_distrib_scalar_prod ix_def lx assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> scalar_prod_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span>dim_vec <span class="free">u</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sum.atLeastLessThan_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> le0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 
      le_add1<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">w</span>"</span></span><span class="main">]</span> index_append_vec<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="free">w</span> <span class="main">∙</span> <span class="skolem">lx</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> * calculation <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ix_def scalar_prod_def vec_first_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∙</span> <span class="skolem">lx</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_vec <span class="free">w</span><span class="main">}</span><span class="main">.</span> <span class="free">w</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="main">(</span><span class="bound">i</span> <span class="main">+</span> dim_vec <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lx vec_last_def 
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">using</span></span> add_diff_cancel_right' index_append_vec<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹dim_vec <span class="main">(</span><span class="free">u</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">u</span> <span class="main">+</span> dim_vec <span class="free">w</span>›</span></span> add.commute add_diff_cancel_right' assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-assoc_scalar_prod_mult_mat_vec"><span class="command">lemma</span></span> assoc_scalar_prod_mult_mat_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_1 mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> carrier_vecD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>vec <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="free">A</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_mat_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="free">A</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span>  <span class="bound">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>row <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> carrier_vecD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>row <span class="free">A</span> <span class="bound">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span>  <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span>  <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>col <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>col <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.swap<span class="main">[</span><span class="operator">of</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>col <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>col <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> col <span class="free">A</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">y</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> carrier_vecD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">y</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>vec <span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalar_prod_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> carrier_vecD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Vectors ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">singletonV</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span> <span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">singletonV</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">(</span>vec <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-elem_in_singleton"><span class="command">lemma</span></span> elem_in_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-elem_in_singleton_append"><span class="command">lemma</span></span> elem_in_singleton_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> dim_vec <span class="free">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-vector_cases_append"><span class="command">lemma</span></span> vector_cases_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> vNil <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">a</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="bound">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> vNil <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">a</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="bound">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> vNil"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> na<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">a</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="bound">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 eq_vecI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> vec <span class="main">(</span>dim_vec <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="skolem">v</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span> <span class="main">$</span> <span class="main">(</span>dim_vec <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> ff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> dim_vec <span class="skolem">v</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> dim_vec <span class="free">x</span>›</span></span> add_diff_cancel_left' dim_vec le_Suc_ex v<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free">x</span><span class="main">.</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="skolem">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">$</span><span class="bound">i</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span><span class="operator">standard</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">$</span> dim_vec <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a v<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="skolem">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ff1 as <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> One_nat_def a' add.left_neutral 
            add_Suc_right add_diff_cancel_left' add_diff_cancel_right' 
            dim_vec index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_Suc_eq v'<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="skolem">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="skolem">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a a' v v'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_vec eq_vecI ff1 index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> na <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-vec_rev_induct"><span class="command">lemma</span></span> vec_rev_induct <span class="main">[</span><span class="operator">case_names</span> vNil append<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> vec<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> vNil"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="bound">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> vNil"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="skolem">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vector_cases_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> dim_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> dim_vec <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> xs_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">xs</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="skolem">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs_x<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-singleton_append_dotP"><span class="command">lemma</span></span> singleton_append_dotP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">z</span> <span class="main">=</span> dim_vec <span class="free">y</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">y</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">z</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">$</span> dim_vec <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">z</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">z</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">z</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">z</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">$</span><span class="main">(</span>dim_vec <span class="free">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main">$</span><span class="main">(</span>dim_vec <span class="free">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">y</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">z</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">x</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">$</span><span class="main">(</span>dim_vec <span class="free">y</span><span class="main">)</span><span class="main">*</span> <span class="free">z</span><span class="main">$</span><span class="main">(</span>dim_vec <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">y</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">z</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">$</span><span class="main">(</span>dim_vec <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-map_vec_append"><span class="command">lemma</span></span> map_vec_append<span class="main">:</span> <span class="quoted"><span class="quoted">"map_vec <span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> map_vec <span class="free">f</span> <span class="free">a</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> map_vec <span class="free">f</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-map_mat_map_vec"><span class="command">lemma</span></span> map_mat_map_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>map_mat <span class="free">f</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> map_vec <span class="free">f</span> <span class="main">(</span>row <span class="free">P</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-append_rows_access1"><span class="command">lemma</span></span> append_rows_access1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_col <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>Matrix.row <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_rows_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> append_rows_def <span class="keyword1"><span class="command">using</span></span> 
      carrier_mat_triv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> row_four_block_mat<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span>"</span></span> 
        <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ _ _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_mat_triv zero_carrier_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vNil"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-append_rows_access2"><span class="command">lemma</span></span> append_rows_access2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span> <span class="main">+</span> dim_row <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_col <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_rows_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> append_rows_def <span class="keyword1"><span class="command">using</span></span> carrier_mat_triv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> row_four_block_mat<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span>"</span></span> 
        <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ _ _ _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> carrier_mat_triv le_antisym less_imp_le_nat nat_less_le zero_carrier_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vNil"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-append_singleton_access"><span class="command">lemma</span></span> append_singleton_access <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Matrix.vec <span class="free">n</span> <span class="free">f</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">r</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Move to right place ›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mat_append_col</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat_append_col</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> mat_of_cols <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>cols <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mat_append_row</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat_append_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> mat_of_rows <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>rows <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_col_dims"><span class="command">lemma</span></span> mat_append_col_dims<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_append_col <span class="free">A</span> <span class="free">b</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_row_dims"><span class="command">lemma</span></span> mat_append_row_dims<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_append_row <span class="free">A</span> <span class="free">c</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_col_col"><span class="command">lemma</span></span> mat_append_col_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nA</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_of_cols <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>cols <span class="free">A</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>col <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> vec_index <span class="main">(</span>vec <span class="main">(</span>dim_row <span class="var">?nA</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?nA</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec_index <span class="main">(</span>vec <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?nA</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec_index <span class="main">(</span><span class="main">(</span>cols <span class="free">A</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> dim_col <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> assms mat_of_cols_index<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec_index <span class="free">b</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cols_length nth_append_length<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_col_vec_index"><span class="command">lemma</span></span> mat_append_col_vec_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mat_append_col_col 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def add_Suc_right assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
      col_def dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_vec lessI mat_append_col.simps 
      mat_append_col_dims mat_of_cols_def semiring_norm<span class="main"><span class="main">(</span></span>51<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_row_row"><span class="command">lemma</span></span> mat_append_row_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_append_row <span class="free">A</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nA</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_of_rows <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Matrix.rows <span class="free">A</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.row <span class="main">(</span>mat_append_row <span class="free">A</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> mat_append_row.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_append_row <span class="free">A</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> vec_index <span class="main">(</span>row <span class="var">?nA</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec_index <span class="main">(</span>vec <span class="main">(</span>dim_col <span class="var">?nA</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="var">?nA</span> <span class="main">$$</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Matrix.row_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  vec_index <span class="main">(</span><span class="main">(</span>rows <span class="free">A</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> dim_row <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹mat_append_row <span class="free">A</span> <span class="free">c</span> <span class="main">=</span> mat_of_rows <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Matrix.rows <span class="free">A</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">)</span>›</span></span> 
        add_Suc_right append_Nil2 assms calculation carrier_matD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> col_transpose cols_transpose 
        index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> length_append length_rows lessI list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
        mat_append_col.elims mat_append_col_col mat_append_row_dims nth_append_length 
        transpose_mat_of_rows One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vec_index <span class="free">c</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_rows nth_append_length<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Matrix.row <span class="main">(</span>mat_append_row <span class="free">A</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_row_in_mat"><span class="command">lemma</span></span> mat_append_row_in_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_append_row <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> assms le_imp_less_Suc length_append_singleton 
      length_rows mat_of_rows_row nat_less_le nth_append nth_rows row_carrier<span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_row_vec_index"><span class="command">lemma</span></span> mat_append_row_vec_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_index <span class="main">(</span>col <span class="main">(</span>mat_append_row <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">=</span> vec_index <span class="free">b</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.right_neutral add_Suc_right assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_matD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_col index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lessI mat_append_row_dims mat_append_row_row<span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-mat_append_col_access_in_mat"><span class="command">lemma</span></span> mat_append_col_access_in_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Matrix.row_transpose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    Matrix.transpose_transpose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span> assms carrier_matD<span class="main">(</span>1<span class="main">)</span> 
    carrier_matD<span class="main">(</span>2<span class="main">)</span> cols_length cols_transpose index_col index_row<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"mat_append_col <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> index_transpose_mat<span class="main">(</span>2<span class="main">)</span>
    mat_append_col.simps mat_append_col_dims
    mat_of_cols_carrier<span class="main">(</span>3<span class="main">)</span> mat_of_rows_row
    nth_append nth_rows row_carrier trans_less_add1 transpose_mat_of_cols
    mat_of_cols_index
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cols_nth index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1" id="More_Jordan_Normal_Forms-constructing_append_col_row"><span class="command">lemma</span></span> constructing_append_col_row<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span>vec_index <span class="free">b</span> <span class="free">i</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.row <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>Matrix.row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">b</span> <span class="main">$</span> <span class="free">i</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>Matrix.row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">b</span> <span class="main">$</span> <span class="free">i</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>     
     <span class="keyword1"><span class="command">using</span></span> a less_SucE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="main">(</span>Matrix.row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">b</span> <span class="main">$</span> <span class="free">i</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> mat_append_col_vec_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> <span class="main">(</span>mat_append_col <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="skolem">ia</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mat_append_col_access_in_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="skolem">ia</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_element_vec</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_element_vec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> vec <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-one_element_vec_carrier"><span class="command">lemma</span></span> one_element_vec_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"one_element_vec <span class="free">n</span> <span class="free">e</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_element_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-one_element_vec_dim"><span class="command">lemma</span></span> one_element_vec_dim <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>one_element_vec <span class="free">n</span> <span class="main">(</span><span class="free">r</span><span class="main">::</span>rat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_element_vec_def<span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-one_element_vec_access"><span class="command">lemma</span></span> one_element_vec_access <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> vec_index <span class="main">(</span>one_element_vec <span class="free">n</span> <span class="free">e</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_element_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">single_nz_val</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">single_nz_val</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> vec <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_val_carrier"><span class="command">lemma</span></span> single_nz_val_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_val_access1"><span class="command">lemma</span></span> single_nz_val_access1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_val_access2"><span class="command">lemma</span></span> single_nz_val_access2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span><span class="main">⟹</span> single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>monoid_mult<span class="main">,</span>times<span class="main">,</span>zero_neq_one<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_val_unit_vec"><span class="command">lemma</span></span> single_nz_val_unit_vec<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>monoid_mult<span class="main">,</span>times<span class="main">,</span>zero_neq_one<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">=</span> single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span> <span class="main">$</span> <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_valI"><span class="command">lemma</span></span> single_nz_valI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="free">i</span> <span class="free">val</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">$</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">$</span><span class="free">i</span> <span class="main">=</span> <span class="free">val</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> single_nz_val <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="free">i</span> <span class="free">val</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_val_dotP"><span class="command">lemma</span></span> single_nz_val_dotP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"single_nz_val <span class="free">n</span> <span class="free">i</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="var">?y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y</span> <span class="main">$</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> atLeast0LessThan 
        finite_atLeastLessThan lessThan_iff sum.remove<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="var">?y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">⟹</span> <span class="var">?y</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="var">?y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-single_nz_zero_singleton"><span class="command">lemma</span></span> single_nz_zero_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"single_nz_val <span class="main">1</span> <span class="main">0</span> <span class="free">v</span> <span class="main">=</span> <span class="main">[</span><span class="free">v</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-append_one_elem_zero_dotP"><span class="command">lemma</span></span> append_one_elem_zero_dotP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> <span class="free">m</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>one_element_vec <span class="free">n</span> <span class="free">e</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">e</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?OEV</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"one_element_vec <span class="free">n</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="var">?OEV</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="free">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> one_element_vec_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>one_element_vec <span class="free">n</span> <span class="free">e</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> one_element_vec <span class="free">n</span> <span class="free">e</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span> <span class="main">∙</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalar_prod_append<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?OEV</span></span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> carrier_vec_dim_vec one_element_vec_carrier zero_carrier_vec<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?OEV</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">u</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?OEV</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">e</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Jordan_Normal_Forms-one_element_vec_dotP"><span class="command">lemma</span></span> one_element_vec_dotP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>one_element_vec <span class="free">n</span> <span class="free">e</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">e</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms one_element_vec_access scalar_prod_def sum.ivl_cong<span class="main">)</span>


<span class="keyword1" id="More_Jordan_Normal_Forms-singleton_dotP"><span class="command">lemma</span></span> singleton_dotP <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">v</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_vec index_vec less_one single_nz_valI single_nz_val_dotP<span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-singletons_dotP"><span class="command">lemma</span></span> singletons_dotP <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">v</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∙</span> <span class="main">[</span><span class="free">w</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_vec index_vec less_one singleton_dotP<span class="main">)</span>

<span class="keyword1" id="More_Jordan_Normal_Forms-singleton_appends_dotP"><span class="command">lemma</span></span> singleton_appends_dotP <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> dim_vec <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">v</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[</span><span class="free">w</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">+</span> <span class="free">v</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> scalar_prod_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">v</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">w</span><span class="keyword1">]<span class="hidden">⇩</span><sub>v</sub></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_dim_vec singletons_dotP vec_carrier<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Matrix_LinPoly">
<div class="head">
<h1>Theory Matrix_LinPoly</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Matrix_LinPoly
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../Jordan_Normal_Form/Matrix_Impl.html">Jordan_Normal_Form.Matrix_Impl</a>
    <a href="../Farkas/Simplex_for_Reals.html">Farkas.Simplex_for_Reals</a>
    <a href="../Farkas/Matrix_Farkas.html">Farkas.Matrix_Farkas</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Add this to linear polynomials in Simplex ›</span></span>

<span class="keyword1" id="Matrix_LinPoly-eval_poly_with_sum"><span class="command">lemma</span></span> eval_poly_with_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⦃</span> <span class="free">X</span> <span class="main">⦄</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span> vars <span class="free">v</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> linear_poly_sum sum.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Matrix_LinPoly-eval_poly_with_sum_superset"><span class="command">lemma</span></span> eval_poly_with_sum_superset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊇</span> vars <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⦃</span><span class="free">X</span><span class="main">⦄</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="free">S</span> <span class="main">-</span> vars <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zeros<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D coeff_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fnt<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⦃</span><span class="free">X</span><span class="main">⦄</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span> vars <span class="free">v</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> linear_poly_sum sum.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span> vars <span class="free">v</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeros <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span> vars <span class="free">v</span> <span class="main">∪</span> <span class="skolem">D</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fnt Diff_partition<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">v</span>"</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 
      sum.subset_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">v</span>"</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> sum <span class="bound">g</span> <span class="free">S</span> <span class="main">=</span> sum <span class="bound">g</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> vars <span class="free">v</span><span class="main">)</span> <span class="main">+</span> sum <span class="bound">g</span> <span class="main">(</span>vars <span class="free">v</span><span class="main">)</span>›</span></span> D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> coeff <span class="free">v</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D Diff_partition assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Get rid of these synonyms ›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Translations of Jordan Normal Forms Matrix Library to Simplex polynomials ›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Vectors ›</span></span>

<span class="comment1">(* Translate rat list to linear polynomial with same coefficients *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_to_lpoly</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">list_to_lpoly</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> sum_list <span class="main">(</span>map2 <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">c</span><span class="main">.</span> lp_monom <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>"</span></span> 


<span class="keyword1" id="Matrix_LinPoly-empty_list_0poly"><span class="command">lemma</span></span> empty_list_0poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_to_lpoly <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_to_lpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Matrix_LinPoly-sum_list_map_upto_coeff_limit"><span class="command">lemma</span></span> sum_list_map_upto_coeff_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> length <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>list_to_lpoly <span class="free">L</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">L</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_to_lpoly_def<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-rl_lpoly_coeff_nth_non_empty"><span class="command">lemma</span></span> rl_lpoly_coeff_nth_non_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>list_to_lpoly <span class="free">cs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">cs</span><span class="main">!</span><span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_nonempty_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span><span class="quoted">rat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>list_to_lpoly <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> lp_monom <span class="skolem">x</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_to_lpoly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>list_to_lpoly <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>›</span></span> list_to_lpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">⟹</span> coeff <span class="main">(</span>list_to_lpoly <span class="skolem">xs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>le<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>›</span></span> less_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>list_to_lpoly <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> le
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>lp_monom <span class="skolem">x</span> <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sum_list <span class="main">(</span>map2 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lp_monom <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> 
          <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH le nth_append<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> IH le list_to_lpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> list_to_lpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> eq
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sum_list <span class="main">(</span>map2 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lp_monom <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">xs</span><span class="main">]</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_map_upto_coeff_limit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_to_lpoly_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum_list <span class="main">(</span>map2 <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lp_monom <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> lp_monom <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">xs</span><span class="main">]</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> lp_monom <span class="skolem">x</span> <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">(</span>list_to_lpoly <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> lp_monom <span class="skolem">x</span> <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> list_to_lpoly_def <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq list_to_lpoly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-list_to_lpoly_coeff_nth"><span class="command">lemma</span></span> list_to_lpoly_coeff_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cs</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>list_to_lpoly <span class="free">cs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gr_implies_not0 rl_lpoly_coeff_nth_non_empty assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Matrix_LinPoly-rat_list_outside_zero"><span class="command">lemma</span></span> rat_list_outside_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>list_to_lpoly <span class="free">cs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_list_map_upto_coeff_limit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cs</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Transform linear polynomials to rational vectors ›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dim_poly</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dim_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>vars <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Max <span class="main">(</span>vars <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
<span class="comment1">(* 0, 0, 0, 3, 0, 0, … has dimension 4 , consistent with  dim vec  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_dim_poly_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">max_dim_poly_list</span> <span class="free"><span class="bound"><span class="entity">lst</span></span></span> <span class="main">=</span> Max <span class="main">{</span>Max <span class="main">(</span>vars <span class="bound">p</span><span class="main">)</span> <span class="main">|</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">lst</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lpoly_to_vec</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">lpoly_to_vec</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> vec <span class="main">(</span>dim_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_LinPoly-all_greater_dim_poly_zero"><span class="command">lemma</span></span> all_greater_dim_poly_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> dim_poly <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Max_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span> <span class="operator">OF</span> finite_vars<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> coeff_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_cancel_left_right assms dim_poly.elims empty_iff leD le_eq_less_or_eq 
      trans_less_add1 zero_neq_one_class.zero_neq_one<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-lpoly_to_vec_0_iff_zero_poly"><span class="command">lemma</span></span> lpoly_to_vec_0_iff_zero_poly <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lpoly_to_vec <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lpoly_to_vec <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vars_empty_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lpoly_to_vec <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_of_dim_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lpoly_to_vec <span class="free">p</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_empty_zero<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-dim_poly_dim_vec_equiv"><span class="command">lemma</span></span> dim_poly_dim_vec_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>lpoly_to_vec <span class="free">p</span><span class="main">)</span> <span class="main">=</span> dim_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lpoly_to_vec.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_LinPoly-dim_poly_greater_ex_coeff"><span class="command">lemma</span></span> dim_poly_greater_ex_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">x</span> <span class="main">&gt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">d</span><span class="main">.</span> coeff <span class="free">x</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> Max_in coeff_zero finite_vars less_Suc_eq_le<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-dimpoly_all_zero_limit"><span class="command">lemma</span></span> dimpoly_all_zero_limit<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> <span class="free">d</span> <span class="main">⟹</span> coeff <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">x</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span> <span class="free">d</span><span class="main">.</span> coeff <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> dim_poly <span class="free">x</span> <span class="main">≤</span> <span class="free">d</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dim_poly <span class="free">x</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">x</span> <span class="main">&gt;</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="free">d</span><span class="main">.</span> coeff <span class="free">x</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dim_poly_greater_ex_coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">d</span><span class="main">.</span> coeff <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-construct_poly_from_lower_dim_poly"><span class="command">lemma</span></span> construct_poly_from_lower_dim_poly<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">x</span> <span class="main">=</span> <span class="free">d</span><span class="main">+</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">p</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> lp_monom <span class="free">c</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> coeff <span class="free">x</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="free">d</span><span class="main">.</span> coeff <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">d</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_poly <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dimpoly_all_zero_limit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span>lp_monom <span class="skolem">c'</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">c</span><span class="main">.</span> dim_poly <span class="bound">p</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">+</span> lp_monom <span class="bound">c</span> <span class="free">d</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="quoted">"**"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> * p' c' that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-vars_subset_0_dim_poly"><span class="command">lemma</span></span> vars_subset_0_dim_poly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vars <span class="free">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="free">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_vars less_Suc_eq_le subsetI<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-in_dim_and_not_var_zero"><span class="command">lemma</span></span> in_dim_and_not_var_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="free">z</span><span class="main">}</span> <span class="main">-</span> vars <span class="free">z</span> <span class="main">⟹</span> coeff <span class="free">z</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coeff_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_LinPoly-valuate_with_dim_poly"><span class="command">lemma</span></span> valuate_with_dim_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⦃</span> <span class="free">X</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="free">z</span><span class="main">}</span><span class="main">.</span> coeff <span class="free">z</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="free">z</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> vars_subset_0_dim_poly <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Matrix_LinPoly-lin_poly_to_vec_coeff_access"><span class="command">lemma</span></span> lin_poly_to_vec_coeff_access<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> dim_poly <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lpoly_to_vec <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="free">x</span> <span class="main">=</span> coeff <span class="free">y</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>lpoly_to_vec <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dim_poly_dim_vec_equiv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-addition_over_lin_poly_to_vec"><span class="command">lemma</span></span> addition_over_lin_poly_to_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> dim_poly <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="free">x</span> <span class="main">=</span> dim_poly <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>lpoly_to_vec <span class="free">x</span> <span class="main">+</span> lpoly_to_vec <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> lin_poly_to_vec_coeff_access <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_poly_dim_vec_equiv<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-list_to_lpoly_dim_less"><span class="command">lemma</span></span> list_to_lpoly_dim_less<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">≥</span> dim_poly <span class="main">(</span>list_to_lpoly <span class="free">cs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dimpoly_all_zero_limit sum_list_map_upto_coeff_limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Transform rational vectors to linear polynomials ›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vec_to_lpoly</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">vec_to_lpoly</span> <span class="free"><span class="bound"><span class="entity">rv</span></span></span> <span class="main">=</span> list_to_lpoly <span class="main">(</span>list_of_vec <span class="free"><span class="bound"><span class="entity">rv</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_LinPoly-vec_to_lin_poly_coeff_access"><span class="command">lemma</span></span> vec_to_lin_poly_coeff_access<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> dim_vec <span class="free">y</span>"</span></span>           
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">$</span> <span class="free">x</span> <span class="main">=</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms list_to_lpoly_coeff_nth<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-addition_over_vec_to_lin_poly"><span class="command">lemma</span></span> addition_over_vec_to_lin_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> dim_vec <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">=</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">x</span> <span class="main">+</span> vec_to_lpoly <span class="free">y</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> coeff_plus index_add_vec<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_to_lin_poly_coeff_access<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-outside_list_coeff0"><span class="command">lemma</span></span> outside_list_coeff0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> dim_vec <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="free">xs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sum_list_map_upto_coeff_limit<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-vec_to_poly_dim_less"><span class="command">lemma</span></span> vec_to_poly_dim_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_poly <span class="main">(</span>vec_to_lpoly <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> dim_vec <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> list_to_lpoly_dim_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"list_of_vec <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Matrix_LinPoly-vec_to_lpoly_from_lpoly_coeff_dual1"><span class="command">lemma</span></span> vec_to_lpoly_from_lpoly_coeff_dual1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span>lpoly_to_vec <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_greater_dim_poly_zero dim_poly_dim_vec_equiv lin_poly_to_vec_coeff_access
      not_less outside_list_coeff0 vec_to_lin_poly_coeff_access<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-vec_to_lpoly_from_lpoly_coeff_dual2"><span class="command">lemma</span></span> vec_to_lpoly_from_lpoly_coeff_dual2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>lpoly_to_vec <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lpoly_to_vec <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dim_poly_dim_vec_equiv less_le_trans lin_poly_to_vec_coeff_access 
      vec_to_lin_poly_coeff_access vec_to_poly_dim_less<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-vars_subset_dim_vec_to_lpoly_dim"><span class="command">lemma</span></span> vars_subset_dim_vec_to_lpoly_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ivl_subset le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> order.trans vec_to_poly_dim_less
      vars_subset_0_dim_poly<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-sum_dim_vec_equals_sum_dim_poly"><span class="command">lemma</span></span> sum_dim_vec_equals_sum_dim_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">A</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly  <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> 
         <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly  <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">A</span> <span class="main">=</span> dim_poly <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span>"</span></span> <span class="main">|</span>
           <span class="main">(</span>le<span class="main">)</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">A</span> <span class="main">&gt;</span> dim_poly <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_to_poly_dim_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> le
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dp</span></span> <span class="keyword2"><span class="keyword">where</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dp</span> <span class="main">=</span> dim_poly <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">A</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">dp</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span> <span class="main">+</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="skolem">dp</span><span class="main">..&lt;</span>dim_vec <span class="free">A</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dp vec_to_poly_dim_less sum.atLeastLessThan_concat zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">dp</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_greater_dim_poly_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span><span class="main">.</span>coeff <span class="main">(</span>vec_to_lpoly <span class="free">A</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">X</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-vec_to_lpoly_vNil"><span class="command">lemma</span></span> vec_to_lpoly_vNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_lpoly vNil <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_list_0poly<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-zero_vector_is_zero_poly"><span class="command">lemma</span></span> zero_vector_is_zero_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less 
      outside_list_coeff0 vec_to_lin_poly_coeff_access<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-coeff_nonzero_dim_vec_non_zero"><span class="command">lemma</span></span> coeff_nonzero_dim_vec_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms leI outside_list_coeff0 vec_to_lin_poly_coeff_access<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms leI outside_list_coeff0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Matrix_LinPoly-lpoly_of_v_equals_v_append0"><span class="command">lemma</span></span> lpoly_of_v_equals_v_append0<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="free">v</span> <span class="main">=</span> vec_to_lpoly <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> coeff <span class="var">?lhs</span> <span class="bound">i</span> <span class="main">=</span> coeff <span class="var">?rhs</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>le<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ge<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> dim_vec <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> le
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vec_to_lin_poly_coeff_access<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> index_append_vec<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_to_lin_poly_coeff_access trans_less_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> ge
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> outside_list_coeff0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> na<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">va</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">va</span> <span class="main">=</span> coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> coeff_nonzero_dim_vec_non_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">v</span></span> <span class="keyword1"><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="keyword1"><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="free"><span class="free">a</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span><span class="main">]</span> na <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">va</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ge diff_is_0_eq' index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
              not_less_zero vec_to_lin_poly_coeff_access v zero_less_diff calculation<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">va</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v na <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  not_less <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Abstract_Linear_Poly.poly_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-vec_to_lpoly_eval_dot_prod"><span class="command">lemma</span></span> vec_to_lpoly_eval_dot_prod<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="main">⦃</span> <span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>vec <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="main">⦃</span> <span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">v</span><span class="main">}</span><span class="main">.</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">v</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="free">v</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
      vars_subset_dim_vec_to_lpoly_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">v</span><span class="main">}</span><span class="main">.</span> <span class="free">v</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_to_lpoly_coeff_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">v</span> <span class="main">∙</span> <span class="main">(</span>vec <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-dim_poly_of_append_vec"><span class="command">lemma</span></span> dim_poly_of_append_vec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_poly <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">a</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dim_vec <span class="free">a</span> <span class="main">+</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vec_to_poly_dim_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">b</span>"</span></span><span class="main">]</span> index_append_vec<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_LinPoly-vec_coeff_append1"><span class="command">lemma</span></span> vec_coeff_append1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">a</span><span class="main">}</span> <span class="main">⟹</span> coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">a</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span><span class="main">$</span><span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastLessThan_iff index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_to_lin_poly_coeff_access trans_less_add1<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-vec_coeff_append2"><span class="command">lemma</span></span> vec_coeff_append2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="main">{</span>dim_vec <span class="free">a</span><span class="main">..&lt;</span>dim_vec <span class="main">(</span><span class="free">a</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">b</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">a</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">b</span><span class="main">$</span><span class="main">(</span><span class="free">i</span><span class="main">-</span>dim_vec <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastLessThan_iff index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> leD vec_to_lin_poly_coeff_access<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Maybe Code Equation ›</span></span>
<span class="keyword1" id="Matrix_LinPoly-vec_to_lpoly_poly_of_vec_eq"><span class="command">lemma</span></span> vec_to_lpoly_poly_of_vec_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="free">v</span> <span class="main">=</span> poly_of_vec <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> coeff <span class="main">(</span>poly_of_vec <span class="free">v</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff.rep_eq poly_of_vec.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_to_lin_poly_coeff_access<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> coeff <span class="main">(</span>poly_of_vec <span class="free">v</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff.rep_eq poly_of_vec.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">v</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> outside_list_coeff0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abstract_Linear_Poly.poly_eq_iff le_less_linear<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-vars_vec_append_subset"><span class="command">lemma</span></span> vars_vec_append_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">+</span>dim_vec <span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="var">?p</span> <span class="main">≤</span> <span class="free">n</span><span class="main">+</span>dim_vec <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dim_poly_of_append_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">+</span>dim_vec <span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vars_subset_dim_vec_to_lpoly_dim<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_coeff_append1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">+</span>dim_vec <span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastLessThan_iff coeff_zero not_le subsetCE subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Matrices ›</span></span>

<span class="comment1">(* ‹ From ‹ mat › to ‹ linear_poly list ›  *)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">matrix_to_lpolies</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">matrix_to_lpolies</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> map vec_to_lpoly <span class="main">(</span>rows <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Matrix_LinPoly-matrix_to_lpolies_vec_of_row"><span class="command">lemma</span></span> matrix_to_lpolies_vec_of_row<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span>dim_row <span class="free">A</span> <span class="main">⟹</span> matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> matrix_to_lpolies.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Matrix_LinPoly-outside_of_col_range_is_0"><span class="command">lemma</span></span> outside_of_col_range_is_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≥</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> outside_list_coeff0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"col <span class="free">A</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_rows matrix_to_lpolies.simps nth_map nth_rows outside_list_coeff0<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-polys_greater_col_zero"><span class="command">lemma</span></span> polys_greater_col_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≥</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">x</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> outside_of_col_range_is_0<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> 
    assms<span class="main">(</span>2<span class="main">)</span> matrix_to_lpolies.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth length_map length_rows<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-matrix_to_lp_vec_to_lpoly_row"><span class="command">lemma</span></span> matrix_to_lp_vec_to_lpoly_row <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-matrix_to_lpolies_coeff_access"><span class="command">lemma</span></span> matrix_to_lpolies_coeff_access<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> matrix_to_lp_vec_to_lpoly_row<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_to_lin_poly_coeff_access<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ From linear polynomial list to matrix ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lin_polies_to_mat</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">lin_polies_to_mat</span> <span class="free"><span class="bound"><span class="entity">lst</span></span></span> <span class="main">=</span> mat <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">lst</span></span></span><span class="main">)</span> <span class="main">(</span>max_dim_poly_list <span class="free"><span class="bound"><span class="entity">lst</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span>coeff <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lst</span></span></span><span class="main">!</span><span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Matrix_LinPoly-lin_polies_to_rat_mat_coeff_index"><span class="command">lemma</span></span> lin_polies_to_rat_mat_coeff_index<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span>  <span class="main">(</span>max_dim_poly_list <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">L</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span>lin_polies_to_mat <span class="free">L</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lin_polies_to_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1" id="Matrix_LinPoly-vec_to_lpoly_valuate_equiv_dot_prod"><span class="command">lemma</span></span> vec_to_lpoly_valuate_equiv_dot_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">y</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span>  <span class="comment1">(* Can be ≥ *)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="free">y</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">($)</span><span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">⦃</span> <span class="main">($)</span><span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>vars<span class="var">?p</span><span class="main">.</span> coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">($)</span><span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="var">?p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vars_subset_dim_vec_to_lpoly_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">⦃</span> <span class="main">($)</span><span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>vars<span class="var">?p</span><span class="main">.</span> coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">($)</span><span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="var">?p</span><span class="main">}</span><span class="main">.</span> coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valuate_with_dim_poly <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> calculation sum.cong<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="main">⟹</span> coeff <span class="main">(</span>vec_to_lpoly <span class="free">y</span><span class="main">)</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">j</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms vec_to_lin_poly_coeff_access <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_to_lpoly_eval_dot_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">($)</span><span class="free">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms calculation dim_vec index_vec vec_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_LinPoly-matrix_to_lpolies_valuate_scalarP"><span class="command">lemma</span></span> matrix_to_lpolies_valuate_scalarP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">($)</span><span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vec_to_lpoly_valuate_equiv_dot_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Matrix_LinPoly-matrix_to_lpolies_lambda_valuate_scalarP"><span class="command">lemma</span></span> matrix_to_lpolies_lambda_valuate_scalarP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">$</span><span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> outside_of_col_range_is_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> subs<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="var">?p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>›</span></span> atLeastLessThan_iff coeff_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> vars <span class="var">?p</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">$</span><span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>›</span></span> coeff_zero<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="free">i</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?p</span> <span class="main">⦃</span> <span class="main">($)</span> <span class="free">x</span> <span class="main">⦄</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> matrix_to_lpolies_valuate_scalarP<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span> vars <span class="var">?p</span><span class="main">.</span> coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span> vars <span class="var">?p</span><span class="main">.</span> coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>›</span></span> mult.commute mult_zero_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?p</span> <span class="main">⦃</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⦄</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="LP_Preliminaries">
<div class="head">
<h1>Theory LP_Preliminaries</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> LP_Preliminaries
 <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="More_Jordan_Normal_Forms.html">More_Jordan_Normal_Forms</a>
    <a href="Matrix_LinPoly.html">Matrix_LinPoly</a>
    <a href="../Jordan_Normal_Form/Matrix_Impl.html">Jordan_Normal_Form.Matrix_Impl</a>
    <a href="../Farkas/Simplex_for_Reals.html">Farkas.Simplex_for_Reals</a>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Mapping.html">HOL-Library.Mapping</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*
        Component wise greater equal constraints for vector b starting at index 
            ‹ [x<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub>, x<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>+</sub><span class="hidden">⇩</span><sub>1</sub>,…,x<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>+</sub><span class="hidden">⇩</span><sub>n</sub>] ≥ [b<span class="hidden">⇩</span><sub>0</sub>, b<span class="hidden">⇩</span><sub>1</sub>,…,b<span class="hidden">⇩</span><sub>n</sub>] › 
*)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vars_from_index_geq_vec</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vars_from_index_geq_vec</span> <span class="free"><span class="bound"><span class="entity">index</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">[</span>GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">index</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>


<span class="keyword1" id="LP_Preliminaries-constraints_set_vars_geq_vec_def"><span class="command">lemma</span></span> constraints_set_vars_geq_vec_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>vars_from_index_geq_vec <span class="free">start</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">{</span>GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">start</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_comprehension_list_comprehension<span class="main">[</span><span class="operator">of</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">start</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LP_Preliminaries-vars_from_index_geq_sat"><span class="command">lemma</span></span> vars_from_index_geq_sat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>vars_from_index_geq_vec <span class="free">start</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">start</span><span class="main">)</span> <span class="main">≥</span> <span class="free">b</span><span class="main">$</span><span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e_e<span class="main">:</span><span class="quoted"><span class="quoted">"GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">start</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>vars_from_index_geq_vec <span class="free">start</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> constraints_set_vars_geq_vec_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">start</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">start</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">start</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">≥</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> satisfies_constraint.simps<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"lp_monom <span class="main">1</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">start</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">$</span><span class="free">i</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* Matrix A less equal vector b (A ≤ b):
           a1 b1 c1 d1 ∙ X ≤ b_1,
           a2 b2 c2 d2 ∙ X ≤ b_2,
           ...
*)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mat_x_leq_vec</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mat_x_leq_vec</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="main">(</span>matrix_to_lpolies <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_x_leq_vec_sol"><span class="command">lemma</span></span> mat_x_leq_vec_sol<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e_e<span class="main">:</span> <span class="quoted"><span class="quoted">"LEQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> LEQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> satisfies_constraint.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* Matrix A less equal vector b (A = b):
           a1 b1 c1 d1 ∙ X = b_1,
           a2 b2 c2 d2 ∙ X = b_2,
           ... 
*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">x_mat_eq_vec</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x_mat_eq_vec</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">[</span>EQ <span class="main">(</span>matrix_to_lpolies <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-x_mat_eq_vec_sol"><span class="command">lemma</span></span> x_mat_eq_vec_sol<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>x_mat_eq_vec <span class="free">b</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⦃</span> <span class="free">x</span> <span class="main">⦄</span> <span class="main">=</span> <span class="free">b</span><span class="main">$</span><span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e_e<span class="main">:</span> <span class="quoted"><span class="quoted">"EQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>x_mat_eq_vec <span class="free">b</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> EQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> satisfies_constraint.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Get different matrices into same space, without interference ›</span></span>

<span class="comment1">(* Given matrix A and B create: 
               A 0
               0 B  
*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">two_block_non_interfering</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">two_block_non_interfering</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">z1</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">;</span>
                                        <span class="bound">z2</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
                                    four_block_mat <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">z1</span> <span class="bound">z2</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-split_two_block_non_interfering"><span class="command">lemma</span></span> split_two_block_non_interfering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_block <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q1</span><span class="main">,</span> <span class="free">Q2</span><span class="main">,</span> <span class="free">Q3</span><span class="main">,</span> <span class="free">Q4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q1</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q4</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> split_four_block_dual_fst_lst<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q3</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q4</span></span></span></span><span class="main">]</span> 
    assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LP_Preliminaries-two_block_non_interfering_dims"><span class="command">lemma</span></span> two_block_non_interfering_dims<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span> <span class="main">+</span> dim_row <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span> <span class="main">+</span> dim_col <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-two_block_non_interfering_zeros_are_0"><span class="command">lemma</span></span> two_block_non_interfering_zeros_are_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≥</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">$$</span><span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">$$</span><span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> four_block_mat_def assms two_block_non_interfering_dims<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="LP_Preliminaries-two_block_non_interfering_row_comp1"><span class="command">lemma</span></span> two_block_non_interfering_row_comp1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span>dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LP_Preliminaries-two_block_non_interfering_row_comp2"><span class="command">lemma</span></span> two_block_non_interfering_row_comp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span>dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_row <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-first_vec_two_block_non_inter_is_first_vec"><span class="command">lemma</span></span> first_vec_two_block_non_inter_is_first_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">+</span> dim_col <span class="free">B</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>vec_first <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"two_block_non_interfering <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="var">?tb</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> vec_first <span class="main">(</span>vec <span class="main">(</span>dim_row <span class="var">?tb</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="var">?tb</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_mat_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>vec <span class="free">n</span>  <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="var">?tb</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_first_def <span class="keyword1"><span class="command">using</span></span> trans_less_add1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dim_mult_mat_vec index_vec  two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="var">?tb</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_n<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> i_n two_block_non_interfering_row_comp1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> vec_first <span class="free">v</span> <span class="main">(</span>dim_vec <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span> <span class="main">∙</span> vec_last <span class="free">v</span> <span class="main">(</span>dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_split_vec_distrib_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> 
             row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> vec_first <span class="free">v</span> <span class="main">(</span>dim_vec <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> 
             <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> i_n<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim_vec_def dim_mult_mat_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_first <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_first <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> 
             dim_vec <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-last_vec_two_block_non_inter_is_last_vec"><span class="command">lemma</span></span> last_vec_two_block_non_inter_is_last_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">+</span> dim_col <span class="free">B</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">B</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span><span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>vec_last <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"two_block_non_interfering <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec <span class="main">(</span>dim_row <span class="var">?tb</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="var">?tb</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> in3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="var">?tb</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">≥</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> in3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="var">?tb</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="var">?tb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> i_n two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">+</span> <span class="free">n</span> <span class="main">=</span> dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dim_a<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> diff_add_inverse2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span><span class="var">?tb</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> vec_last <span class="main">(</span>vec <span class="main">(</span>dim_row <span class="var">?tb</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> row <span class="var">?tb</span> <span class="bound">i</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_mat_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?vl</span> <span class="main">$</span> <span class="main">(</span>dim_vec <span class="var">?vl</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_last_def <span class="keyword1"><span class="command">using</span></span> i_n index_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="var">?tb</span> <span class="main">(</span><span class="main">(</span>dim_row <span class="var">?tb</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> index_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> i_n two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">B</span> <span class="skolem">i</span> <span class="main">∙</span> vec_last <span class="free">v</span> <span class="main">(</span>dim_vec <span class="main">(</span>row <span class="free">B</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">B</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹dim_col <span class="free">A</span> <span class="main">+</span> dim_col <span class="free">B</span> <span class="main">=</span> dim_vec <span class="free">v</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dim_a assms<span class="main">(</span>1<span class="main">)</span> in3' two_block_non_interfering_row_comp2
        append_split_vec_distrib_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"row <span class="free">B</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.right_neutral diff_add_inverse
          in3 index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> scalar_prod_left_zero  vec_first_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">B</span> <span class="skolem">i</span> <span class="main">∙</span> vec_last <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> calculation i_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-two_block_non_interfering_mult_decomposition"><span class="command">lemma</span></span> two_block_non_interfering_mult_decomposition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">+</span> dim_col <span class="free">B</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>      
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"two_block_non_interfering <span class="free">A</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">=</span>
         <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"two_block_non_interfering <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> first_vec_two_block_non_inter_is_first_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="var">?tb</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> last_vec_two_block_non_inter_is_last_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">B</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span><span class="var">?tb</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">v</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vec_first_last_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?tb</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span>"</span></span><span class="main">]</span>
      dim_mult_mat_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?tb</span>"</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> two_block_non_interfering_dims<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_vec_dim_vec<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* A ≤ b   
   A = c *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mat_leqb_eqc</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mat_leqb_eqc</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">lst</span> <span class="main">=</span> matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="keyword1">in</span>
                         <span class="main">[</span>LEQ <span class="main">(</span><span class="bound">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span><span class="main">]</span> <span class="main">@</span>
                         <span class="main">[</span>EQ  <span class="main">(</span><span class="bound">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_for_LEQ"><span class="command">lemma</span></span> mat_leqb_eqc_for_LEQ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> LEQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lst</span></span> <span class="keyword2"><span class="keyword">where</span></span> lst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span> <span class="main">=</span> <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ileqA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> vec_to_lpoly <span class="main">(</span><span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l <span class="keyword1"><span class="command">using</span></span> two_block_non_interfering_row_comp1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">,</span> <span class="operator">OF</span> ileqA<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ileqA lpoly_of_v_equals_v_append0 matrix_to_lp_vec_to_lpoly_row 
        trans_less_add1 two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lpoly_of_v_equals_v_append0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> l
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ileqA<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span> <span class="main">@</span>
                         <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l lst <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat_leqb_eqc.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span> <span class="main">@</span> 
         <span class="main">[</span>EQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> 
         <span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> lst <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nth_append<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> LEQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l lst
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> leq lst  <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_for_EQ"><span class="command">lemma</span></span> mat_leqb_eqc_for_EQ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">≥</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> 
    EQ <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="free">i</span><span class="main">-</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">$</span><span class="main">(</span><span class="free">i</span><span class="main">-</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lst</span></span> <span class="keyword2"><span class="keyword">where</span></span> lst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span> <span class="main">=</span> <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> l'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> vec_to_lpoly <span class="main">(</span><span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l two_block_non_interfering_row_comp2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">,</span> <span class="operator">OF</span> i_s<span class="main">]</span>
      assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> i_s matrix_to_lp_vec_to_lpoly_row <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span> <span class="main">@</span>
                         <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span>
        <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span><span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> leD nth_append<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> EQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> EQ <span class="main">(</span><span class="skolem">l</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">$</span><span class="main">(</span><span class="free">i</span><span class="main">-</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> calculation l l'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_satisfies1"><span class="command">lemma</span></span> mat_leqb_eqc_satisfies1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e_e<span class="main">:</span> <span class="quoted"><span class="quoted">"LEQ <span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_for_LEQ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> 
      nth_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"matrix_to_lpolies <span class="free">A</span>"</span></span><span class="main">]</span> mat_leqb_eqc.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_zero in_set_conv_nth length_append length_map 
        length_upt trans_less_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> LEQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> satisfies_constraint.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_satisfies2"><span class="command">lemma</span></span> mat_leqb_eqc_satisfies2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">≤</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e_e<span class="main">:</span> <span class="quoted"><span class="quoted">"EQ <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∈</span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mat_leqb_eqc.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
      nth_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  mat_leqb_eqc_for_EQ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_diff_cancel_left' assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> diff_zero index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        length_append length_map length_upt<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> sateq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> EQ <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> 
                row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">$</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> dual_order.order_iff_strict dual_order.strict_trans 
        index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nat_add_left_cancel_less 
        two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> EQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_block_non_interfering_row_comp2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">,</span> <span class="operator">OF</span> * **<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> sateq assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> leD
        matrix_to_lp_vec_to_lpoly_row<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> satisfies_constraint.simps<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_simplex_satisfies2"><span class="command">lemma</span></span> mat_leqb_eqc_simplex_satisfies2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">≤</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_satisfies2 assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">index_geq_n</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">index_geq_n</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-index_geq_n_simplex"><span class="command">lemma</span></span> index_geq_n_simplex<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>  <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span>index_geq_n <span class="free">i</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">i</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="comment1">(* In the variables x_i to x_i+(length v) we synthesise a vector that is pointwise
       greater than v *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">from_index_geq0_vector</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">from_index_geq0_vector</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">[</span>GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> j <span class="main">&lt;-</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-from_index_geq_vector_simplex"><span class="command">lemma</span></span> from_index_geq_vector_simplex<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>from_index_geq0_vector <span class="free">i</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">≥</span> <span class="free">v</span><span class="main">$</span><span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="free">j</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span>from_index_geq0_vector <span class="free">i</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> GEQ <span class="main">(</span>lp_monom <span class="main">1</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">$</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">)</span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-from_index_geq0_vector_simplex2"><span class="command">lemma</span></span> from_index_geq0_vector_simplex2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>from_index_geq0_vector <span class="free">i</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">j</span> <span class="main">≥</span> <span class="free">v</span><span class="main">$</span><span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> from_index_geq_vector_simplex 
      le_add_diff_inverse less_diff_conv2<span class="main">)</span>


<span class="comment1">(* [c1, ... cm, 01, ... 0n] * X ≥ [01, ... 0m, b1,...,bn] * X *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">x_times_c_geq_y_times_b</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x_times_c_geq_y_times_b</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> GEQPP <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-x_times_c_geq_y_times_b_correct"><span class="command">lemma</span></span> x_times_c_geq_y_times_b_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">[</span>x_times_c_geq_y_times_b <span class="free">c</span> <span class="free">b</span><span class="main">]</span> <span class="main">=</span> Sat <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="free">c</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main">⦄</span><span class="main">)</span> <span class="main">≥</span>
         <span class="main">(</span><span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main">⦄</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="comment1">(* Splitting an assignment into two vectors *)</span>

<span class="comment1">(* The first [0...(i-1)] elements and [i...j] elements *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">split_i_j_x</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">split_i_j_x</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>vec <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟩</span><span class="main">,</span> vec <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟩</span> <span class="main">(</span><span class="bound">y</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">split_n_m_x</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">split_n_m_x</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> split_i_j_x <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>


<span class="keyword1" id="LP_Preliminaries-split_vec_dims"><span class="command">lemma</span></span> split_vec_dims<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_i_j_x <span class="free">i</span> <span class="free">j</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> split_i_j_x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-split_n_m_x_abbrev_dims"><span class="command">lemma</span></span> split_n_m_x_abbrev_dims<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_n_m_x <span class="free">n</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> split_vec_dims 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> assms split_vec_dims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="LP_Preliminaries-split_access_fst_1"><span class="command">lemma</span></span> split_access_fst_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_i_j_x <span class="free">i</span> <span class="free">j</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_vec split_i_j_x_def<span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-split_access_snd_1"><span class="command">lemma</span></span> split_access_snd_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_i_j_x <span class="free">i</span> <span class="free">j</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">$</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> split_i_j_x_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-split_access_fst_2"><span class="command">lemma</span></span> split_access_fst_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="free">i</span> <span class="free">j</span> <span class="free">Z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> dim_vec <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">$</span><span class="free">k</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">Z</span><span class="main">⟩</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> split_access_fst_1 split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-split_access_snd_2"><span class="command">lemma</span></span> split_access_snd_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="free">i</span> <span class="free">j</span> <span class="free">Z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> dim_vec <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">$</span><span class="free">k</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">Z</span><span class="main">⟩</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span>dim_vec <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms split_i_j_x_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">Z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LP_Preliminaries-from_index_geq0_vector_split_snd"><span class="command">lemma</span></span> from_index_geq0_vector_split_snd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>from_index_geq0_vector <span class="free">d</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="free">d</span> <span class="free">m</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">≥</span> <span class="free">v</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> split_i_j_x_def 
  <span class="keyword1"><span class="command">using</span></span> from_index_geq_vector_simplex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span> <span class="main">_</span><span class="main">]</span> index_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-split_coeff_vec_index_sum"><span class="command">lemma</span></span> split_coeff_vec_index_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_vec <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="free">v</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> 
         <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">.</span> lpoly_to_vec <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> valuate_with_dim_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">.</span> <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">.</span> <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms split_access_fst_1 split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sum.ivl_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms dim_poly_dim_vec_equiv 
        lin_poly_to_vec_coeff_access split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sum.ivl_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-scalar_prod_valuation_after_split_equiv1"><span class="command">lemma</span></span> scalar_prod_valuation_after_split_equiv1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_vec <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> valuate_with_dim_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="free">v</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="free">v</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">.</span> <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">x</span><span class="main">.</span> <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms split_access_fst_1 split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sum.ivl_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>lpoly_to_vec <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"1"</span> dim_poly_dim_vec_equiv lin_poly_to_vec_coeff_access 
        split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sum.ivl_cong assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_times_vec_leq</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span>_<span class="keyword1">]≤</span>_"</span> <span class="main">[</span>1000<span class="main">,</span>1000<span class="main">,</span>100<span class="main">]</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">*<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]≤</span></span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_times_mat_eq</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span>_<span class="keyword1">]=</span>_"</span> <span class="main">[</span>1000<span class="main">,</span>1000<span class="main">,</span>100<span class="main">]</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free"><span class="hidden">⇩</span><sub>v</sub>*</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">]=</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_times_mat_leq</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span>_<span class="keyword1">]≤</span>_"</span> <span class="main">[</span>1000<span class="main">,</span>1000<span class="main">,</span>100<span class="main">]</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free"><span class="hidden">⇩</span><sub>v</sub>*</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">]≤</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_times_vec_leqI"><span class="command">lemma</span></span> mat_times_vec_leqI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_times_vec_leq_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LP_Preliminaries-mat_times_vec_leqD"><span class="command">lemma</span></span> mat_times_vec_leqD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mat_times_vec_leq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-vec_times_mat_eqD"><span class="command">lemma</span></span> vec_times_mat_eqD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free">c</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vec_times_mat_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-vec_times_mat_leqD"><span class="command">lemma</span></span> vec_times_mat_leqD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]≤</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free">c</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vec_times_mat_leq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_times_vec_eqI"><span class="command">lemma</span></span> mat_times_vec_eqI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_times_mat_eq_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_split_correct1"><span class="command">lemma</span></span> mat_leqb_eqc_split_correct1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="free">l</span> <span class="free">X</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> split_i_j_x_def 
    <span class="keyword1"><span class="command">using</span></span> split_vec_dims<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"dim_col <span class="free"><span class="free">A</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> mat_leqb_eqc_satisfies1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="main">⦄</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_poly <span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_to_poly_dim_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> two_block_non_interfering_row_comp1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="skolem">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lpoly_of_v_equals_v_append0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_poly <span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
                      Abstract_Linear_Poly.coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valuate_with_dim_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_col <span class="free">A</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> split_coeff_vec_index_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
      sum_dim_vec_equals_sum_dim_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">x</span>›</span></span> i assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> matrix_to_lpolies_coeff_access<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> matrix_to_lp_vec_to_lpoly_row<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
      split_access_fst_1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> m i lpoly_of_v_equals_v_append0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_split_simplex_correct1"><span class="command">lemma</span></span> mat_leqb_eqc_split_simplex_correct1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="free">l</span> <span class="free">X</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_split_correct1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-sat_mono"><span class="command">lemma</span></span> sat_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">A</span> <span class="main">⊆</span> set <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="free">B</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_split_subset_correct1"><span class="command">lemma</span></span> mat_leqb_eqc_split_subset_correct1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="free">S</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="free">l</span> <span class="free">X</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sat_mono assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> 
    mat_leqb_eqc_split_correct1 simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_split_correct2"><span class="command">lemma</span></span> mat_leqb_eqc_split_correct2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="free">X</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms split_n_m_x_abbrev_dims<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lst</span></span> <span class="keyword2"><span class="keyword">where</span></span> lst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span> <span class="main">=</span> matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">db</span></span> <span class="keyword2"><span class="keyword">where</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">db</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dc</span></span> <span class="keyword2"><span class="keyword">where</span></span> dc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dc</span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">≤</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dbi_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"3"</span> db<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">≤</span> <span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> db<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span> <span class="main">@</span>
        <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
         EQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_for_EQ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    nth_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"3"</span> db<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rowA<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_transpose_mat<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> EQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> db diff_add_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lst</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="main">⦄</span> <span class="main">=</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dbi_dim rowA * cA assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
          index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> leD lst mat_leqb_eqc_satisfies2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> satisfies_constraint.simps<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lst</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span> <span class="free">c</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> vec <span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vdim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">V</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V db dc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dbi_dim assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rowA two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">≤</span> <span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> db<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> two_block_non_interfering_row_comp2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">,</span> <span class="operator">OF</span> * **<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> eql<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">db</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> db<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> matrix_to_lp_vec_to_lpoly_row<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> eqv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> lst matrix_to_lp_vec_to_lpoly_row <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>dim_col <span class="free">A</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        vec_to_lin_poly_coeff_access trans_less_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> eqv index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> leD
        add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coeff_nonzero_dim_vec_non_zero<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> db dc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastLessThan_iff calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coeff_zero not_le subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">V</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span> <span class="main">*</span> <span class="skolem">V</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="main">(</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">≡</span> vec <span class="main">(</span><span class="skolem">db</span> <span class="main">+</span> <span class="skolem">dc</span><span class="main">)</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>›</span></span> vdim assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          atLeastLessThan_iff dim_vec eql eqv index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          vec_to_lin_poly_coeff_access semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> 
          two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_col <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span> <span class="main">*</span> <span class="skolem">V</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span> <span class="main">*</span> <span class="skolem">V</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_cancel_left_left atLeastLessThan_iff mult_eq_0_iff
        class_semiring.add.finprod_all1 index_append_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> trans_less_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">db</span><span class="main">+</span><span class="skolem">dc</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span> <span class="main">*</span> <span class="skolem">V</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dc index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        le_add1 le_add_same_cancel1 sum.atLeastLessThan_concat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">∙</span> vec_first <span class="skolem">V</span> <span class="main">(</span>dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
                   row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span> <span class="main">∙</span> vec_last <span class="skolem">V</span> <span class="main">(</span>dim_vec <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_split_vec_distrib_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="skolem">V</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="skolem">V</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="free">b</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">∙</span> vec_first <span class="skolem">V</span> <span class="main">(</span>dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
                   row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span> <span class="main">∙</span> vec_last <span class="skolem">V</span> <span class="main">(</span>dim_vec <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="skolem">V</span> <span class="main">(</span>dim_vec <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">db</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> db<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">va</span><span class="main">.</span> vec <span class="skolem">db</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">dc</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="bound">va</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject add_diff_cancel_left' assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> dc split_i_j_x_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> V vec_last_def
          <span class="keyword1"><span class="command">using</span></span> split_access_fst_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> add.commute add_diff_cancel_left' add_less_cancel_left 
              dim_vec f1 index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_vec<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult_mat_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation index_vec sat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_split_simplex_correct2"><span class="command">lemma</span></span> mat_leqb_eqc_split_simplex_correct2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="free">X</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> mat_leqb_eqc_split_correct2 simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-mat_leqb_eqc_correct"><span class="command">lemma</span></span> mat_leqb_eqc_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_split_simplex_correct1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> mat_leqb_eqc_split_simplex_correct2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_split_correct2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Matrix.transpose_transpose assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
      mat_leqb_eqc_split_simplex_correct1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-eval_lpoly_eq_dot_prod_split1"><span class="command">lemma</span></span> eval_lpoly_eq_dot_prod_split1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="free">c</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span>  <span class="free">c</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="free">c</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>vars <span class="main">(</span>vec_to_lpoly <span class="free">c</span><span class="main">)</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span>vec_to_lpoly <span class="free">c</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> linear_poly_sum sum.cong eval_poly_with_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">c</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span>vec_to_lpoly <span class="free">c</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vars_subset_dim_vec_to_lpoly_dim<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> linear_poly_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">]</span> 
      eval_poly_with_sum_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"vec_to_lpoly <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> split_access_fst_1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
      split_access_snd_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
      vec_to_lin_poly_coeff_access<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def
    <span class="keyword1"><span class="command">using</span></span> split_vec_dims<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-eval_lpoly_eq_dot_prod_split2"><span class="command">lemma</span></span> eval_lpoly_eq_dot_prod_split2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span>  <span class="free">c</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="free">b</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coeff_nonzero_dim_vec_non_zero<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="var">?v0</span> <span class="main">=</span> dim_vec <span class="free">b</span> <span class="main">+</span> dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⦃</span><span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>vars <span class="var">?p</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="var">?v0</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="var">?v0</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span><span class="main">]</span> calculation
      vars_subset_dim_vec_to_lpoly_dim<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?v0</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">..&lt;</span>dim_vec <span class="var">?v0</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeastLessThan_concat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">..&lt;</span>dim_vec <span class="var">?v0</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">..&lt;</span>dim_vec <span class="var">?v0</span><span class="main">}</span><span class="main">.</span> <span class="var">?v0</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_to_lin_poly_coeff_access <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="var">?v0</span><span class="main">$</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> index_zero_vec<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span>"</span></span><span class="main">]</span> index_append_vec<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> ** *
       sum.shift_bounds_nat_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?v0</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> split_access_snd_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastLessThan_iff split_access_snd_2 
        split_n_m_x_abbrev_dims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms scalar_prod_def split_n_m_x_abbrev_dims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-x_times_c_geq_y_times_b_split_dotP"><span class="command">lemma</span></span> x_times_c_geq_y_times_b_split_dotP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> x_times_c_geq_y_times_b <span class="free">c</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lpoly_of_v_equals_v_append0 eval_lpoly_eq_dot_prod_split2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
   eval_lpoly_eq_dot_prod_split1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LP_Preliminaries-mult_right_leq"><span class="command">lemma</span></span> mult_right_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>ordered_semiring<span class="main">}</span><span class="main">)</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">y</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free">y</span><span class="main">.</span> <span class="free">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span>dim_vec <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span>dim_vec <span class="free">b</span><span class="main">.</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lessThan_iff 
        mat_times_vec_leq_def mult_right_mono sum_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atLeast0LessThan scalar_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-mult_right_eq"><span class="command">lemma</span></span> mult_right_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def 
  <span class="keyword1"><span class="command">using</span></span> atLeastLessThan_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span>"</span></span><span class="main">]</span> vec_times_mat_eq_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
    sum.cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-soundness_mat_x_leq"><span class="command">lemma</span></span> soundness_mat_x_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span>split_n_m_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_i_j_x_def x<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_x_leq_vec_sol<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eval_lpoly_eq_dot_prod_split1 
          fst_conv index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> matrix_to_lp_vec_to_lpoly_row simplex<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> split_i_j_x_def x<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_times_vec_leqI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-completeness_mat_x_leq"><span class="command">lemma</span></span> completeness_mat_x_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Sat <span class="bound">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Inr <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> simplex<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mat_x_leq_vec <span class="free">A</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> sum.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms mat_times_vec_leqD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="main">_</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> x_A<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="skolem">x</span> <span class="keyword1">then</span> <span class="skolem">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> v_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="skolem">x</span><span class="main">.</span> <span class="skolem">x</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">v</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> set <span class="main">(</span>mat_x_leq_vec <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> LEQ <span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"matrix_to_lpolies <span class="free">A</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">⦃</span> <span class="skolem">v</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_to_lpolies_lambda_valuate_scalarP<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> v
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>›</span></span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x_A<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_mult_mat_vec mat_times_vec_leq_def x<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>1<span class="main">)</span> satisfies_constraint.simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> 
        2 <span class="quoted"><span class="quoted">‹row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-soundness_mat_x_eq_vec"><span class="command">lemma</span></span> soundness_mat_x_eq_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span>split_n_m_x <span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> split_i_j_x_def <span class="keyword1"><span class="command">using</span></span> split_vec_dims<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> fst_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_i_j_x_def x<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free">c</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="free">c</span><span class="main">$</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_mat_eq_vec_sol<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">,</span> <span class="operator">OF</span> * a<span class="main">]</span> eval_lpoly_eq_dot_prod_split1 fstI       
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> matrix_to_lpolies_vec_of_row split_i_j_x_def x<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_mat_vec_def <span class="keyword1"><span class="command">using</span></span> a assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_times_vec_eqI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-completeness_mat_x_eq_vec"><span class="command">lemma</span></span> completeness_mat_x_eq_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> Sat <span class="bound">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> Inr <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> simplex<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> sum.exhaust_sel 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_times_mat_eqD<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="skolem">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>›</span></span> vec_times_mat_eq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="skolem">x</span> <span class="keyword1">then</span> <span class="skolem">x</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> v_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="skolem">x</span><span class="main">.</span> <span class="skolem">x</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">v</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>x_mat_eq_vec <span class="free">c</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> EQ <span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_cancel_right_left diff_zero in_set_conv_nth length_map length_upt nth_map_upt x_mat_eq_vec.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"matrix_to_lpolies <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">!</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">⦃</span> <span class="skolem">v</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_to_lpolies_lambda_valuate_scalarP<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> v
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">c</span> <span class="main">=</span> dim_col <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>›</span></span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">x</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">c</span> <span class="main">=</span> dim_col <span class="free">A</span>›</span></span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_mult_mat_vec index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_times_mat_eqD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>1<span class="main">)</span> satisfies_constraint.simps<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-soundness_mat_leqb_eqc1"><span class="command">lemma</span></span> soundness_mat_leqb_eqc1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span>split_n_m_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_i_j_x_def x<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_x_leq_vec_sol<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fst_conv split_i_j_x_def x
          index_mult_mat_vec mat_leqb_eqc_split_simplex_correct1 mat_times_vec_leqD<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_times_vec_leqI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-soundness_mat_leqb_eqc2"><span class="command">lemma</span></span> soundness_mat_leqb_eqc2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="bound">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> mat_times_vec_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> snd <span class="main">(</span>split_n_m_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">y</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_i_j_x_def x<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"*"</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_split_correct2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Matrix.transpose_transpose assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          simplex<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> snd_conv split_i_j_x_def x<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a vec_times_mat_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-completeness_mat_leqb_eqc"><span class="command">lemma</span></span> completeness_mat_leqb_eqc<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="bound">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="bound">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> simplex<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> sum.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms mat_times_vec_leqD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="main">_</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> x_A<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> yr<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">y</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_times_mat_eq_def x<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="skolem">x</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">x</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="skolem">y</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> v_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="skolem">x</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="skolem">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="skolem">y</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">v</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_vec <span class="skolem">y</span><span class="main">}</span><span class="main">.</span> <span class="skolem">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span>dim_vec <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lst</span></span> <span class="keyword2"><span class="keyword">where</span></span> lst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span> <span class="main">=</span> matrix_to_lpolies <span class="main">(</span>two_block_non_interfering <span class="free">A</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>LEQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">]</span><span class="main">]</span> <span class="main">@</span>
              <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span> <span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> lst mat_leqb_eqc.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="var">?L</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="var">?L</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastLessThan_iff in_set_conv_nth not_le not_less0<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ldimbc<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?L</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>leqb<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="free">b</span><span class="main">}</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eqc<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span>dim_vec <span class="free">b</span><span class="main">..&lt;</span>length <span class="var">?L</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> leqb
      <span class="keyword1"><span class="command">have</span></span> il<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> atLeastLessThan_iff leqb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> LEQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nth_append il<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> LEQ <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_for_LEQ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="operator">OF</span> il <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>›</span></span><span class="main">]</span> L i<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eqmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>matrix_to_lpolies <span class="free">A</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> sset<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_to_lpolies_vec_of_row
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>›</span></span> eqmp index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  
            vars_subset_dim_vec_to_lpoly_dim x_A<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⦃</span> <span class="skolem">v</span> <span class="main">⦄</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vec_to_lpoly <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span> <span class="skolem">v</span> <span class="main">⦄</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>›</span></span> eqmp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>vars<span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ** eval_poly_with_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sset eval_poly_with_sum_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> 
            <span class="operator">OF</span> finite_atLeastLessThan sset<span class="main">]</span> <span class="quoted">"**"</span> <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_vec <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> matrix_to_lpolies_vec_of_row<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">OF</span> iA<span class="main">]</span> 
          vec_to_lin_poly_coeff_access<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> index_row<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> 
          atLeastLessThan_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> eqmp sum.cong x_A<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>›</span></span> index_mult_mat_vec mat_times_vec_leq_def x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"*"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> eqc
      <span class="keyword1"><span class="command">have</span></span> igeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> dim_vec <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> atLeastLessThan_iff eqc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?L</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> atLeastLessThan_iff eqc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span><span class="var">?L</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L i<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> set <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span><span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> in_second_append_list length_map
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> igeq *  length_upt minus_nat.diff_0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">[</span>EQ  <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span>dim_vec <span class="free">b</span><span class="main">..&lt;</span> dim_vec <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span>dim_vec <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">b</span> <span class="main">≤</span> <span class="skolem">i</span>›</span></span> diff_zero leD 
            length_map length_upt nth_append<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> EQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> add_diff_inverse_nat diff_less_mono
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">b</span> <span class="main">≤</span> <span class="skolem">i</span>›</span></span> * ldimbc  leD nth_map_upt<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> EQ <span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> mat_leqb_eqc_for_EQ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">OF</span> igeq<span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> lsta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lst</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>›</span></span> * ldimbc assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> igeq 
            index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lst matrix_to_lpolies_vec_of_row vec_times_mat_eq_def
            two_block_non_interfering_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> two_block_non_interfering_row_comp2 <span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_to_lpoly <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_poly <span class="var">?p</span> <span class="main">≤</span> dim_col <span class="free">A</span> <span class="main">+</span> dim_row <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> dim_poly_of_append_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
          index_zero_vec<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>›</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_col <span class="free">A</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vec_coeff_append1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastLessThan_iff index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_le<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span> <span class="main">+</span> dim_row <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_append_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> allcr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' atLeastLessThan_iff diff_add_inverse index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            le_add_same_cancel2 less_diff_conv vec_coeff_append2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="var">?p</span> <span class="main">⊆</span> <span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span>dim_col <span class="free">A</span> <span class="main">+</span> dim_row <span class="free">A</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vars_vec_append_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⦃</span> <span class="skolem">v</span> <span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>vars <span class="var">?p</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_poly_with_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span>dim_col <span class="free">A</span><span class="main">..&lt;</span>dim_col <span class="free">A</span> <span class="main">+</span> dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">j</span><span class="main">)</span>"</span></span>     
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DiffD2 vs coeff_zero finite_atLeastLessThan
            mult_not_zero sum.mono_neutral_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_nat_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">j</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.commute add_cancel_left_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> Abstract_Linear_Poly.coeff <span class="var">?p</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v i_in yr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sum.cong x_A<span class="main">)</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">$</span><span class="bound">j</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">$</span><span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> allcr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sum.cong<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹dim_vec <span class="skolem">y</span> <span class="main">=</span> dim_row <span class="free">A</span>›</span></span> scalar_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span><span class="free">c</span><span class="main">)</span><span class="main">$</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vec_times_mat_eqD<span class="main">[</span><span class="operator">OF</span> x<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> * igeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> e lsta satisfies_constraint.simps<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lst</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LP_Preliminaries-sound_and_compltete_mat_leqb_eqc"><span class="command">lemma</span></span> sound_and_compltete_mat_leqb_eqc <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="bound">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> simplex <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Sat <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> completeness_mat_leqb_eqc index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
      soundness_mat_leqb_eqc1 soundness_mat_leqb_eqc2<span class="main">)</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Translate Inequalities to Matrix Form ›</span></span>

<span class="comment1">(* We (obviously) cannot use strict inequalities hence we use the option type *)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nonstrict_constr</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main">(</span>LEQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main">(</span>GEQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main">(</span>EQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main">(</span>LEQPP <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main">(</span>GEQPP <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main">(</span>EQPP <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constr</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonstrict_constrs</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">.</span> nonstrict_constr <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">transf_constraint</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main">(</span>LEQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main">(</span>GEQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main">(</span>EQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> LEQ <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main">(</span>LEQPP <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main">(</span>GEQPP <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main">(</span>EQPP <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LEQ <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">,</span> LEQ <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transf_constraint</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">transf_constraints</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">transf_constraints</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">transf_constraints</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> transf_constraint <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="main">(</span><span class="free">transf_constraints</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="LP_Preliminaries-trans_constraint_creats_LEQ_only"><span class="command">lemma</span></span> trans_constraint_creats_LEQ_only<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"transf_constraint <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>transf_constraint <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> LEQ <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-trans_constraints_creats_LEQ_only"><span class="command">lemma</span></span> trans_constraints_creats_LEQ_only<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"transf_constraints <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>transf_constraints <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">r</span><span class="main">.</span> LEQ <span class="bound">p</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> trans_constraint_creats_LEQ_only <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> in_set_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> trans_constraint_creats_LEQ_only<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="LP_Preliminaries-non_strict_constr_no_LT"><span class="command">lemma</span></span> non_strict_constr_no_LT<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonstrict_constrs <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> LT <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms nonstrict_constr.simps<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-non_strict_constr_no_GT"><span class="command">lemma</span></span> non_strict_constr_no_GT<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonstrict_constrs <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> GT <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms nonstrict_constr.simps<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-non_strict_constr_no_LTPP"><span class="command">lemma</span></span> non_strict_constr_no_LTPP<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonstrict_constrs <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> LTPP <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms nonstrict_constr.simps<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-non_strict_constr_no_GTPP"><span class="command">lemma</span></span> non_strict_constr_no_GTPP<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonstrict_constrs <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> GTPP <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms nonstrict_constr.simps<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LP_Preliminaries-non_strict_consts_cond"><span class="command">lemma</span></span> non_strict_consts_cond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> LT <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> GT <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> LTPP <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">cs</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> GTPP <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonstrict_constrs <span class="free">cs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> nonstrict_constr.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-sat_constr_sat_transf_constrs"><span class="command">lemma</span></span> sat_constr_sat_transf_constrs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">cs</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>transf_constraint <span class="free">cs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">cs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valuate_uminus valuate_minus<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-sat_constrs_sat_transf_constrs"><span class="command">lemma</span></span> sat_constrs_sat_transf_constrs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="free">cs</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>transf_constraints <span class="free">cs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> UnE list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sat_constr_sat_transf_constrs set_append transf_constraints.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="LP_Preliminaries-sat_transf_constrs_sat_constr"><span class="command">lemma</span></span> sat_transf_constrs_sat_constr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonstrict_constr <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>transf_constraint <span class="free">cs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">cs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">cs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valuate_uminus valuate_minus<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="LP_Preliminaries-sat_transf_constrs_sat_constrs"><span class="command">lemma</span></span> sat_transf_constrs_sat_constrs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonstrict_constrs <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>transf_constraints <span class="free">cs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="free">cs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sat_transf_constrs_sat_constr<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Linear_Programming">
<div class="head">
<h1>Theory Linear_Programming</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Linear_Programming
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Int.html">HOL-Library.Code_Target_Int</a>"</span>
    <span class="quoted">"<a href="LP_Preliminaries.html">LP_Preliminaries</a>"</span>
    <a href="../Farkas/Simplex_for_Reals.html">Farkas.Simplex_for_Reals</a> 
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Abstract LPs ›</span></span>

<span class="comment1">(* A b c, where A leq b are the constraints and c is the objective function *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Primal Problem ›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sat_primal</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Dual Problem ›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sat_dual</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>  <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="bound">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]=</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">optimal_set</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">max_lp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">max_lp</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> optimal_set <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sat_primal <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">min_lp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_lp</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> optimal_set <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sat_dual <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Linear_Programming-optimal_setI"><span class="command">lemma</span></span> optimal_setI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> optimal_set <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Linear_Programming-max_lpI"><span class="command">lemma</span></span> max_lpI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span><span class="main">]≤</span><span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> optimal_setI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span> <span class="main">}</span>"</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def optimal_setI 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sat_primal_def<span class="main">)</span>

<span class="keyword1" id="Linear_Programming-min_lpI"><span class="command">lemma</span></span> min_lpI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> min_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> optimal_setI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="quoted">"sat_dual <span class="free">A</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def optimal_setI sat_dual_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> sat_dual_def<span class="main">)</span>

<span class="keyword1" id="Linear_Programming-sat_primalD"><span class="command">lemma</span></span> sat_primalD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sat_primal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Linear_Programming-sat_primalI"><span class="command">lemma</span></span> sat_primalI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sat_primal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Linear_Programming-sat_dualD"><span class="command">lemma</span></span> sat_dualD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="free">y</span><span class="main">.</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sat_dual_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">using</span></span> assms sat_dual_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Linear_Programming-sat_dualI"><span class="command">lemma</span></span> sat_dualI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="free">y</span><span class="main">.</span> <span class="free">y</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sat_dual_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Programming-sol_dim_in_sat_primal"><span class="command">lemma</span></span> sol_dim_in_sat_primal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span> <span class="main">⟹</span> dim_vec <span class="free">x</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_times_vec_leq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_times_vec_leq_def sat_primal_def<span class="main">)</span>

<span class="keyword1" id="Linear_Programming-sol_dim_in_max_lp"><span class="command">lemma</span></span> sol_dim_in_max_lp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟹</span> dim_vec <span class="free">x</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def <span class="keyword1"><span class="command">using</span></span> sol_dim_in_sat_primal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Linear_Programming-sol_dim_in_sat_dual"><span class="command">lemma</span></span> sol_dim_in_sat_dual<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span> <span class="main">⟹</span> dim_vec <span class="free">x</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_times_vec_leq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sat_dual_def vec_times_mat_eq_def<span class="main">)</span>

<span class="keyword1" id="Linear_Programming-sol_dim_in_min_lp"><span class="command">lemma</span></span> sol_dim_in_min_lp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> min_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟹</span> dim_vec <span class="free">x</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def <span class="keyword1"><span class="command">using</span></span> sol_dim_in_sat_dual<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Linear_Programming-min_lp_in_sat_dual"><span class="command">lemma</span></span> min_lp_in_sat_dual<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> min_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def <span class="keyword1"><span class="command">using</span></span> sol_dim_in_sat_dual<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Linear_Programming-max_lp_in_sat_primal"><span class="command">lemma</span></span> max_lp_in_sat_primal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def <span class="keyword1"><span class="command">using</span></span> sol_dim_in_sat_dual<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">locale</span></span> abstract_LP <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>ordered_semiring<span class="main">,</span>linorder<span class="main">}</span><span class="main">)</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">m</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Linear_Programming-dim_b_row_A"><span class="command">lemma</span></span> dim_b_row_A<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abstract_LP_axioms abstract_LP_def carrier_matD<span class="main">(</span>1<span class="main">)</span> carrier_vecD
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Linear_Programming-dim_b_col_A"><span class="command">lemma</span></span> dim_b_col_A<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abstract_LP_axioms abstract_LP_def carrier_matD<span class="main">(</span>2<span class="main">)</span> carrier_vecD 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Linear_Programming-weak_duality_aux"><span class="command">lemma</span></span> weak_duality_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="main">{</span><span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span><span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="skolem">y</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_times_vec_leq_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract_LP_axioms abstract_LP_def carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">y</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract_LP_axioms abstract_LP_def carrier_matD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> vec_times_mat_eq_def y<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_eq carrier_vecD y abstract_LP_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract_LP_axioms calculation d1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assoc_scalar_prod_mult_mat_vec<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> abstract_LP_axioms abstract_LP_def d1 d2 
      carrier_vec_dim_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_leq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mat_times_vec_leq_def vec_times_mat_eq_def x<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> y<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> y<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> weak_duality_theorem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> min_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">c</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dx<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sol_dim_in_max_lp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> abstract_LP_axioms abstract_LP_def 
      carrier_matD<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> dy<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">y</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sol_dim_in_min_lp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>  abstract_LP_axioms abstract_LP_def 
      carrier_matD<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def dx sat_primal_def
    <span class="keyword1"><span class="command">using</span></span> abstract_LP_axioms abstract_LP_def carrier_vec_dim_vec comm_scalar_prod dx i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="bound">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> optimal_set_def <span class="keyword1"><span class="command">using</span></span> abstract_LP_axioms abstract_LP_def 
      carrier_vec_dim_vec comm_scalar_prod dy j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> weak_duality_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_primal_def sat_dual_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="quoted">"**"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">create_optimal_solutions</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">create_optimal_solutions</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">case</span> simplex <span class="main">(</span>x_times_c_geq_y_times_b <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span>
                                      mat_leqb_eqc <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">@</span>
                                      from_index_geq0_vector <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">of</span>
                                      Unsat <span class="bound">X</span> <span class="main">⇒</span> Unsat <span class="bound">X</span>
                                      <span class="main">|</span> Sat <span class="bound">X</span> <span class="main">⇒</span> Sat <span class="bound">X</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">optimize_no_cond</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">optimize_no_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> create_optimal_solutions <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">of</span> 
                          Unsat <span class="bound">X</span> <span class="main">⇒</span> Unsat <span class="bound">X</span> 
                        <span class="main">|</span> Sat <span class="bound">X</span> <span class="main">⇒</span>  Sat <span class="main">(</span>fst <span class="main">(</span>split_n_m_x <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Linear_Programming-create_opt_sol_satisfies"><span class="command">lemma</span></span> create_opt_sol_satisfies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span><span class="main">(</span>x_times_c_geq_y_times_b <span class="free">c</span> <span class="free">b</span> <span class="main">#</span> mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">@</span>
                      from_index_geq0_vector <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>x_times_c_geq_y_times_b <span class="free">c</span> <span class="free">b</span> <span class="main">#</span> mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">@</span>
        from_index_geq0_vector <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"simplex <span class="main">(</span>x_times_c_geq_y_times_b <span class="free">c</span> <span class="free">b</span> <span class="main">#</span> mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">@</span> from_index_geq0_vector <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> Inr <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> simplex <span class="main">(</span>x_times_c_geq_y_times_b <span class="free">c</span> <span class="free">b</span> <span class="main">#</span> mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">@</span> from_index_geq0_vector <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Unsat <span class="bound">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms create_optimal_solutions.simps sum.case<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sumE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Unsat <span class="bound">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms option.split <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> simplex<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Programming-create_opt_sol_sat_leq_mat"><span class="command">lemma</span></span> create_opt_sol_sat_leq_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> create_opt_sol_satisfies<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> sat_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_assoc in_set_conv_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mat_leqb_eqc_split_correct1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Programming-create_opt_sol_sat_eq_mat"><span class="command">lemma</span></span> create_opt_sol_sat_eq_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_i_j_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">c</span> <span class="main">+</span> dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> create_opt_sol_satisfies<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> sat_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_leqb_eqc <span class="free">A</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
      assms<span class="main">(</span>2<span class="main">)</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_append<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat_leqb_eqc_split_correct2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">]</span></span>
        <span class="quoted"><span class="quoted">‹dim_vec <span class="free">b</span> <span class="main">=</span> dim_col <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹dim_vec <span class="free">c</span> <span class="main">=</span> dim_row <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Linear_Programming-create_opt_sol_satisfies_leq"><span class="command">lemma</span></span> create_opt_sol_satisfies_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">≥</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> create_opt_sol_satisfies<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_vec_dim_vec comm_scalar_prod list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      split_n_m_x_abbrev_dims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> x_times_c_geq_y_times_b_split_dotP<span class="main">)</span>

<span class="keyword1" id="Linear_Programming-create_opt_sol_satisfies_geq0"><span class="command">lemma</span></span> create_opt_sol_satisfies_geq0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="main">(</span>from_index_geq0_vector <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> create_opt_sol_satisfies <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI append_Cons set_append<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">y</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> split_n_m_x_abbrev_dims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> from_index_geq0_vector_split_snd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span>  
        <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span>"</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">,</span> <span class="operator">OF</span> * assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> rat_LP <span class="main">=</span> abstract_LP <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span> 
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span> <span class="main">::</span><span class="quoted"><span class="quoted">"rat mat"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat vec"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat vec"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Linear_Programming-create_opt_sol_in_LP"><span class="command">lemma</span></span> create_opt_sol_in_LP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">≥</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> create_opt_sol_sat_leq_mat dim_b_col_A dim_b_row_A split_i_j_x_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> create_opt_sol_sat_eq_mat dim_b_col_A dim_b_row_A
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> create_opt_sol_satisfies_leq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> create_opt_sol_satisfies_geq0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Linear_Programming-create_optim_in_sols"><span class="command">lemma</span></span> create_optim_in_sols<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">]≤</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="main">[</span><span class="bound">y</span> <span class="keyword1"><span class="hidden">⇩</span><sub>v</sub>*</span> <span class="free">A</span><span class="main">]=</span><span class="free">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">$</span><span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> create_opt_sol_in_LP<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> create_opt_sol_in_LP<span class="main">(</span>2<span class="main">)</span> create_opt_sol_in_LP<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Linear_Programming-cx_leq_bx_in_creating_opt"><span class="command">lemma</span></span> cx_leq_bx_in_creating_opt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> weak_duality_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span><span class="main">]</span>  create_optim_in_sols<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Programming-min_max_for_sol"><span class="command">lemma</span></span> min_max_for_sol<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> create_opt_sol_in_LP<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> cx_leq_bx_in_creating_opt<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    comm_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> comm_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' antisym assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_vec_dim_vec split_vec_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> split_vec_dims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Linear_Programming-create_opt_solutions_correct"><span class="command">lemma</span></span> create_opt_solutions_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> create_opt_sol_in_LP<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sat_primalI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> sat_dual <span class="free">A</span> <span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sat_dualI
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> create_opt_sol_in_LP<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
        mem_Collect_eq rat_LP.create_opt_sol_in_LP<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> rat_LP_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> weak_duality_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> 1 2<span class="main">]</span> sat_primalI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_vec_dim_vec comm_scalar_prod 
        min_max_for_sol split_n_m_x_abbrev_dims<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a carrier_vec_dim_vec comm_scalar_prod dim_b_col_A mat_times_vec_leqD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Programming-optimize_no_cond_correct"><span class="command">lemma</span></span> optimize_no_cond_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"optimize_no_cond <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"create_optimal_solutions <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inr_Inl_False assms old.sum.exhaust old.sum.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> optimize_no_cond.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>split_n_m_x <span class="main">(</span>dim_vec <span class="free">c</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">b</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> old.sum.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> old.sum.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> optimize_no_cond.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> create_opt_solutions_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X fst_conv old.prod.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Programming-optimize_no_cond_sol_sat"><span class="command">lemma</span></span> optimize_no_cond_sol_sat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"optimize_no_cond <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Sat <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> sat_primal <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_lp_in_sat_primal<span class="main">[</span><span class="operator">OF</span> optimize_no_cond_correct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* end of ‹ rat_LP › *)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">maximize</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">maximize</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> dim_vec <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> dim_vec <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span>
                      Some <span class="main">(</span>optimize_no_cond <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>
                    <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1" id="Linear_Programming-optimize_sound"><span class="command">lemma</span></span> optimize_sound<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximize <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Some <span class="main">(</span>Sat <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> max_lp <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span> <span class="main">∧</span> dim_vec <span class="free">c</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms maximize.simps option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> rat<span class="main">:</span> rat_LP <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract_LP_def carrier_mat_triv carrier_vec_dim_vec rat_LP.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sat <span class="free">x</span> <span class="main">=</span> optimize_no_cond <span class="free">A</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rat.optimize_no_cond_correct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Linear_Programming-maximize_option_elim"><span class="command">lemma</span></span> maximize_option_elim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximize <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Some <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">c</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms maximize.simps option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Linear_Programming-optimize_sol_dimension"><span class="command">lemma</span></span> optimize_sol_dimension<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximize <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Some <span class="main">(</span>Sat <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms carrier_dim_vec max_lp_in_sat_primal optimize_sound sol_dim_in_sat_primal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Linear_Programming-optimize_sat"><span class="command">lemma</span></span> optimize_sat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximize <span class="free">A</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> Some <span class="main">(</span>Sat <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">]≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms maximize_option_elim<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    max_lp_in_sat_primal<span class="main">[</span><span class="operator">OF</span> optimize_sound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>eq<span class="main">)</span> ceq <span class="quoted">rat</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>linorder<span class="main">)</span> compare <span class="quoted">rat</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>compare<span class="main">)</span> ccompare <span class="quoted">rat</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>rbt<span class="main">)</span> set_impl <span class="quoted">rat</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>eq<span class="main">)</span> ceq <span class="quoted">atom</span> <span class="quoted">QDelta</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>linorder<span class="main">)</span> compare_order <span class="quoted">QDelta</span>
<span class="keyword1"><span class="command">derive</span></span> compare_order <span class="quoted">atom</span>
<span class="keyword1"><span class="command">derive</span></span> ccompare <span class="quoted">atom</span> <span class="quoted">QDelta</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>rbt<span class="main">)</span> set_impl <span class="quoted">atom</span> <span class="quoted">QDelta</span>


<span class="comment1">(*export_code maximize mat_of_cols_list mat_of_rows_list mat_of_cols vec_of_list quotient_of Inr Inl Some None list_of_vec nat
Rat.Fract int_of_integer in Haskell module_name LP  file "/home/julian/coding/ForGET/LPBenchmarks/HaskellLP/src" 
*)</span>
<span class="comment1">(*
export_code  maximize mat_of_cols_list mat_of_rows_list mat_of_cols vec_of_list quotient_of Inr Inl Some None list_of_vec nat
Rat.Fract int_of_integer in Scala
*)</span>


<span class="comment1">(*
section ‹ Testing ›
lemma "(let A = mat_of_rows 3 (map vec_of_list [[1, 12, 2], [1, 5, 9], [-1,0,0], [0,-1,0],[0,0,-1]]) in
       (let b = vec_of_list [10000, 8539,0,0,0] in
       (let c = vec_of_list [100, 600, 400] in
       maximize A b c))) =  Some (Inr (vec_of_list [52468 / 7, 1461 / 7, 0]))"
  by eval

lemma "(let A = mat_of_cols 4 (map vec_of_list [[2::rat, -1, -1, 1/2], [1, 2, -1, -1/2]]) in
       (let b = vec_of_list [5, 2, -1, 1/2] in
       (let c = vec_of_list [7, 1::rat] in
       maximize A b c))) = Some (Inr (vec_of_list [2::rat, 1]))"
  by eval
*)</span>

<span class="comment1">(*
value "(let A = mat_of_cols_list 4 [[-1::rat, -1, -0, 1], [1, -1, -1, -2]] in
       (let b = vec_of_list [1, -2, -0, 4] in
       (let c = vec_of_list [-2, 1::rat] in
       maximize A b c)))"

value "(let A = mat_of_cols 4 (map vec_of_list [[2::rat, 2, -1, 0], [3, 1, 0, -1]]) in
       (let b = vec_of_list [1500::rat,1000,0,0] in
       (let c = vec_of_list [50, 40::rat] in
       maximize A b c)))"
 (*  Sol should be 375, 250 *)

value "(let A = mat_of_cols 2 (map vec_of_list [[-1::rat, 1], [-1,-1]]) in
       (let b = vec_of_list [2::rat, 2] in
       (let c = vec_of_list [0, 1::rat] in
       maximize A b c)))"
  (* Sol should be 375, 250 *)

value "(let A = mat_of_rows 2 (map vec_of_list [[2::rat,3],[2, 1], [-1,0],[0,-1]]) in
       (let b = vec_of_list [1500::rat,1000,0,0] in
       (let c = vec_of_list [50, 40::rat] in
       maximize A b c)))"
  (* Sol should be 375, 250 *)
*)</span>


<span class="keyword1" id="Linear_Programming-of_rat_val"><span class="command">lemma</span></span> of_rat_val<span class="main">:</span> <span class="quoted"><span class="quoted">"simplex <span class="free">cs</span> <span class="main">=</span> <span class="main">(</span>Sat <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> of_rat_val <span class="main">⟨</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> set <span class="free">cs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> of_rat_val_constraint simplex_real<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>