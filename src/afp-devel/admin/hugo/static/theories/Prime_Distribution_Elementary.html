<div id="Prime_Distribution_Elementary_Library">
<div class="head">
<h1>Theory Prime_Distribution_Elementary_Library</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Prime_Distribution_Elementary_Library.thy
  Author:  Manuel Eberl, TU München

  Various auxiliary material, much of which should probably be moved somewhere else
  eventually.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary material›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Prime_Distribution_Elementary_Library
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Zeta_Function/Zeta_Function.html">Zeta_Function.Zeta_Function</a>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
  <a href="../Stirling_Formula/Stirling_Formula.html">Stirling_Formula.Stirling_Formula</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_pos <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> divisor_count <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_count_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_pos_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> smallest_prime_beyond_eval<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime <span class="free">n</span> <span class="main">⟹</span> smallest_prime_beyond <span class="free">n</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime <span class="free">n</span> <span class="main">⟹</span> smallest_prime_beyond <span class="free">n</span> <span class="main">=</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="free">n</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallest_prime_beyond_eq<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime <span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="free">n</span> <span class="main">=</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="free">n</span> <span class="main">≤</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallest_prime_beyond_smallest<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ smallest_prime_beyond_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="free">n</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_smallest_prime_beyond<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>prime <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="free">n</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smallest_prime_beyond_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="free">n</span> <span class="main">≥</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallest_prime_beyond_smallest<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_numeral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="main">(</span>nth_prime <span class="main">(</span>pred_numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nth_prime_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> nth_prime_eval <span class="main">=</span> smallest_prime_beyond_eval nth_prime_Suc nth_prime_numeral

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_prime_eval<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nth_prime <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">5</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_prime_eval<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nth_prime <span class="numeral">3</span> <span class="main">=</span> <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_prime_eval<span class="main">)</span>

<span class="comment1">(* TODO: copied from afp-devel; delete in AFP 2019 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> strict_mono_sequence_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>linorder<span class="main">,</span> no_top<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">f</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">f</span> <span class="bound">k</span><span class="main">..&lt;</span><span class="free">f</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top eventually_at_top_linorder<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_Suc_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> LeastI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>nth_prime <span class="bound">k</span><span class="main">..&lt;</span>nth_prime <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strict_mono_sequence_partition<span class="main">[</span><span class="operator">OF</span> strict_mono_nth_prime<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms nth_prime_at_top
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_partition'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>real <span class="main">(</span>nth_prime <span class="bound">k</span><span class="main">)</span><span class="main">..&lt;</span>real <span class="main">(</span>nth_prime <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_sequence_partition<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_Suc_iff assms
           <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_real_sequentially filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ nth_prime_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> between_nth_primes_imp_nonprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> nth_prime <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> nth_prime <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI not_le nth_prime_Suc smallest_prime_beyond_smallest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_partition''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">..&lt;</span>real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="free">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>nth_prime <span class="skolem">n</span><span class="main">..&lt;</span>nth_prime <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_prime_partition' assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span>nth_prime <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> π_def <span class="keyword1"><span class="command">using</span></span> between_nth_primes_imp_nonprime n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_sum_upto_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> n_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="free">x</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* END TODO *)</span>

<span class="comment1">(* TODO: Move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> asymp_equivD_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∼[</span><span class="free">F</span><span class="main">]</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hurwitz_zeta_shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> hurwitz_zeta <span class="free">a</span> <span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hurwitz_zeta <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="free">n</span><span class="main">)</span> <span class="bound">s</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> of_nat <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span> hurwitz_zeta <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_hurwitz_zeta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> real <span class="free">n</span>"</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> s assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> of_nat <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span> hurwitz_zeta <span class="free">a</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_hurwitz_zeta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> s assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> of_nat <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span>
            <span class="main">(</span>hurwitz_zeta <span class="free">a</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> of_nat <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_split_initial_segment<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> hurwitz_zeta <span class="free">a</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">::</span>complex<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> connected_punctured_universe<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> open_halfspace_Re_gt exI<span class="main">[</span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pbernpoly_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"pbernpoly <span class="free">n</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bounded_pbernpoly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> harm_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> harm <span class="free">n</span> <span class="main">≤</span> ln <span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> euler_mascheroni_sequence_decreasing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> harm_expand<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="free">f</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: replace original *)</span>
<span class="keyword1"><span class="command">lemma</span></span> sum_upto_cong' <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x'</span> <span class="main">⟹</span> sum_upto <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="free">f'</span> <span class="free">x'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_primes_le<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> frequently_filtermap<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="main">(</span>filtermap <span class="free">f</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> frequently <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> frequently_def eventually_filtermap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> frequently_mono_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently <span class="free">P</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">≤</span> <span class="free">F'</span> <span class="main">⟹</span> frequently <span class="free">P</span> <span class="free">F'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_leD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">F'</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> frequently_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> π_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim primes_pi at_top at_top"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_top
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">=</span> real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌈</span>max <span class="main">0</span> <span class="skolem">C</span><span class="main">⌉</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> primes_pi <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≤</span> real <span class="main">(</span>nat <span class="main">⌈</span>max <span class="main">0</span> <span class="skolem">C</span><span class="main">⌉</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌈</span>max <span class="main">0</span> <span class="skolem">C</span><span class="main">⌉</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> primes_pi <span class="skolem">x0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> primes_pi <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> π_mono<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"primes_pi <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_ln_stirling_weak_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">using</span></span> ln_fact_bounds<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>fact <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">12</span>"</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>fact <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span>
       <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_nat_sequentially<span class="main"><span class="main">]</span></span> filterlim_floor_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>fact <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>fact <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>fact <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_ln_conv_ln_fact <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Various facts about Dirichlet series›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fds_mangoldt'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds mangoldt <span class="main">=</span> fds_zeta <span class="main">*</span> fds_deriv <span class="main">(</span>fds moebius_mu<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds mangoldt <span class="main">=</span> <span class="main">(</span>fds moebius_mu <span class="main">*</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_mangoldt<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fds_zeta <span class="main">*</span> fds_deriv <span class="main">(</span>fds moebius_mu<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult dirichlet_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_mult <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">-</span> ln <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> ln_div<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">d</span><span class="main">)</span> <span class="main">*</span> moebius_mu <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf sum_distrib_left sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_moebius_mu_divisors'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds_zeta <span class="main">*</span> fds_deriv <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> fds<span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult dirichlet_prod_altdef1 fds_nth_deriv sum_negf scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_divisor_sum1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">::</span> real<span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> floor <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">::</span> real<span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
          sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">(</span>floor <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_upto_dirichlet_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> floor <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_divisor_sum2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">::</span> real<span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_upto_dirichlet_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_moebius_times_floor_linear<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
          sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> of_int <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">::</span> real<span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_upto_divisor_sum1<span class="main">[</span><span class="operator">of</span> <span class="quoted">moebius_mu</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong sum_moebius_mu_divisors' refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of_int <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_int_eq_iff <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_fact_conv_sum_mangoldt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> ln <span class="main">(</span>fact <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> of_int <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
          sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">d</span> <span class="main">::</span> real<span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_upto_divisor_sum1<span class="main">[</span><span class="operator">of</span> <span class="quoted">mangoldt</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong mangoldt_sum refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">∏</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_nat_prod <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_prod<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fact_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Facts about prime-counting functions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_π <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>primes_pi <span class="free">x</span><span class="main">¦</span> <span class="main">=</span> primes_pi <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_of_nonneg<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> π_less_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> π_def prime_sum_upto_altdef2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> π_le_self'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> π_def prime_sum_upto_altdef2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> π_le_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> π_less_self<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strengthening `Big-O' bounds›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following two statements are crucial: They allow us to strengthen a `Big-O' statement
  for $n\to\infty$ or $x\to\infty$ to a bound for <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹all›</span></span> $n\geq n_0$ or all $x\geq x_0$ under
  some mild conditions.

  This allows us to use all the machinery of asymptotics in Isabelle and still get a bound
  that is applicable over the full domain of the function in the end. This is important because
  Newman often shows that $f(x) \in O(g(x))$ and then writes
  \[\sum_{n\leq x} f(\frac{x}{n}) = \sum_{n\leq x} O(g(\frac{x}{n}))\]
  which is not easy to justify otherwise.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> natfun_bigoE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="free">n0</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="free">n0</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bigo <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> landau_o.bigE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">n0'</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>insert <span class="free">n0</span> <span class="main">{</span><span class="free">n0</span><span class="main">..&lt;</span><span class="skolem">n0'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">1</span> <span class="main">(</span>max <span class="skolem">c</span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="free">n0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">n0'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> c'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max.coboundedI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">1</span> <span class="main">(</span>max <span class="skolem">c</span> <span class="skolem">c'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n0'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">1</span> <span class="main">(</span>max <span class="skolem">c</span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span>max <span class="skolem">c</span> <span class="skolem">c'</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigoE_bounded_real_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x0</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="free">cg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cg</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≥</span> <span class="free">x0</span> <span class="main">⟹</span> bounded <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x0</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x0</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_o.bigE<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">b</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x0</span><span class="main">..</span>max <span class="free">x0</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x0</span><span class="main">..</span>max <span class="free">x0</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> max <span class="skolem">c</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">/</span> <span class="free">cg</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c'</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">/</span> <span class="free">cg</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abs_ge_zero assms frac_le landau_omega.R_trans that<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c'</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that False assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> b<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c'</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_asymptotics_lift_nat_real_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigo_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h_bigo_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono_g<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="free">g</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono_h<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="free">h</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> h_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> natfun_bigoE<span class="main">[</span><span class="operator">OF</span> bigo h_nz<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> natfun_bigoE<span class="main">[</span><span class="operator">OF</span> g_bigo_self h_nz<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> natfun_bigoE<span class="main">[</span><span class="operator">OF</span> h_bigo_self h_nz<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c3</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_g
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mono_onD<span class="main">[</span><span class="operator">OF</span> mono<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">h</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">h</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono c1 c2<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span>"</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="free">g</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_mono mono_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mono<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c2 h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mono_h
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c3</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c3<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c3</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span> c3<span class="main">(</span>1<span class="main">)</span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span> c3<span class="main">(</span>1<span class="main">)</span> mono_onD<span class="main">[</span><span class="operator">OF</span> mono<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="free">h</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span> c3<span class="main">(</span>1<span class="main">)</span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> x n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span> c3<span class="main">(</span>1<span class="main">)</span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono mono_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mono<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">c3</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span> c3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_pos_pos add_pos_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_asymptotics_lift_nat_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigo_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h_bigo_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono_g<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="free">g</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono_h<span class="main">:</span> <span class="quoted"><span class="quoted">"mono_on <span class="free">h</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_asymptotics_lift_nat_real_aux assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> sum_upto <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.big.uminus_in_iff<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.big.uminus_in_iff<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_negf<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_g
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_asymptotics_lift_nat_real_aux assms<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>sum_upto <span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_negf<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c1<span class="main">(</span>1<span class="main">)</span> c2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> factorial_semiring<span class="main">)</span> primepow_divisors_induct <span class="main">[</span><span class="operator">case_names</span> zero unit factor<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> is_unit <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span><span class="bound">p</span> <span class="keyword1">dvd</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>prime_factors <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">x</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="skolem">x</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_empty_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">p</span> <span class="skolem">A</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity k_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> multiplicity_decompose'<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="skolem">x</span> <span class="main">=</span> replicate_mset <span class="skolem">k</span> <span class="skolem">p</span> <span class="main">+</span> prime_factorization <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> y <span class="keyword1"><span class="command">unfolding</span></span> y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_mult<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_prime_power in_prime_factors_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> y p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> prime_factors <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">y</span> <span class="main">=</span> prime_factors <span class="skolem">x</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">using</span></span> y <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="More_Dirichlet_Misc">
<div class="head">
<h1>Theory More_Dirichlet_Misc</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    More_Dirichlet_Misc.thy
  Author:  Manuel Eberl, TU München

  Generalised Dirichlet products and Legendre's identity, and a weighted sum
  of the Möbius μ function
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous material›</span></span>
<span class="keyword1"><span class="command">theory</span></span> More_Dirichlet_Misc
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Prime_Distribution_Elementary_Library.html">Prime_Distribution_Elementary_Library</a>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalised Dirichlet products›</span></span>

<span class="comment1">(* TODO: Move to Dirichlet_Series *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dirichlet_prod'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dirichlet_prod'</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">m</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> real <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_one_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_def sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">f'</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">g'</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="free">f</span> <span class="free">g</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">f'</span> <span class="free">g'</span> <span class="free">x'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod'_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong' assms<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> assms <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="comment1">(* 2.21 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> dirichlet_prod' <span class="free">g</span> <span class="free">h</span> <span class="bound">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> dirichlet_prod' <span class="free">g</span> <span class="free">h</span> <span class="bound">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> dirichlet_prod'_def dirichlet_prod_def
                  sum_upto_def sum_distrib_left sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">m</span><span class="main">:</span><span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                     <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">mn</span><span class="main">,</span> <span class="bound">m</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">mn</span><span class="main">:</span><span class="main">{</span><span class="bound">mn</span><span class="main">.</span> <span class="bound">mn</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">mn</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="keyword1">dvd</span> <span class="bound">mn</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                    <span class="free">f</span> <span class="bound">m</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">mn</span> <span class="keyword1">div</span> <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">mn</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">mn</span><span class="main">,</span> <span class="bound">m</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">mn</span> <span class="keyword1">div</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod' <span class="main">(</span>dirichlet_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_def dirichlet_prod_def sum_upto_def
                      <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_distrib_left sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 2.22 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_inversion1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">a</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">a</span> <span class="free">ainv</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">ainv</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="free">ainv</span> <span class="free">g</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">ainv</span> <span class="main">(</span>dirichlet_prod' <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod'_cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_assoc dirichlet_prod_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod'_one_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_inversion2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">ainv</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">a</span> <span class="free">ainv</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">a</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="free">a</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">a</span> <span class="main">(</span>dirichlet_prod' <span class="free">ainv</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod'_cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_assoc dirichlet_prod_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod'_one_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_inversion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">a</span> <span class="free">ainv</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">a</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">ainv</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dirichlet_prod'_inversion1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">f</span></span> <span class="main">_</span> <span class="quoted"><span class="free">ainv</span></span><span class="main">]</span> dirichlet_prod'_inversion2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">ainv</span></span> <span class="quoted"><span class="free">g</span></span> <span class="main">_</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
        assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_inversion'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">1</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ainv</span> <span class="main">≡</span> dirichlet_inverse <span class="free">a</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">a</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">ainv</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ainv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod'_inversion dirichlet_prod_inverse assms<span class="main">)</span>

<span class="comment1">(* 3.11 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_floor_conv_sum_upto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real_of_int <span class="main">(</span>floor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_upto_dirichlet_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> sum_upto_dirichlet_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_def dirichlet_prod_commutes<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> completely_multiplicative_function<span class="main">)</span> dirichlet_prod_self<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> of_nat <span class="main">(</span>divisor_count <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span> <span class="main">*</span> of_nat <span class="main">(</span>card <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw fst <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="bound">r</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> False <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">dvd</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> divisor_count <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_count_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> completely_multiplicative_imp_moebius_mu_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> completely_multiplicative_function <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod_commutes<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult fds_nth_fds dirichlet_prod_altdef2 mult_ac mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">r</span></span><span class="main">,</span> <span class="bound"><span class="bound">d</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">n</span><span class="main">.</span> moebius_mu <span class="bound">r</span> <span class="main">*</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod moebius_mu <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="free">n</span> <span class="main">*</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_altdef2 sum_distrib_right case_prod_unfold mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod moebius_mu <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fds_nth <span class="main">(</span>fds moebius_mu <span class="main">*</span> fds_zeta<span class="main">)</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds moebius_mu <span class="main">*</span> fds_zeta <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac fds_zeta_times_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="main">1</span> <span class="free">n</span> <span class="main">*</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> fds_nth <span class="main">1</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 2.23 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_inversion_completely_multiplicative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="free">a</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod'_inversion ext completely_multiplicative_imp_moebius_mu_inverse assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_sigma_conv_dirichlet_prod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"divisor_sigma <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds <span class="main">(</span>divisor_sigma <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fds_shift <span class="free">x</span> fds_zeta <span class="main">*</span> fds_zeta"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_divisor_sigma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Legendre's identity›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">legendre_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">legendre_aux</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> prime <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> nat <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">^</span> <span class="bound">m</span><span class="main">⌋</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_aux_not_prime <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime <span class="free">p</span> <span class="main">⟹</span> legendre_aux <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> legendre_aux_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_aux_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">&gt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"legendre_aux <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>real <span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> real <span class="free">p</span> <span class="main">^</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> real <span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_increasing<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> legendre_aux_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> legendre_aux_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_aux_posD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"legendre_aux <span class="free">x</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> legendre_aux_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> legendre_aux_def <span class="quasi_keyword">split</span><span class="main">:</span> if_splits›</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exponents_le_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_increasing<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_sum_legendre_aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ exponents_le_finite<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k <span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span> l <span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span> p <span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">use</span> assms prime_gt_1_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_aux_set_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>log <span class="main">(</span>real <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_log_iff le_floor_iff powr_realpow<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_aux_altdef1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"legendre_aux <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> prime <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span>
                         <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>log <span class="main">(</span>real <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">⌋</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> legendre_aux_set_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> legendre_aux_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>real <span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> real <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">1</span> <span class="main">≤</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_nat_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> one_le_power<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> prime_gt_1_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>real <span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> legendre_aux_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_aux_altdef2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">^</span> Suc <span class="free">k</span> <span class="main">&gt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"legendre_aux <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"legendre_aux <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> legendre_aux_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="free">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> real <span class="free">p</span> <span class="main">^</span> Suc <span class="free">k</span>›</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> power_strict_increasing_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> prime_gt_0_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 3.14 *)</span>
<span class="keyword1"><span class="command">theorem</span></span> legendre_identity<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto ln <span class="free">x</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> legendre_aux <span class="free">x</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">p</span><span class="main">:</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> prime_power_leD<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">^</span> <span class="main">1</span> <span class="main">≤</span> real <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_increasing<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto ln <span class="free">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_ln_conv_sum_upto_mangoldt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">p</span></span><span class="main">,</span> <span class="bound"><span class="bound">i</span></span><span class="main">)</span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span>
                     ln <span class="bound">p</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_upto_primepows<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">i</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mangoldt_non_primepow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_power_leD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span>
                     ln <span class="bound">p</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> S_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.Sigma<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ballI finite_sum_legendre_aux<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">*</span>
                    real <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">i</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">*</span> real <span class="main">(</span>legendre_aux <span class="free">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> legendre_aux_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ln <span class="bound">p</span> <span class="main">*</span> real <span class="main">(</span>legendre_aux <span class="free">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> legendre_identity'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fact <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> legendre_aux <span class="free">x</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>fact <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span>sum_upto ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_upto_ln_conv_ln_fact<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto ln <span class="free">x</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> legendre_aux <span class="free">x</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> legendre_identity<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> exp <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> legendre_aux <span class="free">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prime_sum_upto_def <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_sum<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> real <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> legendre_aux <span class="free">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_gt_0_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> legendre_aux <span class="free">x</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> real <span class="main">(</span>legendre_aux <span class="free">x</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> legendre_aux <span class="free">x</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> legendre_aux <span class="free">x</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> legendre_aux <span class="free">x</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_eq_iff <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A weighted sum of the Möbius <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>μ›</span></span></span></span> function›</span></span>

<span class="comment1">(* TODO: Move to Dirichlet_Series? *)</span>

<span class="comment1">(* 3.13 *)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_sum_upto_moebius_mu_over_n_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
          sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_right sum_subtractf ring_distribs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">-</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="main">(</span>floor <span class="main">(</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> real_of_int <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
               real_of_int <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_upto_moebius_times_floor_linear<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">M</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">x</span> <span class="main">*</span> <span class="free">M</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> eq
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">1</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span>
               <span class="main">1</span> <span class="main">+</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span>
               sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>moebius_mu <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">1</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> frac <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> frac <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_strict_mono frac_lt_1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span>frac <span class="free">x</span> <span class="main">+</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult_less_cancel_left_pos<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_moebius_mu_over_n_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def sum_upto_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_sum_upto_moebius_mu_over_n_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_upto_moebius_mu_over_n_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> abs_sum_upto_moebius_mu_over_n_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Primes_Omega">
<div class="head">
<h1>Theory Primes_Omega</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Primes_Omega.thy
  Author:  Manuel Eberl, TU München

  The primes ω function (i.e. the number of distinct prime factors)
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Primes_Omega
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Dirichlet_Series/Dirichlet_Series.html">Dirichlet_Series.Dirichlet_Series</a> <a href="../Dirichlet_Series/Divisor_Count.html">Dirichlet_Series.Divisor_Count</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> function $\omega(n)$ counts the number of distinct prime factors of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">primes_omega</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">primes_omega</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> card <span class="main">(</span>prime_factors <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_prime <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> primes_omega <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def prime_factorization_prime<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primes_omega <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primes_omega <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primes_omega <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> primes_omega <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> primes_omega <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def prime_factors_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_primepow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primepow <span class="free">n</span> <span class="main">⟹</span> primes_omega <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primepow_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"primes_omega <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_omega_def prime_factorization_empty_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_pos <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> primes_omega <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"primes_omega <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_omega_eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_mult_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"primes_omega <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> primes_omega <span class="free">x</span> <span class="main">+</span> primes_omega <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> prime_factors <span class="free">x</span> <span class="main">∪</span> prime_factors <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">x</span> <span class="main">∩</span> prime_factors <span class="free">y</span> <span class="main">=</span> set_mset <span class="main">(</span>prime_factorization <span class="main">(</span>gcd <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_gcd<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>prime_factors <span class="free">x</span> <span class="main">∪</span> prime_factors <span class="free">y</span><span class="main">)</span> <span class="main">=</span> primes_omega <span class="free">x</span> <span class="main">+</span> primes_omega <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> primes_omega_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_Un_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> False <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_squarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"divisor_count <span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> primes_omega <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_count <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divisor_count.prod_prime_factors'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> squarefree_factorial_semiring'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Primorial">
<div class="head">
<h1>Theory Primorial</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Primorial.thy
  Author:  Manuel Eberl, TU München

  The primorial function x#, i.\,e. the product of all primes no greater than x.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Primorial function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Primorial
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Prime_Distribution_Elementary_Library.html">Prime_Distribution_Elementary_Library</a> <a href="Primes_Omega.html">Primes_Omega</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and basic properties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">primorial</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">primorial</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">∏</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primorial_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> primorial <span class="free">x</span> <span class="main">≤</span> primorial <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primorial_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le prod_dvd_prod_subset<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_pos finite_primes_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prime_factorization_primorial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> multiset_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">note</span></span> fin <span class="main">=</span> finite_primes_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>prime_factorization <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span>
          count <span class="main">(</span>mset_set <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>prime_factorization <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span>
             sum <span class="main">(</span>multiplicity <span class="skolem">p</span><span class="main">)</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> primorial_def count_prime_factorization <span class="keyword1"><span class="command">using</span></span> fin
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_prod_distrib<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_multiplicity_other <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> count <span class="main">(</span>mset_set <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_factors_primorial <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> prime_factorization_primorial <span class="keyword1"><span class="command">using</span></span> finite_primes_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial_pos <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primorial_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_pos<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial_neq_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> of_nat_primes_omega_primorial <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>primes_omega <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> primes_pi <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def primes_pi_def prime_sum_upto_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_primorial<span class="main">:</span> <span class="quoted"><span class="quoted">"primes_omega <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">=</span> nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_omega_def primes_pi_def prime_sum_upto_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prime_dvd_primorial_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">dvd</span> primorial <span class="free">x</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_primes_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primorial_def prime_dvd_prod_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> primes_dvd_imp_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> squarefree_primorial <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primorial_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_prod_coprime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> squarefree_prime <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> primes_coprime<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"primorial <span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="keyword1">powr</span> primes_pi <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">powr</span> primes_pi <span class="free">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_pi_def prime_sum_upto_def powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> primorial <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primorial_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim primorial at_top at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>primorial <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> primorial <span class="bound">x</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="keyword1">powr</span> primes_pi <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually primorial_ge allI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">*</span> primes_pi <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_top<span class="main"><span class="main">]</span></span>
                filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> π_at_top<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="keyword1">powr</span> primes_pi <span class="bound">x</span><span class="main">)</span> at_top at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> filterlim_sequentially_iff_filterlim_real <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> totient_primorial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     real <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          primorial <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> totient_formula2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_primorial<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">=</span> primes_theta <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_prod primorial_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_prod<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> θ_def prime_sum_upto_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_primorial<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> primes_pi <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_count <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> divisor_count <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> primorial_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divisor_count.prod_coprime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong divisor_count.prime<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> primes_pi <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_pi_def prime_sum_upto_def powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An alternative view on primorials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following function is an alternative representation of primorials; instead of taking
  the product of all primes up to a given real bound <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>, it takes the product of the first
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span> primes. This is sometimes more convenient.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">primorial'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">primorial'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> nth_prime <span class="bound">k</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primorial'_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> primorial'_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="main">1</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> primorial'_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">6</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> primorial'_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="numeral">3</span> <span class="main">=</span> <span class="numeral">30</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial'_def lessThan_nat_numeral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial'_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> nth_prime <span class="free">n</span> <span class="main">*</span> primorial' <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial'_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial'_pos <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primorial'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial'_neq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_mono_primorial'<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono primorial'"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_Suc_iff
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="skolem">n</span> <span class="main">*</span> <span class="main">1</span> <span class="main">&lt;</span> primorial' <span class="skolem">n</span> <span class="main">*</span> nth_prime <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> prime_nth_prime<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="skolem">n</span> <span class="main">&lt;</span> primorial' <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial'_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_factorization_primorial'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>primorial' <span class="free">k</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span>nth_prime <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>primorial' <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> prime_factorization <span class="main">(</span>nth_prime <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> primorial'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">{#</span>nth_prime <span class="bound">i</span><span class="main">#}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong prime_factorization_prime<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>nth_prime <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="main">{#</span><span class="bound">p</span><span class="main">#}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mset_set <span class="main">(</span>nth_prime <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_factors_primorial'<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>primorial' <span class="free">k</span><span class="main">)</span> <span class="main">=</span> nth_prime <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factorization_primorial'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_primorial' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primes_omega <span class="main">(</span>primorial' <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primes_omega_def prime_factors_primorial' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> squarefree_primorial' <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>primorial' <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primorial'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_prod_coprime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> squarefree_prime <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> primes_coprime<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_count_primorial' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_count <span class="main">(</span>primorial' <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divisor_count_squarefree<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> totient_primorial'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"totient <span class="main">(</span>primorial' <span class="free">k</span><span class="main">)</span> <span class="main">=</span> primorial' <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> nth_prime <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> totient_formula2 prime_factors_primorial'
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primorial_conv_primorial'<span class="main">:</span> <span class="quoted"><span class="quoted">"primorial <span class="free">x</span> <span class="main">=</span> primorial' <span class="main">(</span>nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primorial_def primorial'_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">nth_prime</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> nat <span class="main">⌊</span>primes_pi <span class="main">(</span>real <span class="bound">p</span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primes_pi <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_π<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primes_pi <span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p π_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span>nat <span class="main">⌊</span>primes_pi <span class="skolem">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_prime_eqI''<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff primes_pi_def prime_sum_upto_def of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span>primes_pi <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span><span class="main">⌋</span> <span class="main">≤</span> nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nat_mono floor_mono π_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span>primes_pi <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹primes_pi <span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span>primes_pi <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">{..&lt;</span>nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span>nat <span class="main">⌊</span>primes_pi <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹primes_pi <span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_prime_eqI''<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff primes_pi_def prime_sum_upto_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{..&lt;</span>nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span>primes_pi <span class="main">(</span>real <span class="main">(</span>nth_prime <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nth_prime <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_prime_partition''<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primorial'_conv_primorial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"primorial' <span class="free">n</span> <span class="main">=</span> primorial <span class="main">(</span>nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primorial <span class="main">(</span>nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span>nat <span class="main">(</span>int <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> nth_prime <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial_conv_primorial' primorial'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>int <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial'_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Maximal compositeness of primorials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Primorials are maximally composite, i.\,e.\ any number with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span> distinct prime factors
  is as least as big as the primorial with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span> distinct prime factors, and and number less
  than a primorial has strictly less prime factors.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_prime_le_prime_sequence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="free">p</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> prime <span class="main">(</span><span class="free">p</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nth_prime <span class="free">k</span> <span class="main">≤</span> <span class="free">p</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">p</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">0</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>nth_prime <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">p</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="main">(</span>nth_prime <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_prime_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>nth_prime <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">p</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="main">(</span><span class="free">p</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallest_prime_beyond_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="main">(</span>Suc <span class="main">(</span>nth_prime <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> smallest_prime_beyond <span class="main">(</span>Suc <span class="main">(</span><span class="free">p</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallest_prime_beyond_smallest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prime_smallest_prime_beyond<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strict_mono_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"smallest_prime_beyond <span class="main">(</span>Suc <span class="main">(</span><span class="free">p</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallest_prime_beyond_smallest assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> primorial'_primes_omega_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="main">(</span>primes_omega <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> primes_omega <span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> primes_pi <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> set_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ps</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ps_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ps_def m_def primes_omega_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ps_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strict_mono_onI le_neq_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_nth_mono distinct_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def prime_factorization_empty_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> nth_prime <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff primorial'_def m_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> nth_prime <span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">^</span> multiplicity <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_ps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> i set_ps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_prime_le_prime_sequence<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span> mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">^</span> multiplicity <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> self_le_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="skolem">i</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> set <span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ps</span> <span class="main">=</span> prime_factors <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_ps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_factorization_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="skolem">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_less_primes_omega_primorial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> primorial <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primes_omega <span class="free">n</span> <span class="main">&lt;</span> primes_omega <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primes_pi <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_π<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> False assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primorial_conv_primorial'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms π_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> primes_omega <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"primorial' <span class="skolem">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> primorial'_primes_omega_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_def primes_omega_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> primorial <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> primorial' <span class="main">(</span>nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial_conv_primorial'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> nat <span class="main">⌊</span>primes_pi <span class="free">x</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_mono_less<span class="main">[</span><span class="operator">OF</span> strict_mono_primorial'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> primes_pi <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> primes_omega <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def of_nat_less_iff <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primes_omega_le_primes_omega_primorial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> primorial <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"primes_omega <span class="free">n</span> <span class="main">≤</span> primes_omega <span class="main">(</span>primorial <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> primorial <span class="free">x</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> primorial <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">use</span> primes_omega_less_primes_omega_primorial<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Lcm_Nat_Upto">
<div class="head">
<h1>Theory Lcm_Nat_Upto</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Lcm_Nat_Upto.thy
  Author:  Manuel Eberl, TU München

  The LCM of {1..n}, including the relationship Lcm {1..n} = exp (ψ n).
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The LCM of the first $n$ natural numbers›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Lcm_Nat_Upto
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we examine <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Lcm <span class="main"><span class="main">{</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">::</span></span>nat<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In particular,
  we will show that it is equal to $e^{\psi(n)}$ and thus (by the PNT) $e^{n + o(n)}$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> multiplicity_Lcm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semiring_Gcd<span class="main">,</span> factorial_semiring_gcd<span class="main">}</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>Lcm <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lcm <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> lcm <span class="skolem">x</span> <span class="main">(</span>Lcm <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">…</span> <span class="main">=</span> Max <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">`</span> insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_lcm<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Lcm_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The multiplicity of any prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Lcm <span class="main"><span class="main">{</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">::</span></span>nat<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> differs from
  that in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Lcm <span class="main"><span class="main">{</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">::</span></span> nat<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> iff <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> is a power of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>, in which case
  it is greater by 1.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> multiplicity_Lcm_atLeast1AtMost_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="free">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Max <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_Lcm<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span>
               insert <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq image_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">…</span> <span class="main">=</span> max <span class="skolem">l</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l_def k_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Max.insert<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span> <span class="keyword1">dvd</span> Suc <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicity_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span> <span class="main">≤</span> Suc <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le multiplicity_dvd<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">≠</span> <span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> zero_less_power<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max.coboundedI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_def k_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Nat.gr0I<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_strict_increasing<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> zero_less_power<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max.coboundedI<span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> multiplicity <span class="free">p</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le multiplicity_dvd<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> x<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> power_strict_increasing_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Max_less_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_Lcm<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Consequently, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹Lcm <span class="main"><span class="main">{</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">::</span></span>nat<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>›</span></span></span></span> differs from <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹Lcm <span class="main"><span class="main">{</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>nat<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>›</span></span></span></span>
  iff <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> is of the form $p^k$ for some prime $p$, in which case it is greater by a factor
  of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Lcm_atLeast1AtMost_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> primepow <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">then</span> aprimedivisor <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_eq_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> primepow <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">then</span> aprimedivisor <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> aprimedivisor_pos_nat<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="skolem">p</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"primepow <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
                <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>primepow <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def aprimedivisor_prime_power <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"primepow <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> qk<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primepow_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def aprimedivisor_prime_power prime_multiplicity_other<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>primepow <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">k</span><span class="main">.</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_Lcm_atLeast1AtMost_Suc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> Nat.gr0I <span class="quasi_keyword">dest</span><span class="main">:</span> aprimedivisor_pos_nat›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It follows by induction that $\text{Lcm}\ \{1..n\} = e^{\psi(n)}$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Lcm_atLeast1AtMost_conv_ψ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span>real <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
          real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> primepow <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">then</span> aprimedivisor <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Lcm_atLeast1AtMost_Suc<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"primepow <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&gt;</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> primepow_gt_Suc_0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aprimedivisor <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> aprimedivisor_pos_nat<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> primepow <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">then</span> aprimedivisor <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span>mangoldt <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mangoldt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_psi_def sum_upto_plus1 exp_add<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> Lcm_upto_real_conv_ψ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">ψ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Lcm_atLeast1AtMost_conv_ψ<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_psi_def sum_upto_altdef<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Shapiro_Tauberian">
<div class="head">
<h1>Theory Shapiro_Tauberian</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Shapiro_Tauberian.thy
  Author:  Manuel Eberl, TU München

  Shapiro's Tauberian theorem
  (see Section 4.6 of Apostol's Introduction to Analytic Number Theory)
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Shapiro's Tauberian Theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Shapiro_Tauberian
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="More_Dirichlet_Misc.html">More_Dirichlet_Misc</a>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
  <a href="Prime_Distribution_Elementary_Library.html">Prime_Distribution_Elementary_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proof›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given an arithmeticla function $a(n)$, Shapiro's Tauberian theorem relates the sum
  $\sum_{n\leq x} a(n)$ to the weighted sums $\sum_{n\leq x} a(n) \lfloor\frac{x}{n}\rfloor$
  and $\sum_{n\leq x} a(n)/n$.

  More precisely, it shows that if $\sum_{n\leq x} a(n) \lfloor\frac{x}{n}\rfloor = x\ln x + O(x)$,
  then:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> $\sum_{n\leq x} \frac{a(n)}{n} = \ln x + O(1)$
  <span class="antiquoted"><span class="antiquoted">▪</span></span> $\sum_{n\leq x} a(n) \leq Bx$ for some constant $B\geq 0$ and all $x\geq 0$
  <span class="antiquoted"><span class="antiquoted">▪</span></span> $\sum_{n\leq x} a(n) \geq Cx$ for some constant $C&gt;0$ and all $x\geq 1/C$
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> shapiro_tauberian <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="free">S</span> <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≡</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> sum_upto <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' <span class="free">a</span> floor <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_nonneg<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_asymptotics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="free">x</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> le_nat_iff le_floor_iff›</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> S_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">S</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> S_def sum_upto_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2 fin<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> a_nonneg<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonpos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">*</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span>
                <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms True mult_right_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="free">f</span> <span class="main">(</span><span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">α</span><span class="main">*</span><span class="free">x</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fin <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> S_diff_T_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">T</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fin <span class="main">=</span> fin<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> T_diff_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> T_def dirichlet_prod'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> split<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_subtractf ring_distribs
                      sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> split<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">a</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg mult_nonneg_nonneg a_nonneg<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_mult_floor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_diff_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">T</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> diff_bound_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">c</span><span class="main">*</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> asymptotics<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> upper<span class="main">:</span>             <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lower<span class="main">:</span>             <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bigtheta<span class="main">:</span>          <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹We first prove the third case, i.\,e.\ the upper bound for <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>S›</span></span>.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_imp_bigo_real<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> S_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S_diff_T_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a_asymptotics<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a_asymptotics <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cmult_in_bigo_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> landau_o.big.cdiv<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> S_diff_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> S_diff_bigo <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">from</span></span> natfun_bigoE<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span><span class="free">S</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> real <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> real <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> S_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> real <span class="skolem">n</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c_twopow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

    <span class="keyword1"><span class="command">have</span></span> S_twopow_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="bound">r</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">r</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono c_twopow<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="bound">r</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">r</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_lessThan_telescope<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def sum_upto_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">k</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">r</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> geometric_sum<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> S_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def sum_upto_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span>log <span class="numeral">2</span> <span class="skolem">x</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">powr</span> real <span class="skolem">n</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>log <span class="numeral">2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_realpow<span class="main">)</span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">powr</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>log <span class="numeral">2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_less_mono<span class="main">)</span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_realpow<span class="main">)</span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">S</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> S_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> S_twopow_le<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono ge<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹The asymptotics of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>A›</span></span> follows from this immediately:›</span>
  <span class="keyword1"><span class="command">have</span></span> a_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_left_mono a_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_imp_le frac_lt_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> c1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg mult_nonneg_nonneg a_nonneg<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">c1</span><span class="main">*</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">*</span> frac <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def A_def sum_upto_def sum_subtractf frac_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
                    sum_distrib_left sum_distrib_right dirichlet_prod'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">c</span><span class="main">*</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_strong <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_imp_bigo_real<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">c1</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a_asymptotics <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">T</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> landau_o.big.mult_cancel_left<span class="main">)</span> <span class="operator">auto</span>

  <span class="comment1">― ‹It remains to show the lower bound for <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>S›</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">R</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bigo <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">from</span></span> natfun_bigoE<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">R</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">M</span> <span class="main">+</span> ln <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">R</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">R</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def A_def sum_upto_altdef n_def ln_div<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> real <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> ln <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">R</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">+</span> ln <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">R</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">M</span> <span class="main">+</span> ln <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">+</span> ln <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">have</span></span> A_diff_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">-</span>ln <span class="skolem">α</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">α</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> inverse <span class="skolem">α</span> <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> inverse <span class="skolem">α</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">α</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> α <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;=</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">α</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>ln <span class="skolem">α</span> <span class="main">-</span> <span class="skolem">M</span> <span class="main">-</span> <span class="skolem">M</span> <span class="main">≤</span> <span class="main">-</span>ln <span class="skolem">α</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">R</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_mono M<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">-</span>ln <span class="skolem">α</span> <span class="main">+</span> <span class="skolem">R</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> α x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def ln_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">-</span>ln <span class="skolem">α</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">M</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> α_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> S_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">α</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">-</span>ln <span class="skolem">α</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> A_diff_ge<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> split<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">α</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono divide_left_mono a_nonneg<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">S</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono sum_mono2 a_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">α</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">α</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> S_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg a_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">S</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="skolem">α</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">α</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> S_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> elim <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_omega.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">α</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> norm <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Applications to the Chebyshev functions›</span></span>

<span class="comment1">(* 3.16 *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now apply Shapiro's Tauberian theorem to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ψ</span></span>›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">θ</span></span>›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod_mangoldt1_floor_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ind prime <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span> floor <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹This is a perhaps somewhat roundabout way of proving this statement. We show this using
      the asymptotics of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>𝔐›</span></span>: $\mathfrak{M}(x) = \ln x + O(1)$
     
      We proved this before (which was a bit of work, but not that much).
      Apostol, on the other hand, shows the following statement first and then deduces the
      asymptotics of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>𝔐›</span></span> with Shapiro's Tauberian theorem instead. This might save a bit of
      work, but it is probably negligible.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ind prime <span class="bound">i</span> <span class="main">*</span> ln <span class="bound">i</span> <span class="main">*</span> frac <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>ln <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="keyword1">θ</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> R_def prime_sum_upto_altdef1 sum_upto_def θ_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> frac_lt_1<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ln <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> θ_upper_bound<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">≤</span> ln <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">R</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> ln <span class="numeral">4</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ln <span class="numeral">4</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ind prime <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span> floor <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝔐</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_M_def dirichlet_prod'_def prime_sum_upto_altdef1 sum_upto_def
                   frac_def sum_subtractf sum_distrib_left sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span> R_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝔐</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult mertens_bounded<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝔐</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dirichlet_prod'_mangoldt_floor_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' mangoldt floor <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod' mangoldt floor <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_ln_conv_sum_upto_mangoldt dirichlet_prod'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong' ext<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' mangoldt floor <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_ln_stirling_weak_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' mangoldt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real_of_int <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 4.9 *)</span>
<span class="keyword1"><span class="command">interpretation</span></span> ψ<span class="main">:</span> shapiro_tauberian <span class="quoted">mangoldt</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted">primes_psi</span>
  <span class="quoted"><span class="quoted">"dirichlet_prod' mangoldt floor"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod' mangoldt floor <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_ln_conv_sum_upto_mangoldt dirichlet_prod'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong' ext<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' mangoldt floor <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_ln_stirling_weak_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' mangoldt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real_of_int <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>
                   <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' mangoldt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real_of_int <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_psi_def mangoldt_nonneg<span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> ψ.asymptotics ψ.upper ψ.lower


<span class="comment1">(* 4.10 *)</span>
<span class="keyword1"><span class="command">interpretation</span></span> θ<span class="main">:</span> shapiro_tauberian <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ind prime <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span>"</span></span> 
  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ind prime <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted">primes_theta</span> <span class="quoted"><span class="quoted">"dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ind prime <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span> floor"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ind prime <span class="skolem">n</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ind_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ind prime <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span> floor <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dirichlet_prod_mangoldt1_floor_bigo<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_theta_def mangoldt_nonneg prime_sum_upto_altdef1<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> θ.asymptotics θ.upper θ.lower

<span class="comment1">(* 4.11 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> sum_upto_ψ_x_over_n_asymptotics<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_psi <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sum_upto_θ_x_over_n_asymptotics<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_theta <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dirichlet_prod_mangoldt1_floor_bigo dirichlet_prod'_mangoldt_floor_asymptotics
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_floor_conv_sum_upto primes_theta_def
                    primes_psi_def prime_sum_upto_altdef1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Partial_Zeta_Bounds">
<div class="head">
<h1>Theory Partial_Zeta_Bounds</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Partial_Zeta_Bounds.thy
  Author:  Manuel Eberl, TU München

  Asymptotic bounds on sums over k^(-s) for k=1..n, for fixed s and variable n.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bounds on partial sums of the $\zeta$ function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Partial_Zeta_Bounds
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Euler_MacLaurin/Euler_MacLaurin_Landau.html">Euler_MacLaurin.Euler_MacLaurin_Landau</a>
  <a href="../Zeta_Function/Zeta_Function.html">Zeta_Function.Zeta_Function</a>
  <a href="../Prime_Number_Theorem/Prime_Number_Theorem_Library.html">Prime_Number_Theorem.Prime_Number_Theorem_Library</a>
  <a href="Prime_Distribution_Elementary_Library.html">Prime_Distribution_Elementary_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: This does not necessarily require the full complex zeta function. *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We employ Euler--MacLaurin's summation formula to obtain asymptotic estimates
  for the partial sums of the Riemann $\zeta(s)$ function for fixed real $a$, i.\,e.\ the function
  \[f(n) = \sum_{k=1}^n k^{-s}\ .\]
  We distinguish various cases. The case $s = 1$ is simply the Harmonic numbers and is
  treated apart from the others.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> harm_asymp_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_sandwich<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span>ln <span class="main">(</span><span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span>ln <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef harm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">{</span>ln <span class="main">(</span><span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span>ln <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> elim harm_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span><span class="main">]</span> ln_le_harm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> ln <span class="main">(</span><span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
         <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≤</span> ln <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   zeta_partial_sum_bigo_pos<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   zeta_partial_sum_bigo_pos'<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">=o</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">interpret</span></span> euler_maclaurin_nat' <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">(!)</span> <span class="main">[</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">b</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">b</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>
             <span class="main">⇢</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">b</span><span class="main">.</span> complex_of_real <span class="main">(</span>real <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> complex_of_real <span class="free">s</span><span class="main">)</span> <span class="main">-</span>
                             of_nat <span class="bound">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">b</span> <span class="keyword1">in</span> at_top<span class="main">.</span> Re <span class="main">(</span><span class="var">?g</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">b</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">b</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">b</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">Suc</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">-</span> real <span class="skolem">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span><span class="var">?g</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_Reals_eq add_ac<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> Re <span class="main">(</span><span class="var">?g</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hurwitz_zeta_critical_strip<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="free">s</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">b</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> s <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">(</span>real <span class="bound">b</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">[</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⇢</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def F_def z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
         <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> 
               <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main">:</span> has_field_derivative_iff_has_vector_derivative
               <span class="quasi_keyword">simp</span><span class="main">:</span> F_def f_def f'_def nth_Cons <span class="quasi_keyword">split</span><span class="main">:</span> nat.splits›</span><span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span>
            <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">-</span>
            EM_remainder <span class="main">1</span> <span class="skolem">f'</span> <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> euler_maclaurin_strong_nat'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span>
          <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">-</span> EM_remainder <span class="main">1</span> <span class="skolem">f'</span> <span class="main">(</span>int <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">-</span> EM_remainder <span class="main">1</span> <span class="skolem">f'</span> <span class="main">(</span>int <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>EM_remainder <span class="main">1</span> <span class="skolem">f'</span> <span class="main">(</span>int <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> EM_remainder_strong_bigo_nat<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Y <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> s <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> EM_remainder <span class="main">1</span> <span class="skolem">f'</span> <span class="main">(</span>int <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span>
                  <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">=o</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_tail_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> zeta <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
    
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>
              <span class="main">+</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> zeta <span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> hurwitz_zeta_shift<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> zeta_def powr_Reals_eq›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">n</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zeta_partial_sum_bigo_pos<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> s <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> s <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_tail_bigo'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Re <span class="main">(</span>hurwitz_zeta <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zeta_tail_bigo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   zeta_partial_sum_bigo_neg<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   zeta_partial_sum_bigo_neg'<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">=</span>
          <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> EM_remainder' <span class="main">1</span> <span class="skolem">f'</span> <span class="main">1</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> integral <span class="main">{</span>real <span class="main">1</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="skolem">f</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">]</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="main">[</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">]</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span>real <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> EM_remainder' <span class="main">1</span> <span class="main">(</span><span class="main">[</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">]</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>real <span class="main">1</span><span class="main">)</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> euler_maclaurin_strong_raw_nat<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Y <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
           <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> 
                 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main">:</span> has_field_derivative_iff_has_vector_derivative
                 <span class="quasi_keyword">simp</span><span class="main">:</span> F_def f_def f'_def nth_Cons <span class="quasi_keyword">split</span><span class="main">:</span> nat.splits›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>insert <span class="main">1</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">1</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>integral <span class="main">{</span><span class="main">1</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="skolem">f</span> <span class="main">-</span> <span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> EM_remainder' <span class="main">1</span> <span class="skolem">f'</span> <span class="main">1</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>integral <span class="main">{</span><span class="main">1</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="skolem">f</span> <span class="main">-</span> <span class="skolem">F</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span>
              <span class="skolem">f</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> EM_remainder' <span class="main">1</span> <span class="skolem">f'</span> <span class="main">1</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def diff_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def f_def
               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">1</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="skolem">f</span> <span class="main">-</span> <span class="skolem">F</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span>
           <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> EM_remainder' <span class="main">1</span> <span class="skolem">f'</span> <span class="main">1</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">F</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> EM_remainder' <span class="main">1</span> <span class="skolem">f'</span> <span class="main">1</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_def f_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..</span>real <span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">s</span> <span class="main">*</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> integral_bigo<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult pbernpoly_bigo<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> s <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">s</span> <span class="main">*</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> at_top at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f'</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="skolem">a'</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_EM_remainder'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> s <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> filterlim_real_sequentially <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span>›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> EM_remainder' <span class="main">1</span> <span class="skolem">f'</span> <span class="main">1</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EM_remainder'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def F_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_le_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_asymptotics_lift_nat_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_bigo_pos<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span> <span class="main">-</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">real_asymp</span><span class="keyword3">+</span>›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mono_onI powr_mono2'<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_onI powr_mono2 divide_right_mono add_right_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_onI le_imp_neg_le add_right_mono divide_right_mono_neg powr_mono2'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span>
        mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_le_pos'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_asymptotics_lift_nat_real<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_bigo_pos<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>
                     <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">real_asymp</span><span class="keyword3">+</span>›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">-</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mono_onI powr_mono2'<span class="main">)</span>
  
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_onI powr_mono2 divide_right_mono add_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_onI le_imp_neg_le add_right_mono divide_right_mono_neg powr_mono2'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span>
          mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_le_pos''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_partial_sum_le_pos'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="main">(</span>1<span class="main">)</span> c<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono powr_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono powr_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_pos_pos divide_pos_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_le_pos_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_partial_sum_le_pos''<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_01_asymp_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_partial_sum_le_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_gt_1_asymp_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ζ</span> <span class="main">≡</span> Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ζ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ζ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms zeta_Re_gt_1_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> zeta_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_partial_sum_le_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">ζ</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span>
                        <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ζ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
             <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smallo_imp_asymp_equiv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_pos_bigtheta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> asymp_equiv_imp_bigtheta<span class="main">[</span><span class="operator">OF</span> zeta_partial_sum_01_asymp_equiv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True zeta_Re_gt_1_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> zeta_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True asymp_equiv_imp_bigtheta<span class="main">[</span><span class="operator">OF</span> zeta_partial_sum_gt_1_asymp_equiv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_le_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_upto_asymptotics_lift_nat_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">k</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_bigo_neg<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span> mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mono_onI powr_mono2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">∨</span>
        mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI1 divide_right_mono powr_mono2 mono_onI<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zeta_partial_sum_neg_asymp_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_partial_sum_le_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Moebius_Mu_Sum">
<div class="head">
<h1>Theory Moebius_Mu_Sum</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Moebius_Mu_Sum.thy
  Author:  Manuel Eberl, TU München

  Properties of the summatory Möbius μ function, including its relationship to
  the Prime Number Theorem.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The summatory Möbius <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>μ›</span></span></span></span> function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Moebius_Mu_Sum
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="More_Dirichlet_Misc.html">More_Dirichlet_Misc</a>
  <a href="../Dirichlet_Series/Partial_Summation.html">Dirichlet_Series.Partial_Summation</a>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
  <a href="../Dirichlet_Series/Arithmetic_Summatory_Asymptotics.html">Dirichlet_Series.Arithmetic_Summatory_Asymptotics</a>
  <a href="Shapiro_Tauberian.html">Shapiro_Tauberian</a>
  <a href="Partial_Zeta_Bounds.html">Partial_Zeta_Bounds</a>
  <a href="../Prime_Number_Theorem/Prime_Number_Theorem_Library.html">Prime_Number_Theorem.Prime_Number_Theorem_Library</a>
  <a href="Prime_Distribution_Elementary_Library.html">Prime_Distribution_Elementary_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we shall examine the summatory Möbius <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>μ›</span></span></span></span> function
  $M(x) := \sum_{n\leq x} \mu(n)$. The main result is that $M(x) \in o(x)$ is equivalent
  to the Prime Number Theorem.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> sum_upto moebius_mu"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_moebius_mu_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">M</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">H</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sum_upto_moebius_mu_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">M</span> <span class="skolem">b</span> <span class="main">*</span> ln <span class="skolem">b</span> <span class="main">-</span> <span class="free">M</span> <span class="skolem">a</span> <span class="main">*</span> ln <span class="skolem">a</span> <span class="main">-</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">&lt;..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">using</span></span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> partial_summation_strong <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span>
               <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">M</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">-</span> <span class="free">H</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> integrable_negligible<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_moebius_mu_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>moebius_mu <span class="bound">n</span><span class="main">¦</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_moebius_mu_aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_upto_moebius_mu_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def has_integral_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.divide_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_moebius_mu_bound
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">M</span> <span class="bound">t</span> <span class="main">/</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> R_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_bigo<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_ident has_integral_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_upto_moebius_mu_integrable<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 4.13 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> sum_moebius_mu_aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_moebius_mu_aux1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> smalloD_tendsto<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_moebius_mu_ln_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> dirichlet_prod' moebius_mu <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds mangoldt <span class="main">=</span> <span class="main">(</span>fds_deriv <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="main">*</span> fds_zeta <span class="main">::</span> real fds<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_mangoldt' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_deriv <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="main">=</span> fds moebius_mu <span class="main">*</span> <span class="main">(</span>fds mangoldt <span class="main">::</span> real fds<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> fds_moebius_inversion <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">H</span> <span class="skolem">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>ln <span class="bound">n</span> <span class="main">*</span> moebius_mu <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def sum_upto_def sum_negf mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> dirichlet_prod moebius_mu mangoldt <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff fds_nth_deriv fds_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod' moebius_mu <span class="keyword1">ψ</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_upto_dirichlet_prod<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_psi_def dirichlet_prod'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>dirichlet_prod' moebius_mu <span class="keyword1">ψ</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 4.14 *)</span>
<span class="keyword1"><span class="command">theorem</span></span> PNT_implies_sum_moebius_mu_sublinear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendstoI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ε'</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> ε'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ε' <span class="keyword1"><span class="command">have</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> asymp_equivD_strong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> tendstoD<span class="main">[</span><span class="operator">OF</span> this ε<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_if <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">A'</span> <span class="main">⟹</span> <span class="main">¦</span><span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> max <span class="numeral">2</span> <span class="skolem">A'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A' <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="main">¦</span><span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> H_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">H</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span>
  
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> nat <span class="main">⌊</span>floor <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">y</span> <span class="main">=</span> real_of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">⌋</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> y_def le_nat_iff le_floor_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span>
  
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="skolem">y</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>dirichlet_prod' moebius_mu <span class="keyword1">ψ</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_moebius_mu_ln_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dirichlet_prod' moebius_mu <span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod'_def sum_upto_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x y A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">S1</span> <span class="main">+</span> <span class="skolem">S2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod'_def sum_upto_def S1_def S2_def <span class="keyword1"><span class="command">using</span></span> fin
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> abs_H_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">H</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">S1</span> <span class="main">+</span> <span class="skolem">S2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S1_1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1_1</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S1_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1_2</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">S1_1</span> <span class="main">+</span> <span class="skolem">S1_2</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left sum_distrib_right
                      mult_ac sum_subtractf ring_distribs<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">S1_1</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">S1_2</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> abs_mult›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono mult_left_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S1_1</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abs_sum_upto_moebius_mu_over_n_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S1_2</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">¦</span>moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> S1_2_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> abs_mult sum_upto_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_mono less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> real <span class="bound">i</span> <span class="main">≤</span> real <span class="skolem">y</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="main">≤</span> real <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>1<span class="main">)</span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef sum_distrib_left <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">y</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> harm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ln <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">y</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> harm_le<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> y <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">y</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S1_2</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ε x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> S1_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S1</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S2</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">¦</span>moebius_mu <span class="bound">m</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">m</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> y
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="main">∧</span> real <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> of_int <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">/</span> <span class="skolem">A</span> <span class="main">≤</span> real <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ψ</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> m A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ψ_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">m</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="keyword1">ψ</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ψ_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def ψ_nonneg <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ψ_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> S2_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">S2</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">H</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">S1</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">S2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs_H_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="keyword1">ψ</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono S1_bound S2_bound<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">H</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">H</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">H</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> H_bound <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">&lt;</span> <span class="skolem">ε'</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ε_def <span class="keyword1"><span class="command">using</span></span> ε' <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">H</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε'</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dist <span class="main">(</span><span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ε'</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_moebius_mu_aux1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">H</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 4.15 *)</span>
<span class="keyword1"><span class="command">theorem</span></span> sum_moebius_mu_sublinear_imp_PNT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span>euler_mascheroni <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">σ</span> <span class="bound">n</span> <span class="main">-</span> ln <span class="bound">n</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> sum_upto <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">write</span></span> moebius_mu <span class="main">(</span><span class="quoted">"<span class="keyword1">μ</span>"</span><span class="main">)</span>

  <span class="comment1">― ‹The proof is based on the fact that $\psi(x)-x$ can be approximated fairly well by
      the Dirichlet product $\sum_{n\leq x} \sum_{d\mid n} \mu(d) f(n/d)$:›</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> frac <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">=</span>
            sum_upto <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> sum_upto mangoldt <span class="skolem">x</span> <span class="main">-</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef ψ_def le_nat_iff le_floor_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> mangoldt <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_subtractf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong refl moebius_inversion<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divisor_count_def sum_subtractf mangoldt_sum f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> frac <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> frac_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹We now obtain a bound of the form <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>¦F x¦ ≤ B * sqrt x›</span></span>.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sum_upto <span class="skolem">σ</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span>sum_upto ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> frac <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?rhs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_upto_altdef sum_subtractf f_def frac_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="skolem">σ</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> C_def σ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summatory_divisor_count_asymptotics<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sum_upto_ln_stirling_weak_bigo<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> euler_mascheroni_pos <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">from</span></span> natfun_bigoE<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">F</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">F</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">F</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef le_nat_iff le_floor_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B<span class="main">(</span>1<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Next, we obtain a good bound for $\sum_{n\leq x} \frac{1}{\sqrt{n}}$.›</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_partial_sum_le_pos''<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="main">*</span> sqrt <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def powr_half_sqrt powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="comment1">― ‹Finally, we show that $\sum_{n\leq x} \sum_{d\mid n} \mu(d) f(n/d) \in o(x)$.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.smallI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ε</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">/</span> sqrt <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">/</span> sqrt <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> euler_mascheroni_gt_19_over_33 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K_def f_def sum_upto_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_pos2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">/</span> <span class="skolem">K</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> smalloD_tendsto<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> ε K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tendsto_iff dist_norm<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">c'</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">M</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">/</span> <span class="skolem">K</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> max <span class="main">1</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">/</span> <span class="skolem">K</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> c'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span><span class="main">]</span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> elim <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
                sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">μ</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">-</span> <span class="free">M</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">F</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> M_def F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hyperbola_method<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> ab <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">…</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq4<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">μ</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">μ</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def abs_mult <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_mono B'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">n</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left real_sqrt_divide<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="skolem">x</span> <span class="main">*</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="bound">n</span><span class="main">)</span> <span class="skolem">a</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> B<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> sqrt <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> sqrt <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> B<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono A<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">/</span> sqrt <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ab <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">b</span>›</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> real_sqrt_divide<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono b<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">μ</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">M</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">n</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">/</span> <span class="skolem">K</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def abs_mult
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_right_mono<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">/</span> <span class="skolem">K</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">K</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> K_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">F</span> <span class="skolem">b</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">*</span> sqrt <span class="skolem">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono sum_moebius_mu_bound B'<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">/</span> sqrt <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">a</span>›</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono b<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">M</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">F</span> <span class="skolem">b</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">b</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">/</span> sqrt <span class="bound">b</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">/</span> sqrt <span class="bound">b</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ε <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj<span class="main"><span class="keyword3">;</span></span> <span class="operator">real_asymp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">/</span> sqrt <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">/</span> sqrt <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> norm <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span>sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>frac <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>frac <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> landau_theta.uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>frac <span class="bound">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sum_upto <span class="main">(</span>dirichlet_prod <span class="keyword1">μ</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now turn to a related fact: For the weighted sum $A(x) := \sum_{n\leq x} \mu(n)/n$, the
  asymptotic relation $A(x)\in o(1)$ is also equivalent to the Prime Number Theorem.
  Like Apostol, we only show one direction, namely that $A(x)\in o(1)$ implies the PNT.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≡</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_upto_moebius_mu_integral'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">has_integral</span> <span class="free">x</span> <span class="main">*</span> <span class="free">A</span> <span class="free">x</span> <span class="main">-</span> <span class="free">M</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sum_upto_moebius_mu_integrable'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">A</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">A</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">-</span> <span class="free">A</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">-</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">&lt;..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def A_def <span class="keyword1"><span class="command">using</span></span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> partial_summation_strong <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span>
               <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>real <span class="main">-`</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span>insert <span class="main">1</span> <span class="main">(</span>real <span class="main">-`</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_vimage_real_of_nat_greaterThanAtMost<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">1</span> <span class="main">(</span>real <span class="main">-`</span> <span class="main">{</span><span class="main">1</span><span class="main">&lt;..</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">has_integral</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">A</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">M</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> integrable_negligible<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 4.16 *)</span>
<span class="keyword1"><span class="command">theorem</span></span> sum_moebius_mu_div_n_smallo_imp_PNT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> smallo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">M</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">A</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> sum_upto_moebius_mu_integral' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> has_integral_iff›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">-</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_smallo<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> smallo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_smallo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> smallo<span class="main"><span class="main">]</span></span> sum_upto_moebius_mu_integrable'<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_moebius_mu_sublinear_imp_PNT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Elementary_Prime_Bounds">
<div class="head">
<h1>Theory Elementary_Prime_Bounds</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Elementary_Prime_Bounds.thy
  Author:  Manuel Eberl, TU München

  Elementary bounds for the prime-counting function π(x) and the "n-th prime" function p_n
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Elementary bounds on $\pi(x)$ and $p_n$›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Elementary_Prime_Bounds
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
  <a href="Prime_Distribution_Elementary_Library.html">Prime_Distribution_Elementary_Library</a>
  <a href="More_Dirichlet_Misc.html">More_Dirichlet_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we will follow Apostol and give elementary proofs of Chebyshev-type
  lower and upper bounds for $\pi(x)$, i.\,e.\ $c_1 x/\ln x &lt; \pi(x) &lt; c_2 x/\ln x$. From
  this, similar bounds for $p_n$ follow as easy corollaries.
›</span></span>

<span class="comment1">(* TODO: Move stuff from Prime_Number_Theorem here *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminary lemmas›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following two estimates relating the central Binomial coefficient to powers
  of 2 and 4 form the starting point for Apostol's elementary bounds for $\pi(x)$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> twopow_le_central_binomial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> fact <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">*</span> fact <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> fact <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono Suc.IH<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> fact <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> binomial_fact_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fourpow_gt_central_binomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">^</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_pos<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> insert <span class="free">n</span> <span class="main">(</span><span class="main">{..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">(</span><span class="main">{..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> binomial<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_mult<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lower bound for $\pi(x)$›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>log <span class="bound">p</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">/</span><span class="bound">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="bound">n</span><span class="main">/</span><span class="bound">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now first prove the bound $\pi(x) \geq \frac{1}{6} x/\ln x$ for $x\geq 2$.
  The constant could probably be improved for starting points greater than 2; this
  is true for most of the constants in this section.

  The first step is to show a slightly stronger bound for even numbers, where the
  constant is $\frac{1}{2}\ln 2 \approx 0.347$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   π_bounds_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
                           prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     π_lower_bound_ge_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">≥</span> ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">p</span><span class="main">.</span> legendre_aux <span class="bound">x</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> <span class="main">=</span> sum_upto ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> sum_upto ln <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_fact_conv_sum_upto<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span>
                    <span class="numeral">2</span> <span class="main">*</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">L</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> legendre_identity<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">L</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">L</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prime_sum_upto_altdef2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_subset<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat legendre_aux_posD
             <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> legendre_aux_eq_0 L_def le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">-</span>
                 <span class="numeral">2</span> <span class="main">*</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">L</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
               prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>real <span class="main">(</span><span class="skolem">L</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="skolem">L</span> <span class="free">n</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs sum_subtractf sum_distrib_left mult.assoc prime_sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">S</span> <span class="free">n</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prime_sum_upto_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span> <span class="main">=</span> nat <span class="main">⌊</span>log <span class="skolem">p</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">ub</span><span class="main">}</span><span class="main">.</span> nat <span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> L_def legendre_aux_altdef1 <span class="keyword1"><span class="command">using</span></span> p 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="free">n</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">ub</span><span class="main">}</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> legendre_aux_altdef2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">=</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> log <span class="skolem">p</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"log <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"log <span class="skolem">p</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">+</span> of_int <span class="main">⌊</span>log <span class="skolem">p</span> <span class="numeral">2</span> <span class="main">+</span> log <span class="skolem">p</span> <span class="free">n</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="keyword1">powr</span> log <span class="skolem">p</span> <span class="free">n</span> <span class="main">&lt;</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> Suc <span class="skolem">ub</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ub_def <span class="keyword1"><span class="command">using</span></span> n p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_less_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> log_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">ub</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">&lt;</span> real <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">ub</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> n p <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">L</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="skolem">L</span> <span class="free">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span>
                       <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">ub</span><span class="main">}</span><span class="main">.</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">ub</span><span class="main">}</span><span class="main">.</span> <span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_int_sum <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ub_def S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
                      prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> S_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">n</span> <span class="skolem">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg<span class="main">)</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> S_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">n</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="main">⌊</span>log <span class="skolem">p</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">⌋</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">n</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>nat <span class="main">⌊</span>log <span class="skolem">p</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">⌋</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def of_nat_mult of_nat_numeral <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> that n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">=</span> ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ln <span class="main">(</span>real <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twopow_le_central_binomial<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> of_nat_le_iff<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binomial_fact ln_div ln_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">⌊</span>log <span class="bound">p</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prime_sum_upto_def <span class="keyword1"><span class="command">using</span></span> S_le
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prime_sum_upto_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">⌊</span>log <span class="skolem">p</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span> real_of_int <span class="main">⌊</span>ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">p</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> log_def ln_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> ln <span class="skolem">p</span> <span class="main">=</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">⌊</span>log <span class="skolem">p</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">*</span> ln <span class="skolem">p</span> <span class="main">≤</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">π</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def prime_sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> ln_2_ge_56_81<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">56</span> <span class="main">/</span> <span class="numeral">81</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ln_approx_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">simplified</span> eval_nat_numeral<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The bound for any real number $x\geq 2$ follows fairly easily, although some ugly
  accounting for error terms has to be done.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> π_lower_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> True assms <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ln_2_ge_56_81 x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> ln <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> ln <span class="free">x</span> <span class="main">≤</span> ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">/</span> ln <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> frac_le mult_mono mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">/</span> ln <span class="skolem">n</span> <span class="main">≤</span> <span class="keyword1">π</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_lower_bound_ge_strong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹even <span class="skolem">n</span>›</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="skolem">n</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False assms <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> oddE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> real <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="main">&lt;</span> ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> frac_less<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ln_2_ge_56_81 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> real <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">x</span> <span class="main">&lt;</span> ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> real <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ln <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> k x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">π</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> π_lower_bound_ge_strong<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">π</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> π_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> π_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim primes_pi at_top at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> primes_pi <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">intro</span> less_imp_le π_lower_bound<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Upper bound for $\vartheta(x)$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we prove a linear upper bound for $\vartheta$. This is somewhat unnecessary
  because we already have a considerably better bound on $\vartheta(x)$ using a proof that has
  roughly the same complexity as this one and also only uses elementary means. Nevertheless,
  here is the proof from Apostol's book; it is quite nice and it would be a shame not to
  formalise it.

  The idea is to first show a bound for $\vartheta(2n)-\vartheta(n)$ and then deduce one for
  $\vartheta(2^n)$ from this by telescoping, which then yields one for general $x$ by
  monotonicity.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> θ_double_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="main">(</span>real <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> real <span class="free">n</span> <span class="main">*</span> ln <span class="numeral">4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="numeral">2</span> <span class="main">=</span> ln <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_θ<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> θ_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="skolem">n</span><span class="main">.</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> θ_def prime_sum_upto_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span> <span class="free">n</span><span class="main">.</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> θ_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Groups_Big.sum_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span> <span class="free">n</span><span class="main">.</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span>real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="skolem">p</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">P</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span>real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">⌋</span> <span class="main">≤</span> <span class="main">⌊</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="main">⌊</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span>real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="main">⌊</span>real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">⌋</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">⌊</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span> <span class="main">^</span> <span class="bound">m</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span> <span class="main">/</span> real <span class="skolem">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> <span class="free">S</span> <span class="free">n</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> that<span class="main">(</span>2<span class="main">)</span> n *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">^</span><span class="bound">m</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_right_mono<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> of_int_le_iff<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">⌊</span><span class="free">n</span><span class="main">/</span><span class="bound">p</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">S</span> <span class="free">n</span> <span class="bound">p</span> <span class="main">*</span> ln <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def prime_sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> π_bounds_aux <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span>real <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binomial_fact ln_div ln_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">4</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> of_nat_le_iff<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> fourpow_gt_central_binomial<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> ln <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> θ_twopow_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> θ_twopow_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">k</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> θ_double_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> ln_realpow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">*</span> ln <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_strict_mono θ_twopow_diff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_lessThan_telescope<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right sum_distrib_left mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">r</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> geometric_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">::</span> real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> θ_upper_bound_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> Discrete.log <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="free">n</span> <span class="main">≤</span> <span class="keyword1">θ</span> <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> log_exp2_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> θ_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> of_nat_le_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> θ_twopow_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> of_nat_le_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> log_exp2_le<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Upper bound for $\pi(x)$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We use our upper bound for $\vartheta(x)$ (the strong one, not the one from the previous
  section) to derive an upper bound for $\pi(x)$.

  As a first step, we show the following lemma about the global maximum of the function
  $\ln x / x^c$ for $c &gt; 0$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> π_upper_bound_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">c</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> exp <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">c</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">f'</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def f'_def <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff powr_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> exp <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def f_def powr_def exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x assms <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">&gt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> MVT2 deriv<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&gt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">t</span> <span class="main">&lt;</span> ln <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x assms <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">&gt;</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> MVT2 deriv<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&gt;</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">z</span> <span class="main">&lt;</span> ln <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonpos_nonpos mult_nonneg_nonpos<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Following Apostol, we first show a generic bound depending on some real-valued
  parameter <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α›</span></span></span></span>:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> π_upper_bound_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">≤</span> real <span class="free">n</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">≤</span> real <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">∈</span> <span class="main">{</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">&lt;..</span><span class="free">n</span><span class="main">}</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> finite_P <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">P</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="main">{..</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff P_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> P_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">P</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">P</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">P</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span><span class="skolem">P</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_Diff_subset finite_P P_subset n'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">…</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="free">n</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ P_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> n' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> π_def prime_sum_upto_def P_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> card_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>card <span class="skolem">Q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="free">n</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">π</span> <span class="free">n</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> ln <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> ln <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="keyword1">θ</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> θ_def prime_sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ln <span class="numeral">4</span> <span class="main">*</span> real <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> θ_upper_bound<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">π</span> <span class="free">n</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="numeral">4</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">with</span></span> n assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_powr
             <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> π_le_self<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">+</span> ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span> <span class="main">=</span>
               <span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">+</span> ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff
                       <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> π_upper_bound_aux<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> α n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">+</span> ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span> <span class="main">≤</span>
           <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono mult_right_mono add_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">4</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">/</span> ln <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The choice $\alpha := \frac{2}{3}$ then leads to the upper bound $\pi(x) &lt; cx/\ln x$
  with $c = 3(e^{-1} + \ln 2) \approx 3.183$. This is considerably stronger than
  Apostol's bound.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> π_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_π<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> add_pos_pos
             <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_upper_bound_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def le_nat_iff le_floor_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_upper_bound_strong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span><span class="main">]</span> ln_realpow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_minus
             <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono divide_ln_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> π_upper_bound'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">443</span> <span class="main">/</span> <span class="numeral">139</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2.71828</span> <span class="main">≤</span> <span class="numeral">5837465777</span> <span class="main">/</span> <span class="numeral">2147483648</span> <span class="main">-</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">32</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_approx_32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2.71828</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> e_m1<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">5</span> <span class="main">/</span> <span class="numeral">271828</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_minus<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_upper_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">443</span> <span class="main">/</span> <span class="numeral">139</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">5</span> <span class="main">/</span> <span class="numeral">271828</span> <span class="main">+</span> <span class="numeral">25</span> <span class="main">/</span> <span class="numeral">36</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_m1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono add_mono ln2_le_25_over_36<span class="main">)</span>
                    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">443</span> <span class="main">/</span> <span class="numeral">139</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> <span class="numeral">443</span> <span class="main">/</span> <span class="numeral">139</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> π_upper_bound''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π_upper_bound'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> mult_right_mono<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In particular, we have now shown a weak version of the Prime Number Theorem, namely
  that $\pi(x) \in \Theta(x/\ln x)$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> π_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> π_upper_bound <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> less_imp_le›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> π_lower_bound <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> less_imp_le›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_omega.bigI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounds for $p_n$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By some rearrangements, the lower and upper bounds for $\pi(x)$ give rise to
  analogous bounds for $p_n$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> nth_prime_lower_bound_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="keyword1">π</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def nth_prime_ge_2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nth_prime_lower_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> ln <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n c <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">p</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span>real <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> ln <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> nth_prime_lower_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">139</span> <span class="main">/</span> <span class="numeral">443</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> π_upper_bound' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_prime_lower_bound_gen<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> nth_prime_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def nth_prime_ge_2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">/</span> ln <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">π</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> π_lower_bound<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">n</span> <span class="main">*</span> ln <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">p</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_upper_bound_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus powr_half_sqrt<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="skolem">p</span> <span class="main">*</span> sqrt <span class="skolem">p</span> <span class="main">&lt;</span> <span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span> <span class="main">*</span> <span class="free">n</span> <span class="main">*</span> sqrt <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="skolem">p</span> <span class="main">&lt;</span> <span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult_less_cancel_right<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>sqrt <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>sqrt <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> ln <span class="skolem">p</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_sqrt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ln <span class="free">n</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_div ln_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ln_less<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="skolem">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">n</span> <span class="main">*</span> ln <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> less<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">6</span> <span class="main">*</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono ln_less<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can thus also conclude that $p_n \sim n \ln n$:
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> nth_prime_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>nth_prime <span class="bound">n</span><span class="main">¦</span> <span class="main">≤</span>
           <span class="numeral">12</span> <span class="main">*</span> <span class="main">¦</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nth_prime_upper_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="numeral">12</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">12</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>nth_prime <span class="bound">n</span><span class="main">¦</span> <span class="main">≥</span> <span class="numeral">139</span> <span class="main">/</span> <span class="numeral">443</span> <span class="main">*</span> <span class="main">¦</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nth_prime_lower_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_omega.bigI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="numeral">139</span> <span class="main">/</span> <span class="numeral">443</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Summatory_Divisor_Sigma_Bounds">
<div class="head">
<h1>Theory Summatory_Divisor_Sigma_Bounds</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Summatory_Divisor_Sigma_Bounds.thy
  Author:  Manuel Eberl, TU München

  Asymptotic expansions for the sums over the divisor function σ_x.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The asymptotics of the summatory divisor $\sigma$ function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Summatory_Divisor_Sigma_Bounds
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Partial_Zeta_Bounds.html">Partial_Zeta_Bounds</a> <a href="More_Dirichlet_Misc.html">More_Dirichlet_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we analyse the asymptotic behaviour of the summatory divisor functions
  $\sum_{n\leq x} \sigma_\alpha(n)$ for real <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α›</span></span></span></span>. This essentially tells us what the average value
  of these functions is for large <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>.

  The case <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α = 0›</span></span></span></span> is not treated here since $\sigma_0$ is simply the divisor function,
  for which precise asymptotics are already available in the AFP.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Case 1: $\alpha = 1$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α = 1›</span></span></span></span>, $\sigma_\alpha(n)$ is simply the sum of all divisors of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>. Here, the asymptotics is
  \[\sum_{n\leq x} \sigma_1(n) = \frac{\pi^2}{12} x^2 + O(x\ln x)\ .\]
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> summatory_divisor_sum_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_upto divisor_sum <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">12</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ζ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ζ</span> <span class="main">=</span> Re <span class="main">(</span>zeta <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto real <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">ζ</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R1</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R1_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R2</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ζ_def R2_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span>
              <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto divisor_sum <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">ζ</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> div_le<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>sum_upto divisor_sum <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="main">(</span>dirichlet_prod real <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_conv_dirichlet_prod <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> 
                    sum_upto_def divisor_sigma_1_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> real <span class="bound">d</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">n</span><span class="main">:</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> real <span class="bound">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">d</span><span class="main">:</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">q</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> real <span class="bound">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> div_le <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> sum_upto real <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum.Sigma<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def sum_upto_def sum.distrib sum_subtractf sum_divide_distrib
                    power_divide sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ζ</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>sum_upto divisor_sum <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
                        <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">ζ</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>sum_upto divisor_sum <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">ζ</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
            <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_diff div_add
               <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">…</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq4<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c2</span> <span class="main">/</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono c2<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono c1<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_altdef harm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ln <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> harm_le<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> le_nat_iff›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c1<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto divisor_sum <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">ζ</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto divisor_sum <span class="bound">x</span> <span class="main">-</span> <span class="skolem">ζ</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span> <span class="main">≤</span>
                            <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> le <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto divisor_sum <span class="bound">x</span> <span class="main">-</span> <span class="skolem">ζ</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span> <span class="main">≤</span>
                              <span class="main">¦</span><span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto divisor_sum <span class="bound">x</span> <span class="main">-</span> <span class="skolem">ζ</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> ζ_def zeta_even_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Case 2: $\alpha &gt; 0$, $\alpha \neq 1$›</span></span>

<span class="comment1">(* TODO: Unify *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we consider the case $\alpha &gt; 0$ and $\alpha\neq 1$. We then have:
  \[\sum_{n\leq x} \sigma_\alpha(n) = \frac{\zeta(\alpha + 1)}{\alpha + 1} x^{\alpha + 1} +
       O\left(x^{\text{max}(1,\alpha)}\right)\]
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> summatory_divisor_sigma_asymptotics_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ζ</span> <span class="main">≡</span> Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="keyword1">=o</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ζ</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> max <span class="main">1</span> <span class="free">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">ζ</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R1</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R1_def add_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R2</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ζ_def R2_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R3</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">α</span>"</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R3_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">ub</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">*</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">c3</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> div_le<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
            sum_upto <span class="main">(</span>dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_conv_dirichlet_prod <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> 
                    sum_upto_def divisor_sigma_1_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">n</span><span class="main">:</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">d</span><span class="main">:</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">q</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> real <span class="bound">q</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> div_le <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum.Sigma<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span>
                    sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def sum_upto_def sum.distrib sum_subtractf sum_divide_distrib
                    powr_divide sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">ζ</span> <span class="main">-</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">/</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff powr_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
       <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ζ</span> <span class="main">-</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">/</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">-</span><span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">*</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x α
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span>
                         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square powr_add powr_minus <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_diff div_add
               <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">…</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ub_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq4<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono c2<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> α x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff powr_minus powr_add<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> real <span class="bound">d</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono c1<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left powr_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">R3</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R3_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">R3</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
                   <span class="skolem">c1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">*</span> <span class="skolem">R3</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">divide_simps</span></span>
                    <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
                   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">*</span> <span class="skolem">R3</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">α</span> <span class="main">*</span> <span class="skolem">c3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x c1<span class="main">(</span>1<span class="main">)</span> c3<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="skolem">R1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">c3</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> α x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">/</span> <span class="main">(</span><span class="free">α</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> le <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span><span class="main">/</span><span class="main">(</span><span class="free">α</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">ub</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>divisor_sigma <span class="free">α</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span><span class="main">/</span><span class="main">(</span><span class="free">α</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">α</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="skolem">ub</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> max <span class="main">1</span> <span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> α <span class="keyword1"><span class="command">unfolding</span></span> ub_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">real_asymp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> ζ_def zeta_even_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Case 3: $\alpha &lt; 0$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Last, we consider the case of a negative exponent. We have for $\alpha &gt; 0$:
  \[\sum_{n\leq x} \sigma_{-\alpha}(n) = \zeta(\alpha + 1)x + O(R(x))\]
  where $R(x) = \ln x$ if $\alpha = 1$ and $R(x) = x^{\text{max}(0, 1-\alpha)}$ otherwise.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> summatory_divisor_sigma_asymptotics_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">≡</span> max <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ζ</span> <span class="main">≡</span> Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">α</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span>ln<span class="main">)</span>
                                                     <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ζ</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ra</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="main">*</span> frac <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">+</span> <span class="free">ζ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">ζ</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">R2</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ζ_def R2_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">ub</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">α</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">Ra</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> div_le<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
            sum_upto <span class="main">(</span>dirichlet_prod <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_sigma_conv_dirichlet_prod <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> 
                    sum_upto_def divisor_sigma_1_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">n</span><span class="main">:</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">d</span><span class="main">:</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">q</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                         real <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> div_le <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">dest</span><span class="main">:</span> dvd_imp_le›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="main">⌊</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">⌋</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">Ra</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac_def sum_distrib_left sum_distrib_right
                    sum_subtractf sum_upto_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Ra_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff powr_minus powr_add <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">ζ</span> <span class="main">-</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">α</span> <span class="main">/</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">Ra</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">…</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">Ra</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq4<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">α</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono c2<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus powr_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">R2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> x α <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span> <span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ub_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">*</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> le <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">*</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">ub</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ζ</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="skolem">ub</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ub'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub'</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">Ra</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">ub'</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">Ra</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">*</span> frac <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Ra_def abs_minus sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">α</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs_mult sum_upto_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> frac_lt_1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ub'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ra</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="skolem">ub'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub'</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">α</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> ln <span class="bound">x</span> <span class="keyword1">else</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_imp_bigo harm_asymp_equiv<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ub'_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">unfolding</span></span> δ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> zeta_partial_sum_pos_bigtheta bigthetaD1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_neg_asymp_equiv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> α False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ub'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Ra_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ra</span> <span class="main">∈</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
    <span class="keyword1"><span class="command">with</span></span> Ra_bigo <span class="keyword1"><span class="command">have</span></span> Ra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">Ra</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> bigo
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ub_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo Ra<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>pi<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> ζ_def zeta_even_numeral<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True refl if_True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Ra_bigo <span class="keyword1"><span class="command">have</span></span> Ra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">Ra</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> δ_def <span class="keyword1"><span class="command">using</span></span> α False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">real_asymp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">note</span></span> bigo
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ub_def <span class="keyword1"><span class="command">using</span></span> α False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo Ra *<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span>divisor_sigma <span class="main">(</span><span class="main">-</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">=o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ζ</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> ζ_def zeta_even_numeral<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> False refl if_False<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Selberg_Asymptotic_Formula">
<div class="head">
<h1>Theory Selberg_Asymptotic_Formula</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Selberg_Asymptotic_Formula.thy
  Author:  Manuel Eberl, TU München

  Selberg's asymptotic formula, which is an important ingredient in the elementary
  proof of the Prime Number Theorem by Selberg and Erdős.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Selberg's asymptotic formula›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Selberg_Asymptotic_Formula
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="More_Dirichlet_Misc.html">More_Dirichlet_Misc</a>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
  <a href="Shapiro_Tauberian.html">Shapiro_Tauberian</a>
  <a href="../Euler_MacLaurin/Euler_MacLaurin_Landau.html">Euler_MacLaurin.Euler_MacLaurin_Landau</a>
  <a href="Partial_Zeta_Bounds.html">Partial_Zeta_Bounds</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Following Apostol, we first show an inversion formula: Consider a function $f(x)$ for 
  $x\in\mathbb{R}_{{}&gt;\,0}$. Define $g(x) := \ln x \cdot \sum_{n\leq x} f(x / n)$. Then:
  \[f(x) \ln x + \sum_{n\leq x} \Lambda(n) f(x/n) = \sum_{n\leq x} \mu(n) g(x/n)\]
›</span></span>
<span class="comment1">(* 4.17 *)</span>
<span class="keyword1"><span class="command">locale</span></span> selberg_inversion <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_algebra_1<span class="main">,</span> comm_ring_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">+</span> dirichlet_prod' mangoldt <span class="free">F</span> <span class="free">x</span> <span class="main">=</span> dirichlet_prod' moebius_mu <span class="free">G</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
          dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dirichlet_prod'_one_left<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod' <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod'_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_moebius_mu_divisors'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"dirichlet_prod' mangoldt <span class="free">F</span> <span class="free">x</span> <span class="main">=</span>
               dirichlet_prod' <span class="main">(</span>dirichlet_prod moebius_mu <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> dirichlet_prod'_cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mangoldt <span class="skolem">n</span> <span class="main">=</span> dirichlet_prod moebius_mu <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> moebius_inversion mangoldt_sum <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">+</span> dirichlet_prod' mangoldt <span class="free">F</span> <span class="free">x</span> <span class="main">=</span>
          sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span>
            moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> ln <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 <span class="keyword1"><span class="command">unfolding</span></span> dirichlet_prod'_def sum_upto_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib dirichlet_prod_def sum_distrib_left sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_upto_cong refl arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span>"</span></span><span class="main"><span class="main">]</span></span> sum.cong<span class="main">)</span>
                     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_div ln_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">d</span></span> <span class="main">|</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">n</span><span class="main">:</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                    moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">d</span><span class="main">:</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">d</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">q</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                    moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">q</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Real.real_of_nat_div <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> moebius_mu <span class="bound">d</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                                  sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">q</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_upto_def sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dirichlet_prod' moebius_mu <span class="free">G</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_def G_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now show Selberg's formula
  \[\psi(x)\ln x + \sum_{n\leq x} \Lambda(n)\psi(x/n) = 2x\ln x + O(x)\ .\]
›</span></span>
<span class="comment1">(* 4.18 *)</span>
<span class="keyword1"><span class="command">theorem</span></span> selberg_asymptotic_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> dirichlet_prod' mangoldt <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">=o</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="keyword1">+o</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> euler_mascheroni"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F2</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">F2</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> F1<span class="main">:</span> selberg_inversion <span class="quoted"><span class="keyword1">ψ</span></span> <span class="quoted"><span class="skolem">G1</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> F2<span class="main">:</span> selberg_inversion <span class="quoted"><span class="skolem">F2</span></span> <span class="quoted"><span class="skolem">G2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G2_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> G1_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G1</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult_left sum_upto_ψ_x_over_n_asymptotics<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square G1_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> G2_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G2</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>harm <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> frac <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G2</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">R1</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">*</span> ln <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G2_def sum_upto_altdef sum_subtractf
                              sum_distrib_left sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def harm_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">*</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">=</span>
                   <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">R1</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def R2_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> frac_def power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G2</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R1</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">R1</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">R2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bigo_ln_floor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> harm_expansion_bigo_simple2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.compose<span class="main">)</span> <span class="comment1">(* TODO: real_asymp should be able to do this *)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_nat_sequentially filterlim_floor_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _bigo_ln_floor<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> harm <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>harm <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult_left<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span> R1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="comment1">(* TODO: real_asymp? *)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> R2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult landau_o.big_refl<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G2</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>ln<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> G2_bigo'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G2</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.trans<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">― ‹Now things become a bit hairy. In order to show that the `Big-O' bound is actually
      valid for all <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x ≥ 1›</span></span>, we need to show that <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>G1 x - G2 x›</span></span> is bounded on any compact
      interval starting at 1.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">G1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="main">¦</span>sqrt <span class="bound">x</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigoE_bounded_real_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_in_bigo<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> G1_bigo G2_bigo'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>sqrt<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sqrt <span class="skolem">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> boundedI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">G1</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G1_def G2_def sum_upto_def sum_distrib_left ring_distribs sum_subtractf<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="skolem">x</span> <span class="main">*</span> <span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span>
                   sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> F2_def <span class="keyword1"><span class="command">using</span></span> euler_mascheroni_pos x le ψ_nonneg ψ_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">/</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span>
                    order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq4<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> real_of_int <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span>
                   ln <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> real_of_int <span class="main">⌊</span><span class="skolem">b</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> euler_mascheroni_pos x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono add_mono order.refl ψ_mono add_nonneg_nonneg mult_nonneg_nonneg
                     ψ_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> floor_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">G1</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> real_of_int <span class="main">⌊</span><span class="skolem">b</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">G1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="main">*</span> sqrt <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹The rest of the proof now consists merely of combining some asymptotic estimates.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
          <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">G1</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> dirichlet_prod' mangoldt <span class="keyword1">ψ</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span>
            <span class="main">(</span><span class="skolem">F2</span> <span class="skolem">x</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> dirichlet_prod' mangoldt <span class="skolem">F2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> dirichlet_prod'_def sum_upto_def sum_subtractf sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">G1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F1.eq<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> F2.eq<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dirichlet_prod'_def sum_upto_def sum_subtractf sum.distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ψ</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">G1</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span>
               <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">*</span> sqrt <span class="bound">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">G1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span>
            sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span>moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">G1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def abs_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> A sum_mono mult_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> moebius_mu_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">*</span> sqrt <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_upto_def powr_minus powr_half_sqrt sum_distrib_left
                            sum_distrib_right real_sqrt_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">A</span> <span class="main">*</span> sqrt <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">G1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">G2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span>
                    <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> sqrt <span class="skolem">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">*</span> sqrt <span class="bound">x</span> <span class="main">*</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> sqrt <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeta_partial_sum_le_pos_bigo<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult <span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">*</span> sqrt <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">ψ</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">F2</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
                        <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> dirichlet_prod' mangoldt <span class="keyword1">ψ</span> <span class="bound">x</span>"</span></span>

  <span class="keyword1"><span class="command">note</span></span> bigo
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?lhs</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?R</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> dirichlet_prod'_def  sum_distrib_right ψ_def
                             sum_upto_def sum_subtractf sum.distrib sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?lhs</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?R</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="var">?R</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h'</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult_left ψ.asymptotics<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?lhs</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?lhs</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">*</span>ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_bigo bigthetaD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ψ.bigtheta<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?lhs</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">*</span>ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">C</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?lhs</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minus_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="PNT_Consequences">
<div class="head">
<h1>Theory PNT_Consequences</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    PNT_Consequences.thy
  Author:  Manuel Eberl, TU München

  Some alternative forms and consequences of the Prime Number Theorem,
  including the asymptotics of the divisor function and Euler's totient function.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Consequences of the Prime Number Theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> PNT_Consequences
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Elementary_Prime_Bounds.html">Elementary_Prime_Bounds</a>
  <a href="../Prime_Number_Theorem/Mertens_Theorems.html">Prime_Number_Theorem.Mertens_Theorems</a>
  <a href="../Prime_Number_Theorem/Prime_Counting_Functions.html">Prime_Number_Theorem.Prime_Counting_Functions</a>
  <a href="Moebius_Mu_Sum.html">Moebius_Mu_Sum</a>
  <a href="Lcm_Nat_Upto.html">Lcm_Nat_Upto</a>
  <a href="Primorial.html">Primorial</a>
  <a href="Primes_Omega.html">Primes_Omega</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we will define a locale that assumes the Prime Number Theorem in order to
  explore some of its elementary consequences.
›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">unbundle</span></span> prime_counting_notation
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Statement and alternative forms of the PNT›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="comment1">(* TODO: copied from afp-devel; delete in AFP 2019 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> PNT1_imp_PNT1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">(* TODO: Tedious Landau sum reasoning *)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> ln <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_div <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_mult π_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT1_imp_PNT2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> assms PNT1_imp_PNT1'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_refl_ev eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT2_imp_PNT3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"nth_prime <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> nth_prime <span class="bound">n</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">π</span> <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_symI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> asymp_equiv_compose'<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_real_sequentially nth_prime_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT3_imp_PNT2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nth_prime <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_symI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> asymp_equiv_sandwich_real<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span>real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">..</span>real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nth_prime_partition''<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="main">(</span>nat <span class="main">⌊</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT2_imp_PNT1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
            <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
            <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">real_asymp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> ln <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                   ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> ev
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_mult ln_div<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> ln <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> ln <span class="main">1</span> <span class="main">*</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="main">⤏</span> ln <span class="main">1</span> <span class="main">*</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span> <span class="main">+</span> <span class="main">0</span> <span class="main">-</span> ln <span class="main">1</span> <span class="main">*</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ π_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">real_asymp</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_symI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> asymp_equivI'<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_refl_ev<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT4_imp_PNT5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ψ_minus_θ_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT4_imp_PNT1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> π_θ_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.divide_right asymp_equiv_imp_diff_smallo assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_divide_distrib asymp_equiv_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT1_imp_PNT4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> landau_o.big.uminus_in_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult_right π_θ_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_imp_bigtheta <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> asymp_equiv_symI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PNT5_imp_PNT4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">ψ</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ψ_minus_θ_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">-</span> <span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sqrt <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> sqrt <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ψ</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* END TODO *)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">locale</span></span> prime_number_theorem <span class="main">=</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime_number_theorem <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">corollary</span></span> θ_asymptotics <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_number_theorem <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PNT1_imp_PNT4<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> ψ_asymptotics <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ψ</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> θ_asymptotics PNT4_imp_PNT5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">corollary</span></span> ln_π_asymptotics <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_number_theorem PNT1_imp_PNT1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> π_ln_π_asymptotics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_number_theorem PNT1_imp_PNT2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> nth_prime_asymptotics <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> π_ln_π_asymptotics PNT2_imp_PNT3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> moebius_mu_smallo<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_upto moebius_mu <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> PNT_implies_sum_moebius_mu_sublinear ψ_asymptotics <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_θ_asymptotics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="numeral">2</span> <span class="main">=</span> ln <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_θ<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> θ_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">θ</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="keyword1">θ</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> θ_mono<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> asymp_equivD_strong<span class="main">[</span><span class="operator">OF</span> θ_asymptotics nz<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">(</span>ln <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_div θ_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_θ_asymp_equiv <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> prime_counting_notation
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ln_θ_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span>ln<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_nth_prime_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">(</span>ln <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_ln asymp_equivD_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nth_prime_asymptotics<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_gt_0_nat<span class="main">[</span><span class="operator">OF</span> prime_nth_prime<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_mult ln_div<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_nth_prime_asymp_equiv <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> ln"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span>ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ln_nth_prime_asymptotics <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small.trans<span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span>ln<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallo_imp_asymp_equiv<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following versions use a little less notation.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> prime_number_theorem'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_number_theorem
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> prime_number_theorem''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def prime_sum_upto_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prime_number_theorem <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> prime_number_theorem'''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> real <span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_number_theorem''
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_real_sequentially<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of primes in intervals›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For fixed <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ε›</span></span></span></span>, The interval $(x; \varepsilon x]$ contains a prime number for any sufficiently
  large <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>. This proof was taken from A.\,J. Hildebrand's lecture notes~\cite{hildebrand_ant}.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> prime_in_interval_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prime_number_theorem<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD_const<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_tendstoD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π_at_top <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top_dense<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">*</span><span class="skolem">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Diff_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_primes_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">…</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> π_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_pi_def prime_sum_upto_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>card <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">π</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>card <span class="skolem">P</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">P</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The set of rationals whose numerator and denominator are primes is
  dense in $\mathbb{R}_{{}&gt;0}$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> prime_fractions_dense<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="free">ε</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>real <span class="free">p</span> <span class="main">/</span> real <span class="free">q</span><span class="main">)</span> <span class="free">α</span> <span class="main">&lt;</span> <span class="free">ε</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε'</span> <span class="main">=</span> <span class="free">ε</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">&lt;..</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">ε'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_in_interval_exists<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="keyword2"><span class="keyword">where</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">&lt;..</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> prime <span class="bound">q</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">&gt;</span> nat <span class="main">⌊</span><span class="skolem">x0</span> <span class="main">/</span> <span class="free">α</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigger_prime<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&gt;</span> nat <span class="main">⌊</span><span class="skolem">x0</span> <span class="main">/</span> <span class="free">α</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">q</span> <span class="main">≥</span> <span class="skolem">x0</span> <span class="main">/</span> <span class="free">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">*</span> real <span class="skolem">q</span> <span class="main">≥</span> <span class="skolem">x0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">∈</span> <span class="main">{</span><span class="free">α</span> <span class="main">*</span> real <span class="skolem">q</span><span class="main">&lt;..</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">α</span> <span class="main">*</span> real <span class="skolem">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">&gt;</span> <span class="free">α</span> <span class="main">*</span> real <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">α</span> <span class="main">*</span> real <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> p <span class="quoted"><span class="quoted">‹prime <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">/</span> real <span class="skolem">q</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">ε'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">/</span> real <span class="skolem">q</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">+</span> <span class="skolem">ε'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="quoted"><span class="quoted">‹prime <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">/</span> real <span class="skolem">q</span> <span class="main">&gt;</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">/</span> real <span class="skolem">q</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε'</span> <span class="main">/</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>real <span class="skolem">p</span> <span class="main">/</span> real <span class="skolem">q</span><span class="main">)</span> <span class="free">α</span> <span class="main">≤</span> <span class="skolem">ε'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">q</span>›</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The logarithm of the primorial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The PNT directly implies the asymptotics of the logarithm of the primorial function:
›</span></span>

<span class="keyword1"><span class="command">context</span></span> prime_number_theorem
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_primorial_asymp_equiv <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>primorial <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_primorial θ_asymptotics<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_ln_primorial_asymp_equiv <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_primorial ln_θ_asymp_equiv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_primorial'_asymp_equiv <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ln_ln_primorial'_asymp_equiv <span class="main">[</span><span class="operator">asymp_equiv_intros</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ln_over_ln_ln_primorial'_asymp_equiv<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> lim1<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_real_sequentially<span class="main"><span class="main">]</span></span>
             filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nth_prime_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">have</span></span> lim2<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_top at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>primorial <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_refl_ev eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primorial'_conv_primorial<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ lim1<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ lim2<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_refl_ev eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primorial'_conv_primorial<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ lim1<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ lim2<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> 1 2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequences of the asymptotics of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ψ›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>θ›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we will show some consequences of $\psi(x)\sim x$ and $\vartheta(x)\sim x$. To this
  end, we first show generically that any function $g = e^{x + o(x)}$ is $o(c^n)$ if $c &gt; e$ and
  $\omega(c^n)$ if $c &lt; e$.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> exp_asymp_equiv_linear <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_asymp_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ε</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> smallo<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> smallomega<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> ring_distribs <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> exp_add exp_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_bot<span class="main"><span class="main">]</span></span> filterlim_tendsto_neg_mult_at_bot<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> smallo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_asymp_equiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_imp_diff_smallo<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_diff smalloD_tendsto<span class="main"><span class="main">[</span></span><span class="operator">OF</span> smallo<span class="main"><span class="main">]</span></span> tendsto_const<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> filterlim_ident›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.in_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> exp_add exp_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_top<span class="main"><span class="main">]</span></span> filterlim_tendsto_pos_mult_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> smallo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_asymp_equiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_imp_diff_smallo<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_add smalloD_tendsto<span class="main"><span class="main">[</span></span><span class="operator">OF</span> smallo<span class="main"><span class="main">]</span></span> tendsto_const<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> filterlim_ident›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_iff_smallomega<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_omega.small.in_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallo'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> exp <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">&lt;</span> exp <span class="main">(</span>ln <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> exp_less_cancel_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallo<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallomega'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>exp <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">&gt;</span> exp <span class="main">(</span>ln <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">c</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> exp_less_cancel_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallomega<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The primorial fulfils $x\# = e^{\vartheta(x)}$ and is therefore one example of this.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> prime_number_theorem
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> primorial<span class="main">:</span> exp_asymp_equiv_linear <span class="quoted"><span class="keyword1">θ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>primorial <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> θ_asymptotics <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_primorial <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The LCM of the first <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> natural numbers is equal to $e^{\psi(n)}$ and is
  therefore another example.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> prime_number_theorem
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> Lcm_upto<span class="main">:</span> exp_asymp_equiv_linear <span class="quoted"><span class="keyword1">ψ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ψ_asymptotics <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Lcm_upto_real_conv_ψ<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounds on the prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> function›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we will examine the asymptotic behaviour of the prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ω›</span></span></span></span> function $\omega(n)$,
  i.\,e.\ the number of distinct prime factors of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>. These proofs are again taken from
  A.\,J. Hildebrand's lecture notes~\cite{hildebrand_ant}.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_gt_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> exp <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_le assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> primes_omega_primorial'_asymp_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> primes_omega <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ln_over_ln_ln_primorial'_asymp_equiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_sym<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The number of distinct prime factors of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> has maximal order $\ln n / \ln\ln n$:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span>
  limsup_primes_omega<span class="main">:</span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> primes_omega <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> primes_omega_primorial'_asymp_equiv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equivD_strong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> primorial'<span class="main">)</span> <span class="main">=</span> ereal <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lim_imp_Limsup tendsto_ereal<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> limsup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span>primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> primorial'<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_mono_primorial' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> limsup_subseq_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Limsup_le_iff
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C'</span> <span class="main">::</span> <span class="quoted">ereal</span> <span class="keyword3"><span class="command">assume</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">C</span> <span class="main">&lt;</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> primes_omega <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">1</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?f</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> primes_omega_primorial'_asymp_equiv
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equivD_strong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this C<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k0</span></span> <span class="keyword2"><span class="keyword">where</span></span> k0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="skolem">k0</span> <span class="main">⟹</span> <span class="var">?f</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span> 
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> max <span class="numeral">3</span> <span class="skolem">k0</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"primorial' <span class="main">(</span>max <span class="skolem">k0</span> <span class="numeral">3</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> primes_omega <span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> primorial' <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="numeral">3</span> <span class="main">≤</span> primorial' <span class="main">(</span>max <span class="skolem">k0</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> strict_mono_less_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> strict_mono_primorial'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">30</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> max <span class="numeral">3</span> <span class="skolem">k0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="numeral">30</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> strict_mono_less_eq<span class="main">[</span><span class="operator">OF</span> strict_mono_primorial'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_def k_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> exp_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="numeral">30</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>exp <span class="main">1</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="numeral">30</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">m</span> <span class="main">&gt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ln_realpow<span class="main">)</span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="main">(</span>primes_omega <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">30</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> primorial'_primes_omega_le<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def k_def <span class="keyword1"><span class="command">using</span></span> elim
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"primes_omega <span class="skolem">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">/</span> <span class="main">(</span>ln <span class="skolem">m</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">using</span></span> elim <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="numeral">30</span>›</span></span> ln_gt_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹ln <span class="skolem">m</span> <span class="main">&gt;</span> <span class="numeral">3</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> frac_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"primes_omega <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span> divide_ln_mono mult_pos_pos divide_pos_pos<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_def m_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">C</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> k0<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> k_def›</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"primes_omega <span class="skolem">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> max <span class="numeral">3</span> <span class="skolem">k0</span> <span class="main">/</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> elim ln_gt_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">30</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono divide_nonneg_pos<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">C</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span>primes_omega <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">C'</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ C<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounds on the divisor function›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we shall examine the growth of the divisor function $\sigma_0(n)$.
  In particular, we will show that $\sigma_0(n) &lt; 2^{c\ln n / \ln\ln n}$ for all sufficiently
  large <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> if $c &gt; 1$ and $\sigma_0(n) &gt; 2^{c\ln n / \ln\ln n}$ for infinitely many <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>
  if $c &lt; 1$.

  An equivalent statement is that $\ln(\sigma_0(n))$ has maximal order
  $\ln 2 \cdot \ln n / \ln\ln n$.

  Following Apostol's somewhat didactic approach, we first show a generic bounding lemma for
  $\sigma_0$ that depends on some function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> that we will specify later.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> divisor_count_bound_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">/</span> ln <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">include</span></span> prime_counting_notation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">1</span> <span class="main">+</span> log <span class="numeral">2</span> <span class="bound">n</span> <span class="main">≤</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> log <span class="numeral">2</span> <span class="skolem">n</span> <span class="main">≤</span> ln <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr</span> <span class="main">=</span> prime_factors <span class="skolem">n</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr1</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr2</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≥</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">&lt;</span> real <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_less_272 <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> ln <span class="main">(</span>ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S2_def power_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> real <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono conjI power_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> real <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono2 one_le_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">S2</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">S2</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span> <span class="main">≤</span> ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_realpow<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> le_twopow<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">a</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono conjI le_twopow<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">S2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S2_def power_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> real <span class="skolem">S2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono <span class="quoted"><span class="quoted">‹<span class="skolem">S2</span> <span class="main">≤</span> ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">have</span></span> multiplicity_le<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">≤</span> log <span class="numeral">2</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">Pr</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le prod_dvd_prod_subset<span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"log <span class="numeral">2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> log <span class="numeral">2</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> log_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">≤</span> log <span class="numeral">2</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> log_nat_power<span class="main">)</span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> ln <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> ln <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">Pr1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> log <span class="numeral">2</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p multiplicity_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ln <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> log <span class="numeral">2</span> <span class="skolem">n</span> <span class="main">≤</span> ln <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_pos_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_realpow<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> card <span class="skolem">Pr1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="free">f</span> <span class="skolem">n</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff le_floor_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Pr1</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">…</span> <span class="main">=</span> <span class="keyword1">π</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_pi_def prime_sum_upto_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> π_upper_bound''<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def c_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>
                             <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_strict_left_mono<span class="main">)</span>
  
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_count <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divisor_count.prod_prime_factors'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr</span> <span class="main">=</span> <span class="skolem">Pr1</span> <span class="main">∪</span> <span class="skolem">Pr2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 real <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> Suc <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_nat_mult
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_less_le_imp_less bound1 bound2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_nonneg prod_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def add_divide_distrib powr_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>divisor_count <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now, Apostol explains that one can choose $f(n) := \ln n / (\ln\ln n) ^ 2$ to obtain
  the desired bound.
›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> divisor_count_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ε</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="numeral">8</span> <span class="main">/</span> ln <span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def c_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> divisor_count_bound_gen<span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def c_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> less_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we will examine the `worst case'. Since any prime factor of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> with multiplicity
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span> contributes a factor of $k + 1$, it is intuitively clear that $\sigma_0(n)$ is
  largest w.\,r.\,t.\ <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> if it is a product of small distinct primes.

  We show that indeed, if $n := x\#$ (where $x\#$ denotes the primorial), we have
  $\sigma_0(n) = 2^{\pi(x)}$, which, by the Prime Number Theorem, indeed
  exceeds $c \ln n / \ln\ln n$.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> divisor_count_primorial_gt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≡</span> primorial"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> divisor_count <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">θ</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def ln_primorial<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> θ_asymptotics ln_θ_asymp_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> asymp_equiv_imp_diff_smallo<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>
                <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.in_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>
                   <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">π</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_in_smallo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ asymp_equiv_imp_diff_smallo<span class="main"><span class="main">]</span></span> prime_number_theorem<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.small.cmult<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallo_imp_asymp_equiv<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">π</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span>
                         <span class="main">-</span><span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_eventually_neg_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">π</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> divisor_count <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="keyword1">π</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_less_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_count_primorial h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since $h(x)\longrightarrow\infty$, this gives us our infinitely many values of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>
  that exceed the bound.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> divisor_count_lower_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> primorial"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>filtermap <span class="skolem">h</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> divisor_count_primorial_gt<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_filtermap h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> divisor_count <span class="bound">n</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>filtermap <span class="skolem">h</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_frequently<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filtermap_bot_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> primorial_at_top
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="skolem">h</span> at_top <span class="main">≤</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_def h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_mono_filter<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A different formulation that is not quite as tedious to prove is this one:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> ln_divisor_count_primorial'_asymp_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> ln_over_ln_ln_primorial'_asymp_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_realpow mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_sym mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It follows that the maximal order of the divisor function is $\ln 2 \cdot \ln n /\ln \ln n$.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> limsup_divisor_count<span class="main">:</span>
  <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> ln <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"primorial'"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⟷</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">using</span></span> power_eq_1_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ln_divisor_count_primorial'_asymp_equiv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equivD_strong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_eq_1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">1</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="var">?h</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> ln <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span> <span class="main">∘</span> primorial'<span class="main">)</span> <span class="main">=</span> ereal <span class="main">(</span>ln <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lim_imp_Limsup tendsto_ereal<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="numeral">2</span> <span class="main">=</span> limsup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span>ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> primorial'<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_mono_primorial' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> limsup_subseq_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> ln <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> ln <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Limsup_le_iff
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">&gt;</span> ereal <span class="main">(</span>ln <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> ln <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">C</span> <span class="main">&lt;</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">/</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span> <span class="main">&lt;</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divisor_count_upper_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>divisor_count <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>divisor_count <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span>ln <span class="main">(</span>divisor_count <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">C'</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ C<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Mertens' Third Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we will show that
  \[\prod_{p\leq x} \left(1 - \frac{1}{p}\right) =
      \frac{C}{\ln x} + O\left(\frac{1}{\ln^2 x}\right)\]
  with explicit bounds for the factor in the `Big-O'. Here, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span> is the following constant:
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">third_mertens_const</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">third_mertens_const</span> <span class="main">=</span>
     exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span> meissel_mertens<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This constant is actually equal to $e^{-\gamma}$ where $\gamma$ is the Euler--Mascheroni
   constant, but showing this is quite a bit of work, which we shall not do here.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> third_mertens_const_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"third_mertens_const <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> third_mertens_const_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≡</span> third_mertens_const"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>   mertens_third_theorem_strong<span class="main">:</span>
            <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span>
                                <span class="numeral">10</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     mertens_third_theorem<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> suminf <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> C_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">B</span> <span class="main">-</span> meissel_mertens<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def a_def third_mertens_const_def C_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">Pr</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pr_def le_nat_iff le_floor_iff<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span> <span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">+</span> meissel_mertens<span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> exp_S<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span> <span class="skolem">x</span><span class="main">.</span> exp <span class="main">(</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def exp_sum fin<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pr_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> a_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ln_one_minus_pos_upper_bound<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inverse_power_summable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def of_nat_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_all_ge_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main">)</span>
       <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_nat_sequentially<span class="main"><span class="main">]</span></span> filterlim_floor_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">-</span> sum_upto <span class="skolem">a</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> telescope<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> telescope_sums'<span class="main">)</span> <span class="operator">real_asymp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> B_def sum_upto_altdef m_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹summable <span class="skolem">a</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> suminf_split_initial_segment<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> sum_upto <span class="skolem">a</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m_def sum_upto_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_le allI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_ignore_initial_segment<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> telescope <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_summable<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> telescope <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">-</span> sum_upto <span class="skolem">a</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">R</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">5</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> sum_upto <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> meissel_mertens<span class="main">)</span><span class="main">¦</span> <span class="main">≤</span>
             <span class="main">1</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq4 add_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> meissel_mertens<span class="main">¦</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mertens_second_theorem <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="skolem">a</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> B_def sum_upto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_le_suminf <span class="quoted"><span class="quoted">‹summable <span class="skolem">a</span>›</span></span> a_nonneg ballI<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">B</span> <span class="main">-</span> sum_upto <span class="skolem">a</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_upto <span class="skolem">a</span> <span class="skolem">x</span> <span class="main">=</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_upto_def prime_sum_upto_altdef1 a_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong allI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">S</span> <span class="skolem">x</span> <span class="main">-</span> prime_sum_upto <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def S_def Pr_def prime_sum_upto_def sum_subtractf sum_negf<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">¦</span><span class="numeral">5</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">R</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="numeral">5</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">..</span><span class="numeral">10</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">}</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span><span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">10</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> real_exp_bound_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span><span class="main">]</span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">10</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span><span class="main">-</span><span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exp_ge_add_one_self<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">5</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> le <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">10</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span>"</span></span><span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>exp <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">10</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>exp <span class="main">(</span><span class="skolem">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="free">C</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">*</span> <span class="main">¦</span>exp <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def exp_add C_eq exp_diff exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">C</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">10</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_S power2_eq_square mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">10</span>  <span class="main">*</span> <span class="free">C</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mertens_third_theorem_asymp_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> third_mertens_const <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> landau_o.big_small_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mertens_third_theorem<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">use</span> third_mertens_const_pos <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">real_asymp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now show an equivalent version where $\prod_{p\leq x} (1 - 1 / p)$ is replaced
  by $\prod_{i=1}^k (1 - 1 / p_i)$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> mertens_third_convert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>nth_prime <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primorial' <span class="free">n</span> <span class="main">=</span> primorial <span class="main">(</span>nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primorial'_conv_primorial<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="main">…</span><span class="main">)</span> <span class="main">=</span>
               primorial' <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> nth_prime <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> totient_primorial<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primorial'_conv_primorial<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> totient_primorial'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> mertens_third_theorem_asymp_equiv'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> nth_prime <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> third_mertens_const <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_real_sequentially<span class="main"><span class="main">]</span></span>
              filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nth_prime_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> nth_prime <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> real <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_refl_ev eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">subst</span> mertens_third_convert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> third_mertens_const <span class="main">/</span> ln <span class="main">(</span>real <span class="main">(</span>nth_prime <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mertens_third_theorem_asymp_equiv lim<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> third_mertens_const <span class="main">/</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_nth_prime_asymp_equiv<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> third_mertens_const <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> third_mertens_const_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounds on Euler's totient function›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly to the divisor function, we will show that $\varphi(n)$ has minimal order
  $C n / \ln\ln n$.

  The first part is to show the lower bound:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> totient_lower_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ε</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≡</span> third_mertens_const"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">include</span></span> prime_counting_notation
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span>prime_factors <span class="bound">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&gt;</span> ln <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lb1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> ln <span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lb2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>ln <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lb1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb1'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">10</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">1</span> <span class="main">+</span> log <span class="numeral">2</span> <span class="bound">n</span> <span class="main">≤</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">lb1</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> log <span class="numeral">2</span> <span class="skolem">n</span> <span class="main">≤</span> ln <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr</span> <span class="main">=</span> prime_factors <span class="skolem">n</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr1</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≤</span> ln <span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr2</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&gt;</span> ln <span class="skolem">n</span><span class="main">}</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">&lt;</span> real <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_less_272 <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> ln <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> ln <span class="main">(</span>ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> real <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_prod
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="bound">p</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_dvd_prod dvd_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_dvd_prod_subset2<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prime_factorization_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_realpow<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> f_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">≤</span> ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> ln <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> ln <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ln <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono' f_le<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> ln <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ln <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹ln <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono conjI diff_mono divide_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">lb2</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lb2_def <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> ln <span class="skolem">n</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_primes_le  <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat                                                <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> ln <span class="skolem">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">≥</span> inverse <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> prod_inversef <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">lb1</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lb1_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inverse_le_imp_le<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_pos <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb1</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr2</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono bound1 bound2 prod_nonneg ballI<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff lb1_def lb2_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr1</span> <span class="main">∪</span> <span class="skolem">Pr2</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Pr1</span> <span class="main">∪</span> <span class="skolem">Pr2</span> <span class="main">=</span> <span class="skolem">Pr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Pr</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> totient <span class="skolem">n</span> <span class="main">/</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> totient_formula2<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>totient <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> real <span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">lb1</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lb1_def lb2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">lb1</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">10</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lb1_def C_def <span class="keyword1"><span class="command">using</span></span> mertens_third_theorem_strong
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main">)</span> <span class="operator">real_asymp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">lb1'</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lb1'_def lb2_def C_def <span class="keyword1"><span class="command">using</span></span> third_mertens_const_pos <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">lb1'</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb1'</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">lb1</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lb1'_def <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb1'</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">lb1</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">lb2</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lb2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> totient <span class="skolem">n</span> <span class="main">/</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"totient <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">/</span> <span class="main">(</span>ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we examine the `worst case' of $\varphi(n)$ where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> is the primorial of $x$.
  In this case, we have $\varphi(n) &lt; c n / \ln\ln n$ for any $c &gt; C$ for all sufficiently
  large $n$.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> totient_primorial_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ε</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≡</span> third_mertens_const"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≡</span> primorial"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> totient <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def third_mertens_const_pos<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span><span class="keyword1">θ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_primorial h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> ln_θ_asymp_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_imp_diff_smallo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fun_eq_iff add_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">-</span> 
           <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> C_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_smallo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ landau_o.big_small_trans<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">OF</span></span> mertens_third_theorem<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span> C_def third_mertens_const_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_asymp_equiv<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>
                          <span class="main">⟷</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_eventually_pos_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ε</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span>
                      <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> real <span class="bound">p</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def primorial_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_pos <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> totient <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim primorial_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> h_def totient_primorial
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It follows that infinitely many values of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> exceed $c n / \ln (\ln n)$ when <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> is chosen
  larger than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> totient_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≡</span> third_mertens_const"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> primorial"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>filtermap <span class="skolem">h</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> totient_primorial_less<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_filtermap C_def h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>filtermap <span class="skolem">h</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_frequently<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filtermap_bot_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> primorial_at_top
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="skolem">h</span> at_top <span class="main">≤</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_def h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_mono_filter<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Again, the following alternative formulation is somewhat nicer to prove:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> totient_primorial'_asymp_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> third_mertens_const <span class="main">*</span> primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted">third_mertens_const</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> primorial' <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> nth_prime <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> totient_primorial'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> primorial' <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="var">?C</span> <span class="main">/</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> mertens_third_theorem_asymp_equiv'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span> totient_primorial'_asymp_equiv'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
      <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> third_mertens_const <span class="main">*</span> primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted">third_mertens_const</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> third_mertens_const <span class="main">*</span> primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> totient_primorial'_asymp_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> third_mertens_const <span class="main">*</span> primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> asymp_equiv_symI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_ln_primorial'_asymp_equiv<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  All in all, $\varphi(n)$ has minimal order $cn / \ln\ln n$:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prime_number_theorem<span class="main">)</span>
  liminf_totient<span class="main">:</span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> third_mertens_const"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> ereal <span class="var">?c</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?c</span> <span class="main">*</span> primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> totient_primorial'_asymp_equiv'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equivD_strong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?c</span> <span class="main">*</span> primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span><span class="main">)</span>
             <span class="main">⇢</span> <span class="main">1</span> <span class="main">*</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> totient <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>primorial' <span class="bound">k</span> <span class="main">/</span> ln <span class="main">(</span>ln <span class="main">(</span>primorial' <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> third_mertens_const_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∘</span> primorial'<span class="main">)</span> <span class="main">=</span> ereal <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lim_imp_Liminf tendsto_ereal<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> liminf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span>totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> primorial'<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_mono_primorial' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> liminf_subseq_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> le_Liminf_iff
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">&lt;</span> ereal <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> <span class="var">?c</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">C</span> <span class="main">&gt;</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">C</span> <span class="main">/</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> third_mertens_const_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> totient_lower_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"totient <span class="skolem">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> third_mertens_const_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ε_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span>totient <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">C'</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">unbundle</span></span> no_prime_counting_notation
<span class="comment1">(*&gt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>