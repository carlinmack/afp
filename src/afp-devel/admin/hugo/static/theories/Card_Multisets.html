<div id="Card_Multisets">
<div class="head">
<h1>Theory Card_Multisets</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of Multisets›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Card_Multisets
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Multiset Theory›</span></span>

<span class="keyword1" id="Card_Multisets-mset_set_set_mset_subseteq"><span class="command">lemma</span></span> mset_set_set_mset_subseteq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span> <span class="main">⊆#</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">M</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>set_mset <span class="main">(</span><span class="skolem">M</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span>set_mset <span class="skolem">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this add.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> subset_mset.order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this add.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span> <span class="main">+</span> mset_set <span class="main">(</span>set_mset <span class="skolem">M</span><span class="main">)</span> <span class="main">⊆#</span> <span class="skolem">M</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_subset_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Card_Multisets-size_mset_set_eq_card"><span class="command">lemma</span></span> size_mset_set_eq_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Card_Multisets-card_set_mset_leq"><span class="command">lemma</span></span> card_set_mset_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_le_m1<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemma to Enumerate Sets of Multisets›</span></span>

<span class="keyword1" id="Card_Multisets-set_of_multisets_eq"><span class="command">lemma</span></span> set_of_multisets_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="free">k</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="free">k</span><span class="main">}</span> <span class="main">∪</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="free">k</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="free">k</span><span class="main">}</span> <span class="main">∪</span>
    <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="free">k</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈#</span> <span class="bound">M</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="free">k</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈#</span> <span class="bound">M</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="var">?T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">k</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈#</span> <span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">⊆</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derivation of Suitable Induction Rule›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"finite <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟹</span> <span class="free">R</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">{}</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"finite <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟹</span> <span class="free">R</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Card_Multisets-R_eq_finite"><span class="command">lemma</span></span> R_eq_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"R <span class="free">A</span> <span class="free">k</span> <span class="main">⟷</span> finite <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"R <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"R <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> insert
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> R.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite.insertI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Suc
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R.simps Zero_neq_Suc diff_Suc_1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Card_Multisets-finite_set_and_nat_induct"><span class="command">lemma</span></span> finite_set_and_nat_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> zero empty step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">P</span> <span class="main">{}</span> <span class="bound">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="bound">A</span><span class="main">)</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="bound">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> R_eq_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finiteness of Sets of Multisets›</span></span>

<span class="keyword1" id="Card_Multisets-finite_multisets"><span class="command">lemma</span></span> finite_multisets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_set_and_nat_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">A</span> <span class="skolem">k</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> set_of_multisets_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of Multisets›</span></span>

<span class="keyword1" id="Card_Multisets-card_multisets"><span class="command">lemma</span></span> card_multisets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_set_and_nat_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>zero <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> card <span class="skolem">A</span> <span class="main">+</span> <span class="main">0</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>empty <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="main">{}</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{}</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binomial_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">A</span> <span class="skolem">k</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="skolem">x</span> <span class="skolem">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyps1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?S<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> card <span class="skolem">A</span> <span class="main">+</span> Suc <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> Suc <span class="skolem">k</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyps2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> finite_sets<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?S<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">`</span> <span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_multisets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span><span class="main">)</span> <span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> insert <span class="skolem">x</span> <span class="skolem">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> Suc <span class="skolem">k</span><span class="main">}</span> <span class="main">=</span>
    card <span class="main">(</span><span class="var">?S<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">`</span> <span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_of_multisets_eq <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="var">?S<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span><span class="main">)</span> <span class="main">`</span> <span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_sets <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="var">?S<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> card <span class="var">?S<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="skolem">A</span> <span class="main">+</span> Suc <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hyps1 hyps2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span> Suc <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> Suc <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Card_Multisets-card_too_small_multisets_covering_set"><span class="command">lemma</span></span> card_too_small_multisets_covering_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&lt;</span> card <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_set_mset_leq Collect_empty_eq leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Card_Multisets-card_multisets_covering_set"><span class="command">lemma</span></span> card_multisets_covering_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> card <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">+</span> mset_set <span class="free">A</span><span class="main">)</span> <span class="main">`</span>
    <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> card <span class="free">A</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">`</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="var">?f</span> <span class="main">`</span> <span class="var">?T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">-</span> mset_set <span class="free">A</span> <span class="main">+</span> mset_set <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_set_set_mset_subseteq subset_mset.diff_add<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">-</span> mset_set <span class="free">A</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_set_set_mset_subseteq size_Diff_submset size_mset_set_eq_card in_diffD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≤</span> <span class="free">k</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="var">?T</span> <span class="main">⊆</span> <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size_mset_set_eq_card<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S</span> <span class="main">=</span> card <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> card <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> card <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card_multisets<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> card <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≤</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>